{"ast":null,"code":"import TaskListPostownersModel from \"../../models/BPM/TaskListPostownersModel\";\nimport { GetDashBoardModel } from \"../../models\";\nimport ApiServiceBpm from \"../ApiServiceBpm\";\nimport * as url from \"../../helpers/url_helper\";\nimport * as opt from \"../../helpers/options_helper\";\nimport qs from \"qs\";\nimport { result } from \"lodash\";\nexport default class Services extends ApiServiceBpm {\n  /* ------------------------------------------------------------------------------------------------------------------ */\n\n  /*                                 retorna las actividades para la bandeja de entrada                                 */\n\n  /* ------------------------------------------------------------------------------------------------------------------ */\n  //creamos un nueva instancia de proceso en BPM...    \n  async createNewInstance() {\n    try {\n      var number = await this.startProcess();\n\n      if (number !== null && number !== undefined && number > 0) {\n        var result = await this.getTasksByPrcess(number);\n\n        if (result !== undefined) {}\n      }\n    } catch (err) {\n      console.error(err);\n    }\n\n    return undefined;\n    const apiServiceBPM = new BpmServices();\n    apiServiceBPM.startProcess().then(number => {\n      if (number !== null && number !== undefined && number > 0) {\n        //buscamos la tarea que crea el nuevo proceso\n        apiServiceBPM.getTasksByPrcess(number).then(result => {\n          if (result !== undefined) {\n            //Inicializamos la nueva tarea en BPM   \n            apiServiceBPM.startedStatusTask(result.taskId).then(iniresult => {\n              if (iniresult !== undefined) {\n                //datos que le enviamos a la pantalla de busqueda y descarte\n                history.push({\n                  //pathname: '/creditocomercial/busquedadescarte',\n                  pathname: '/creditocomercial/presolicitud',\n                  data: {\n                    customerId: \"\",\n                    transactionId: \"\",\n                    processId: opt.PROCESS_BUSQUEDADESCARTE.toString(),\n                    activityId: opt.ACT_NONE.toString(),\n                    instanceId: result.instanceId,\n                    taskId: result.taskId,\n                    taskStatus: result.status\n                  }\n                });\n              }\n            });\n          }\n        });\n      }\n    }).catch(error => {\n      //Mostrar Mensaje Proceso no instanciado\n      console.error('api error: ', error);\n    });\n  } //retorna la bandeja de entrada\n\n\n  async getDashBoard(params) {\n    var result = await this.get(url.URL_BPM_DASHBOARD);\n    return GetDashBoardModel.fromJson(result);\n  } //Cheque e Inicializa la tarea\n\n\n  async checkAndStartTask(locationData) {\n    try {\n      console.log('checkAndStartTask', locationData);\n      await this.startedStatusTask(locationData.taskId);\n      return true; //chequear si la tarea no ha sido iniciada\n\n      /*if(locationData.taskStatus === \"Ready\" || locationData.taskStatus === \"Listo\"){        \r\n        //Iniciamos la nueva tarea en BPM   \r\n        await this.startedStatusTask(locationData.taskId)\r\n        return true;\r\n      }\r\n      else{\r\n        return true;\r\n      }      */\n    } catch (err) {\n      console.error(err);\n    }\n\n    return false;\n  } //retorna las tareas de un proceso especifico\n\n\n  async getTasksByPrcess(instanceId) {\n    var result = await this.get(url.URL_BPM_DASHBOARD);\n    result = GetDashBoardModel.fromJson(result);\n    return result.results.filter(e => e.instanceId === instanceId)[0];\n  } //crea e inicia una nueva instancia de Proceso y actividad\n\n\n  async startProcess() {\n    //Estructura de la data que se le debe pasar\n    var data = {\n      \"containerId\": url.WORD_BPM_CONTAINERID,\n      \"processId\": url.WORD_BPM_PROCESSID,\n      \"parametros\": {\n        \"values\": {\n          \"info\": \"\",\n          \"processId\": opt.PROCESS_BUSQUEDADESCARTE.toString(),\n          \"activityId\": \"0\",\n          \"transactionId\": \"\",\n          \"customerId\": \"\",\n          \"applicationNumber\": \"\",\n          \"procedureNumber\": \"\",\n          \"requestId\": \"\",\n          \"facilityId\": \"\",\n          \"dambientalparalelo\": \"\",\n          \"decision\": \"\",\n          \"id\": \"\",\n          \"monto\": 0,\n          \"status\": \"\",\n          \"decicionforma\": \"\",\n          \"cargo\": \"cargo\",\n          \"statuscredito\": \"\",\n          \"statusadm\": \"\",\n          \"statusformali\": \"\",\n          \"tiposolicitud\": \"\",\n          \"origensolicitud\": \"\",\n          \"dcreditoparalelo\": \"\",\n          \"regresar\": \"\",\n          \"rol\": \"\"\n        }\n      }\n    };\n    var result = await this.post(url.URL_BPM_STARTPROCESS, data);\n    /*\r\n    {\r\n    \"body\": {\r\n        \"processInstanceId\": \"8124\",\r\n        \"containers\": null,\r\n        \"response\": null\r\n    },\r\n    \"status\": \"CREATED\",\r\n    \"businessStatus\": \"\",\r\n    \"timeResponse\": \"2021-12-06 13:41:57\",\r\n    \"message\": null,\r\n    \"path\": \"/api-jbpm-0.0.1-SNAPSHOT/soaint-toolbox-eis/bpm-api/v0/processes/startProcess\",\r\n    \"transactionState\": null\r\n    }\r\n    */\n\n    return result.body.processInstanceId;\n  }\n\n  async authentication(data) {\n    var result = await this.post(url.URL_BPM_LOGIN, data);\n    return result.status; //OK\n  }\n\n  async startedStatusTask(taskId) {\n    try {\n      var data = {\n        \"containerId\": url.WORD_BPM_CONTAINERID,\n        \"taskId\": taskId,\n        \"taskStatus\": url.WORD_BPM_STARTED\n      };\n      var result = await this.put(url.URL_BPM_STATUSTASK, data);\n\n      if (result.status === \"OK\") {\n        return result;\n      }\n    } catch (err) {\n      console.error(\"api startedStatusTask:\", err);\n    }\n\n    return undefined;\n  }\n\n  async completedStatusTask(taskId, values) {\n    try {\n      /* \"values\":{\r\n          \"decision\":\"si\"  \r\n      } */\n      var data = {\n        \"containerId\": url.WORD_BPM_CONTAINERID,\n        \"taskId\": taskId,\n        \"taskStatus\": url.WORD_BPM_COMPLETED,\n        \"parametros\": {\n          \"values\": values\n        }\n      };\n      var result = await this.put(url.URL_BPM_STATUSTASK, data);\n\n      if (result.status === \"OK\") {\n        return result;\n      }\n    } catch (err) {\n      console.error(\"api completedStatusTask:\", err);\n    }\n\n    return undefined;\n  }\n\n  async abortProcess(instanceId) {\n    try {\n      console.log(\"abortProcess\", instanceId); //Estructura de la data que se le debe pasar\n\n      var data = {\n        \"containerId\": url.WORD_BPM_CONTAINERID,\n        \"processInstanceId\": instanceId\n      };\n      console.log(\"data\", data);\n      var result = await this.del(url.URL_BPM_ABORTPROCESS, data);\n\n      if (result.status === \"OK\") {\n        return result;\n      }\n    } catch (err) {\n      console.error(\"api abortProcess:\", err);\n    }\n\n    return undefined;\n  }\n\n  async updatevariables(instanceId, values) {\n    try {\n      /* \"values\":{\r\n          \"decision\":\"si\"  \r\n      } */\n      var data = {\n        \"containerId\": url.WORD_BPM_CONTAINERID,\n        \"processInstanceId\": instanceId,\n        \"parametros\": {\n          \"values\": values\n        }\n      };\n      var result = await this.post(url.URL_BPM_UPDATEVAR, data);\n\n      if (result.status === \"OK\") {\n        return result;\n      }\n    } catch (err) {\n      console.error(\"api completedStatusTask:\", err);\n    }\n\n    return undefined;\n  } //Retorna la imagen relacionada a un proceso\n\n\n  async wacthprocess(processInstanceId) {\n    try {\n      var params = {\n        containerId: url.WORD_BPM_CONTAINERID,\n        processInstanceId: processInstanceId\n      };\n      var data = qs.stringify(params);\n      var result = await this.get(url.URL_BPM_WATCHPROCESS + \"?\" + data);\n      console.log(\"wacthprocess\", result);\n      return result.body.response;\n    } catch (err) {\n      console.error(err);\n    }\n\n    return undefined;\n  }\n\n}","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/services/BpmServices/Services.js"],"names":["TaskListPostownersModel","GetDashBoardModel","ApiServiceBpm","url","opt","qs","result","Services","createNewInstance","number","startProcess","undefined","getTasksByPrcess","err","console","error","apiServiceBPM","BpmServices","then","startedStatusTask","taskId","iniresult","history","push","pathname","data","customerId","transactionId","processId","PROCESS_BUSQUEDADESCARTE","toString","activityId","ACT_NONE","instanceId","taskStatus","status","catch","getDashBoard","params","get","URL_BPM_DASHBOARD","fromJson","checkAndStartTask","locationData","log","results","filter","e","WORD_BPM_CONTAINERID","WORD_BPM_PROCESSID","post","URL_BPM_STARTPROCESS","body","processInstanceId","authentication","URL_BPM_LOGIN","WORD_BPM_STARTED","put","URL_BPM_STATUSTASK","completedStatusTask","values","WORD_BPM_COMPLETED","abortProcess","del","URL_BPM_ABORTPROCESS","updatevariables","URL_BPM_UPDATEVAR","wacthprocess","containerId","stringify","URL_BPM_WATCHPROCESS","response"],"mappings":"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","sourcesContent":["\r\nimport TaskListPostownersModel from \"../../models/BPM/TaskListPostownersModel\";\r\nimport { GetDashBoardModel } from \"../../models\";\r\nimport ApiServiceBpm from \"../ApiServiceBpm\";\r\nimport * as url from \"../../helpers/url_helper\"\r\nimport * as opt from \"../../helpers/options_helper\"\r\nimport qs from \"qs\";\r\nimport { result } from \"lodash\";\r\n\r\nexport default class Services extends ApiServiceBpm {\r\n  /* ------------------------------------------------------------------------------------------------------------------ */\r\n  /*                                 retorna las actividades para la bandeja de entrada                                 */\r\n  /* ------------------------------------------------------------------------------------------------------------------ */\r\n  \r\n  \r\n    //creamos un nueva instancia de proceso en BPM...    \r\n  async createNewInstance(){  \r\n    try{\r\n      var number = await this.startProcess();\r\n      if(number!== null && number !==undefined && number > 0){\r\n        var result = await this.getTasksByPrcess(number);\r\n        if(result !== undefined){\r\n          \r\n        }\r\n      }\r\n    }\r\n    catch(err){\r\n      console.error(err);\r\n    }\r\n    return undefined;\r\n    \r\n    const apiServiceBPM = new BpmServices();\r\n    apiServiceBPM.startProcess()\r\n      .then((number) => {        \r\n        \r\n        if(number!== null && number !==undefined && number > 0){     \r\n          //buscamos la tarea que crea el nuevo proceso\r\n          apiServiceBPM.getTasksByPrcess(number)\r\n          .then((result) => {                                \r\n            if(result !== undefined){\r\n                                         \r\n              //Inicializamos la nueva tarea en BPM   \r\n              apiServiceBPM.startedStatusTask(result.taskId)\r\n              .then((iniresult) => {                       \r\n                if(iniresult!==undefined){\r\n                   //datos que le enviamos a la pantalla de busqueda y descarte\r\n                  history.push({                    \r\n                    //pathname: '/creditocomercial/busquedadescarte',\r\n                    pathname: '/creditocomercial/presolicitud',\r\n                    data: {customerId:\"\",transactionId:\"\",processId:opt.PROCESS_BUSQUEDADESCARTE.toString(),activityId:opt.ACT_NONE.toString(),instanceId:result.instanceId,taskId:result.taskId,taskStatus:result.status},\r\n                  });     \r\n                }                \r\n              })\r\n            }\r\n          })          \r\n        }\r\n    })\r\n    .catch((error) => {            \r\n\r\n      //Mostrar Mensaje Proceso no instanciado\r\n      console.error('api error: ', error);\r\n    });\r\n  }\r\n  \r\n  //retorna la bandeja de entrada\r\n  async getDashBoard(params) {\r\n    var result = await this.get(url.URL_BPM_DASHBOARD);\r\n    return GetDashBoardModel.fromJson(result);\r\n  }\r\n\r\n  //Cheque e Inicializa la tarea\r\n  async checkAndStartTask(locationData) {\r\n    try {\r\n      console.log('checkAndStartTask',locationData);\r\n      \r\n      await this.startedStatusTask(locationData.taskId)\r\n        return true;\r\n      //chequear si la tarea no ha sido iniciada\r\n      /*if(locationData.taskStatus === \"Ready\" || locationData.taskStatus === \"Listo\"){        \r\n        //Iniciamos la nueva tarea en BPM   \r\n        await this.startedStatusTask(locationData.taskId)\r\n        return true;\r\n      }\r\n      else{\r\n        return true;\r\n      }      */\r\n    }\r\n    catch (err) {console.error(err)}\r\n    return false;\r\n  }\r\n\r\n  //retorna las tareas de un proceso especifico\r\n  async getTasksByPrcess(instanceId) {\r\n\r\n    var result = await this.get(url.URL_BPM_DASHBOARD);\r\n\r\n    result = GetDashBoardModel.fromJson(result);\r\n\r\n    return result.results.filter((e) => e.instanceId === instanceId)[0];\r\n  }\r\n\r\n  //crea e inicia una nueva instancia de Proceso y actividad\r\n  async startProcess() {\r\n    //Estructura de la data que se le debe pasar\r\n    var data = {\r\n      \"containerId\": url.WORD_BPM_CONTAINERID,\r\n      \"processId\": url.WORD_BPM_PROCESSID,\r\n      \"parametros\": {\r\n        \"values\": {\r\n          \"info\":\"\", \r\n          \"processId\":opt.PROCESS_BUSQUEDADESCARTE.toString(),\r\n          \"activityId\":\"0\",                    \r\n          \"transactionId\": \"\",\r\n          \"customerId\": \"\",\r\n          \"applicationNumber\": \"\",\r\n          \"procedureNumber\": \"\",\r\n          \"requestId\":\"\",\r\n          \"facilityId\":\"\",\r\n          \"dambientalparalelo\":\"\",\r\n          \"decision\":\"\",\r\n          \"id\":\"\",\r\n          \"monto\":0,\r\n          \"status\":\"\",\r\n          \"decicionforma\":\"\",\r\n          \"cargo\":\"cargo\",\r\n          \"statuscredito\":\"\",\r\n          \"statusadm\":\"\",\r\n          \"statusformali\":\"\",\r\n          \"tiposolicitud\":\"\",\r\n          \"origensolicitud\":\"\",\r\n          \"dcreditoparalelo\":\"\",\r\n          \"regresar\":\"\",\r\n          \"rol\":\"\"\r\n        }\r\n      }\r\n    }\r\n\r\n    var result = await this.post(url.URL_BPM_STARTPROCESS, data);\r\n    /*\r\n    {\r\n    \"body\": {\r\n        \"processInstanceId\": \"8124\",\r\n        \"containers\": null,\r\n        \"response\": null\r\n    },\r\n    \"status\": \"CREATED\",\r\n    \"businessStatus\": \"\",\r\n    \"timeResponse\": \"2021-12-06 13:41:57\",\r\n    \"message\": null,\r\n    \"path\": \"/api-jbpm-0.0.1-SNAPSHOT/soaint-toolbox-eis/bpm-api/v0/processes/startProcess\",\r\n    \"transactionState\": null\r\n    }\r\n    */\r\n\r\n    return result.body.processInstanceId;\r\n  }\r\n\r\n  async authentication(data) {\r\n    var result = await this.post(url.URL_BPM_LOGIN, data);\r\n    return result.status; //OK\r\n  }\r\n\r\n  async startedStatusTask(taskId) {\r\n    try {\r\n      var data = {\r\n        \"containerId\": url.WORD_BPM_CONTAINERID,\r\n        \"taskId\": taskId,\r\n        \"taskStatus\": url.WORD_BPM_STARTED,\r\n      }\r\n\r\n      var result = await this.put(url.URL_BPM_STATUSTASK, data);\r\n\r\n      if (result.status === \"OK\") {\r\n        return result;\r\n      }\r\n\r\n    }\r\n    catch (err) {\r\n      console.error(\"api startedStatusTask:\", err)\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  async completedStatusTask(taskId, values) {\r\n    try {\r\n      /* \"values\":{\r\n          \"decision\":\"si\"  \r\n      } */\r\n      var data = {\r\n        \"containerId\": url.WORD_BPM_CONTAINERID,\r\n        \"taskId\": taskId,\r\n        \"taskStatus\": url.WORD_BPM_COMPLETED,\r\n        \"parametros\": {\r\n          \"values\": values,\r\n        }\r\n      }\r\n      var result = await this.put(url.URL_BPM_STATUSTASK, data);\r\n      if (result.status === \"OK\") {\r\n        return result;\r\n      }\r\n\r\n    }\r\n    catch (err) {\r\n      console.error(\"api completedStatusTask:\", err)\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  async abortProcess(instanceId) {\r\n\r\n    try{\r\n      console.log(\"abortProcess\",instanceId);\r\n      //Estructura de la data que se le debe pasar\r\n    var data ={\r\n      \"containerId\":url.WORD_BPM_CONTAINERID,\r\n      \"processInstanceId\": instanceId,\r\n      } \r\n      console.log(\"data\",data);\r\n    var result = await this.del(url.URL_BPM_ABORTPROCESS,data);\r\n    \r\n      if(result.status === \"OK\"){\r\n        return result;\r\n      }\r\n\r\n    } \r\n    catch(err){\r\n      console.error(\"api abortProcess:\",err)\r\n    }   \r\n\r\n    return undefined;\r\n  }\r\n\r\n  async updatevariables(instanceId, values) {\r\n    try {\r\n      /* \"values\":{\r\n          \"decision\":\"si\"  \r\n      } */\r\n      var data = {\r\n        \"containerId\": url.WORD_BPM_CONTAINERID,\r\n        \"processInstanceId\": instanceId,\r\n        \"parametros\": {\r\n          \"values\": values,\r\n        }\r\n      }\r\n      var result = await this.post(url.URL_BPM_UPDATEVAR, data);\r\n      if (result.status === \"OK\") {\r\n        return result;\r\n      }\r\n\r\n    }\r\n    catch (err) {\r\n      console.error(\"api completedStatusTask:\", err)\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  //Retorna la imagen relacionada a un proceso\r\n  async wacthprocess(processInstanceId) {\r\n    try{\r\n\r\n      var params = { containerId: url.WORD_BPM_CONTAINERID, processInstanceId: processInstanceId}\r\n      var data = qs.stringify(params);\r\n          \r\n      var result = await this.get(url.URL_BPM_WATCHPROCESS + \"?\" + data);\r\n\r\n      console.log(\"wacthprocess\",result);\r\n\r\n      return result.body.response;\r\n    }\r\n    catch(err){console.error(err);}\r\n    return undefined;\r\n  }\r\n  \r\n}\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{withTranslation}from\"react-i18next\";import{Row,Col,Button,Label,Input,Modal,Card,CardBody,CardFooter}from\"reactstrap\";import{AvForm,AvField}from\"availity-reactstrap-validation\";import{translationHelpers}from\"../../../../helpers\";import{BackendServices,BpmServices}from\"../../../../services\";import{useHistory,useLocation}from\"react-router-dom\";import*as url from\"../../../../helpers/url_helper\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LevelAutonomy=function LevelAutonomy(props){var _translationHelpers=translationHelpers('translation','common'),_translationHelpers2=_slicedToArray(_translationHelpers,2),t=_translationHelpers2[0],c=_translationHelpers2[1];var _useState=useState(0),_useState2=_slicedToArray(_useState,2),levelAutonomy=_useState2[0],setLevelAutonomy=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),levelAutonomyPosition=_useState4[0],setLevelAutonomyPosition=_useState4[1];var bpmServices=new BpmServices();var backendServices=new BackendServices();var location=useLocation();var history=useHistory();var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),locationData=_useState6[0],setLocationData=_useState6[1];useEffect(function(){var dataSession;if(location.data!==null&&location.data!==undefined){if(location.data.transactionId===undefined||location.data.transactionId.length<=0){//location.data.transactionId = 0;\n//checkAndCreateProcedure(location.data);\nhistory.push(url.URL_DASHBOARD);}else{sessionStorage.setItem('locationData',JSON.stringify(location.data));setLocationData(location.data);dataSession=location.data;}}else{//chequeamos si tenemos guardado en session\nvar result=sessionStorage.getItem('locationData');if(result!==undefined&&result!==null){result=JSON.parse(result);setLocationData(result);dataSession=result;}}getFacilityHistory({dataSession:dataSession});},[]);useEffect(function(){var _props$levelAutonomy;var amount=levelAutonomy+((_props$levelAutonomy=props.levelAutonomy)!==null&&_props$levelAutonomy!==void 0?_props$levelAutonomy:0);amount>0&&bpmServices.saveAutonomy(amount).then(function(resp){var _resp$body,_resp$body$result$dmn,_resp$body$result$dmn2;setLevelAutonomyPosition(resp===null||resp===void 0?void 0:(_resp$body=resp.body)===null||_resp$body===void 0?void 0:(_resp$body$result$dmn=_resp$body.result['dmn-evaluation-result']['dmn-context'])===null||_resp$body$result$dmn===void 0?void 0:(_resp$body$result$dmn2=_resp$body$result$dmn.autonomia)===null||_resp$body$result$dmn2===void 0?void 0:_resp$body$result$dmn2.cargo);}).catch(function(err){console.log(err);});},[levelAutonomy,props.levelAutonomy]);function getFacilityHistory(_x){return _getFacilityHistory.apply(this,arguments);}function _getFacilityHistory(){_getFacilityHistory=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref){var _dataSession$transact;var _ref$dataSession,dataSession;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_ref$dataSession=_ref.dataSession,dataSession=_ref$dataSession===void 0?locationData:_ref$dataSession;_context3.next=3;return backendServices.consultGeneralDataPropCred((_dataSession$transact=dataSession===null||dataSession===void 0?void 0:dataSession.transactionId)!==null&&_dataSession$transact!==void 0?_dataSession$transact:0).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(propuesta){var _propuesta$;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:backendServices.consultarFacilidadesT24((_propuesta$=propuesta[0])===null||_propuesta$===void 0?void 0:_propuesta$.requestId).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(resp){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(resp.length>0&&resp!=undefined){setLevelAutonomy(function(levelAutonomy){return levelAutonomy+ +resp.reduce(function(acc,crr){return acc+crr.amount;},0);});}case 1:case\"end\":return _context.stop();}}},_callee);}));return function(_x3){return _ref3.apply(this,arguments);};}());backendServices.consultarFacilidades(propuesta[0].requestId).then(function(resp){var _resp;resp=(_resp=resp)===null||_resp===void 0?void 0:_resp.filter(function(data){return data.debtor!=\"  \";});if(resp.length>0){setLevelAutonomy(function(levelAutonomy){return levelAutonomy+ +resp.reduce(function(acc,crr){return acc+crr.amount;},0);});}});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}());case 3:case\"end\":return _context3.stop();}}},_callee3);}));return _getFacilityHistory.apply(this,arguments);}return/*#__PURE__*/_jsxs(\"h5\",{className:\"card-title mt-2\",style:{textAlign:\"right\",fontSize:'21px!important'},children:[t(\"Level of Autonomy\"),\": \",levelAutonomyPosition]});};export default withTranslation()(LevelAutonomy);","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/CommercialCredit/5_PropuestaCredito/Secciones/LevelAutonomy.js"],"names":["React","useEffect","useState","withTranslation","Row","Col","Button","Label","Input","Modal","Card","CardBody","CardFooter","AvForm","AvField","translationHelpers","BackendServices","BpmServices","useHistory","useLocation","url","LevelAutonomy","props","t","c","levelAutonomy","setLevelAutonomy","levelAutonomyPosition","setLevelAutonomyPosition","bpmServices","backendServices","location","history","locationData","setLocationData","dataSession","data","undefined","transactionId","length","push","URL_DASHBOARD","sessionStorage","setItem","JSON","stringify","result","getItem","parse","getFacilityHistory","amount","saveAutonomy","then","resp","body","autonomia","cargo","catch","err","console","log","consultGeneralDataPropCred","propuesta","consultarFacilidadesT24","requestId","reduce","acc","crr","consultarFacilidades","filter","debtor","textAlign","fontSize"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\"\r\nimport { withTranslation } from \"react-i18next\"\r\nimport PropTypes from 'prop-types';\r\n\r\nimport {\r\n  Row,\r\n  Col,\r\n  Button,\r\n  Label,\r\n  Input,\r\n  Modal,\r\n  Card,\r\n  CardBody,\r\n  CardFooter,\r\n} from \"reactstrap\"\r\n\r\nimport { AvForm, AvField } from \"availity-reactstrap-validation\"\r\nimport { translationHelpers } from \"../../../../helpers\";\r\nimport { BackendServices, BpmServices } from \"../../../../services\";\r\nimport { useHistory, useLocation } from \"react-router-dom\";\r\nimport * as url from \"../../../../helpers/url_helper\"\r\n\r\nconst LevelAutonomy = (props) => {\r\n  const [t, c] = translationHelpers('translation', 'common');\r\n  const [levelAutonomy, setLevelAutonomy] = useState(0);\r\n  const [levelAutonomyPosition, setLevelAutonomyPosition] = useState('');\r\n  const bpmServices = new BpmServices();\r\n  const backendServices = new BackendServices();\r\n\r\n  const location = useLocation();\r\n  const history = useHistory();\r\n  const [locationData, setLocationData] = useState(null);\r\n\r\n  useEffect(() => {\r\n\r\n    let dataSession;\r\n    if (location.data !== null && location.data !== undefined) {\r\n      if (location.data.transactionId === undefined || location.data.transactionId.length <= 0) {\r\n        //location.data.transactionId = 0;\r\n        //checkAndCreateProcedure(location.data);\r\n        history.push(url.URL_DASHBOARD);\r\n      }\r\n      else {\r\n        sessionStorage.setItem('locationData', JSON.stringify(location.data));\r\n        setLocationData(location.data);\r\n        dataSession = location.data;\r\n      }\r\n    }\r\n    else {\r\n      //chequeamos si tenemos guardado en session\r\n      var result = sessionStorage.getItem('locationData');\r\n      if (result !== undefined && result !== null) {\r\n        result = JSON.parse(result);\r\n        setLocationData(result);\r\n        dataSession = result\r\n      }\r\n    }\r\n\r\n    getFacilityHistory({ dataSession })\r\n\r\n  }, []);\r\n\r\n\r\n  useEffect(() => {\r\n    let amount = levelAutonomy + (props.levelAutonomy ?? 0)\r\n    amount > 0 && bpmServices.saveAutonomy(amount).then(resp => {\r\n      setLevelAutonomyPosition(resp?.body?.result['dmn-evaluation-result']['dmn-context']?.autonomia?.cargo)\r\n    }).catch(err => {\r\n      console.log(err)\r\n    });\r\n  }, [levelAutonomy, props.levelAutonomy])\r\n\r\n  async function getFacilityHistory({ dataSession = locationData }) {\r\n    await backendServices.consultGeneralDataPropCred(dataSession?.transactionId ?? 0).then(async propuesta => {\r\n      backendServices.consultarFacilidadesT24(propuesta[0]?.requestId).then(async resp => {\r\n        if (resp.length > 0 && resp != undefined) {\r\n          setLevelAutonomy(levelAutonomy => levelAutonomy + +resp.reduce((acc, crr) => acc + crr.amount, 0))\r\n        }\r\n      })\r\n      backendServices.consultarFacilidades(propuesta[0].requestId).then(resp => {\r\n        resp = resp?.filter(data => data.debtor != \"  \");\r\n        if (resp.length > 0) {\r\n          setLevelAutonomy(levelAutonomy => levelAutonomy + +resp.reduce((acc, crr) => acc + crr.amount, 0))\r\n        }\r\n      });\r\n    })\r\n  }\r\n\r\n  return (\r\n    <h5 className=\"card-title mt-2\" style={{ textAlign: \"right\", fontSize: '21px!important' }}>{t(\"Level of Autonomy\")}: {levelAutonomyPosition}</h5>\r\n  );\r\n};\r\n\r\nexport default (withTranslation()(LevelAutonomy));\r\n"]},"metadata":{},"sourceType":"module"}
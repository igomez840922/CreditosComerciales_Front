{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import{useLocation,useHistory,Link}from'react-router-dom';import{useTranslation}from\"react-i18next\";import*as OPTs from\"../../helpers/options_helper\";import*as url from\"../../helpers/url_helper\";import moment from\"moment\";import{InfoBpmModel}from'../../models/Common/InfoBpmModel';import{Row,Col,Card,CardBody,CardFooter,Button,Label,Table,Modal}from\"reactstrap\";import{AvForm,AvField,AvGroup,AvInput,AvCheckbox}from\"availity-reactstrap-validation\";import Select from\"react-select\";import{BackendServices,CoreServices,BpmServices}from\"../../services\";import*as opt from\"../../helpers/options_helper\";import LocalStorageHelper from\"../../helpers/LocalStorageHelper\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ModalTransferProcess=function ModalTransferProcess(props){var _useTranslation=useTranslation(),t=_useTranslation.t,i18n=_useTranslation.i18n;var location=useLocation();var history=useHistory();//Servicios\nvar _useState=useState(new BackendServices()),_useState2=_slicedToArray(_useState,2),backendServices=_useState2[0],setbackendServices=_useState2[1];var _useState3=useState(new CoreServices()),_useState4=_slicedToArray(_useState3,2),coreServices=_useState4[0],setcoreServices=_useState4[1];var _useState5=useState(new BpmServices()),_useState6=_slicedToArray(_useState5,2),bpmServices=_useState6[0],setbpmServices=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),usersByGroupList=_useState8[0],setusersByGroupList=_useState8[1];var _useState9=useState(undefined),_useState10=_slicedToArray(_useState9,2),usersByGroupSelected=_useState10[0],setusersByGroupSelected=_useState10[1];var localStorageHelper=new LocalStorageHelper();React.useEffect(function(){loadUserGroups();},[props.data]);//cargar lista de tipo de personas\nfunction loadUserGroups(){if(props.data===undefined||props.data===null){return;}if(props.data.data===undefined||props.data.data===null){return;}console.log(\"loadUserGroups\",props.data.data);backendServices.getUsersByGroup(props.data.data.grupoldap).then(function(data){if(data!==null&&data.result!==undefined){var json=[];for(var i=0;i<data.result.length;i++){json.push({label:data.result[i][\"userName\"],value:data.result[i][\"userName\"]});}console.log(\"getUsersByGroup\",json);setusersByGroupList(json);setusersByGroupSelected(json[0]);}}).catch(function(error){});}//Guardar el Cliente\nfunction handleSubmitFormClient(_x,_x2,_x3){return _handleSubmitFormClient.apply(this,arguments);}function _handleSubmitFormClient(){_handleSubmitFormClient=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event,errors,values){var credentials;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();if(!(errors.length>0)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:console.log(\"handleSubmitFormClient\",values);/*var result = await bpmServices.ChangeTaskUser(usersByGroupSelected.value,props.data.taskId,props.data.instanceId);\r\n    if(result){\r\n      props.updateData();\r\n    }*/credentials=localStorageHelper.get(opt.VARNAME_USRCREDENTIAL);if(usersByGroupSelected){if(credentials&&credentials.isAnalysisSupervisor){bpmServices.checkAndStartTask(props.data).then(function(iniresult){saveJBPMProcess(OPTs.PROCESS_ANALISISCREDITO);props.updateData();props.toggle();});}}case 6:case\"end\":return _context.stop();}}},_callee);}));return _handleSubmitFormClient.apply(this,arguments);}function saveJBPMProcess(_x4){return _saveJBPMProcess.apply(this,arguments);}function _saveJBPMProcess(){_saveJBPMProcess=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(option){var _props$data$infoBpmMo,_props$data$infoBpmMo2,_props$data$infoBpmMo3,_props$data$infoBpmMo4;var maindebtor,infoBpmModel,values;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return backendServices.consultPrincipalDebtor(props.data.transactionId);case 2:maindebtor=_context2.sent;infoBpmModel=new InfoBpmModel((_props$data$infoBpmMo=(_props$data$infoBpmMo2=props.data.infoBpmModel)===null||_props$data$infoBpmMo2===void 0?void 0:_props$data$infoBpmMo2.instanceId)!==null&&_props$data$infoBpmMo!==void 0?_props$data$infoBpmMo:props.data.instanceId,(_props$data$infoBpmMo3=(_props$data$infoBpmMo4=props.data.infoBpmModel)===null||_props$data$infoBpmMo4===void 0?void 0:_props$data$infoBpmMo4.transactId)!==null&&_props$data$infoBpmMo3!==void 0?_props$data$infoBpmMo3:props.data.transactionId,0,0,maindebtor===null||maindebtor===void 0?void 0:maindebtor.personId);infoBpmModel.personName=maindebtor!==undefined?maindebtor.typePerson==\"2\"?maindebtor.name:maindebtor.name+\" \"+maindebtor.name2+\" \"+maindebtor.lastName+\" \"+maindebtor.lastName2:\"\";infoBpmModel.toprocess=0;//props.data.infobpm.toprocess;\n_context2.t0=option;_context2.next=_context2.t0===OPTs.PROCESS_ANALISISCREDITO?9:14;break;case 9://Enviar a Analisis de Credito\ninfoBpmModel.processId=OPTs.PROCESS_ANALISISCREDITO;infoBpmModel.activityId=OPTs.ACT_NONE;values={\"info\":JSON.stringify(infoBpmModel),\"processId\":OPTs.PROCESS_ANALISISCREDITO.toString(),\"activityId\":OPTs.ACT_NONE.toString(),\"transactionId\":props.data.transactionId,\"requestId\":props.data.requestId,//\"decision\": \"si\",\n//\"tiposolicitud\": \"si\", //flujo normal (no es devolucion)\n\"id\":props.data.instanceId,\"analista\":usersByGroupSelected.value//autonomy.banca\n};bpmServices.completedStatusTask(props.data.taskId,values).then(function(data){if(data!==undefined){//saveAutoLog(null, null);\nhistory.push(url.URL_DASHBOARD);}else{//Mensaje ERROR\n//seterror_msg(t(\"ErrorSaveMessage\"));\n// seterror_dlg(false);\n}});return _context2.abrupt(\"break\",15);case 14:return _context2.abrupt(\"break\",15);case 15:case\"end\":return _context2.stop();}}},_callee2);}));return _saveJBPMProcess.apply(this,arguments);}return/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsxs(Modal,{isOpen:props.isOpen,toggle:props.toggle,centered:true,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"modal-title mt-0\",children:t(\"Transferir Trámite\")}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:props.toggle,className:\"close\",\"data-dismiss\":\"modal\",\"aria-label\":\"Close\",children:/*#__PURE__*/_jsx(\"span\",{\"aria-hidden\":\"true\",children:\"\\xD7\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-body\",children:/*#__PURE__*/_jsxs(AvForm,{id:\"frmClient\",className:\"needs-validation\",onSubmit:handleSubmitFormClient,children:[/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{md:\"12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"userSelected\",children:t(\"Seleccionar Usuario\")}),/*#__PURE__*/_jsx(Select,{noOptionsMessage:function noOptionsMessage(){return\"\";},onChange:function onChange(e){setusersByGroupSelected(usersByGroupList.find(function(x){return x.value===e.value;}));}//handleSubmitFormClient({ target: { name: 'usersSelected', value: e.value } })\n,options:usersByGroupList,classNamePrefix:\"select2-selection\",value:usersByGroupSelected,name:\"userSelected\"})]})})})}),/*#__PURE__*/_jsxs(CardFooter,{style:{textAlign:\"right\"},children:[/*#__PURE__*/_jsxs(Button,{color:\"danger\",style:{margin:'5px 0px'},type:\"button\",onClick:props.toggle,children:[/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi mdi-cancel mid-12px\"}),\" \",t(\"Cancel\")]}),/*#__PURE__*/_jsxs(Button,{color:\"success\",type:\"submit\",style:{margin:'5px'},children:[/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-content-save mdi-12px\"}),\" \",t(\"Save\")]})]})]})},\"TransferForm\")]})},\"mcf1\");};export default ModalTransferProcess;","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/Dashboard/ModalTransferProcess.js"],"names":["React","useState","useLocation","useHistory","Link","useTranslation","OPTs","url","moment","InfoBpmModel","Row","Col","Card","CardBody","CardFooter","Button","Label","Table","Modal","AvForm","AvField","AvGroup","AvInput","AvCheckbox","Select","BackendServices","CoreServices","BpmServices","opt","LocalStorageHelper","ModalTransferProcess","props","t","i18n","location","history","backendServices","setbackendServices","coreServices","setcoreServices","bpmServices","setbpmServices","usersByGroupList","setusersByGroupList","undefined","usersByGroupSelected","setusersByGroupSelected","localStorageHelper","useEffect","loadUserGroups","data","console","log","getUsersByGroup","grupoldap","then","result","json","i","length","push","label","value","catch","error","handleSubmitFormClient","event","errors","values","preventDefault","credentials","get","VARNAME_USRCREDENTIAL","isAnalysisSupervisor","checkAndStartTask","iniresult","saveJBPMProcess","PROCESS_ANALISISCREDITO","updateData","toggle","option","consultPrincipalDebtor","transactionId","maindebtor","infoBpmModel","instanceId","transactId","personId","personName","typePerson","name","name2","lastName","lastName2","toprocess","processId","activityId","ACT_NONE","JSON","stringify","toString","requestId","completedStatusTask","taskId","URL_DASHBOARD","isOpen","e","find","x","textAlign","margin"],"mappings":"0gBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CACA,OAASC,WAAT,CAAsBC,UAAtB,CAAkCC,IAAlC,KAA8C,kBAA9C,CAEA,OAASC,cAAT,KAA+B,eAA/B,CACA,MAAO,GAAKC,CAAAA,IAAZ,KAAsB,8BAAtB,CACA,MAAO,GAAKC,CAAAA,GAAZ,KAAqB,0BAArB,CACA,MAAOC,CAAAA,MAAP,KAAmB,QAAnB,CACA,OAASC,YAAT,KAA6B,kCAA7B,CAEA,OACIC,GADJ,CAEIC,GAFJ,CAGIC,IAHJ,CAIIC,QAJJ,CAKIC,UALJ,CAMIC,MANJ,CAOIC,KAPJ,CAQIC,KARJ,CASEC,KATF,KAUO,YAVP,CAYA,OAASC,MAAT,CAAiBC,OAAjB,CAA0BC,OAA1B,CAAmCC,OAAnC,CAA4CC,UAA5C,KAA8D,gCAA9D,CACA,MAAOC,CAAAA,MAAP,KAAmB,cAAnB,CACA,OAASC,eAAT,CAA0BC,YAA1B,CAAwCC,WAAxC,KAA2D,gBAA3D,CACA,MAAO,GAAKC,CAAAA,GAAZ,KAAqB,8BAArB,CACA,MAAOC,CAAAA,kBAAP,KAA+B,kCAA/B,C,wFAEA,GAAMC,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAAAC,KAAK,CAAI,CACpC,oBAAoB1B,cAAc,EAAlC,CAAQ2B,CAAR,iBAAQA,CAAR,CAAWC,IAAX,iBAAWA,IAAX,CACA,GAAMC,CAAAA,QAAQ,CAAGhC,WAAW,EAA5B,CACA,GAAMiC,CAAAA,OAAO,CAAGhC,UAAU,EAA1B,CAEA;AACA,cAA8CF,QAAQ,CAAC,GAAIwB,CAAAA,eAAJ,EAAD,CAAtD,wCAAOW,eAAP,eAAwBC,kBAAxB,eACA,eAAwCpC,QAAQ,CAAC,GAAIyB,CAAAA,YAAJ,EAAD,CAAhD,yCAAOY,YAAP,eAAqBC,eAArB,eACA,eAAsCtC,QAAQ,CAAC,GAAI0B,CAAAA,WAAJ,EAAD,CAA9C,yCAAOa,WAAP,eAAoBC,cAApB,eACA,eAAgDxC,QAAQ,CAAC,EAAD,CAAxD,yCAAOyC,gBAAP,eAAyBC,mBAAzB,eACA,eAAwD1C,QAAQ,CAAC2C,SAAD,CAAhE,0CAAOC,oBAAP,gBAA6BC,uBAA7B,gBACA,GAAMC,CAAAA,kBAAkB,CAAG,GAAIlB,CAAAA,kBAAJ,EAA3B,CAEA7B,KAAK,CAACgD,SAAN,CAAgB,UAAM,CACpBC,cAAc,GACf,CAFD,CAEG,CAAClB,KAAK,CAACmB,IAAP,CAFH,EAKA;AACA,QAASD,CAAAA,cAAT,EAA0B,CAExB,GAAGlB,KAAK,CAACmB,IAAN,GAAeN,SAAf,EAA4Bb,KAAK,CAACmB,IAAN,GAAe,IAA9C,CAAmD,CACjD,OACD,CACD,GAAGnB,KAAK,CAACmB,IAAN,CAAWA,IAAX,GAAoBN,SAApB,EAAiCb,KAAK,CAACmB,IAAN,CAAWA,IAAX,GAAoB,IAAxD,CAA6D,CAC3D,OACD,CAEDC,OAAO,CAACC,GAAR,CAAY,gBAAZ,CAA6BrB,KAAK,CAACmB,IAAN,CAAWA,IAAxC,EACAd,eAAe,CAACiB,eAAhB,CAAgCtB,KAAK,CAACmB,IAAN,CAAWA,IAAX,CAAgBI,SAAhD,EACGC,IADH,CACQ,SAACL,IAAD,CAAU,CACd,GAAIA,IAAI,GAAK,IAAT,EAAiBA,IAAI,CAACM,MAAL,GAAgBZ,SAArC,CAAgD,CAC9C,GAAIa,CAAAA,IAAI,CAAG,EAAX,CACA,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGR,IAAI,CAACM,MAAL,CAAYG,MAAhC,CAAwCD,CAAC,EAAzC,CAA6C,CAC3CD,IAAI,CAACG,IAAL,CAAU,CAAEC,KAAK,CAAEX,IAAI,CAACM,MAAL,CAAYE,CAAZ,EAAe,UAAf,CAAT,CAAqCI,KAAK,CAAEZ,IAAI,CAACM,MAAL,CAAYE,CAAZ,EAAe,UAAf,CAA5C,CAAV,EACD,CACDP,OAAO,CAACC,GAAR,CAAY,iBAAZ,CAA8BK,IAA9B,EACAd,mBAAmB,CAACc,IAAD,CAAnB,CACAX,uBAAuB,CAACW,IAAI,CAAC,CAAD,CAAL,CAAvB,CACD,CACF,CAXH,EAWKM,KAXL,CAWW,SAACC,KAAD,CAAW,CAAG,CAXzB,EAYD,CAED;AA3CoC,QA4CrBC,CAAAA,sBA5CqB,sLA4CpC,iBAAsCC,KAAtC,CAA6CC,MAA7C,CAAqDC,MAArD,kIACEF,KAAK,CAACG,cAAN,GADF,KAEMF,MAAM,CAACR,MAAP,CAAgB,CAFtB,kEAKER,OAAO,CAACC,GAAR,CAAY,wBAAZ,CAAsCgB,MAAtC,EAEA;AACJ;AACA;AACA,OACQE,WAXN,CAWoBvB,kBAAkB,CAACwB,GAAnB,CAAuB3C,GAAG,CAAC4C,qBAA3B,CAXpB,CAaE,GAAG3B,oBAAH,CAAwB,CACtB,GAAGyB,WAAW,EAAIA,WAAW,CAACG,oBAA9B,CAAmD,CAEjDjC,WAAW,CAACkC,iBAAZ,CAA8B3C,KAAK,CAACmB,IAApC,EACCK,IADD,CACM,SAACoB,SAAD,CAAe,CAEnBC,eAAe,CAACtE,IAAI,CAACuE,uBAAN,CAAf,CACF9C,KAAK,CAAC+C,UAAN,GACA/C,KAAK,CAACgD,MAAN,GAEC,CAPD,EASH,CACA,CA1BH,sDA5CoC,iEAyErBH,CAAAA,eAzEqB,0JAyEpC,kBAA+BI,MAA/B,+QACyB5C,CAAAA,eAAe,CAAC6C,sBAAhB,CAAuClD,KAAK,CAACmB,IAAN,CAAWgC,aAAlD,CADzB,QACMC,UADN,gBAEMC,YAFN,CAEqB,GAAI3E,CAAAA,YAAJ,gDACjBsB,KAAK,CAACmB,IAAN,CAAWkC,YADM,iDACjB,uBAAyBC,UADR,+DACsBtD,KAAK,CAACmB,IAAN,CAAWmC,UADjC,iDAEjBtD,KAAK,CAACmB,IAAN,CAAWkC,YAFM,iDAEjB,uBAAyBE,UAFR,iEAEsBvD,KAAK,CAACmB,IAAN,CAAWgC,aAFjC,CAGjB,CAHiB,CAGd,CAHc,CAIjBC,UAJiB,SAIjBA,UAJiB,iBAIjBA,UAAU,CAAEI,QAJK,CAFrB,CAQEH,YAAY,CAACI,UAAb,CAA0BL,UAAU,GAAKvC,SAAf,CAA4BuC,UAAU,CAACM,UAAX,EAAyB,GAAzB,CAA+BN,UAAU,CAACO,IAA1C,CAAkDP,UAAU,CAACO,IAAX,CAAkB,GAAlB,CAAwBP,UAAU,CAACQ,KAAnC,CAA2C,GAA3C,CAAiDR,UAAU,CAACS,QAA5D,CAAuE,GAAvE,CAA6ET,UAAU,CAACU,SAAtK,CAAoL,EAA9M,CACAT,YAAY,CAACU,SAAb,CAAyB,CAAzB,CAA2B;AAT7B,aAWUd,MAXV,+BAYS1E,IAAI,CAACuE,uBAZd,mBAYyC;AACnCO,YAAY,CAACW,SAAb,CAAyBzF,IAAI,CAACuE,uBAA9B,CACAO,YAAY,CAACY,UAAb,CAA0B1F,IAAI,CAAC2F,QAA/B,CAEO7B,MAhBb,CAgBsB,CACV,OAAQ8B,IAAI,CAACC,SAAL,CAAef,YAAf,CADE,CAEV,YAAa9E,IAAI,CAACuE,uBAAL,CAA6BuB,QAA7B,EAFH,CAGV,aAAc9F,IAAI,CAAC2F,QAAL,CAAcG,QAAd,EAHJ,CAIV,gBAAiBrE,KAAK,CAACmB,IAAN,CAAWgC,aAJlB,CAKV,YAAanD,KAAK,CAACmB,IAAN,CAAWmD,SALd,CAMV;AACA;AACA,KAAMtE,KAAK,CAACmB,IAAN,CAAWmC,UARP,CASV,WAAYxC,oBAAoB,CAACiB,KAAmB;AAT1C,CAhBtB,CA2BMtB,WAAW,CAAC8D,mBAAZ,CAAgCvE,KAAK,CAACmB,IAAN,CAAWqD,MAA3C,CAAmDnC,MAAnD,EACGb,IADH,CACQ,SAACL,IAAD,CAAU,CACd,GAAIA,IAAI,GAAKN,SAAb,CAAwB,CAEtB;AACAT,OAAO,CAACyB,IAAR,CAAarD,GAAG,CAACiG,aAAjB,EACD,CAJD,IAKK,CACH;AACA;AACA;AACD,CACF,CAZH,EA3BN,yIAzEoC,kDA2HpC,mBACE,KAAC,KAAD,CAAO,QAAP,wBACA,MAAC,KAAD,EACE,MAAM,CAAEzE,KAAK,CAAC0E,MADhB,CAEE,MAAM,CAAE1E,KAAK,CAACgD,MAFhB,CAGE,QAAQ,CAAE,IAHZ,wBAIE,aAAK,SAAS,CAAC,cAAf,wBACE,WAAI,SAAS,CAAC,kBAAd,UAAkC/C,CAAC,CAAC,oBAAD,CAAnC,EADF,cAEE,eACE,IAAI,CAAC,QADP,CAEE,OAAO,CAAED,KAAK,CAACgD,MAFjB,CAGE,SAAS,CAAC,OAHZ,CAIE,eAAa,OAJf,CAKE,aAAW,OALb,uBAME,aAAM,cAAY,MAAlB,kBANF,EAFF,GAJF,cAeE,YAAwB,SAAS,CAAC,YAAlC,uBAGA,MAAC,MAAD,EAAQ,EAAE,CAAC,WAAX,CAAuB,SAAS,CAAC,kBAAjC,CAAoD,QAAQ,CAAEd,sBAA9D,wBAGI,KAAC,QAAD,wBACE,KAAC,GAAD,wBAEC,KAAC,GAAD,EAAK,EAAE,CAAC,IAAR,uBACG,aAAK,SAAS,CAAC,MAAf,wBACE,KAAC,KAAD,EAAO,OAAO,CAAC,cAAf,UAA+BjC,CAAC,CAAC,qBAAD,CAAhC,EADF,cAEE,KAAC,MAAD,EAAQ,gBAAgB,CAAE,kCAAM,EAAN,EAA1B,CACE,QAAQ,CAAE,kBAAC0E,CAAD,CAAO,CAAE5D,uBAAuB,CAACJ,gBAAgB,CAACiE,IAAjB,CAAsB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAAC9C,KAAF,GAAY4C,CAAC,CAAC5C,KAAlB,EAAvB,CAAD,CAAvB,CAA4E,CAAE;AADnG,CAEE,OAAO,CAAEpB,gBAFX,CAGE,eAAe,CAAC,mBAHlB,CAIE,KAAK,CAAEG,oBAJT,CAKE,IAAI,CAAC,cALP,EAFF,GADH,EAFD,EADF,EAHJ,cA6BI,MAAC,UAAD,EAAY,KAAK,CAAE,CAAEgE,SAAS,CAAE,OAAb,CAAnB,wBACE,MAAC,MAAD,EAAQ,KAAK,CAAC,QAAd,CAAuB,KAAK,CAAE,CAAEC,MAAM,CAAE,SAAV,CAA9B,CAAqD,IAAI,CAAC,QAA1D,CAAmE,OAAO,CAAE/E,KAAK,CAACgD,MAAlF,wBACE,UAAG,SAAS,CAAC,6BAAb,EADF,CACkD,GADlD,CACuD/C,CAAC,CAAC,QAAD,CADxD,GADF,cAIE,MAAC,MAAD,EAAQ,KAAK,CAAC,SAAd,CAAwB,IAAI,CAAC,QAA7B,CAAsC,KAAK,CAAE,CAAE8E,MAAM,CAAE,KAAV,CAA7C,wBAAgE,UAAG,SAAS,CAAC,+BAAb,EAAhE,CACG,GADH,CACQ9E,CAAC,CAAC,MAAD,CADT,GAJF,GA7BJ,GAHA,EAAS,cAAT,CAfF,GADA,EAAoB,MAApB,CADF,CAgED,CA3LD,CAqMA,cAAeF,CAAAA,oBAAf","sourcesContent":["import React, { useState } from \"react\"\r\nimport { useLocation, useHistory, Link } from 'react-router-dom'\r\nimport PropTypes from 'prop-types';\r\nimport { useTranslation } from \"react-i18next\";\r\nimport * as OPTs from \"../../helpers/options_helper\"\r\nimport * as url from \"../../helpers/url_helper\"\r\nimport moment from \"moment\";\r\nimport { InfoBpmModel } from '../../models/Common/InfoBpmModel';\r\n\r\nimport {\r\n    Row,\r\n    Col,\r\n    Card,\r\n    CardBody,\r\n    CardFooter,\r\n    Button,\r\n    Label,\r\n    Table,\r\n  Modal,\r\n} from \"reactstrap\"\r\n\r\nimport { AvForm, AvField, AvGroup, AvInput, AvCheckbox } from \"availity-reactstrap-validation\";\r\nimport Select from \"react-select\";\r\nimport { BackendServices, CoreServices, BpmServices } from \"../../services\";\r\nimport * as opt from \"../../helpers/options_helper\"\r\nimport LocalStorageHelper from \"../../helpers/LocalStorageHelper\";\r\n\r\nconst ModalTransferProcess = props => {\r\n  const { t, i18n } = useTranslation();\r\n  const location = useLocation();\r\n  const history = useHistory();\r\n\r\n  //Servicios\r\n  const [backendServices, setbackendServices] = useState(new BackendServices());\r\n  const [coreServices, setcoreServices] = useState(new CoreServices());\r\n  const [bpmServices, setbpmServices] = useState(new BpmServices());\r\n  const [usersByGroupList, setusersByGroupList] = useState([]);\r\n  const [usersByGroupSelected, setusersByGroupSelected] = useState(undefined);\r\n  const localStorageHelper = new LocalStorageHelper();\r\n    \r\n  React.useEffect(() => {\r\n    loadUserGroups();\r\n  }, [props.data]);\r\n  \r\n\r\n  //cargar lista de tipo de personas\r\n  function loadUserGroups() {\r\n\r\n    if(props.data === undefined || props.data === null){\r\n      return;\r\n    }\r\n    if(props.data.data === undefined || props.data.data === null){\r\n      return;\r\n    }\r\n\r\n    console.log(\"loadUserGroups\",props.data.data)\r\n    backendServices.getUsersByGroup(props.data.data.grupoldap)\r\n      .then((data) => {\r\n        if (data !== null && data.result !== undefined) {\r\n          let json = [];\r\n          for (let i = 0; i < data.result.length; i++) {\r\n            json.push({ label: data.result[i][\"userName\"], value: data.result[i][\"userName\"] })\r\n          }\r\n          console.log(\"getUsersByGroup\",json);\r\n          setusersByGroupList(json);\r\n          setusersByGroupSelected(json[0]);\r\n        }\r\n      }).catch((error) => { });\r\n  }\r\n\r\n  //Guardar el Cliente\r\n  async function handleSubmitFormClient(event, errors, values) {    \r\n    event.preventDefault();\r\n    if (errors.length > 0) {\r\n      return;\r\n    }\r\n    console.log(\"handleSubmitFormClient\", values);\r\n\r\n    /*var result = await bpmServices.ChangeTaskUser(usersByGroupSelected.value,props.data.taskId,props.data.instanceId);\r\n    if(result){\r\n      props.updateData();\r\n    }*/\r\n    var credentials = localStorageHelper.get(opt.VARNAME_USRCREDENTIAL);\r\n\r\n    if(usersByGroupSelected){\r\n      if(credentials && credentials.isAnalysisSupervisor){\r\n\r\n        bpmServices.checkAndStartTask(props.data)\r\n        .then((iniresult) => {\r\n          \r\n          saveJBPMProcess(OPTs.PROCESS_ANALISISCREDITO);\r\n        props.updateData();\r\n        props.toggle();\r\n\r\n        })\r\n      \r\n    }\r\n    }\r\n  }\r\n\r\n  async function saveJBPMProcess(option) {\r\n    var maindebtor = await backendServices.consultPrincipalDebtor(props.data.transactionId)\r\n    var infoBpmModel = new InfoBpmModel(\r\n      props.data.infoBpmModel?.instanceId ?? props.data.instanceId,\r\n      props.data.infoBpmModel?.transactId ?? props.data.transactionId,\r\n      0, 0,\r\n      maindebtor?.personId\r\n    );\r\n    infoBpmModel.personName = maindebtor !== undefined ? (maindebtor.typePerson == \"2\" ? maindebtor.name : (maindebtor.name + \" \" + maindebtor.name2 + \" \" + maindebtor.lastName + \" \" + maindebtor.lastName2)) : \"\";\r\n    infoBpmModel.toprocess = 0;//props.data.infobpm.toprocess;\r\n\r\n    switch (option) {\r\n      case OPTs.PROCESS_ANALISISCREDITO: { //Enviar a Analisis de Credito\r\n        infoBpmModel.processId = OPTs.PROCESS_ANALISISCREDITO;\r\n        infoBpmModel.activityId = OPTs.ACT_NONE;\r\n\r\n           var values = {\r\n              \"info\": JSON.stringify(infoBpmModel),\r\n              \"processId\": OPTs.PROCESS_ANALISISCREDITO.toString(),\r\n              \"activityId\": OPTs.ACT_NONE.toString(),\r\n              \"transactionId\": props.data.transactionId,\r\n              \"requestId\": props.data.requestId,\r\n              //\"decision\": \"si\",\r\n              //\"tiposolicitud\": \"si\", //flujo normal (no es devolucion)\r\n              \"id\": props.data.instanceId,\r\n              \"analista\": usersByGroupSelected.value              //autonomy.banca\r\n            };\r\n        bpmServices.completedStatusTask(props.data.taskId, values)\r\n          .then((data) => {\r\n            if (data !== undefined) {\r\n\r\n              //saveAutoLog(null, null);\r\n              history.push(url.URL_DASHBOARD);\r\n            }\r\n            else {\r\n              //Mensaje ERROR\r\n              //seterror_msg(t(\"ErrorSaveMessage\"));\r\n              // seterror_dlg(false);\r\n            }\r\n          });\r\n\r\n        break;\r\n      }      \r\n      \r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n\r\n  return (\r\n    <React.Fragment key=\"mcf1\">\r\n    <Modal\r\n      isOpen={props.isOpen}\r\n      toggle={props.toggle}\r\n      centered={true}>\r\n      <div className=\"modal-header\">\r\n        <h5 className=\"modal-title mt-0\">{t(\"Transferir Trámite\")}</h5>\r\n        <button\r\n          type=\"button\"\r\n          onClick={props.toggle}\r\n          className=\"close\"\r\n          data-dismiss=\"modal\"\r\n          aria-label=\"Close\">\r\n          <span aria-hidden=\"true\">&times;</span>\r\n        </button>\r\n      </div>\r\n      <div key=\"TransferForm\" className=\"modal-body\">\r\n\r\n      \r\n      <AvForm id=\"frmClient\" className=\"needs-validation\" onSubmit={handleSubmitFormClient}>\r\n       \r\n          {/*<h5 className=\"card-sub-title\">{t(\"Seleccionar Usuario\")}</h5>*/}\r\n          <CardBody>\r\n            <Row>\r\n             \r\n             <Col md=\"12\">\r\n                <div className=\"mb-3\">\r\n                  <Label htmlFor=\"userSelected\">{t(\"Seleccionar Usuario\")}</Label>\r\n                  <Select noOptionsMessage={() => \"\"}\r\n                    onChange={(e) => { setusersByGroupSelected(usersByGroupList.find(x => x.value === e.value));  }} //handleSubmitFormClient({ target: { name: 'usersSelected', value: e.value } })\r\n                    options={usersByGroupList}\r\n                    classNamePrefix=\"select2-selection\"\r\n                    value={usersByGroupSelected}\r\n                    name=\"userSelected\"\r\n                  />\r\n                </div>\r\n              </Col>\r\n              \r\n              {/*<Col md=\"6\">\r\n                <div className=\"mb-3\">\r\n                  <Label htmlFor=\"transferto\">{t(\"Seleccionar Usuario\")}</Label>\r\n                  <AvField className=\"form-control\"\r\n                    name=\"transferTo\" type=\"text\" />\r\n                </div>\r\n              </Col>*/}\r\n            </Row>\r\n           \r\n          </CardBody>\r\n          <CardFooter style={{ textAlign: \"right\" }}>\r\n            <Button color=\"danger\" style={{ margin: '5px 0px' }} type=\"button\" onClick={props.toggle}>\r\n              <i className=\"mdi mdi mdi-cancel mid-12px\"></i>{\" \"}{t(\"Cancel\")}\r\n            </Button>\r\n            <Button color=\"success\" type=\"submit\" style={{ margin: '5px' }}><i className=\"mdi mdi-content-save mdi-12px\"></i>\r\n              {\" \"}{t(\"Save\")}\r\n            </Button>\r\n          </CardFooter>\r\n       \r\n      </AvForm>\r\n      \r\n      </div>\r\n    </Modal>\r\n</React.Fragment>\r\n  );\r\n};\r\n\r\nModalTransferProcess.propTypes = {\r\n  isOpen: PropTypes.bool,\r\n  toggle: PropTypes.func,\r\n  onCancel:PropTypes.func,\r\n  data:PropTypes.any,\r\n  updateData: PropTypes.func,\r\n}\r\n\r\nexport default ModalTransferProcess;\r\n"]},"metadata":{},"sourceType":"module"}
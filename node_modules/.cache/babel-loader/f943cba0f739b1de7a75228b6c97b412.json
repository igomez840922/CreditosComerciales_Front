{"ast":null,"code":"import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useRef}from\"react\";import{translationHelpers}from\"../../../helpers\";import{useLocation,useHistory}from'react-router-dom';import*as url from\"../../../helpers/url_helper\";import RiesgoAmbientalContext from'./RiesgoAmbientalContext';import{Row,Col,Button,Card,CardBody}from\"reactstrap\";//Import Breadcrumb\nimport Breadcrumbs from\"../../../components/Common/Breadcrumb\";import FormAspectosAmbientales from\"./riesgoAmbiental/FormAspectosAmbientales\";import FormDetalles from\"./riesgoAmbiental/FormDetalles\";import AspectosAmbientales from\"../4_InformeGestionReforzado/FormularioIGR/Secciones/AspectosAmbientales\";import{BackendServices}from\"../../../services\";import ServicioRiesgoAmbiental from\"../../../services/RiesgoAmbiental/RiesgoAmbiental\";import SweetAlert from\"react-bootstrap-sweetalert\";import LoadingOverlay from\"react-loading-overlay\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var RiesgoAmbientalDetalle=function RiesgoAmbientalDetalle(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isActiveLoading=_useState2[0],setIsActiveLoading=_useState2[1];//loading de la pagina\nvar history=useHistory();var location=useLocation();var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),successSave_dlg=_useState4[0],setsuccessSave_dlg=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),error_dlg=_useState6[0],seterror_dlg=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),error_msg=_useState8[0],seterror_msg=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),info_dlg=_useState10[0],setinfo_dlg=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),info_msg=_useState12[0],setinfo_msg=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),tipo=_useState14[0],settipo=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),confirm_alert=_useState16[0],setconfirm_alert=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),estado=_useState18[0],setestado=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),dynamic_description=_useState20[0],setdynamic_description=_useState20[1];var _useState21=useState({}),_useState22=_slicedToArray(_useState21,2),context=_useState22[0],setContext=_useState22[1];var _useState23=useState(location.data),_useState24=_slicedToArray(_useState23,2),dataLocation=_useState24[0],setdataLocation=_useState24[1];var _useState25=useState({dataAspectosAmbientales:{transactId:0,riskPreClassification:null,sustainableCreditRating:\"2\",riskClassificationConfirmation:null,natureLocationProject:false,physicalResettlement:false,environmentalPermits:false,newProject:false,tipo:false,workersContractors:false},datosGenerales:{codigoTipoIdentificacion:null,numeroCliente:null,primerNombre:null,segundoNombre:null,primerApellido:null,segundoApellido:null,numeroIdentificacion:null,transactId:0,economicGroup:{code:\"\",name:\"\"},economicActivity:{code:\"\",name:\"\"},subeconomicActivity:{code:\"\",name:\"\"},bank:{code:\"\",name:\"\"}}}),_useState26=_slicedToArray(_useState25,2),modelo=_useState26[0],setmodelo=_useState26[1];var _translationHelpers=translationHelpers('navigation','commercial_credit','common'),_translationHelpers2=_slicedToArray(_translationHelpers,3),n=_translationHelpers2[0],t=_translationHelpers2[1],c=_translationHelpers2[2];useEffect(function(){if(!location.data){location.data={\"requestId\":\"XYZ892022\",\"facilityId\":\"\",\"customerId\":\"68\",\"transactionId\":\"110\",\"processId\":\"6\",\"activityId\":\"0\",\"instanceId\":9104,\"taskId\":456,\"taskStatus\":\"InProgress\"};}var apiBack=new BackendServices();apiBack.consultarDatosGeneralesIGR(location.data.transactionId).then(function(resp){modelo.datosGenerales.codigoTipoIdentificacion=resp.identificationType;modelo.datosGenerales.economicGroup.code=resp.economicGroup.code;modelo.datosGenerales.economicGroup.name=resp.economicGroup.name;modelo.datosGenerales.economicActivity.code=resp.economicActivity.code;modelo.datosGenerales.economicActivity.name=resp.economicActivity.name;modelo.datosGenerales.subeconomicActivity.code=resp.subeconomicActivity.code;modelo.datosGenerales.subeconomicActivity.name=resp.subeconomicActivity.name;modelo.datosGenerales.bank.code=resp.bank.code;modelo.datosGenerales.bank.name=resp.bank.name;setmodelo(modelo);}).catch(function(error){});apiBack.consultarAspectosAmbientalesIGR(location.data.transactionId).then(function(resp){console.log(resp);if(resp!==undefined){modelo.dataAspectosAmbientales.transactId=location.data.transactionId;modelo.dataAspectosAmbientales.riskPreClassification=resp.environmentalAspectsDTO.riskPreClassification;modelo.dataAspectosAmbientales.sustainableCreditRating=resp.environmentalAspectsDTO.sustainableCreditRating;modelo.dataAspectosAmbientales.riskClassificationConfirmation=resp.environmentalAspectsDTO.riskClassificationConfirmation;modelo.dataAspectosAmbientales.natureLocationProject=resp.environmentalAspectsDTO.natureLocationProject;modelo.dataAspectosAmbientales.physicalResettlement=resp.environmentalAspectsDTO.physicalResettlement;modelo.dataAspectosAmbientales.environmentalPermits=resp.environmentalAspectsDTO.environmentalPermits;modelo.dataAspectosAmbientales.newProject=resp.environmentalAspectsDTO.newProject;modelo.dataAspectosAmbientales.workersContractors=resp.environmentalAspectsDTO.workersContractors;setestado(true);setmodelo(modelo);}});// update context\n// console.log('context', location.data);\nsetContext({transactionId:location.data.transactionId,customerId:location.data.customerId,instanceId:location.data.instanceId,requestId:location.data.requestId});},[]);// Component Refs\nvar aspectosAmbientalesRef=useRef();var formDetallesRef=useRef();function handleSave(){/* ---------------------------------------------------------------------------------------------- */ /*                   Aqui se debe de realizar la decision o continuar el proceso                  */ /* ---------------------------------------------------------------------------------------------- */aspectosAmbientalesRef.current.submit();formDetallesRef.current.submit();history.push(url.URL_DASHBOARD);}function handleClose(){/* ---------------------------------------------------------------------------------------------- */ /*           Verificar si toca culminar el proceso o solo salir a la bandeja de entrada           */ /* ---------------------------------------------------------------------------------------------- */history.push(url.URL_DASHBOARD);}function submitData(){var servicioRiesgoAmbiental=new BackendServices();if(!formDetallesRef.current.getFormValidation()){formDetallesRef.current.validateForm();return false;}else{if(!aspectosAmbientalesRef.current.getFormValidation()){aspectosAmbientalesRef.current.validateForm();return false;}formDetallesRef.current.dataReturn.transactId=Number(dataLocation.transactionId);var datos=formDetallesRef.current.dataReturn;var dataDetails={\"transactId\":Number(dataLocation.transactionId),\"environmentCovenant\":datos.environmentCovenant?datos.environmentCovenant:false,\"detail\":datos.detail?datos.detail:\"\",\"compliance\":datos.compliance?datos.compliance:\"\",\"term\":datos.term?datos.term:\"\",\"detected\":datos.detected?datos.detected:\"\",\"recommendations\":datos.recommendations?datos.recommendations:\"\",\"conclusions\":datos.conclusions?datos.conclusions:\"\"};servicioRiesgoAmbiental.nuevoInformacionRiesgoAmbiental(dataDetails).then(function(result){if(result!=undefined){servicioRiesgoAmbiental.guardarAspectosAmbientalesIGR(aspectosAmbientalesRef.current.dataReturn).then(function(resp){if(resp!=undefined){setsuccessSave_dlg(true);}else{seterror_dlg(true);}setIsActiveLoading(false);});}else{seterror_dlg(true);setIsActiveLoading(false);}});}}return/*#__PURE__*/_jsxs(RiesgoAmbientalContext.Provider,{value:context,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"page-content\",children:[/*#__PURE__*/_jsx(Breadcrumbs,{title:n(\"Commercial Credit\"),breadcrumbItem:n(\"Environmental Risk\")}),/*#__PURE__*/_jsxs(LoadingOverlay,{active:isActiveLoading,spinner:true,text:t(\"Processinginformation\"),children:[/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{xl:\"12\",children:/*#__PURE__*/_jsx(AspectosAmbientales,{datosGenerales:modelo.datosGenerales,locationData:location.data,dataAspectosAmbientales:modelo.dataAspectosAmbientales,ref:aspectosAmbientalesRef,onSubmit:submitData})})})})}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{xl:\"12\",children:/*#__PURE__*/_jsx(FormDetalles,{ref:formDetallesRef})})})]}),/*#__PURE__*/_jsx(Row,{className:\"my-2\",children:/*#__PURE__*/_jsxs(Col,{xl:\"12 text-end\",children:[/*#__PURE__*/_jsxs(Button,{id:\"btnClose\",color:\"dark\",type:\"button\",style:{margin:'5px'},onClick:handleClose,children:[/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-arrow-left-bold-circle-outline mid-12px\"}),\" \",\" \",c(\"Close\")]}),/*#__PURE__*/_jsxs(Button,{id:\"btnSubmit\",color:\"success\",type:\"button\",style:{margin:'5px'},onClick:function onClick(){submitData();setIsActiveLoading(true);setTimeout(function(){submitData();},1000);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-content-save mdi-12px\"}),\" \",c(\"Save\")]})]})})]}),successSave_dlg?/*#__PURE__*/_jsx(SweetAlert,{success:true,title:t(\"SuccessDialog\"),onConfirm:function onConfirm(){setsuccessSave_dlg(false);},children:t(\"SuccessSaveMessage\")}):null,error_dlg?/*#__PURE__*/_jsx(SweetAlert,{error:true,title:t(\"ErrorDialog\"),onConfirm:function onConfirm(){seterror_dlg(false);},children:error_msg}):null]});};export default RiesgoAmbientalDetalle;","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/CommercialCredit/16_RiesgoAmbiental/RiesgoAmbientalDetalle.js"],"names":["React","useEffect","useState","useRef","translationHelpers","useLocation","useHistory","url","RiesgoAmbientalContext","Row","Col","Button","Card","CardBody","Breadcrumbs","FormAspectosAmbientales","FormDetalles","AspectosAmbientales","BackendServices","ServicioRiesgoAmbiental","SweetAlert","LoadingOverlay","RiesgoAmbientalDetalle","props","isActiveLoading","setIsActiveLoading","history","location","successSave_dlg","setsuccessSave_dlg","error_dlg","seterror_dlg","error_msg","seterror_msg","info_dlg","setinfo_dlg","info_msg","setinfo_msg","tipo","settipo","confirm_alert","setconfirm_alert","estado","setestado","dynamic_description","setdynamic_description","context","setContext","data","dataLocation","setdataLocation","dataAspectosAmbientales","transactId","riskPreClassification","sustainableCreditRating","riskClassificationConfirmation","natureLocationProject","physicalResettlement","environmentalPermits","newProject","workersContractors","datosGenerales","codigoTipoIdentificacion","numeroCliente","primerNombre","segundoNombre","primerApellido","segundoApellido","numeroIdentificacion","economicGroup","code","name","economicActivity","subeconomicActivity","bank","modelo","setmodelo","n","t","c","apiBack","consultarDatosGeneralesIGR","transactionId","then","resp","identificationType","catch","error","consultarAspectosAmbientalesIGR","console","log","undefined","environmentalAspectsDTO","customerId","instanceId","requestId","aspectosAmbientalesRef","formDetallesRef","handleSave","current","submit","push","URL_DASHBOARD","handleClose","submitData","servicioRiesgoAmbiental","getFormValidation","validateForm","dataReturn","Number","datos","dataDetails","environmentCovenant","detail","compliance","term","detected","recommendations","conclusions","nuevoInformacionRiesgoAmbiental","result","guardarAspectosAmbientalesIGR","margin","setTimeout"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\"\r\nimport { translationHelpers } from \"../../../helpers\"\r\nimport { useLocation, useHistory } from 'react-router-dom'\r\nimport * as url from \"../../../helpers/url_helper\"\r\nimport RiesgoAmbientalContext from './RiesgoAmbientalContext'\r\n\r\nimport {\r\n  Row,\r\n  Col,\r\n  Button,\r\n  Card,\r\n  CardBody\r\n} from \"reactstrap\"\r\n\r\n\r\n//Import Breadcrumb\r\nimport Breadcrumbs from \"../../../components/Common/Breadcrumb\"\r\nimport FormAspectosAmbientales from \"./riesgoAmbiental/FormAspectosAmbientales\"\r\nimport FormDetalles from \"./riesgoAmbiental/FormDetalles\"\r\nimport AspectosAmbientales from \"../4_InformeGestionReforzado/FormularioIGR/Secciones/AspectosAmbientales\"\r\nimport { BackendServices } from \"../../../services\"\r\nimport ServicioRiesgoAmbiental from \"../../../services/RiesgoAmbiental/RiesgoAmbiental\"\r\nimport SweetAlert from \"react-bootstrap-sweetalert\"\r\nimport LoadingOverlay from \"react-loading-overlay\"\r\n\r\n\r\nconst RiesgoAmbientalDetalle = (props) => {\r\n  const [isActiveLoading, setIsActiveLoading] = useState(false); //loading de la pagina\r\n\r\n  const history = useHistory();\r\n  const location = useLocation();\r\n  const [successSave_dlg, setsuccessSave_dlg] = useState(false);\r\n  const [error_dlg, seterror_dlg] = useState(false);\r\n  const [error_msg, seterror_msg] = useState(\"\");\r\n  const [info_dlg, setinfo_dlg] = useState(false)\r\n  const [info_msg, setinfo_msg] = useState(\"\")\r\n  const [tipo, settipo] = useState(\"\")\r\n  const [confirm_alert, setconfirm_alert] = useState(false)\r\n  const [estado, setestado] = useState(false)\r\n  const [dynamic_description, setdynamic_description] = useState(\"\")\r\n  const [context, setContext] = useState({});\r\n  const [dataLocation, setdataLocation] = useState(location.data);\r\n  const [modelo, setmodelo] = useState({\r\n    dataAspectosAmbientales: {\r\n      transactId: 0,\r\n      riskPreClassification: null,\r\n      sustainableCreditRating: \"2\",\r\n      riskClassificationConfirmation: null,\r\n      natureLocationProject: false,\r\n      physicalResettlement: false,\r\n      environmentalPermits: false,\r\n      newProject: false,\r\n      tipo: false,\r\n      workersContractors: false\r\n    },\r\n    datosGenerales: {\r\n      codigoTipoIdentificacion: null,\r\n      numeroCliente: null,\r\n      primerNombre: null,\r\n      segundoNombre: null,\r\n      primerApellido: null,\r\n      segundoApellido: null,\r\n      numeroIdentificacion: null,\r\n      transactId: 0,\r\n      economicGroup: {\r\n        code: \"\",\r\n        name: \"\"\r\n      },\r\n      economicActivity: {\r\n        code: \"\",\r\n        name: \"\"\r\n      },\r\n      subeconomicActivity: {\r\n        code: \"\",\r\n        name: \"\"\r\n      },\r\n      bank: {\r\n        code: \"\",\r\n        name: \"\"\r\n      },\r\n    }\r\n  });\r\n\r\n  const [n, t, c] = translationHelpers('navigation', 'commercial_credit', 'common');\r\n\r\n  useEffect(() => {\r\n\r\n    if (!location.data) {\r\n      location.data = {\r\n        \"requestId\": \"XYZ892022\",\r\n        \"facilityId\": \"\",\r\n        \"customerId\": \"68\",\r\n        \"transactionId\": \"110\",\r\n        \"processId\": \"6\",\r\n        \"activityId\": \"0\",\r\n        \"instanceId\": 9104,\r\n        \"taskId\": 456,\r\n        \"taskStatus\": \"InProgress\"\r\n      }\r\n    }\r\n    const apiBack = new BackendServices();\r\n    apiBack.consultarDatosGeneralesIGR(location.data.transactionId).then(resp => {\r\n      modelo.datosGenerales.codigoTipoIdentificacion = resp.identificationType\r\n      modelo.datosGenerales.economicGroup.code = resp.economicGroup.code;\r\n      modelo.datosGenerales.economicGroup.name = resp.economicGroup.name;\r\n      modelo.datosGenerales.economicActivity.code = resp.economicActivity.code;\r\n      modelo.datosGenerales.economicActivity.name = resp.economicActivity.name;\r\n      modelo.datosGenerales.subeconomicActivity.code = resp.subeconomicActivity.code;\r\n      modelo.datosGenerales.subeconomicActivity.name = resp.subeconomicActivity.name;\r\n      modelo.datosGenerales.bank.code = resp.bank.code;\r\n      modelo.datosGenerales.bank.name = resp.bank.name;\r\n      setmodelo(modelo);\r\n    }).catch((error) => {\r\n\r\n    });\r\n    apiBack.consultarAspectosAmbientalesIGR(location.data.transactionId).then(resp => {\r\n      console.log(resp);\r\n      if (resp !== undefined) {\r\n        modelo.dataAspectosAmbientales.transactId = location.data.transactionId;\r\n        modelo.dataAspectosAmbientales.riskPreClassification = resp.environmentalAspectsDTO.riskPreClassification;\r\n        modelo.dataAspectosAmbientales.sustainableCreditRating = resp.environmentalAspectsDTO.sustainableCreditRating;\r\n        modelo.dataAspectosAmbientales.riskClassificationConfirmation = resp.environmentalAspectsDTO.riskClassificationConfirmation;\r\n        modelo.dataAspectosAmbientales.natureLocationProject = resp.environmentalAspectsDTO.natureLocationProject;\r\n        modelo.dataAspectosAmbientales.physicalResettlement = resp.environmentalAspectsDTO.physicalResettlement;\r\n        modelo.dataAspectosAmbientales.environmentalPermits = resp.environmentalAspectsDTO.environmentalPermits;\r\n        modelo.dataAspectosAmbientales.newProject = resp.environmentalAspectsDTO.newProject;\r\n        modelo.dataAspectosAmbientales.workersContractors = resp.environmentalAspectsDTO.workersContractors;\r\n        setestado(true)\r\n        setmodelo(modelo);\r\n      }\r\n    });\r\n    // update context\r\n    // console.log('context', location.data);\r\n    setContext({\r\n      transactionId: location.data.transactionId,\r\n      customerId: location.data.customerId,\r\n      instanceId: location.data.instanceId,\r\n      requestId: location.data.requestId,\r\n    });\r\n\r\n  }, []);\r\n\r\n  // Component Refs\r\n  const aspectosAmbientalesRef = useRef();\r\n  const formDetallesRef = useRef();\r\n\r\n  function handleSave() {\r\n    /* ---------------------------------------------------------------------------------------------- */\r\n    /*                   Aqui se debe de realizar la decision o continuar el proceso                  */\r\n    /* ---------------------------------------------------------------------------------------------- */\r\n    aspectosAmbientalesRef.current.submit();\r\n    formDetallesRef.current.submit();\r\n    history.push(url.URL_DASHBOARD);\r\n  }\r\n  function handleClose() {\r\n    /* ---------------------------------------------------------------------------------------------- */\r\n    /*           Verificar si toca culminar el proceso o solo salir a la bandeja de entrada           */\r\n    /* ---------------------------------------------------------------------------------------------- */\r\n    history.push(url.URL_DASHBOARD);\r\n  }\r\n  function submitData() {\r\n\r\n    const servicioRiesgoAmbiental = new BackendServices();\r\n    if (!formDetallesRef.current.getFormValidation()) {\r\n      formDetallesRef.current.validateForm();\r\n      return false;\r\n    } else {\r\n      if (!aspectosAmbientalesRef.current.getFormValidation()) {\r\n        aspectosAmbientalesRef.current.validateForm();\r\n        return false;\r\n      }\r\n      formDetallesRef.current.dataReturn.transactId = Number(dataLocation.transactionId);\r\n      const datos=formDetallesRef.current.dataReturn;\r\n      const dataDetails = {\r\n        \"transactId\": Number(dataLocation.transactionId),\r\n        \"environmentCovenant\":datos.environmentCovenant?datos.environmentCovenant:false,\r\n        \"detail\":datos.detail?datos.detail:\"\",\r\n        \"compliance\":datos.compliance?datos.compliance:\"\",\r\n        \"term\":datos.term?datos.term:\"\",\r\n        \"detected\":datos.detected?datos.detected:\"\",\r\n        \"recommendations\":datos.recommendations?datos.recommendations:\"\",\r\n        \"conclusions\":datos.conclusions?datos.conclusions:\"\"\r\n      }\r\n      servicioRiesgoAmbiental.nuevoInformacionRiesgoAmbiental(dataDetails)\r\n        .then((result) => {\r\n          if (result != undefined) {\r\n            servicioRiesgoAmbiental.guardarAspectosAmbientalesIGR(aspectosAmbientalesRef.current.dataReturn).then(resp => {\r\n              if (resp != undefined) {\r\n                setsuccessSave_dlg(true);\r\n              } else {\r\n                seterror_dlg(true)\r\n              }\r\n              setIsActiveLoading(false);\r\n            })\r\n          } else {\r\n            seterror_dlg(true)\r\n            setIsActiveLoading(false);\r\n          }\r\n\r\n        });\r\n    }\r\n  }\r\n  return (\r\n\r\n    <RiesgoAmbientalContext.Provider value={context}>\r\n\r\n      <div className=\"page-content\">\r\n\r\n        <Breadcrumbs title={n(\"Commercial Credit\")} breadcrumbItem={n(\"Environmental Risk\")} />\r\n        <LoadingOverlay active={isActiveLoading} spinner text={t(\"Processinginformation\")}>\r\n\r\n          <Card>\r\n            <CardBody>\r\n              <Row>\r\n                <Col xl=\"12\">\r\n                  <AspectosAmbientales datosGenerales={modelo.datosGenerales} locationData={location.data} dataAspectosAmbientales={modelo.dataAspectosAmbientales} ref={aspectosAmbientalesRef} onSubmit={submitData} />\r\n                </Col>\r\n              </Row>\r\n            </CardBody>\r\n          </Card>\r\n        <Row>\r\n          <Col xl=\"12\">\r\n            <FormDetalles ref={formDetallesRef} />\r\n          </Col>\r\n        </Row>\r\n        </LoadingOverlay>\r\n\r\n        <Row className=\"my-2\">\r\n          <Col xl=\"12 text-end\">\r\n            <Button id=\"btnClose\" color=\"dark\" type=\"button\" style={{ margin: '5px' }} onClick={handleClose}>\r\n              <i className=\"mdi mdi-arrow-left-bold-circle-outline mid-12px\"></i>\r\n              {\" \"} {c(\"Close\")}\r\n            </Button>\r\n            <Button id=\"btnSubmit\" color=\"success\" type=\"button\" style={{ margin: '5px' }} onClick={() => {\r\n              submitData(); setIsActiveLoading(true); setTimeout(() => {\r\n                submitData();\r\n              }, 1000);\r\n            }}>\r\n              <i className=\"mdi mdi-content-save mdi-12px\"></i>\r\n              {\" \"}{c(\"Save\")}\r\n            </Button>\r\n\r\n          </Col>\r\n        </Row>\r\n\r\n      </div>\r\n      {successSave_dlg ? (\r\n        <SweetAlert\r\n          success\r\n          title={t(\"SuccessDialog\")}\r\n          onConfirm={() => {\r\n            setsuccessSave_dlg(false)\r\n          }}\r\n        >\r\n          {t(\"SuccessSaveMessage\")}\r\n        </SweetAlert>\r\n      ) : null}\r\n\r\n      {error_dlg ? (\r\n        <SweetAlert\r\n          error\r\n          title={t(\"ErrorDialog\")}\r\n          onConfirm={() => {\r\n            seterror_dlg(false)\r\n          }}\r\n        >\r\n          {error_msg}\r\n        </SweetAlert>\r\n      ) : null}\r\n    </RiesgoAmbientalContext.Provider>\r\n  );\r\n\r\n}\r\n\r\n\r\nexport default RiesgoAmbientalDetalle;\r\n"]},"metadata":{},"sourceType":"module"}
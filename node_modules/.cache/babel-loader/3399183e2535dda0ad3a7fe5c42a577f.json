{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _createForOfIteratorHelper from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{withTranslation}from\"react-i18next\";import{Row,Col,Button,Label,Input,Modal,Card,CardBody,CardFooter}from\"reactstrap\";import{AvForm,AvField}from\"availity-reactstrap-validation\";import{translationHelpers}from\"../../../../helpers\";import{BackendServices,BpmServices,CoreServices}from\"../../../../services\";import{useHistory,useLocation}from\"react-router-dom\";import*as url from\"../../../../helpers/url_helper\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LevelAutonomy=function LevelAutonomy(props){var _translationHelpers=translationHelpers('translation','common'),_translationHelpers2=_slicedToArray(_translationHelpers,2),t=_translationHelpers2[0],c=_translationHelpers2[1];var _useState=useState(0),_useState2=_slicedToArray(_useState,2),levelAutonomy=_useState2[0],setLevelAutonomy=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),levelAutonomyPosition=_useState4[0],setLevelAutonomyPosition=_useState4[1];var bpmServices=new BpmServices();var backendServices=new BackendServices();var coreServices=new CoreServices();var location=useLocation();var history=useHistory();var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),locationData=_useState6[0],setLocationData=_useState6[1];useEffect(function(){var dataSession;if(location.data!==null&&location.data!==undefined){if(location.data.transactionId===undefined||location.data.transactionId.length<=0){//location.data.transactionId = 0;\n//checkAndCreateProcedure(location.data);\nhistory.push(url.URL_DASHBOARD);}else{sessionStorage.setItem('locationData',JSON.stringify(location.data));setLocationData(location.data);dataSession=location.data;}}else{//chequeamos si tenemos guardado en session\nvar result=sessionStorage.getItem('locationData');if(result!==undefined&&result!==null){result=JSON.parse(result);setLocationData(result);dataSession=result;}}getFacilityHistory({dataSession:dataSession});},[]);useEffect(function(){(levelAutonomy===null||levelAutonomy===void 0?void 0:levelAutonomy.amount)>0&&bpmServices.saveAutonomy(levelAutonomy).then(function(resp){var _resp$body,_resp$body$result$dmn,_resp$body$result$dmn2,_resp$body2,_resp$body2$result$dm,_resp$body2$result$dm2;var banca=resp===null||resp===void 0?void 0:(_resp$body=resp.body)===null||_resp$body===void 0?void 0:(_resp$body$result$dmn=_resp$body.result['dmn-evaluation-result']['dmn-context'])===null||_resp$body$result$dmn===void 0?void 0:(_resp$body$result$dmn2=_resp$body$result$dmn.autonomiaduales)===null||_resp$body$result$dmn2===void 0?void 0:_resp$body$result$dmn2.banca;var credito=resp===null||resp===void 0?void 0:(_resp$body2=resp.body)===null||_resp$body2===void 0?void 0:(_resp$body2$result$dm=_resp$body2.result['dmn-evaluation-result']['dmn-context'])===null||_resp$body2$result$dm===void 0?void 0:(_resp$body2$result$dm2=_resp$body2$result$dm.autonomiaduales)===null||_resp$body2$result$dm2===void 0?void 0:_resp$body2$result$dm2.credito;setLevelAutonomyPosition({banca:banca,credito:credito});}).catch(function(err){console.log(err);});},[levelAutonomy,props.levelAutonomy]);function getFacilityHistory(_x){return _getFacilityHistory.apply(this,arguments);}function _getFacilityHistory(){_getFacilityHistory=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref){var _dataSession$transact;var _ref$dataSession,dataSession;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_ref$dataSession=_ref.dataSession,dataSession=_ref$dataSession===void 0?locationData:_ref$dataSession;_context3.next=3;return backendServices.consultGeneralDataPropCred((_dataSession$transact=dataSession===null||dataSession===void 0?void 0:dataSession.transactionId)!==null&&_dataSession$transact!==void 0?_dataSession$transact:0).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(propuesta){var _propuesta$;var requestId;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:requestId=(_propuesta$=propuesta[0])===null||_propuesta$===void 0?void 0:_propuesta$.requestId;backendServices.consultarFacilidades(requestId!==null&&requestId!==void 0?requestId:'').then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(resp){var _guaranteePrendario$c,_guaranteePrendario,guaranteePrendario,_iterator,_step,facility,guarantee,tipo,amount,_expositionCorporativ,_expositionCorporativ2,expositionCorporative,facilityCP,facilityLP,facilities,jsonFacilidades,amountCP,amountLP,ltvCP,ltvLP,_ref4,amounting,ltv;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(resp.length>0&&resp!=undefined)){_context.next=42;break;}_iterator=_createForOfIteratorHelper(resp);_context.prev=2;_iterator.s();case 4:if((_step=_iterator.n()).done){_context.next=14;break;}facility=_step.value;_context.next=8;return backendServices.consultarGarantiaPropCred(facility.facilityId);case 8:guarantee=_context.sent;guaranteePrendario=guarantee.find(function(prendario){return prendario.guaranteeTypeName==='500';});if(!guaranteePrendario){_context.next=12;break;}return _context.abrupt(\"break\",14);case 12:_context.next=4;break;case 14:_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](2);_iterator.e(_context.t0);case 19:_context.prev=19;_iterator.f();return _context.finish(19);case 22:tipo=guaranteePrendario?'3':'';amount=(_guaranteePrendario$c=(_guaranteePrendario=guaranteePrendario)===null||_guaranteePrendario===void 0?void 0:_guaranteePrendario.commercialValue)!==null&&_guaranteePrendario$c!==void 0?_guaranteePrendario$c:0;if(!(tipo!=='3')){_context.next=41;break;}_context.next=27;return backendServices.getExposicionCorporativaBD(dataSession.transactionId);case 27:expositionCorporative=_context.sent;facilityCP=(_expositionCorporativ=expositionCorporative.find(function(x){return x.description.toUpperCase()===\"Facilidades Corto Plazo\".toUpperCase();}))!==null&&_expositionCorporativ!==void 0?_expositionCorporativ:{\"approved\":0,\"currentBalance\":0,\"ltv\":0,\"proposed\":0,\"guarantee\":0};facilityLP=(_expositionCorporativ2=expositionCorporative.find(function(x){return x.description.toUpperCase()===\"Facilidades Largo Plazo\".toUpperCase();}))!==null&&_expositionCorporativ2!==void 0?_expositionCorporativ2:{\"approved\":0,\"currentBalance\":0,\"ltv\":0,\"proposed\":0,\"guarantee\":0};_context.next=32;return backendServices.consultarFacilidadesExposicionCorporativa(requestId!==null&&requestId!==void 0?requestId:'');case 32:facilities=_context.sent;jsonFacilidades={CP:facilities.CP.reduce(function(acu,crr){return acu+crr.requestAmount;},0)||0,LP:facilities.LP.reduce(function(acu,crr){return acu+crr.requestAmount;},0)||0};amountCP=parseFloat(facilityCP.approved)+parseFloat(jsonFacilidades.CP);amountLP=parseFloat(facilityLP.currentBalance)+parseFloat(jsonFacilidades.LP);ltvCP=facilityCP.guarantee>0?parseFloat(facilityCP.proposed)/parseFloat(facilityCP.guarantee)*100:0;ltvLP=facilityLP.guarantee>0?parseFloat(facilityLP.proposed)/parseFloat(facilityLP.guarantee)*100:0;_ref4=amountCP>amountLP?{amount:amountCP,ltv:ltvCP}:{amount:amountLP,ltv:ltvLP},amounting=_ref4.amount,ltv=_ref4.ltv;amount=amounting;tipo=ltv>=70?'1':'2';case 41:setLevelAutonomy({tipo:tipo,amount:amount});case 42:case\"end\":return _context.stop();}}},_callee,null,[[2,16,19,22]]);}));return function(_x3){return _ref3.apply(this,arguments);};}());case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}());case 3:case\"end\":return _context3.stop();}}},_callee3);}));return _getFacilityHistory.apply(this,arguments);}return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"card-title mt-2\",style:{textAlign:\"left\",fontSize:'21px!important'},children:[t(\"Level of Autonomy\"),\" \",t(\"Creditt\"),\": \",/*#__PURE__*/_jsx(\"br\",{}),levelAutonomyPosition.credito]}),/*#__PURE__*/_jsxs(\"h5\",{className:\"card-title mt-2\",style:{textAlign:\"right\",fontSize:'21px!important'},children:[t(\"Level of Autonomy\"),\" \",t(\"Banking\"),\": \",/*#__PURE__*/_jsx(\"br\",{}),levelAutonomyPosition.banca]})]});};export default withTranslation()(LevelAutonomy);","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/CommercialCredit/5_PropuestaCredito/Secciones/LevelAutonomy.js"],"names":["React","useEffect","useState","withTranslation","Row","Col","Button","Label","Input","Modal","Card","CardBody","CardFooter","AvForm","AvField","translationHelpers","BackendServices","BpmServices","CoreServices","useHistory","useLocation","url","LevelAutonomy","props","t","c","levelAutonomy","setLevelAutonomy","levelAutonomyPosition","setLevelAutonomyPosition","bpmServices","backendServices","coreServices","location","history","locationData","setLocationData","dataSession","data","undefined","transactionId","length","push","URL_DASHBOARD","sessionStorage","setItem","JSON","stringify","result","getItem","parse","getFacilityHistory","amount","saveAutonomy","then","resp","banca","body","autonomiaduales","credito","catch","err","console","log","consultGeneralDataPropCred","propuesta","requestId","consultarFacilidades","facility","consultarGarantiaPropCred","facilityId","guarantee","guaranteePrendario","find","prendario","guaranteeTypeName","tipo","commercialValue","getExposicionCorporativaBD","expositionCorporative","facilityCP","x","description","toUpperCase","facilityLP","consultarFacilidadesExposicionCorporativa","facilities","jsonFacilidades","CP","reduce","acu","crr","requestAmount","LP","amountCP","parseFloat","approved","amountLP","currentBalance","ltvCP","proposed","ltvLP","ltv","amounting","textAlign","fontSize"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\"\r\nimport { withTranslation } from \"react-i18next\"\r\nimport PropTypes from 'prop-types';\r\n\r\nimport {\r\n  Row,\r\n  Col,\r\n  Button,\r\n  Label,\r\n  Input,\r\n  Modal,\r\n  Card,\r\n  CardBody,\r\n  CardFooter,\r\n} from \"reactstrap\"\r\n\r\nimport { AvForm, AvField } from \"availity-reactstrap-validation\"\r\nimport { translationHelpers } from \"../../../../helpers\";\r\nimport { BackendServices, BpmServices, CoreServices } from \"../../../../services\";\r\nimport { useHistory, useLocation } from \"react-router-dom\";\r\nimport * as url from \"../../../../helpers/url_helper\"\r\n\r\nconst LevelAutonomy = (props) => {\r\n  const [t, c] = translationHelpers('translation', 'common');\r\n  const [levelAutonomy, setLevelAutonomy] = useState(0);\r\n  const [levelAutonomyPosition, setLevelAutonomyPosition] = useState('');\r\n  const bpmServices = new BpmServices();\r\n  const backendServices = new BackendServices();\r\n  const coreServices = new CoreServices();\r\n\r\n  const location = useLocation();\r\n  const history = useHistory();\r\n  const [locationData, setLocationData] = useState(null);\r\n\r\n  useEffect(() => {\r\n\r\n    let dataSession;\r\n    if (location.data !== null && location.data !== undefined) {\r\n      if (location.data.transactionId === undefined || location.data.transactionId.length <= 0) {\r\n        //location.data.transactionId = 0;\r\n        //checkAndCreateProcedure(location.data);\r\n        history.push(url.URL_DASHBOARD);\r\n      }\r\n      else {\r\n        sessionStorage.setItem('locationData', JSON.stringify(location.data));\r\n        setLocationData(location.data);\r\n        dataSession = location.data;\r\n      }\r\n    }\r\n    else {\r\n      //chequeamos si tenemos guardado en session\r\n      var result = sessionStorage.getItem('locationData');\r\n      if (result !== undefined && result !== null) {\r\n        result = JSON.parse(result);\r\n        setLocationData(result);\r\n        dataSession = result\r\n      }\r\n    }\r\n\r\n    getFacilityHistory({ dataSession })\r\n\r\n  }, []);\r\n\r\n\r\n  useEffect(() => {\r\n    levelAutonomy?.amount > 0 && bpmServices.saveAutonomy(levelAutonomy).then(resp => {\r\n      let banca = resp?.body?.result['dmn-evaluation-result']['dmn-context']?.autonomiaduales?.banca;\r\n      let credito = resp?.body?.result['dmn-evaluation-result']['dmn-context']?.autonomiaduales?.credito;\r\n      setLevelAutonomyPosition({ banca, credito })\r\n    }).catch(err => {\r\n      console.log(err)\r\n    });\r\n  }, [levelAutonomy, props.levelAutonomy])\r\n\r\n  async function getFacilityHistory({ dataSession = locationData }) {\r\n    //guarantee prendaria code 500\r\n    await backendServices.consultGeneralDataPropCred(dataSession?.transactionId ?? 0).then(async propuesta => {\r\n      let requestId = propuesta[0]?.requestId;\r\n      backendServices.consultarFacilidades(requestId ?? '').then(async resp => {\r\n        if (resp.length > 0 && resp != undefined) {\r\n          let guaranteePrendario;\r\n          for (const facility of resp) {\r\n            let guarantee = await backendServices.consultarGarantiaPropCred(facility.facilityId)\r\n            guaranteePrendario = guarantee.find(prendario => prendario.guaranteeTypeName === '500')\r\n            if (guaranteePrendario)\r\n              break;\r\n          }\r\n          let tipo = guaranteePrendario ? '3' : '';\r\n          let amount = guaranteePrendario?.commercialValue ?? 0;\r\n\r\n          if (tipo !== '3') {\r\n            let expositionCorporative = await backendServices.getExposicionCorporativaBD(dataSession.transactionId);\r\n            let facilityCP = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Corto Plazo\".toUpperCase()) ?? {\r\n              \"approved\": 0,\r\n              \"currentBalance\": 0,\r\n              \"ltv\": 0,\r\n              \"proposed\": 0,\r\n              \"guarantee\": 0,\r\n            }\r\n            let facilityLP = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Largo Plazo\".toUpperCase()) ?? {\r\n              \"approved\": 0,\r\n              \"currentBalance\": 0,\r\n              \"ltv\": 0,\r\n              \"proposed\": 0,\r\n              \"guarantee\": 0,\r\n            }\r\n\r\n            let facilities = await backendServices.consultarFacilidadesExposicionCorporativa(requestId ?? '');\r\n            let jsonFacilidades = {\r\n              CP: facilities.CP.reduce((acu, crr) => (acu + crr.requestAmount), 0) || 0,\r\n              LP: facilities.LP.reduce((acu, crr) => (acu + crr.requestAmount), 0) || 0,\r\n            }\r\n            let amountCP = parseFloat(facilityCP.approved) + parseFloat(jsonFacilidades.CP);\r\n            let amountLP = parseFloat(facilityLP.currentBalance) + parseFloat(jsonFacilidades.LP);\r\n\r\n            let ltvCP = facilityCP.guarantee > 0 ? parseFloat(facilityCP.proposed) / parseFloat(facilityCP.guarantee) * 100 : 0;\r\n            let ltvLP = facilityLP.guarantee > 0 ? parseFloat(facilityLP.proposed) / parseFloat(facilityLP.guarantee) * 100 : 0;\r\n\r\n            const { amount: amounting, ltv } = amountCP > amountLP ? { amount: amountCP, ltv: ltvCP } : { amount: amountLP, ltv: ltvLP };\r\n            amount = amounting;\r\n            tipo = ltv >= 70 ? '1' : '2';\r\n\r\n          }\r\n          setLevelAutonomy({ tipo, amount })\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <h5 className=\"card-title mt-2\" style={{ textAlign: \"left\", fontSize: '21px!important' }}>{t(\"Level of Autonomy\")} {t(\"Creditt\")}: <br />{levelAutonomyPosition.credito}</h5>\r\n      <h5 className=\"card-title mt-2\" style={{ textAlign: \"right\", fontSize: '21px!important' }}>{t(\"Level of Autonomy\")} {t(\"Banking\")}: <br />{levelAutonomyPosition.banca}</h5>\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default (withTranslation()(LevelAutonomy));\r\n"]},"metadata":{},"sourceType":"module"}
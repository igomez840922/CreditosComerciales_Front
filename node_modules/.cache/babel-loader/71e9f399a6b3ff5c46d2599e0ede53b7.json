{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{withTranslation}from\"react-i18next\";import{Row,Col,Button,Label,Input,Modal,Card,CardBody,CardFooter}from\"reactstrap\";import{AvForm,AvField}from\"availity-reactstrap-validation\";import{translationHelpers}from\"../../../../helpers\";import{BackendServices,BpmServices,CoreServices}from\"../../../../services\";import{useHistory,useLocation}from\"react-router-dom\";import*as url from\"../../../../helpers/url_helper\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var LevelAutonomy=function LevelAutonomy(props){var _translationHelpers=translationHelpers('translation','common'),_translationHelpers2=_slicedToArray(_translationHelpers,2),t=_translationHelpers2[0],c=_translationHelpers2[1];var _useState=useState(0),_useState2=_slicedToArray(_useState,2),levelAutonomy=_useState2[0],setLevelAutonomy=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),levelAutonomyPosition=_useState4[0],setLevelAutonomyPosition=_useState4[1];var bpmServices=new BpmServices();var backendServices=new BackendServices();var coreServices=new CoreServices();var location=useLocation();var history=useHistory();var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),locationData=_useState6[0],setLocationData=_useState6[1];var MODEL_FACILITY={\"approved\":0,\"currentBalance\":0,\"ltv\":0,\"proposed\":0,\"guarantee\":0};useEffect(function(){var dataSession;if(location.data!==null&&location.data!==undefined){if(location.data.transactionId===undefined||location.data.transactionId.length<=0){history.push(url.URL_DASHBOARD);}else{sessionStorage.setItem('locationData',JSON.stringify(location.data));setLocationData(location.data);dataSession=location.data;}}else{//chequeamos si tenemos guardado en session\nvar result=sessionStorage.getItem('locationData');if(result!==undefined&&result!==null){result=JSON.parse(result);setLocationData(result);dataSession=result;}}getFacilityHistory({dataSession:dataSession});},[]);useEffect(function(){(levelAutonomy===null||levelAutonomy===void 0?void 0:levelAutonomy.amount)>0&&bpmServices.saveAutonomy(levelAutonomy).then(function(resp){var _resp$body,_resp$body$result$dmn,_resp$body$result$dmn2,_resp$body2,_resp$body2$result$dm,_resp$body2$result$dm2;var banca=resp===null||resp===void 0?void 0:(_resp$body=resp.body)===null||_resp$body===void 0?void 0:(_resp$body$result$dmn=_resp$body.result['dmn-evaluation-result']['dmn-context'])===null||_resp$body$result$dmn===void 0?void 0:(_resp$body$result$dmn2=_resp$body$result$dmn.autonomiaduales)===null||_resp$body$result$dmn2===void 0?void 0:_resp$body$result$dmn2.banca;var credito=resp===null||resp===void 0?void 0:(_resp$body2=resp.body)===null||_resp$body2===void 0?void 0:(_resp$body2$result$dm=_resp$body2.result['dmn-evaluation-result']['dmn-context'])===null||_resp$body2$result$dm===void 0?void 0:(_resp$body2$result$dm2=_resp$body2$result$dm.autonomiaduales)===null||_resp$body2$result$dm2===void 0?void 0:_resp$body2$result$dm2.credito;setLevelAutonomyPosition({banca:banca,credito:credito});}).catch(function(err){console.log(err);});},[levelAutonomy,props.levelAutonomy]);function getFacilityHistory(_x){return _getFacilityHistory.apply(this,arguments);}function _getFacilityHistory(){_getFacilityHistory=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref){var _dataSession$transact;var _ref$dataSession,dataSession;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_ref$dataSession=_ref.dataSession,dataSession=_ref$dataSession===void 0?locationData:_ref$dataSession;//facility type prendaria code PR\nPromise.allSettled([backendServices.consultGeneralDataPropCred((_dataSession$transact=dataSession===null||dataSession===void 0?void 0:dataSession.transactionId)!==null&&_dataSession$transact!==void 0?_dataSession$transact:0)]).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(allPromise){var _propuesta$,_facilitiesProposal$r,_facilitiesProposal$r2;var _allPromise,propuesta,requestId,facilitiesProposal,tipo,amount,ltv,_expositionCorporativ,_expositionCorporativ2,expositionCorporative,facilityCP,facilityLP,facilities,jsonFacilidades,amountCP,amountLP,ltvCP,ltvLP,_ref3,amounting,ltvF;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_allPromise=_slicedToArray(allPromise,1),propuesta=_allPromise[0].value;requestId=(_propuesta$=propuesta[0])===null||_propuesta$===void 0?void 0:_propuesta$.requestId;_context.next=4;return backendServices.consultarFacilidades(requestId!==null&&requestId!==void 0?requestId:'');case 4:facilitiesProposal=_context.sent;tipo=(facilitiesProposal===null||facilitiesProposal===void 0?void 0:facilitiesProposal.some(function(facility){return facility.facilityTypeId==='PR';}))?'4':'';amount=(_facilitiesProposal$r=facilitiesProposal===null||facilitiesProposal===void 0?void 0:facilitiesProposal.reduce(function(acu,crr){return crr.facilityTypeId==='PR'?acu+crr.amount:0;},0))!==null&&_facilitiesProposal$r!==void 0?_facilitiesProposal$r:0;ltv=(_facilitiesProposal$r2=facilitiesProposal===null||facilitiesProposal===void 0?void 0:facilitiesProposal.reduce(function(acu,crr){return crr.facilityTypeId==='PR'?acu+crr.ltv:0;},0))!==null&&_facilitiesProposal$r2!==void 0?_facilitiesProposal$r2:0;if(!(tipo!=='4')){_context.next=26;break;}_context.next=11;return backendServices.getExposicionCorporativaBD(dataSession.transactionId);case 11:expositionCorporative=_context.sent;facilityCP=(_expositionCorporativ=expositionCorporative.find(function(x){return x.description.toUpperCase()===\"Facilidades Corto Plazo\".toUpperCase();}))!==null&&_expositionCorporativ!==void 0?_expositionCorporativ:MODEL_FACILITY;facilityLP=(_expositionCorporativ2=expositionCorporative.find(function(x){return x.description.toUpperCase()===\"Facilidades Largo Plazo\".toUpperCase();}))!==null&&_expositionCorporativ2!==void 0?_expositionCorporativ2:MODEL_FACILITY;_context.next=16;return backendServices.consultarFacilidadesExposicionCorporativa(requestId!==null&&requestId!==void 0?requestId:'');case 16:facilities=_context.sent;jsonFacilidades={CP:facilities.CP.reduce(function(acu,crr){return acu+crr.requestAmount;},0)||0,LP:facilities.LP.reduce(function(acu,crr){return acu+crr.requestAmount;},0)||0};amountCP=parseFloat(facilityCP.approved)+parseFloat(jsonFacilidades.CP);amountLP=parseFloat(facilityLP.currentBalance)+parseFloat(jsonFacilidades.LP);ltvCP=facilityCP.guarantee>0?parseFloat(facilityCP.proposed)/parseFloat(facilityCP.guarantee)*100:0;ltvLP=facilityLP.guarantee>0?parseFloat(facilityLP.proposed)/parseFloat(facilityLP.guarantee)*100:0;_ref3=amountCP>amountLP?{amount:amountCP,ltvF:ltvCP}:{amount:amountLP,ltvF:ltvLP},amounting=_ref3.amount,ltvF=_ref3.ltv;amount=amounting;ltv=ltvF;tipo=ltv>=70?'1':'2';case 26:setLevelAutonomy({tipo:tipo,amount:amount});case 27:case\"end\":return _context.stop();}}},_callee);}));return function(_x2){return _ref2.apply(this,arguments);};}()).catch(function(err){console.log(err);});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return _getFacilityHistory.apply(this,arguments);}return/*#__PURE__*/_jsx(React.Fragment,{children:(props===null||props===void 0?void 0:props.fideicomiso)?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Col,{sm:\"3\",className:\"d-flex flex-column\",children:[/*#__PURE__*/_jsxs(\"strong\",{htmlFor:\"clientNumber\",children:[t(\"Level of Autonomy\"),\" \",t(\"Creditt\")]}),/*#__PURE__*/_jsx(\"label\",{children:levelAutonomyPosition.credito})]}),/*#__PURE__*/_jsxs(Col,{sm:\"3\",className:\"d-flex flex-column\",children:[/*#__PURE__*/_jsxs(\"strong\",{htmlFor:\"clientNumber\",children:[t(\"Level of Autonomy\"),\" \",t(\"Banking\")]}),/*#__PURE__*/_jsx(\"label\",{children:levelAutonomyPosition.banca})]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"card-title mt-2\",style:{textAlign:\"left\",fontSize:'21px!important'},children:[t(\"Level of Autonomy\"),\" \",t(\"Creditt\"),\": \",/*#__PURE__*/_jsx(\"br\",{}),levelAutonomyPosition.credito]}),/*#__PURE__*/_jsxs(\"h5\",{className:\"card-title mt-2\",style:{textAlign:\"right\",fontSize:'21px!important'},children:[t(\"Level of Autonomy\"),\" \",t(\"Banking\"),\": \",/*#__PURE__*/_jsx(\"br\",{}),levelAutonomyPosition.banca]})]})});};export default withTranslation()(LevelAutonomy);","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/CommercialCredit/5_PropuestaCredito/Secciones/LevelAutonomy.js"],"names":["React","useEffect","useState","withTranslation","Row","Col","Button","Label","Input","Modal","Card","CardBody","CardFooter","AvForm","AvField","translationHelpers","BackendServices","BpmServices","CoreServices","useHistory","useLocation","url","LevelAutonomy","props","t","c","levelAutonomy","setLevelAutonomy","levelAutonomyPosition","setLevelAutonomyPosition","bpmServices","backendServices","coreServices","location","history","locationData","setLocationData","MODEL_FACILITY","dataSession","data","undefined","transactionId","length","push","URL_DASHBOARD","sessionStorage","setItem","JSON","stringify","result","getItem","parse","getFacilityHistory","amount","saveAutonomy","then","resp","banca","body","autonomiaduales","credito","catch","err","console","log","Promise","allSettled","consultGeneralDataPropCred","allPromise","propuesta","value","requestId","consultarFacilidades","facilitiesProposal","tipo","some","facility","facilityTypeId","reduce","acu","crr","ltv","getExposicionCorporativaBD","expositionCorporative","facilityCP","find","x","description","toUpperCase","facilityLP","consultarFacilidadesExposicionCorporativa","facilities","jsonFacilidades","CP","requestAmount","LP","amountCP","parseFloat","approved","amountLP","currentBalance","ltvCP","guarantee","proposed","ltvLP","ltvF","amounting","fideicomiso","textAlign","fontSize"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\"\r\nimport { withTranslation } from \"react-i18next\"\r\nimport PropTypes from 'prop-types';\r\n\r\nimport {\r\n  Row,\r\n  Col,\r\n  Button,\r\n  Label,\r\n  Input,\r\n  Modal,\r\n  Card,\r\n  CardBody,\r\n  CardFooter,\r\n} from \"reactstrap\"\r\n\r\nimport { AvForm, AvField } from \"availity-reactstrap-validation\"\r\nimport { translationHelpers } from \"../../../../helpers\";\r\nimport { BackendServices, BpmServices, CoreServices } from \"../../../../services\";\r\nimport { useHistory, useLocation } from \"react-router-dom\";\r\nimport * as url from \"../../../../helpers/url_helper\"\r\n\r\nconst LevelAutonomy = (props) => {\r\n  const [t, c] = translationHelpers('translation', 'common');\r\n  const [levelAutonomy, setLevelAutonomy] = useState(0);\r\n  const [levelAutonomyPosition, setLevelAutonomyPosition] = useState('');\r\n  const bpmServices = new BpmServices();\r\n  const backendServices = new BackendServices();\r\n  const coreServices = new CoreServices();\r\n\r\n  const location = useLocation();\r\n  const history = useHistory();\r\n  const [locationData, setLocationData] = useState(null);\r\n\r\n  const MODEL_FACILITY = {\r\n    \"approved\": 0,\r\n    \"currentBalance\": 0,\r\n    \"ltv\": 0,\r\n    \"proposed\": 0,\r\n    \"guarantee\": 0,\r\n  }\r\n\r\n  useEffect(() => {\r\n\r\n    let dataSession;\r\n    if (location.data !== null && location.data !== undefined) {\r\n      if (location.data.transactionId === undefined || location.data.transactionId.length <= 0) {\r\n        history.push(url.URL_DASHBOARD);\r\n      }\r\n      else {\r\n        sessionStorage.setItem('locationData', JSON.stringify(location.data));\r\n        setLocationData(location.data);\r\n        dataSession = location.data;\r\n      }\r\n    }\r\n    else {\r\n      //chequeamos si tenemos guardado en session\r\n      var result = sessionStorage.getItem('locationData');\r\n      if (result !== undefined && result !== null) {\r\n        result = JSON.parse(result);\r\n        setLocationData(result);\r\n        dataSession = result\r\n      }\r\n    }\r\n\r\n    getFacilityHistory({ dataSession })\r\n\r\n  }, []);\r\n\r\n\r\n  useEffect(() => {\r\n    levelAutonomy?.amount > 0 && bpmServices.saveAutonomy(levelAutonomy).then(resp => {\r\n      let banca = resp?.body?.result['dmn-evaluation-result']['dmn-context']?.autonomiaduales?.banca;\r\n      let credito = resp?.body?.result['dmn-evaluation-result']['dmn-context']?.autonomiaduales?.credito;\r\n      setLevelAutonomyPosition({ banca, credito })\r\n    }).catch(err => {\r\n      console.log(err)\r\n    });\r\n  }, [levelAutonomy, props.levelAutonomy])\r\n\r\n  async function getFacilityHistory({ dataSession = locationData }) {\r\n    //facility type prendaria code PR\r\n    Promise.allSettled([\r\n      backendServices.consultGeneralDataPropCred(dataSession?.transactionId ?? 0),\r\n    ]).then(async allPromise => {\r\n      const [{ value: propuesta }] = allPromise;\r\n\r\n      let requestId = propuesta[0]?.requestId;\r\n      let facilitiesProposal = await backendServices.consultarFacilidades(requestId ?? '');\r\n\r\n      let tipo = facilitiesProposal?.some(facility => facility.facilityTypeId === 'PR') ? '4' : '';\r\n      let amount = facilitiesProposal?.reduce((acu, crr) => crr.facilityTypeId === 'PR' ? acu + crr.amount : 0, 0) ?? 0;\r\n      let ltv = facilitiesProposal?.reduce((acu, crr) => crr.facilityTypeId === 'PR' ? acu + crr.ltv : 0, 0) ?? 0;\r\n\r\n      if (tipo !== '4') {\r\n        let expositionCorporative = await backendServices.getExposicionCorporativaBD(dataSession.transactionId);\r\n        let facilityCP = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Corto Plazo\".toUpperCase()) ?? MODEL_FACILITY;\r\n        let facilityLP = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Largo Plazo\".toUpperCase()) ?? MODEL_FACILITY;\r\n\r\n        let facilities = await backendServices.consultarFacilidadesExposicionCorporativa(requestId ?? '');\r\n        let jsonFacilidades = {\r\n          CP: facilities.CP.reduce((acu, crr) => (acu + crr.requestAmount), 0) || 0,\r\n          LP: facilities.LP.reduce((acu, crr) => (acu + crr.requestAmount), 0) || 0,\r\n        }\r\n        let amountCP = parseFloat(facilityCP.approved) + parseFloat(jsonFacilidades.CP);\r\n        let amountLP = parseFloat(facilityLP.currentBalance) + parseFloat(jsonFacilidades.LP);\r\n\r\n        let ltvCP = facilityCP.guarantee > 0 ? parseFloat(facilityCP.proposed) / parseFloat(facilityCP.guarantee) * 100 : 0;\r\n        let ltvLP = facilityLP.guarantee > 0 ? parseFloat(facilityLP.proposed) / parseFloat(facilityLP.guarantee) * 100 : 0;\r\n\r\n        const { amount: amounting, ltv: ltvF } = amountCP > amountLP ? { amount: amountCP, ltvF: ltvCP } : { amount: amountLP, ltvF: ltvLP };\r\n        amount = amounting;\r\n        ltv = ltvF;\r\n        tipo = ltv >= 70 ? '1' : '2';\r\n\r\n      }\r\n      setLevelAutonomy({ tipo, amount })\r\n\r\n    }).catch(err => {\r\n      console.log(err)\r\n    })\r\n\r\n  }\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {props?.fideicomiso ? <>\r\n        <Col sm=\"3\" className=\"d-flex flex-column\">\r\n          <strong htmlFor=\"clientNumber\">{t(\"Level of Autonomy\")} {t(\"Creditt\")}</strong>\r\n          <label>{levelAutonomyPosition.credito}</label>\r\n        </Col>\r\n        <Col sm=\"3\" className=\"d-flex flex-column\">\r\n          <strong htmlFor=\"clientNumber\">{t(\"Level of Autonomy\")} {t(\"Banking\")}</strong>\r\n          <label>{levelAutonomyPosition.banca}</label>\r\n        </Col>\r\n      </> : <><h5 className=\"card-title mt-2\" style={{ textAlign: \"left\", fontSize: '21px!important' }}>{t(\"Level of Autonomy\")} {t(\"Creditt\")}: <br />{levelAutonomyPosition.credito}</h5>\r\n        <h5 className=\"card-title mt-2\" style={{ textAlign: \"right\", fontSize: '21px!important' }}>{t(\"Level of Autonomy\")} {t(\"Banking\")}: <br />{levelAutonomyPosition.banca}</h5></>}\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default (withTranslation()(LevelAutonomy));\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _createForOfIteratorHelper from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{translationHelper}from'../../../helpers';import{Card,CardBody,Col,Row,Table}from\"reactstrap\";import{useTranslation}from'react-i18next';import{BackendServices,CoreServices,BpmServices}from\"../../../services\";import{useHistory,useLocation}from\"react-router-dom\";import HeaderSections from\"../../Common/HeaderSections\";import LoadingOverlay from\"react-loading-overlay\";import Currency from\"../../../helpers/currency\";import*as url from\"../../../helpers/url_helper\";import{uniq_key}from\"../../../helpers/unq_key\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Guarantees=function Guarantees(props){var _location$data;var location=useLocation();var apiCore=new CoreServices();var apiBack=new BackendServices();var apiBpm=new BpmServices();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),bodyRows1=_useState2[0],setbodyRows1=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),bodyRows2=_useState4[0],setbodyRows2=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),bodyRows3=_useState6[0],setbodyRows3=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isActiveLoading=_useState8[0],setisActiveLoading=_useState8[1];var _useState9=useState((_location$data=location.data)!==null&&_location$data!==void 0?_location$data:JSON.parse(sessionStorage.getItem('locationData'))),_useState10=_slicedToArray(_useState9,2),dataLocation=_useState10[0],setdataLocation=_useState10[1];var _useTranslation=useTranslation(),t=_useTranslation.t,i18n=_useTranslation.i18n;function initializeData(){var jsonSet={Muebles:{},Inmuebles:{},Depositos:{}};var CustomerNumeroT24=props.customerNumberT24;// const CustomerNumeroT24=user.customerNumberT24;\nsetisActiveLoading(true);apiCore.getColaterals(CustomerNumeroT24).then(function(colaterals){var _loop=function _loop(i){apiCore.getWarrantyDetails(colaterals[i].collateralId,\"Muebles\").then(function(respgarantias){var garantias=respgarantias.Collateral;// console.log(\"Muebles\", garantias);\nif(!garantias)return;setbodyRows1(/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:\"Muebles\"}),/*#__PURE__*/_jsx(\"td\",{children:garantias.EmisionDt?garantias.EmisionDt:\"\"}),/*#__PURE__*/_jsx(\"td\",{children:garantias.AppraisedBy?garantias.AppraisedBy:\"\"}),/*#__PURE__*/_jsxs(\"td\",{children:[\"$ \",garantias.CollateralAmt.Amt?garantias.CollateralAmt.Amt:0]}),/*#__PURE__*/_jsxs(\"td\",{children:[parseFloat(colaterals[i].facilityAmt)/parseFloat(garantias.CollateralAmt.Amt?garantias.CollateralAmt.Amt:0),\"%\"]})]}));}).catch(function(err){console.log(err);});apiCore.getWarrantyDetails(colaterals[i].collateralId,\"Inmuebles\").then(function(respgarantias){var garantias=respgarantias.Collateral;// console.log(\"Inmuebles\", garantias);\nif(!garantias)return;setbodyRows2(/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:\"Inmuebles\"}),/*#__PURE__*/_jsx(\"td\",{children:garantias.EmisionDt?garantias.EmisionDt:\"\"}),/*#__PURE__*/_jsx(\"td\",{children:garantias.AppraisedBy?garantias.AppraisedBy:\"\"}),/*#__PURE__*/_jsxs(\"td\",{children:[\"$ \",garantias.CollateralAmt.Amt?garantias.CollateralAmt.Amt:0]}),/*#__PURE__*/_jsxs(\"td\",{children:[parseFloat(colaterals[i].facilityAmt)/parseFloat(garantias.CollateralAmt.Amt?garantias.CollateralAmt.Amt:0),\"%\"]})]}));});apiCore.getWarrantyDetails(colaterals[i].collateralId,\"Depositos\").then(function(respgarantias){var garantias=respgarantias.Collateral;// console.log(\"Depositos\", garantias);\nif(!garantias)return;setbodyRows3(/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:\"Depositos\"}),/*#__PURE__*/_jsx(\"td\",{children:garantias.EmisionDt?garantias.EmisionDt:\"\"}),/*#__PURE__*/_jsx(\"td\",{children:garantias.AppraisedBy?garantias.AppraisedBy:\"\"}),/*#__PURE__*/_jsxs(\"td\",{children:[\"$ \",garantias.CollateralAmt.Amt?garantias.CollateralAmt.Amt:0]}),/*#__PURE__*/_jsxs(\"td\",{children:[parseFloat(colaterals[i].facilityAmt)/parseFloat(garantias.CollateralAmt.Amt?garantias.CollateralAmt.Amt:0),\"%\"]})]}));});};for(var i=0;i<(colaterals===null||colaterals===void 0?void 0:colaterals.length);i++){_loop(i);}setisActiveLoading(false);}).catch(function(err){});// })\n}var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),locationData=_useState12[0],setLocationData=_useState12[1];var history=useHistory();var currencyData=new Currency();var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),muebles=_useState14[0],setMuebles=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),Inmuebles=_useState16[0],setInmuebles=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),desposito=_useState18[0],setDeposito=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),guaranteesRow=_useState20[0],setGuaranteesRow=_useState20[1];React.useEffect(function(){// initializeData();\nvar dataSession;if(location.data!==null&&location.data!==undefined){if(location.data.transactionId===undefined||location.data.transactionId.length<=0){//location.data.transactionId = 0;\n//checkAndCreateProcedure(location.data);\nhistory.push(url.URL_DASHBOARD);}else{sessionStorage.setItem('locationData',JSON.stringify(location.data));setLocationData(location.data);dataSession=location.data;}}else{//chequeamos si tenemos guardado en session\nvar result=sessionStorage.getItem('locationData');if(result!==undefined&&result!==null){result=JSON.parse(result);setLocationData(result);dataSession=result;}}initializeData2(dataSession);},[]);function initializeData2(dataSession){apiBack.consultGeneralDataPropCred(dataSession.transactionId).then(function(proposal){var requestId=proposal.length===0?undefined:proposal[0].requestId;Promise.allSettled([apiBack.consultarFacilidades(requestId),apiCore.getTipoGarantiaCatalogo()]).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(allPromises){var _allPromises,facilities,guaranteesType,guaranteesArr,_iterator,_step,_guaranteesArr,facility,guarantees,arrGuarantees,rows;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_allPromises=_slicedToArray(allPromises,2),facilities=_allPromises[0].value,guaranteesType=_allPromises[1].value;guaranteesArr=[];_iterator=_createForOfIteratorHelper(facilities);_context.prev=3;_iterator.s();case 5:if((_step=_iterator.n()).done){_context.next=13;break;}facility=_step.value;_context.next=9;return apiBack.consultarGarantiaPropCred(facility.facilityId);case 9:guarantees=_context.sent;(_guaranteesArr=guaranteesArr).push.apply(_guaranteesArr,_toConsumableArray(currencyData.groupBy(guarantees,'guaranteeTypeName')));case 11:_context.next=5;break;case 13:_context.next=18;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](3);_iterator.e(_context.t0);case 18:_context.prev=18;_iterator.f();return _context.finish(18);case 21:guaranteesArr=[].concat.apply([],guaranteesArr);arrGuarantees=currencyData.groupBy(guaranteesArr,'guaranteeTypeName').map(function(guarantee){return guarantee[0];});rows=(arrGuarantees===null||arrGuarantees===void 0?void 0:arrGuarantees.length)===0?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"6\",style:{textAlign:'center'},children:t(\"NoData\")})},uniq_key()+\"1\"):arrGuarantees.map(function(guarantee){var _guaranteesType$Recor,_guaranteesType$Recor2;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:guaranteesType===null||guaranteesType===void 0?void 0:(_guaranteesType$Recor=guaranteesType.Records)===null||_guaranteesType$Recor===void 0?void 0:(_guaranteesType$Recor2=_guaranteesType$Recor.find(function(guaranteeType){return guaranteeType.Code===guarantee.guaranteeTypeName;}))===null||_guaranteesType$Recor2===void 0?void 0:_guaranteesType$Recor2.Description}),/*#__PURE__*/_jsxs(\"td\",{children:[\"$\",currencyData.format(guaranteesArr.filter(function(guaranteeArr){return guaranteeArr.guaranteeTypeName===guarantee.guaranteeTypeName;}).reduce(function(ac,crr){return ac+crr.commercialValue;},0))]}),/*#__PURE__*/_jsxs(\"td\",{children:[\"$\",currencyData.format(guaranteesArr.filter(function(guaranteeArr){return guaranteeArr.guaranteeTypeName===guarantee.guaranteeTypeName;}).reduce(function(ac,crr){return ac+crr.fastValue;},0))]}),/*#__PURE__*/_jsxs(\"td\",{children:[currencyData.format(guaranteesArr.filter(function(guaranteeArr){return guaranteeArr.guaranteeTypeName===guarantee.guaranteeTypeName;}).reduce(function(ac,crr){return ac+crr.ltv;},0)),\"%\"]})]},uniq_key()+\"2\");});setGuaranteesRow(rows);case 25:case\"end\":return _context.stop();}}},_callee,null,[[3,15,18,21]]);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(err){console.log(err);});}).catch(function(err){console.log(err);});}return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(LoadingOverlay,{active:isActiveLoading,spinner:true,text:t(\"WaitingPlease\"),children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{md:\"6\",children:/*#__PURE__*/_jsx(\"h5\",{className:\"card-sub-title\",children:t(\"WarrantyDetails\")})})}),/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(\"div\",{style:{minHeight:\"100px\"},children:/*#__PURE__*/_jsx(Col,{className:\"table-responsive styled-table-div\",children:/*#__PURE__*/_jsxs(Table,{className:\"table table-striped table-hover styled-table table mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:t(\"Type\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"Commercial Value\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"QuickValue\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"LTV\")})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:guaranteesRow})]})})})})})]})});};Guarantees.defaultProps={headers:[],data:[]};export default Guarantees;","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/components/InformeFinanciero/background/Guarantees.js"],"names":["React","useEffect","useState","translationHelper","Card","CardBody","Col","Row","Table","useTranslation","BackendServices","CoreServices","BpmServices","useHistory","useLocation","HeaderSections","LoadingOverlay","Currency","url","uniq_key","Guarantees","props","location","apiCore","apiBack","apiBpm","bodyRows1","setbodyRows1","bodyRows2","setbodyRows2","bodyRows3","setbodyRows3","isActiveLoading","setisActiveLoading","data","JSON","parse","sessionStorage","getItem","dataLocation","setdataLocation","t","i18n","initializeData","jsonSet","Muebles","Inmuebles","Depositos","CustomerNumeroT24","customerNumberT24","getColaterals","then","colaterals","i","getWarrantyDetails","collateralId","respgarantias","garantias","Collateral","EmisionDt","AppraisedBy","CollateralAmt","Amt","parseFloat","facilityAmt","catch","err","console","log","length","locationData","setLocationData","history","currencyData","muebles","setMuebles","setInmuebles","desposito","setDeposito","guaranteesRow","setGuaranteesRow","dataSession","undefined","transactionId","push","URL_DASHBOARD","setItem","stringify","result","initializeData2","consultGeneralDataPropCred","proposal","requestId","Promise","allSettled","consultarFacilidades","getTipoGarantiaCatalogo","allPromises","facilities","value","guaranteesType","guaranteesArr","facility","consultarGarantiaPropCred","facilityId","guarantees","groupBy","concat","apply","arrGuarantees","map","guarantee","rows","textAlign","Records","find","guaranteeType","Code","guaranteeTypeName","Description","format","filter","guaranteeArr","reduce","ac","crr","commercialValue","fastValue","ltv","minHeight","defaultProps","headers"],"mappings":"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","sourcesContent":["\r\nimport React, { useEffect, useState } from \"react\"\r\nimport PropTypes from 'prop-types';\r\nimport { translationHelper } from '../../../helpers';\r\n\r\nimport {\r\n  Card,\r\n  CardBody,\r\n  Col,\r\n  Row,\r\n  Table,\r\n} from \"reactstrap\"\r\nimport { useTranslation } from 'react-i18next';\r\nimport { BackendServices, CoreServices, BpmServices, } from \"../../../services\";\r\nimport { useHistory, useLocation } from \"react-router-dom\";\r\nimport HeaderSections from \"../../Common/HeaderSections\";\r\nimport LoadingOverlay from \"react-loading-overlay\";\r\nimport Currency from \"../../../helpers/currency\";\r\nimport * as url from \"../../../helpers/url_helper\"\r\nimport { uniq_key } from \"../../../helpers/unq_key\";\r\n\r\n\r\nconst Guarantees = (props) => {\r\n  const location = useLocation();\r\n  const apiCore = new CoreServices();\r\n  const apiBack = new BackendServices();\r\n  const apiBpm = new BpmServices();\r\n  const [bodyRows1, setbodyRows1] = useState(null);\r\n  const [bodyRows2, setbodyRows2] = useState(null);\r\n  const [bodyRows3, setbodyRows3] = useState(null);\r\n  const [isActiveLoading, setisActiveLoading] = useState(false);\r\n  const [dataLocation, setdataLocation] = useState(location.data ?? JSON.parse(sessionStorage.getItem('locationData')));\r\n  const { t, i18n } = useTranslation();\r\n  function initializeData() {\r\n    const jsonSet = {\r\n      Muebles: {},\r\n      Inmuebles: {},\r\n      Depositos: {},\r\n    }\r\n    const CustomerNumeroT24 = props.customerNumberT24;\r\n    // const CustomerNumeroT24=user.customerNumberT24;\r\n    setisActiveLoading(true);\r\n\r\n\r\n\r\n    apiCore.getColaterals(CustomerNumeroT24).then(colaterals => {\r\n      for (let i = 0; i < colaterals?.length; i++) {\r\n        apiCore.getWarrantyDetails(colaterals[i].collateralId, \"Muebles\").then(respgarantias => {\r\n          let garantias = respgarantias.Collateral;\r\n          // console.log(\"Muebles\", garantias);\r\n          if (!garantias)\r\n            return;\r\n\r\n          setbodyRows1(<tr>\r\n            <td>Muebles</td>\r\n            <td>{garantias.EmisionDt ? garantias.EmisionDt : \"\"}</td>\r\n            <td>{garantias.AppraisedBy ? garantias.AppraisedBy : \"\"}</td>\r\n            <td>$ {garantias.CollateralAmt.Amt ? garantias.CollateralAmt.Amt : 0}</td>\r\n            <td>{parseFloat(colaterals[i].facilityAmt) / parseFloat(garantias.CollateralAmt.Amt ? garantias.CollateralAmt.Amt : 0)}%</td>\r\n          </tr>);\r\n        }).catch(err => {\r\n          console.log(err);\r\n\r\n        })\r\n        apiCore.getWarrantyDetails(colaterals[i].collateralId, \"Inmuebles\").then(respgarantias => {\r\n          let garantias = respgarantias.Collateral;\r\n          // console.log(\"Inmuebles\", garantias);\r\n          if (!garantias)\r\n            return;\r\n          setbodyRows2(<tr>\r\n            <td>Inmuebles</td>\r\n            <td>{garantias.EmisionDt ? garantias.EmisionDt : \"\"}</td>\r\n            <td>{garantias.AppraisedBy ? garantias.AppraisedBy : \"\"}</td>\r\n            <td>$ {garantias.CollateralAmt.Amt ? garantias.CollateralAmt.Amt : 0}</td>\r\n            <td>{parseFloat(colaterals[i].facilityAmt) / parseFloat(garantias.CollateralAmt.Amt ? garantias.CollateralAmt.Amt : 0)}%</td>\r\n          </tr>);\r\n        })\r\n        apiCore.getWarrantyDetails(colaterals[i].collateralId, \"Depositos\").then(respgarantias => {\r\n          let garantias = respgarantias.Collateral;\r\n          // console.log(\"Depositos\", garantias);\r\n          if (!garantias)\r\n            return;\r\n          setbodyRows3(<tr>\r\n            <td>Depositos</td>\r\n            <td>{garantias.EmisionDt ? garantias.EmisionDt : \"\"}</td>\r\n            <td>{garantias.AppraisedBy ? garantias.AppraisedBy : \"\"}</td>\r\n            <td>$ {garantias.CollateralAmt.Amt ? garantias.CollateralAmt.Amt : 0}</td>\r\n            <td>{parseFloat(colaterals[i].facilityAmt) / parseFloat(garantias.CollateralAmt.Amt ? garantias.CollateralAmt.Amt : 0)}%</td>\r\n          </tr>);\r\n        })\r\n      }\r\n      setisActiveLoading(false);\r\n    }).catch(err => {\r\n    });\r\n\r\n    // })\r\n  }\r\n\r\n  const [locationData, setLocationData] = useState(null);\r\n  const history = useHistory();\r\n  const currencyData = new Currency();\r\n\r\n  const [muebles, setMuebles] = useState([])\r\n  const [Inmuebles, setInmuebles] = useState([])\r\n  const [desposito, setDeposito] = useState([])\r\n  const [guaranteesRow, setGuaranteesRow] = useState([])\r\n\r\n  React.useEffect(() => {\r\n    // initializeData();\r\n    let dataSession;\r\n    if (location.data !== null && location.data !== undefined) {\r\n      if (location.data.transactionId === undefined || location.data.transactionId.length <= 0) {\r\n        //location.data.transactionId = 0;\r\n        //checkAndCreateProcedure(location.data);\r\n        history.push(url.URL_DASHBOARD);\r\n      }\r\n      else {\r\n        sessionStorage.setItem('locationData', JSON.stringify(location.data));\r\n        setLocationData(location.data);\r\n        dataSession = location.data;\r\n      }\r\n    }\r\n    else {\r\n      //chequeamos si tenemos guardado en session\r\n      var result = sessionStorage.getItem('locationData');\r\n      if (result !== undefined && result !== null) {\r\n        result = JSON.parse(result);\r\n        setLocationData(result);\r\n        dataSession = result;\r\n      }\r\n    }\r\n    initializeData2(dataSession);\r\n  }, []);\r\n\r\n  function initializeData2(dataSession) {\r\n    apiBack.consultGeneralDataPropCred(dataSession.transactionId).then((proposal) => {\r\n      let requestId = proposal.length === 0 ? undefined : proposal[0].requestId;\r\n      Promise.allSettled([\r\n        apiBack.consultarFacilidades(requestId),\r\n        apiCore.getTipoGarantiaCatalogo(),\r\n      ]).then(async allPromises => {\r\n        const [{ value: facilities }, { value: guaranteesType }] = allPromises\r\n        let guaranteesArr = [];\r\n        for (let facility of facilities) {\r\n          let guarantees = await apiBack.consultarGarantiaPropCred(facility.facilityId)\r\n          guaranteesArr.push(...currencyData.groupBy(guarantees, 'guaranteeTypeName'));\r\n        }\r\n        guaranteesArr = [].concat.apply([], guaranteesArr)\r\n        let arrGuarantees = currencyData.groupBy(guaranteesArr, 'guaranteeTypeName').map(guarantee => guarantee[0]);\r\n        let rows = arrGuarantees?.length === 0 ? <tr key={uniq_key() + \"1\"}>\r\n          <td colSpan=\"6\" style={{ textAlign: 'center' }}>{t(\"NoData\")}</td>\r\n        </tr> : arrGuarantees.map(guarantee => (\r\n          <tr key={uniq_key() + \"2\"}>\r\n            <td>{guaranteesType?.Records?.find(guaranteeType => guaranteeType.Code === guarantee.guaranteeTypeName)?.Description}</td>\r\n            <td>${currencyData.format(guaranteesArr.filter(guaranteeArr => guaranteeArr.guaranteeTypeName === guarantee.guaranteeTypeName).reduce((ac, crr) => ac + crr.commercialValue, 0))}</td>\r\n            <td>${currencyData.format(guaranteesArr.filter(guaranteeArr => guaranteeArr.guaranteeTypeName === guarantee.guaranteeTypeName).reduce((ac, crr) => ac + crr.fastValue, 0))}</td>\r\n            <td>{currencyData.format(guaranteesArr.filter(guaranteeArr => guaranteeArr.guaranteeTypeName === guarantee.guaranteeTypeName).reduce((ac, crr) => ac + crr.ltv, 0))}%</td>\r\n          </tr>\r\n        ))\r\n        setGuaranteesRow(rows)\r\n      }).catch(err => { console.log(err) })\r\n    }).catch(err => { console.log(err) })\r\n  }\r\n  return (\r\n\r\n\r\n    <Card>\r\n      <LoadingOverlay active={isActiveLoading} spinner text={t(\"WaitingPlease\")}>\r\n        <Row>\r\n          <Col md=\"6\">\r\n            <h5 className=\"card-sub-title\">{t(\"WarrantyDetails\")}</h5>\r\n          </Col>\r\n        </Row>\r\n        <CardBody>\r\n\r\n          <Row>\r\n            <div style={{ minHeight: \"100px\" }}>\r\n              <Col className=\"table-responsive styled-table-div\">\r\n                <Table className=\"table table-striped table-hover styled-table table mb-0\">\r\n                  <thead>\r\n                    <tr>\r\n                      <th>{t(\"Type\")}</th>\r\n                      <th>{t(\"Commercial Value\")}</th>\r\n                      <th>{t(\"QuickValue\")}</th>\r\n                      <th>{t(\"LTV\")}</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {guaranteesRow}\r\n                  </tbody>\r\n                </Table>\r\n              </Col>\r\n            </div>\r\n          </Row>\r\n        </CardBody>\r\n      </LoadingOverlay>\r\n    </Card>\r\n  );\r\n\r\n};\r\n\r\n\r\nGuarantees.defaultProps = {\r\n  headers: [],\r\n  data: []\r\n};\r\n\r\nexport default Guarantees;\r\n"]},"metadata":{},"sourceType":"module"}
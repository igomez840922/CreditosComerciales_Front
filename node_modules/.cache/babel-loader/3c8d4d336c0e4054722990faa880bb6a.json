{"ast":null,"code":"var _jsxFileName = \"D:\\\\_PROJECTS\\\\_SOAINT\\\\JBPM\\\\App\\\\banescocreditoscomerciales\\\\src\\\\pages\\\\CommercialCredit\\\\5_PropuestaCredito\\\\Secciones\\\\LevelAutonomy.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport { withTranslation } from \"react-i18next\";\nimport PropTypes from 'prop-types';\nimport { Row, Col, Button, Label, Input, Modal, Card, CardBody, CardFooter } from \"reactstrap\";\nimport { AvForm, AvField } from \"availity-reactstrap-validation\";\nimport { translationHelpers } from \"../../../../helpers\";\nimport { BackendServices, BpmServices, CoreServices } from \"../../../../services\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport * as url from \"../../../../helpers/url_helper\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst LevelAutonomy = props => {\n  _s();\n\n  const [t, c] = translationHelpers('translation', 'common');\n  const [levelAutonomy, setLevelAutonomy] = useState(0);\n  const [levelAutonomyPosition, setLevelAutonomyPosition] = useState('');\n  const bpmServices = new BpmServices();\n  const backendServices = new BackendServices();\n  const coreServices = new CoreServices();\n  const location = useLocation();\n  const history = useHistory();\n  const [locationData, setLocationData] = useState(null);\n  const MODEL_FACILITY = {\n    \"approved\": 0,\n    \"currentBalance\": 0,\n    \"ltv\": 0,\n    \"proposed\": 0,\n    \"guarantee\": 0\n  };\n  useEffect(() => {\n    let dataSession;\n\n    if (location.data !== null && location.data !== undefined) {\n      if (location.data.transactionId === undefined || location.data.transactionId.length <= 0) {\n        history.push(url.URL_DASHBOARD);\n      } else {\n        sessionStorage.setItem('locationData', JSON.stringify(location.data));\n        setLocationData(location.data);\n        dataSession = location.data;\n      }\n    } else {\n      //chequeamos si tenemos guardado en session\n      var result = sessionStorage.getItem('locationData');\n\n      if (result !== undefined && result !== null) {\n        result = JSON.parse(result);\n        setLocationData(result);\n        dataSession = result;\n      }\n    }\n\n    getFacilityHistory({\n      dataSession\n    });\n  }, []);\n  useEffect(() => {\n    (levelAutonomy === null || levelAutonomy === void 0 ? void 0 : levelAutonomy.amount) > 0 && bpmServices.saveAutonomy(levelAutonomy).then(resp => {\n      var _resp$body, _resp$body$result$dmn, _resp$body$result$dmn2, _resp$body2, _resp$body2$result$dm, _resp$body2$result$dm2;\n\n      let banca = resp === null || resp === void 0 ? void 0 : (_resp$body = resp.body) === null || _resp$body === void 0 ? void 0 : (_resp$body$result$dmn = _resp$body.result['dmn-evaluation-result']['dmn-context']) === null || _resp$body$result$dmn === void 0 ? void 0 : (_resp$body$result$dmn2 = _resp$body$result$dmn.autonomiaduales) === null || _resp$body$result$dmn2 === void 0 ? void 0 : _resp$body$result$dmn2.banca;\n      let credito = resp === null || resp === void 0 ? void 0 : (_resp$body2 = resp.body) === null || _resp$body2 === void 0 ? void 0 : (_resp$body2$result$dm = _resp$body2.result['dmn-evaluation-result']['dmn-context']) === null || _resp$body2$result$dm === void 0 ? void 0 : (_resp$body2$result$dm2 = _resp$body2$result$dm.autonomiaduales) === null || _resp$body2$result$dm2 === void 0 ? void 0 : _resp$body2$result$dm2.credito;\n      setLevelAutonomyPosition({\n        banca,\n        credito\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }, [levelAutonomy, props.levelAutonomy]);\n\n  async function getFacilityHistory({\n    dataSession = locationData\n  }) {\n    var _dataSession$transact;\n\n    //facility type prendaria code PR\n    Promise.allSettled([backendServices.consultGeneralDataPropCred((_dataSession$transact = dataSession === null || dataSession === void 0 ? void 0 : dataSession.transactionId) !== null && _dataSession$transact !== void 0 ? _dataSession$transact : 0)]).then(async allPromise => {\n      var _propuesta$, _facilitiesProposal$r, _facilitiesProposal$r2;\n\n      const [{\n        value: propuesta\n      }] = allPromise;\n      let requestId = (_propuesta$ = propuesta[0]) === null || _propuesta$ === void 0 ? void 0 : _propuesta$.requestId;\n      let facilitiesProposal = await backendServices.consultarFacilidades(requestId !== null && requestId !== void 0 ? requestId : '');\n      let tipo = (facilitiesProposal === null || facilitiesProposal === void 0 ? void 0 : facilitiesProposal.some(facility => facility.facilityTypeId === 'PR')) ? '4' : '';\n      let amount = (_facilitiesProposal$r = facilitiesProposal === null || facilitiesProposal === void 0 ? void 0 : facilitiesProposal.reduce((acu, crr) => crr.facilityTypeId === 'PR' ? acu + crr.amount : 0, 0)) !== null && _facilitiesProposal$r !== void 0 ? _facilitiesProposal$r : 0;\n      let ltv = (_facilitiesProposal$r2 = facilitiesProposal === null || facilitiesProposal === void 0 ? void 0 : facilitiesProposal.reduce((acu, crr) => crr.facilityTypeId === 'PR' ? acu + crr.ltv : 0, 0)) !== null && _facilitiesProposal$r2 !== void 0 ? _facilitiesProposal$r2 : 0;\n\n      if (tipo !== '4') {\n        var _expositionCorporativ, _expositionCorporativ2;\n\n        let expositionCorporative = await backendServices.getExposicionCorporativaBD(dataSession.transactionId);\n        let facilityCP = (_expositionCorporativ = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Corto Plazo\".toUpperCase())) !== null && _expositionCorporativ !== void 0 ? _expositionCorporativ : MODEL_FACILITY;\n        let facilityLP = (_expositionCorporativ2 = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Largo Plazo\".toUpperCase())) !== null && _expositionCorporativ2 !== void 0 ? _expositionCorporativ2 : MODEL_FACILITY;\n        let facilities = await backendServices.consultarFacilidadesExposicionCorporativa(requestId !== null && requestId !== void 0 ? requestId : '');\n        let jsonFacilidades = {\n          CP: facilities.CP.reduce((acu, crr) => acu + crr.requestAmount, 0) || 0,\n          LP: facilities.LP.reduce((acu, crr) => acu + crr.requestAmount, 0) || 0\n        };\n        let amountCP = parseFloat(facilityCP.approved) + parseFloat(jsonFacilidades.CP);\n        let amountLP = parseFloat(facilityLP.currentBalance) + parseFloat(jsonFacilidades.LP);\n        let ltvCP = facilityCP.guarantee > 0 ? parseFloat(facilityCP.proposed) / parseFloat(facilityCP.guarantee) * 100 : 0;\n        let ltvLP = facilityLP.guarantee > 0 ? parseFloat(facilityLP.proposed) / parseFloat(facilityLP.guarantee) * 100 : 0;\n        const {\n          amount: amounting,\n          ltv: ltvF\n        } = amountCP > amountLP ? {\n          amount: amountCP,\n          ltvF: ltvCP\n        } : {\n          amount: amountLP,\n          ltvF: ltvLP\n        };\n        amount = amounting;\n        ltv = ltvF;\n        tipo = ltv >= 70 ? '1' : '2';\n      }\n\n      setLevelAutonomy({\n        tipo,\n        amount\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(React.Fragment, {\n    children: (props === null || props === void 0 ? void 0 : props.fideicomiso) ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Col, {\n        sm: \"3\",\n        className: \"d-flex flex-column\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          htmlFor: \"clientNumber\",\n          children: [t(\"Level of Autonomy\"), \" \", t(\"Creditt\")]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          children: levelAutonomyPosition.credito\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Col, {\n        sm: \"3\",\n        className: \"d-flex flex-column\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          htmlFor: \"clientNumber\",\n          children: [t(\"Level of Autonomy\"), \" \", t(\"Banking\")]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          children: levelAutonomyPosition.banca\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n        className: \"card-title mt-2\",\n        style: {\n          textAlign: \"left\",\n          fontSize: '21px!important'\n        },\n        children: [t(\"Level of Autonomy\"), \" \", t(\"Creditt\"), \": \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 146\n        }, this), levelAutonomyPosition.credito]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n        className: \"card-title mt-2\",\n        style: {\n          textAlign: \"right\",\n          fontSize: '21px!important'\n        },\n        children: [t(\"Level of Autonomy\"), \" \", t(\"Banking\"), \": \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 141\n        }, this), levelAutonomyPosition.banca]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 126,\n    columnNumber: 5\n  }, this);\n};\n\n_s(LevelAutonomy, \"q32ct45+21x6fsQYMduHcaUn+Tk=\", false, function () {\n  return [useLocation, useHistory];\n});\n\n_c = LevelAutonomy;\nexport default withTranslation()(LevelAutonomy);\n\nvar _c;\n\n$RefreshReg$(_c, \"LevelAutonomy\");","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/CommercialCredit/5_PropuestaCredito/Secciones/LevelAutonomy.js"],"names":["React","useEffect","useState","withTranslation","PropTypes","Row","Col","Button","Label","Input","Modal","Card","CardBody","CardFooter","AvForm","AvField","translationHelpers","BackendServices","BpmServices","CoreServices","useHistory","useLocation","url","LevelAutonomy","props","t","c","levelAutonomy","setLevelAutonomy","levelAutonomyPosition","setLevelAutonomyPosition","bpmServices","backendServices","coreServices","location","history","locationData","setLocationData","MODEL_FACILITY","dataSession","data","undefined","transactionId","length","push","URL_DASHBOARD","sessionStorage","setItem","JSON","stringify","result","getItem","parse","getFacilityHistory","amount","saveAutonomy","then","resp","banca","body","autonomiaduales","credito","catch","err","console","log","Promise","allSettled","consultGeneralDataPropCred","allPromise","value","propuesta","requestId","facilitiesProposal","consultarFacilidades","tipo","some","facility","facilityTypeId","reduce","acu","crr","ltv","expositionCorporative","getExposicionCorporativaBD","facilityCP","find","x","description","toUpperCase","facilityLP","facilities","consultarFacilidadesExposicionCorporativa","jsonFacilidades","CP","requestAmount","LP","amountCP","parseFloat","approved","amountLP","currentBalance","ltvCP","guarantee","proposed","ltvLP","amounting","ltvF","fideicomiso","textAlign","fontSize"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\"\r\nimport { withTranslation } from \"react-i18next\"\r\nimport PropTypes from 'prop-types';\r\n\r\nimport {\r\n  Row,\r\n  Col,\r\n  Button,\r\n  Label,\r\n  Input,\r\n  Modal,\r\n  Card,\r\n  CardBody,\r\n  CardFooter,\r\n} from \"reactstrap\"\r\n\r\nimport { AvForm, AvField } from \"availity-reactstrap-validation\"\r\nimport { translationHelpers } from \"../../../../helpers\";\r\nimport { BackendServices, BpmServices, CoreServices } from \"../../../../services\";\r\nimport { useHistory, useLocation } from \"react-router-dom\";\r\nimport * as url from \"../../../../helpers/url_helper\"\r\n\r\nconst LevelAutonomy = (props) => {\r\n  const [t, c] = translationHelpers('translation', 'common');\r\n  const [levelAutonomy, setLevelAutonomy] = useState(0);\r\n  const [levelAutonomyPosition, setLevelAutonomyPosition] = useState('');\r\n  const bpmServices = new BpmServices();\r\n  const backendServices = new BackendServices();\r\n  const coreServices = new CoreServices();\r\n\r\n  const location = useLocation();\r\n  const history = useHistory();\r\n  const [locationData, setLocationData] = useState(null);\r\n\r\n  const MODEL_FACILITY = {\r\n    \"approved\": 0,\r\n    \"currentBalance\": 0,\r\n    \"ltv\": 0,\r\n    \"proposed\": 0,\r\n    \"guarantee\": 0,\r\n  }\r\n\r\n  useEffect(() => {\r\n\r\n    let dataSession;\r\n    if (location.data !== null && location.data !== undefined) {\r\n      if (location.data.transactionId === undefined || location.data.transactionId.length <= 0) {\r\n        history.push(url.URL_DASHBOARD);\r\n      }\r\n      else {\r\n        sessionStorage.setItem('locationData', JSON.stringify(location.data));\r\n        setLocationData(location.data);\r\n        dataSession = location.data;\r\n      }\r\n    }\r\n    else {\r\n      //chequeamos si tenemos guardado en session\r\n      var result = sessionStorage.getItem('locationData');\r\n      if (result !== undefined && result !== null) {\r\n        result = JSON.parse(result);\r\n        setLocationData(result);\r\n        dataSession = result\r\n      }\r\n    }\r\n\r\n    getFacilityHistory({ dataSession })\r\n\r\n  }, []);\r\n\r\n\r\n  useEffect(() => {\r\n    levelAutonomy?.amount > 0 && bpmServices.saveAutonomy(levelAutonomy).then(resp => {\r\n      let banca = resp?.body?.result['dmn-evaluation-result']['dmn-context']?.autonomiaduales?.banca;\r\n      let credito = resp?.body?.result['dmn-evaluation-result']['dmn-context']?.autonomiaduales?.credito;\r\n      setLevelAutonomyPosition({ banca, credito })\r\n    }).catch(err => {\r\n      console.log(err)\r\n    });\r\n  }, [levelAutonomy, props.levelAutonomy])\r\n\r\n  async function getFacilityHistory({ dataSession = locationData }) {\r\n    //facility type prendaria code PR\r\n    Promise.allSettled([\r\n      backendServices.consultGeneralDataPropCred(dataSession?.transactionId ?? 0),\r\n    ]).then(async allPromise => {\r\n      const [{ value: propuesta }] = allPromise;\r\n\r\n      let requestId = propuesta[0]?.requestId;\r\n      let facilitiesProposal = await backendServices.consultarFacilidades(requestId ?? '');\r\n\r\n      let tipo = facilitiesProposal?.some(facility => facility.facilityTypeId === 'PR') ? '4' : '';\r\n      let amount = facilitiesProposal?.reduce((acu, crr) => crr.facilityTypeId === 'PR' ? acu + crr.amount : 0, 0) ?? 0;\r\n      let ltv = facilitiesProposal?.reduce((acu, crr) => crr.facilityTypeId === 'PR' ? acu + crr.ltv : 0, 0) ?? 0;\r\n\r\n      if (tipo !== '4') {\r\n        let expositionCorporative = await backendServices.getExposicionCorporativaBD(dataSession.transactionId);\r\n        let facilityCP = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Corto Plazo\".toUpperCase()) ?? MODEL_FACILITY;\r\n        let facilityLP = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Largo Plazo\".toUpperCase()) ?? MODEL_FACILITY;\r\n\r\n        let facilities = await backendServices.consultarFacilidadesExposicionCorporativa(requestId ?? '');\r\n        let jsonFacilidades = {\r\n          CP: facilities.CP.reduce((acu, crr) => (acu + crr.requestAmount), 0) || 0,\r\n          LP: facilities.LP.reduce((acu, crr) => (acu + crr.requestAmount), 0) || 0,\r\n        }\r\n        let amountCP = parseFloat(facilityCP.approved) + parseFloat(jsonFacilidades.CP);\r\n        let amountLP = parseFloat(facilityLP.currentBalance) + parseFloat(jsonFacilidades.LP);\r\n\r\n        let ltvCP = facilityCP.guarantee > 0 ? parseFloat(facilityCP.proposed) / parseFloat(facilityCP.guarantee) * 100 : 0;\r\n        let ltvLP = facilityLP.guarantee > 0 ? parseFloat(facilityLP.proposed) / parseFloat(facilityLP.guarantee) * 100 : 0;\r\n\r\n        const { amount: amounting, ltv: ltvF } = amountCP > amountLP ? { amount: amountCP, ltvF: ltvCP } : { amount: amountLP, ltvF: ltvLP };\r\n        amount = amounting;\r\n        ltv = ltvF;\r\n        tipo = ltv >= 70 ? '1' : '2';\r\n\r\n      }\r\n      setLevelAutonomy({ tipo, amount })\r\n\r\n    }).catch(err => {\r\n      console.log(err)\r\n    })\r\n\r\n  }\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {props?.fideicomiso ? <>\r\n        <Col sm=\"3\" className=\"d-flex flex-column\">\r\n          <strong htmlFor=\"clientNumber\">{t(\"Level of Autonomy\")} {t(\"Creditt\")}</strong>\r\n          <label>{levelAutonomyPosition.credito}</label>\r\n        </Col>\r\n        <Col sm=\"3\" className=\"d-flex flex-column\">\r\n          <strong htmlFor=\"clientNumber\">{t(\"Level of Autonomy\")} {t(\"Banking\")}</strong>\r\n          <label>{levelAutonomyPosition.banca}</label>\r\n        </Col>\r\n      </> : <><h5 className=\"card-title mt-2\" style={{ textAlign: \"left\", fontSize: '21px!important' }}>{t(\"Level of Autonomy\")} {t(\"Creditt\")}: <br />{levelAutonomyPosition.credito}</h5>\r\n        <h5 className=\"card-title mt-2\" style={{ textAlign: \"right\", fontSize: '21px!important' }}>{t(\"Level of Autonomy\")} {t(\"Banking\")}: <br />{levelAutonomyPosition.banca}</h5></>}\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default (withTranslation()(LevelAutonomy));\r\n"]},"metadata":{},"sourceType":"module"}
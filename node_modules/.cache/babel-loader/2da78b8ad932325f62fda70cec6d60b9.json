{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import{BackendServices,BpmServices,CoreServices}from\"../../../../services\";export var LevelAutonomyClass=/*#__PURE__*/function(){function LevelAutonomyClass(){var _this$location,_this$location2;var dataSession=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,LevelAutonomyClass);this.backendServices=new BackendServices();this.bpmServices=new BpmServices();this.coreServices=new CoreServices();this.MODEL_FACILITY={\"approved\":0,\"currentBalance\":0,\"ltv\":0,\"proposed\":0,\"guarantee\":0};if(((_this$location=this.location)===null||_this$location===void 0?void 0:_this$location.data)!==null&&((_this$location2=this.location)===null||_this$location2===void 0?void 0:_this$location2.data)!==undefined){var _this$location3,_this$location4;if(((_this$location3=this.location)===null||_this$location3===void 0?void 0:_this$location3.data.transactionId)===undefined||((_this$location4=this.location)===null||_this$location4===void 0?void 0:_this$location4.data.transactionId.length)<=0){//this.location?.data.transactionId = 0;\n//checkAndCreateProcedure(this.location?.data);\nthis.validateRoute=true;}else{var _this$location5,_this$location6;sessionStorage.setItem('locationData',JSON.stringify((_this$location5=this.location)===null||_this$location5===void 0?void 0:_this$location5.data));this.locationData=(_this$location6=this.location)===null||_this$location6===void 0?void 0:_this$location6.data;}}else{//chequeamos si tenemos guardado en session\nvar result=sessionStorage.getItem('locationData');if(result!==undefined&&result!==null){result=JSON.parse(result);this.locationData=result;}else{this.locationData=dataSession;}}}_createClass(LevelAutonomyClass,[{key:\"getLevelAutonomy\",value:function(){var _getLevelAutonomy=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _this=this;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",new Promise(function(resolve,reject){var _this$locationData$tr,_this$locationData;//facility type prendaria code PR\nPromise.allSettled([_this.backendServices.consultGeneralDataPropCred((_this$locationData$tr=(_this$locationData=_this.locationData)===null||_this$locationData===void 0?void 0:_this$locationData.transactionId)!==null&&_this$locationData$tr!==void 0?_this$locationData$tr:0)]).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(allPromise){var _propuesta$,_facilitiesProposal$r,_facilitiesProposal$r2;var _allPromise,propuesta,requestId,facilitiesProposal,tipo,amount,ltv,_expositionCorporativ,_expositionCorporativ2,expositionCorporative,facilityCP,facilityLP,facilities,jsonFacilidades,amountCP,amountLP,ltvCP,ltvLP,_ref2,amounting,ltvF;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_allPromise=_slicedToArray(allPromise,1),propuesta=_allPromise[0].value;requestId=(_propuesta$=propuesta[0])===null||_propuesta$===void 0?void 0:_propuesta$.requestId;_context.next=4;return _this.backendServices.consultarFacilidades(requestId!==null&&requestId!==void 0?requestId:'');case 4:facilitiesProposal=_context.sent;tipo=(facilitiesProposal===null||facilitiesProposal===void 0?void 0:facilitiesProposal.some(function(facility){return facility.facilityTypeId==='PR';}))?'4':'';amount=(_facilitiesProposal$r=facilitiesProposal===null||facilitiesProposal===void 0?void 0:facilitiesProposal.reduce(function(acu,crr){return crr.facilityTypeId==='PR'?acu+crr.amount:0;},0))!==null&&_facilitiesProposal$r!==void 0?_facilitiesProposal$r:0;ltv=(_facilitiesProposal$r2=facilitiesProposal===null||facilitiesProposal===void 0?void 0:facilitiesProposal.reduce(function(acu,crr){return crr.facilityTypeId==='PR'?acu+crr.ltv:0;},0))!==null&&_facilitiesProposal$r2!==void 0?_facilitiesProposal$r2:0;if(!(tipo!=='4')){_context.next=26;break;}_context.next=11;return _this.backendServices.getExposicionCorporativaBD(_this.locationData.transactionId);case 11:expositionCorporative=_context.sent;facilityCP=(_expositionCorporativ=expositionCorporative.find(function(x){return x.description.toUpperCase()===\"Facilidades Corto Plazo\".toUpperCase();}))!==null&&_expositionCorporativ!==void 0?_expositionCorporativ:_this.MODEL_FACILITY;facilityLP=(_expositionCorporativ2=expositionCorporative.find(function(x){return x.description.toUpperCase()===\"Facilidades Largo Plazo\".toUpperCase();}))!==null&&_expositionCorporativ2!==void 0?_expositionCorporativ2:_this.MODEL_FACILITY;_context.next=16;return _this.backendServices.consultarFacilidadesExposicionCorporativa(requestId!==null&&requestId!==void 0?requestId:'');case 16:facilities=_context.sent;jsonFacilidades={CP:facilities.CP.reduce(function(acu,crr){return acu+crr.requestAmount;},0)||0,LP:facilities.LP.reduce(function(acu,crr){return acu+crr.requestAmount;},0)||0};amountCP=parseFloat(facilityCP.approved)+parseFloat(jsonFacilidades.CP);amountLP=parseFloat(facilityLP.currentBalance)+parseFloat(jsonFacilidades.LP);ltvCP=facilityCP.guarantee>0?parseFloat(facilityCP.proposed)/parseFloat(facilityCP.guarantee)*100:0;ltvLP=facilityLP.guarantee>0?parseFloat(facilityLP.proposed)/parseFloat(facilityLP.guarantee)*100:0;_ref2=amountCP>amountLP?{amount:amountCP,ltvF:ltvCP}:{amount:amountLP,ltvF:ltvLP},amounting=_ref2.amount,ltvF=_ref2.ltv;amount=amounting;ltv=ltvF;tipo=ltv>=70?'1':'2';case 26:_context.t0=resolve;_context.next=29;return _this.onLevelAutonomy({tipo:tipo,amount:amount});case 29:_context.t1=_context.sent;(0,_context.t0)(_context.t1);case 31:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(err){console.error(err);});}));case 1:case\"end\":return _context2.stop();}}},_callee2);}));function getLevelAutonomy(){return _getLevelAutonomy.apply(this,arguments);}return getLevelAutonomy;}()},{key:\"onLevelAutonomy\",value:function onLevelAutonomy(_ref3){var _this2=this;var tipo=_ref3.tipo,amount=_ref3.amount;return new Promise(function(resolve,reject){amount>0&&_this2.bpmServices.saveAutonomy({tipo:tipo,amount:amount}).then(function(resp){var _resp$body,_resp$body$result$dmn,_resp$body$result$dmn2,_resp$body2,_resp$body2$result$dm,_resp$body2$result$dm2;var banca=resp===null||resp===void 0?void 0:(_resp$body=resp.body)===null||_resp$body===void 0?void 0:(_resp$body$result$dmn=_resp$body.result['dmn-evaluation-result']['dmn-context'])===null||_resp$body$result$dmn===void 0?void 0:(_resp$body$result$dmn2=_resp$body$result$dmn.autonomiaduales)===null||_resp$body$result$dmn2===void 0?void 0:_resp$body$result$dmn2.banca;var credit=resp===null||resp===void 0?void 0:(_resp$body2=resp.body)===null||_resp$body2===void 0?void 0:(_resp$body2$result$dm=_resp$body2.result['dmn-evaluation-result']['dmn-context'])===null||_resp$body2$result$dm===void 0?void 0:(_resp$body2$result$dm2=_resp$body2$result$dm.autonomiaduales)===null||_resp$body2$result$dm2===void 0?void 0:_resp$body2$result$dm2.credito;resolve({banca:banca,credit:credit});}).catch(function(err){console.log(err);});});}}]);return LevelAutonomyClass;}();","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/CommercialCredit/5_PropuestaCredito/Secciones/LevelAutonomy.model.js"],"names":["BackendServices","BpmServices","CoreServices","LevelAutonomyClass","dataSession","backendServices","bpmServices","coreServices","MODEL_FACILITY","location","data","undefined","transactionId","length","validateRoute","sessionStorage","setItem","JSON","stringify","locationData","result","getItem","parse","Promise","resolve","reject","allSettled","consultGeneralDataPropCred","then","allPromise","propuesta","value","requestId","consultarFacilidades","facilitiesProposal","tipo","some","facility","facilityTypeId","amount","reduce","acu","crr","ltv","getExposicionCorporativaBD","expositionCorporative","facilityCP","find","x","description","toUpperCase","facilityLP","consultarFacilidadesExposicionCorporativa","facilities","jsonFacilidades","CP","requestAmount","LP","amountCP","parseFloat","approved","amountLP","currentBalance","ltvCP","guarantee","proposed","ltvLP","ltvF","amounting","onLevelAutonomy","catch","err","console","error","saveAutonomy","resp","banca","body","autonomiaduales","credit","credito","log"],"mappings":"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","sourcesContent":["import { BackendServices, BpmServices, CoreServices } from \"../../../../services\";\r\n\r\nexport class LevelAutonomyClass {\r\n\r\n    backendServices = new BackendServices();\r\n    bpmServices = new BpmServices();\r\n    coreServices = new CoreServices();\r\n    locationData;\r\n\r\n    MODEL_FACILITY = {\r\n        \"approved\": 0,\r\n        \"currentBalance\": 0,\r\n        \"ltv\": 0,\r\n        \"proposed\": 0,\r\n        \"guarantee\": 0,\r\n    }\r\n\r\n    constructor(dataSession = {}) {\r\n\r\n        if (this.location?.data !== null && this.location?.data !== undefined) {\r\n            if (this.location?.data.transactionId === undefined || this.location?.data.transactionId.length <= 0) {\r\n                //this.location?.data.transactionId = 0;\r\n                //checkAndCreateProcedure(this.location?.data);\r\n                this.validateRoute = true\r\n            }\r\n            else {\r\n                sessionStorage.setItem('locationData', JSON.stringify(this.location?.data));\r\n                this.locationData = this.location?.data;\r\n            }\r\n        }\r\n        else {\r\n            //chequeamos si tenemos guardado en session\r\n            var result = sessionStorage.getItem('locationData');\r\n            if (result !== undefined && result !== null) {\r\n                result = JSON.parse(result);\r\n                this.locationData = result;\r\n            } else {\r\n                this.locationData = dataSession\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    async getLevelAutonomy() {\r\n        return new Promise((resolve, reject) => {\r\n            //facility type prendaria code PR\r\n            Promise.allSettled([\r\n                this.backendServices.consultGeneralDataPropCred(this.locationData?.transactionId ?? 0),\r\n            ]).then(async allPromise => {\r\n                const [{ value: propuesta }] = allPromise;\r\n\r\n                let requestId = propuesta[0]?.requestId;\r\n                let facilitiesProposal = await this.backendServices.consultarFacilidades(requestId ?? '');\r\n\r\n                let tipo = facilitiesProposal?.some(facility => facility.facilityTypeId === 'PR') ? '4' : '';\r\n                let amount = facilitiesProposal?.reduce((acu, crr) => crr.facilityTypeId === 'PR' ? acu + crr.amount : 0, 0) ?? 0;\r\n                let ltv = facilitiesProposal?.reduce((acu, crr) => crr.facilityTypeId === 'PR' ? acu + crr.ltv : 0, 0) ?? 0;\r\n\r\n                if (tipo !== '4') {\r\n                    let expositionCorporative = await this.backendServices.getExposicionCorporativaBD(this.locationData.transactionId);\r\n                    let facilityCP = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Corto Plazo\".toUpperCase()) ?? this.MODEL_FACILITY;\r\n                    let facilityLP = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Largo Plazo\".toUpperCase()) ?? this.MODEL_FACILITY;\r\n\r\n                    let facilities = await this.backendServices.consultarFacilidadesExposicionCorporativa(requestId ?? '');\r\n                    let jsonFacilidades = {\r\n                        CP: facilities.CP.reduce((acu, crr) => (acu + crr.requestAmount), 0) || 0,\r\n                        LP: facilities.LP.reduce((acu, crr) => (acu + crr.requestAmount), 0) || 0,\r\n                    }\r\n                    let amountCP = parseFloat(facilityCP.approved) + parseFloat(jsonFacilidades.CP);\r\n                    let amountLP = parseFloat(facilityLP.currentBalance) + parseFloat(jsonFacilidades.LP);\r\n\r\n                    let ltvCP = facilityCP.guarantee > 0 ? parseFloat(facilityCP.proposed) / parseFloat(facilityCP.guarantee) * 100 : 0;\r\n                    let ltvLP = facilityLP.guarantee > 0 ? parseFloat(facilityLP.proposed) / parseFloat(facilityLP.guarantee) * 100 : 0;\r\n\r\n                    const { amount: amounting, ltv: ltvF } = amountCP > amountLP ? { amount: amountCP, ltvF: ltvCP } : { amount: amountLP, ltvF: ltvLP };\r\n                    amount = amounting;\r\n                    ltv = ltvF;\r\n                    tipo = ltv >= 70 ? '1' : '2';\r\n\r\n                }\r\n\r\n                resolve(await this.onLevelAutonomy({ tipo, amount }))\r\n\r\n            }).catch(err => {\r\n                console.error(err)\r\n            })\r\n        })\r\n    }\r\n\r\n    onLevelAutonomy({ tipo, amount }) {\r\n        return new Promise((resolve, reject) => {\r\n            amount > 0 && this.bpmServices.saveAutonomy({ tipo, amount }).then(resp => {\r\n                let banca = resp?.body?.result['dmn-evaluation-result']['dmn-context']?.autonomiaduales?.banca;\r\n                let credit = resp?.body?.result['dmn-evaluation-result']['dmn-context']?.autonomiaduales?.credito;\r\n                resolve({ banca, credit });\r\n            }).catch(err => {\r\n                console.log(err)\r\n            });\r\n        })\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}
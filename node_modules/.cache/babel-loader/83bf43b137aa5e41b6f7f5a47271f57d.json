{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import{useTranslation}from'react-i18next';import{useLocation,useHistory}from'react-router-dom';import{Row,Col,Card,CardBody,Button,Label,Table,Pagination,PaginationItem,PaginationLink,CardFooter,Modal}from\"reactstrap\";import{AvForm,AvField}from\"availity-reactstrap-validation\";import{Link}from\"react-router-dom\";import DocumentModel from\"../../models/Core/DocumentModel\";import DocumentoAnexoModel from\"../../models/Backend/DocumentoAnexoModel\";import functionshelper from\"../../helpers/functions_helper\";import LoadingOverlay from'react-loading-overlay';import{CoreServices,BackendServices}from'../../services';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AttachmentFileCore=function AttachmentFileCore(props){var _useTranslation=useTranslation(),t=_useTranslation.t,i18n=_useTranslation.i18n;var locationData=props.locationData;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showModelAttachment=_useState2[0],setShowModelAttachment=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),attachments=_useState4[0],setAttachments=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isActiveLoading=_useState6[0],setIsActiveLoading=_useState6[1];//On Mounting (componentDidMount) if selectedData has changes\nReact.useEffect(function(){console.log(\"attachments\",attachments);console.log(\"AttachmentFileCore\");if(locationData!==undefined&&locationData!==null){updateAttachments();}},[locationData]);//abrimos modal para adjunar archivos\nfunction toggleShowModelAttachment(){setShowModelAttachment(!showModelAttachment);removeBodyCss();}function removeBodyCss(){document.body.classList.add(\"no_padding\");}//GUARDAR ADJUNTO\nfunction addAttachment(filedata){setIsActiveLoading(true);try{//GUARDAR EN GESTOR DOCUMENTAL ONBASE\nvar data=DocumentModel.getRequestModel(filedata);//filedata.name, filedata.description, filedata.fileName, filedata.fileExtension, filedata.fileBase64\nvar apicore=new CoreServices();apicore.postDocument(data).then(function(resultCore){filedata['transactId']=locationData.instanceId;filedata['processId']=locationData.processId;filedata['activityId']=locationData.activityId;filedata['documentId']=resultCore.documentId;filedata['docName']=resultCore.docName;////GUARDAR EN BD \ndata=DocumentoAnexoModel.getSaveModel(filedata);var apibackend=new BackendServices();apibackend.guardarDocumentoAnexo(data).then(function(resultBackend){if(resultBackend){// SI TODO OK ACTUALIZAR LA LISTA DE ADJUNTOS\nupdateAttachments();}}).catch(function(error){console.error('api error',error);}).finally(function(){setIsActiveLoading(false);});}).catch(function(error){console.error('api error',error);}).finally(function(){setIsActiveLoading(false);});}catch(error){setIsActiveLoading(false);}}//BORRAR ADJUNTO\nfunction removeAttachment(filedata){//BORRAR EN GESTOR DOCUMENTAL ONBASE\n//var data = DocumentModel.getDeleteModel(filedata);\n//const apicore = new CoreServices()\n//apicore.postDocument(data).then((resultCore) => {\n////BORRAR EN BD \nvar data={transactId:filedata.transactId,onBaseIdentification:filedata.onBaseIdentification};var apibackend=new BackendServices();apibackend.eliminarDocumentoAnexo(data).then(function(resultBackend){if(resultBackend){// SI TODO OK ACTUALIZAR LA LISTA DE ADJUNTOS\nupdateAttachments();}}).catch(function(error){console.error('api error',error);}).finally(function(){});//})\n//.catch((error) => {console.error('api error', error);})\n//.finally (() => {  });        \n}//VER ADJUNTO\nfunction viewAttachment(docId){var apicore=new CoreServices();apicore.postViewDocument(docId).then(function(resultCore){if(resultCore!==null){window.open(resultCore,\"_blank\");}}).catch(function(error){console.error('api error',error);}).finally(function(){setIsActiveLoading(false);});}//ACTUALIZAR LISTA DE ADJUNTOS\nfunction updateAttachments(){var params={transactId:locationData.instanceId,processId:locationData.processId,activityId:locationData.activityId};var apibackend=new BackendServices();apibackend.consultarDocumentosAnexos(params).then(function(data){setAttachments(data);}).catch(function(error){console.error('api error',error);}).finally(function(){});}//On change Inputs\nvar fileData={};// Submitimos formulario para busqueda de clientes\nfunction handleSubmitfrmAttachment(event,errors,values){event.preventDefault();if(errors.length>0){return;}addAttachment(fileData);toggleShowModelAttachment();}//On change Inputs\nfunction handleChangeInputfrm(_x){return _handleChangeInputfrm.apply(this,arguments);}function _handleChangeInputfrm(){_handleChangeInputfrm=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var file,base64;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:fileData[e.target.name]=e.target.value;_context.t0=e.target.name;_context.next=_context.t0===\"attachment\"?4:12;break;case 4:file=e.target.files[0];fileData['fileName']=file.name;fileData['fileExtension']=\".\"+file.name.split('.').pop();_context.next=9;return functionshelper.convertBase64(file);case 9:base64=_context.sent;//console.log(\"base64\",base64.split(','))\nfileData['fileBase64']=base64.split(',')[1];return _context.abrupt(\"break\",12);case 12:case\"end\":return _context.stop();}}},_callee);}));return _handleChangeInputfrm.apply(this,arguments);}return/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsxs(LoadingOverlay,{active:isActiveLoading,spinner:true,text:t(\"WaitingPlease\"),children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{md:\"12\",children:/*#__PURE__*/_jsxs(Table,{className:\"table m-0\",responsive:true,children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-light\",children:/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsxs(\"th\",{colSpan:3,children:[/*#__PURE__*/_jsx(\"h6\",{className:\"float-start\",children:t(\"Attach File\")}),/*#__PURE__*/_jsxs(Link,{to:\"#\",className:\"float-end\",onClick:function onClick(){toggleShowModelAttachment();},title:t(\"Add\"),children:[/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-plus-box-multiple-outline mdi-24px\"}),\" \"]})]})})}),/*#__PURE__*/_jsx(\"tbody\",{children:attachments!==null&&attachments!==undefined&&attachments.length>0?attachments.map(function(data){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:data.fileName}),/*#__PURE__*/_jsx(\"td\",{children:data.fileDescription}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(Link,{to:\"#\",className:\"float-end mx-1\",title:t(\"Delete\"),onClick:function onClick(){return removeAttachment(data);},children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-file-remove-outline mdi-24px\"})}),/*#__PURE__*/_jsx(Link,{to:\"#\",className:\"float-end mx-1\",title:t(\"View\"),onClick:function onClick(){return viewAttachment(data.documentIdentification);},children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-file-search-outline mdi-24px\"})})]})]},data.documentIdentification);}):/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-info m-0\",children:t(\"No attachments yet\")})})})})]})})}),/*#__PURE__*/_jsxs(Modal,{size:\"xl\",isOpen:showModelAttachment,toggle:toggleShowModelAttachment,centered:true,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"modal-title mt-0\",children:t(\"Attach File\")}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:toggleShowModelAttachment,className:\"close\",\"data-dismiss\":\"modal\",\"aria-label\":\"Close\",children:/*#__PURE__*/_jsx(\"span\",{\"aria-hidden\":\"true\",children:\"\\xD7\"})})]}),/*#__PURE__*/_jsxs(AvForm,{id:\"frmAttachment\",className:\"needs-validation\",onSubmit:handleSubmitfrmAttachment,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:\"6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"name\",children:t(\"Name\")}),/*#__PURE__*/_jsx(AvField,{className:\"form-control\",type:\"text\",name:\"name\",onChange:handleChangeInputfrm,errorMessage:t(\"Required Field\"),validate:{required:{value:true}}})]})}),/*#__PURE__*/_jsx(Col,{md:\"6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"attachment\",children:t(\"File\")}),/*#__PURE__*/_jsx(AvField,{className:\"form-control\",type:\"file\",name:\"attachment\",onChange:handleChangeInputfrm,errorMessage:t(\"Required Field\"),validate:{required:{value:true}},accept:\".jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx,.pdf\"})]})})]}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{md:\"12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"description\",children:t(\"Description\")}),/*#__PURE__*/_jsx(AvField,{className:\"form-control\",type:\"textarea\",name:\"description\",maxLength:\"1000\",rows:\"7\",onChange:handleChangeInputfrm})]})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsxs(Button,{color:\"dark\",type:\"button\",style:{margin:'5px'},onClick:toggleShowModelAttachment,\"data-dismiss\":\"modal\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi mdi-cancel mid-12px\"}),\" \",t(\"Cancel\")]}),/*#__PURE__*/_jsxs(Button,{color:\"success\",type:\"submit\",style:{margin:'5px'},children:[/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-content-save mid-12px\"}),\" \",t(\"Save\")]})]})]})]})]})});};//export default (withTranslation()(DatosGenerales));\nexport default AttachmentFileCore;","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/components/Common/AttachmentFileCore.js"],"names":["React","useState","useTranslation","useLocation","useHistory","Row","Col","Card","CardBody","Button","Label","Table","Pagination","PaginationItem","PaginationLink","CardFooter","Modal","AvForm","AvField","Link","DocumentModel","DocumentoAnexoModel","functionshelper","LoadingOverlay","CoreServices","BackendServices","AttachmentFileCore","props","t","i18n","locationData","showModelAttachment","setShowModelAttachment","attachments","setAttachments","isActiveLoading","setIsActiveLoading","useEffect","console","log","undefined","updateAttachments","toggleShowModelAttachment","removeBodyCss","document","body","classList","add","addAttachment","filedata","data","getRequestModel","apicore","postDocument","then","resultCore","instanceId","processId","activityId","documentId","docName","getSaveModel","apibackend","guardarDocumentoAnexo","resultBackend","catch","error","finally","removeAttachment","transactId","onBaseIdentification","eliminarDocumentoAnexo","viewAttachment","docId","postViewDocument","window","open","params","consultarDocumentosAnexos","fileData","handleSubmitfrmAttachment","event","errors","values","preventDefault","length","handleChangeInputfrm","e","target","name","value","file","files","split","pop","convertBase64","base64","map","fileName","fileDescription","documentIdentification","required","margin"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useTranslation } from 'react-i18next'\r\nimport { useLocation, useHistory } from 'react-router-dom'\r\n\r\nimport {\r\n  Row,\r\n  Col,\r\n  Card,\r\n  CardBody,\r\n  Button,\r\n  Label,\r\n  Table,\r\n  Pagination,\r\n  PaginationItem,\r\n  PaginationLink,\r\n  CardFooter,\r\n  Modal,\r\n} from \"reactstrap\"\r\n\r\nimport { AvForm, AvField } from \"availity-reactstrap-validation\"\r\nimport { Link } from \"react-router-dom\"\r\nimport DocumentModel from \"../../models/Core/DocumentModel\";\r\nimport DocumentoAnexoModel from \"../../models/Backend/DocumentoAnexoModel\";\r\nimport functionshelper from \"../../helpers/functions_helper\"\r\nimport LoadingOverlay from 'react-loading-overlay';\r\n\r\nimport { CoreServices, BackendServices } from '../../services';\r\n\r\nconst AttachmentFileCore = (props) => {\r\n\r\n  const { t, i18n } = useTranslation();\r\n\r\n  const { locationData } = props;\r\n\r\n  const [showModelAttachment, setShowModelAttachment] = useState(false);\r\n  const [attachments, setAttachments] = useState([]);\r\n  const [isActiveLoading, setIsActiveLoading] = useState(false);\r\n\r\n  //On Mounting (componentDidMount) if selectedData has changes\r\n  React.useEffect(() => {\r\n    console.log(\"attachments\", attachments);\r\n    console.log(\"AttachmentFileCore\");\r\n    if (locationData !== undefined && locationData !== null) {\r\n      updateAttachments();\r\n    }\r\n  }, [locationData]);\r\n\r\n\r\n  //abrimos modal para adjunar archivos\r\n  function toggleShowModelAttachment() {\r\n    setShowModelAttachment(!showModelAttachment);\r\n    removeBodyCss()\r\n  }\r\n\r\n  function removeBodyCss() {\r\n    document.body.classList.add(\"no_padding\")\r\n  }\r\n\r\n  //GUARDAR ADJUNTO\r\n  function addAttachment(filedata) {\r\n\r\n    setIsActiveLoading(true);\r\n\r\n    try {\r\n      //GUARDAR EN GESTOR DOCUMENTAL ONBASE\r\n      var data = DocumentModel.getRequestModel(filedata);//filedata.name, filedata.description, filedata.fileName, filedata.fileExtension, filedata.fileBase64\r\n      const apicore = new CoreServices()\r\n      apicore.postDocument(data).then((resultCore) => {\r\n\r\n        filedata['transactId'] = locationData.instanceId;\r\n        filedata['processId'] = locationData.processId;\r\n        filedata['activityId'] = locationData.activityId;\r\n        filedata['documentId'] = resultCore.documentId;\r\n        filedata['docName'] = resultCore.docName;\r\n\r\n        ////GUARDAR EN BD \r\n        data = DocumentoAnexoModel.getSaveModel(filedata);\r\n        const apibackend = new BackendServices();\r\n        apibackend.guardarDocumentoAnexo(data).then((resultBackend) => {\r\n\r\n          if (resultBackend) {\r\n            // SI TODO OK ACTUALIZAR LA LISTA DE ADJUNTOS\r\n            updateAttachments();\r\n          }\r\n        })\r\n          .catch((error) => { console.error('api error', error); })\r\n          .finally(() => { setIsActiveLoading(false); });\r\n      })\r\n        .catch((error) => { console.error('api error', error); })\r\n        .finally(() => { setIsActiveLoading(false); });\r\n\r\n    }\r\n    catch (error) { setIsActiveLoading(false); }\r\n  }\r\n\r\n  //BORRAR ADJUNTO\r\n  function removeAttachment(filedata) {\r\n\r\n    //BORRAR EN GESTOR DOCUMENTAL ONBASE\r\n    //var data = DocumentModel.getDeleteModel(filedata);\r\n    //const apicore = new CoreServices()\r\n    //apicore.postDocument(data).then((resultCore) => {\r\n\r\n    ////BORRAR EN BD \r\n    var data = { transactId: filedata.transactId, onBaseIdentification: filedata.onBaseIdentification };\r\n    const apibackend = new BackendServices();\r\n    apibackend.eliminarDocumentoAnexo(data).then((resultBackend) => {\r\n\r\n      if (resultBackend) {\r\n        // SI TODO OK ACTUALIZAR LA LISTA DE ADJUNTOS\r\n        updateAttachments();\r\n      }\r\n\r\n    })\r\n      .catch((error) => { console.error('api error', error); })\r\n      .finally(() => { });\r\n    //})\r\n    //.catch((error) => {console.error('api error', error);})\r\n    //.finally (() => {  });        \r\n  }\r\n\r\n  //VER ADJUNTO\r\n  function viewAttachment(docId) {\r\n\r\n    const apicore = new CoreServices()\r\n    apicore.postViewDocument(docId).then((resultCore) => {\r\n      if (resultCore !== null) {\r\n        window.open(resultCore, \"_blank\")\r\n      }\r\n    }).catch((error) => { console.error('api error', error); })\r\n      .finally(() => { setIsActiveLoading(false); });\r\n  }\r\n\r\n  //ACTUALIZAR LISTA DE ADJUNTOS\r\n  function updateAttachments() {\r\n\r\n    var params = { transactId: locationData.instanceId, processId: locationData.processId, activityId: locationData.activityId }\r\n\r\n    const apibackend = new BackendServices();\r\n    apibackend.consultarDocumentosAnexos(params).then((data) => {\r\n      setAttachments(data);\r\n    })\r\n      .catch((error) => { console.error('api error', error); })\r\n      .finally(() => { });\r\n  }\r\n\r\n  //On change Inputs\r\n  let fileData = {};\r\n  // Submitimos formulario para busqueda de clientes\r\n  function handleSubmitfrmAttachment(event, errors, values) {\r\n    event.preventDefault();\r\n    if (errors.length > 0) {\r\n      return;\r\n    }\r\n\r\n    addAttachment(fileData);\r\n    toggleShowModelAttachment();\r\n  }\r\n  //On change Inputs\r\n  async function handleChangeInputfrm(e) {\r\n    fileData[e.target.name] = e.target.value;\r\n    switch (e.target.name) {\r\n      case \"attachment\": {\r\n        const file = e.target.files[0]\r\n        fileData['fileName'] = file.name;\r\n        fileData['fileExtension'] = \".\" + file.name.split('.').pop();\r\n        var base64 = await functionshelper.convertBase64(file);\r\n        //console.log(\"base64\",base64.split(','))\r\n        fileData['fileBase64'] = base64.split(',')[1];\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  return (\r\n\r\n    <React.Fragment>\r\n      <LoadingOverlay active={isActiveLoading} spinner text={t(\"WaitingPlease\")}>\r\n        <Row>\r\n          <Col md=\"12\">\r\n            <Table className=\"table m-0\" responsive>\r\n              <thead className=\"table-light\">\r\n                <tr>\r\n                  <th colSpan={3}>\r\n                    <h6 className=\"float-start\">{t(\"Attach File\")}</h6>\r\n                    <Link to=\"#\" className=\"float-end\" onClick={() => { toggleShowModelAttachment() }} title={t(\"Add\")}><i className=\"mdi mdi-plus-box-multiple-outline mdi-24px\"></i>{\" \"}</Link>\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n\r\n                {attachments !== null && attachments !== undefined && attachments.length > 0 ?\r\n                  (attachments.map((data) => (\r\n                    <tr key={data.documentIdentification}>\r\n                      <td>{data.fileName}</td>\r\n                      <td>{data.fileDescription}</td>\r\n                      <td>\r\n                        <Link to=\"#\" className=\"float-end mx-1\" title={t(\"Delete\")} onClick={() => removeAttachment(data)}><i className=\"mdi mdi-file-remove-outline mdi-24px\"></i></Link>\r\n                        <Link to=\"#\" className=\"float-end mx-1\" title={t(\"View\")} onClick={() => viewAttachment(data.documentIdentification)}><i className=\"mdi mdi-file-search-outline mdi-24px\"></i></Link>\r\n                      </td>\r\n                    </tr>\r\n                  ))) : (\r\n                    <tr>\r\n                      <td colSpan=\"4\">\r\n                        <div className=\"alert alert-info m-0\">{t(\"No attachments yet\")}</div>\r\n                      </td>\r\n                    </tr>\r\n                  )}\r\n\r\n              </tbody>\r\n            </Table>\r\n\r\n\r\n          </Col>\r\n        </Row>\r\n\r\n        <Modal size=\"xl\" isOpen={showModelAttachment} toggle={toggleShowModelAttachment} centered={true}>\r\n          <div className=\"modal-header\">\r\n            <h5 className=\"modal-title mt-0\">{t(\"Attach File\")}</h5>\r\n            <button\r\n              type=\"button\"\r\n              onClick={toggleShowModelAttachment}\r\n              className=\"close\"\r\n              data-dismiss=\"modal\"\r\n              aria-label=\"Close\">\r\n              <span aria-hidden=\"true\">&times;</span>\r\n            </button>\r\n          </div>\r\n\r\n          <AvForm id=\"frmAttachment\" className=\"needs-validation\" onSubmit={handleSubmitfrmAttachment}>\r\n            <div className=\"modal-body\">\r\n              <Row>\r\n                <Col md=\"6\">\r\n                  <div className=\"mb-3\">\r\n                    <Label htmlFor=\"name\">{t(\"Name\")}</Label>\r\n                    <AvField\r\n                      className=\"form-control\"\r\n                      type=\"text\"\r\n                      name=\"name\" onChange={handleChangeInputfrm}\r\n                      errorMessage={t(\"Required Field\")}\r\n                      validate={{ required: { value: true } }}\r\n                    />\r\n                  </div>\r\n                </Col>\r\n                <Col md=\"6\">\r\n                  <div className=\"mb-3\">\r\n                    <Label htmlFor=\"attachment\">{t(\"File\")}</Label>\r\n                    <AvField\r\n                      className=\"form-control\"\r\n                      type=\"file\"\r\n                      name=\"attachment\" onChange={handleChangeInputfrm}\r\n                      errorMessage={t(\"Required Field\")}\r\n                      validate={{ required: { value: true } }}\r\n                      accept=\".jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx,.pdf\"\r\n                    />\r\n\r\n                  </div>\r\n                </Col>\r\n              </Row>\r\n              <Row>\r\n                <Col md=\"12\">\r\n                  <div className=\"mb-3\">\r\n                    <Label htmlFor=\"description\">{t(\"Description\")}</Label>\r\n                    <AvField\r\n                      className=\"form-control\"\r\n                      type=\"textarea\"\r\n                      name=\"description\"\r\n                      maxLength=\"1000\"\r\n                      rows=\"7\"\r\n                      onChange={handleChangeInputfrm}\r\n                    />\r\n                  </div>\r\n                </Col>\r\n              </Row>\r\n            </div>\r\n            <div className=\"modal-footer\">\r\n              <Button color=\"dark\" type=\"button\" style={{ margin: '5px' }} onClick={toggleShowModelAttachment} data-dismiss=\"modal\">\r\n                <i className=\"mdi mdi mdi-cancel mid-12px\"></i> {t(\"Cancel\")}\r\n              </Button>\r\n\r\n              <Button color=\"success\" type=\"submit\" style={{ margin: '5px' }}>\r\n                <i className=\"mdi mdi-content-save mid-12px\"></i> {t(\"Save\")}\r\n              </Button>\r\n            </div>\r\n          </AvForm>\r\n\r\n        </Modal>\r\n      </LoadingOverlay>\r\n    </React.Fragment>\r\n\r\n  )\r\n}\r\n\r\nAttachmentFileCore.propTypes = {\r\n  locationData: PropTypes.any,\r\n}\r\n\r\n//export default (withTranslation()(DatosGenerales));\r\nexport default AttachmentFileCore;\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}
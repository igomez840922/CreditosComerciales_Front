{"ast":null,"code":"import _objectSpread from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import moment from\"moment\";import{BackendServices,CoreServices,BpmServices}from\"../../../../services\";import{Tab,Tabs}from'react-bootstrap';import{jsx as _jsx}from\"react/jsx-runtime\";var previewEscrow=/*#__PURE__*/function(){function previewEscrow(dataSession){_classCallCheck(this,previewEscrow);this.backendServices=new BackendServices();this.bpmServices=new BpmServices();this.coreServices=new CoreServices();this.validateRoute=false;this.isActiveLoading=false;// super();\nthis.saveDataSession(dataSession);}_createClass(previewEscrow,[{key:\"saveDataSession\",value:function saveDataSession(dataSession){var _this$location,_this$location2;sessionStorage.setItem('locationData',JSON.stringify(dataSession));if(((_this$location=this.location)===null||_this$location===void 0?void 0:_this$location.data)!==null&&((_this$location2=this.location)===null||_this$location2===void 0?void 0:_this$location2.data)!==undefined){var _this$location3,_this$location4;if(((_this$location3=this.location)===null||_this$location3===void 0?void 0:_this$location3.data.transactionId)===undefined||((_this$location4=this.location)===null||_this$location4===void 0?void 0:_this$location4.data.transactionId.length)<=0){//this.location?.data.transactionId = 0;\n//checkAndCreateProcedure(this.location?.data);\nthis.validateRoute=true;}else{var _this$location5,_this$location6,_this$location7;sessionStorage.setItem('locationData',JSON.stringify((_this$location5=this.location)===null||_this$location5===void 0?void 0:_this$location5.data));this.locationData=(_this$location6=this.location)===null||_this$location6===void 0?void 0:_this$location6.data;this.dataSession=(_this$location7=this.location)===null||_this$location7===void 0?void 0:_this$location7.data;}}else{//chequeamos si tenemos guardado en session\nvar result=sessionStorage.getItem('locationData');if(result!==undefined&&result!==null){result=JSON.parse(result);this.locationData=result;this.dataSession=result;}}this.loadCustomerID();this.loadDataGeneral();this.loadDataIGR();this.loadDataEnvironmentAspects();this.loadCatalogCreditRisk();}},{key:\"loadCatalogCreditRisk\",value:function(){var _loadCatalogCreditRisk=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// let catalogue = await this.backendServices.getCreditRiskOpinionCatalog();\n// this.flowType = (catalogue?.map(creditRiskOpinion => ({ Code: creditRiskOpinion.id, Description: creditRiskOpinion.description })))\nthis.flowType=[{Code:'1',Description:'Normal'},{Code:'2',Description:'Urgente'}];case 1:case\"end\":return _context.stop();}}},_callee,this);}));function loadCatalogCreditRisk(){return _loadCatalogCreditRisk.apply(this,arguments);}return loadCatalogCreditRisk;}()},{key:\"loadOtherServiceFiduciary\",value:function loadOtherServiceFiduciary(){var _this=this;return new Promise(function(resolve,reject){Promise.allSettled([_this.backendServices.consultGeneralDataPropCred(_this.locationData.transactionId),_this.backendServices.retrieveFacilityType(),_this.coreServices.getTipoGarantiaCatalogo(),_this.backendServices.retrieveProposalType()]).then(function(data){var _data=_slicedToArray(data,4),GeneralDataPropCred=_data[0].value,FacilityType=_data[1].value,guaranteesType=_data[2].value,proposalType=_data[3].value;_this.facilityType=FacilityType;_this.proposalType=proposalType;_this.guaranteesType=guaranteesType===null||guaranteesType===void 0?void 0:guaranteesType.Records;_this.backendServices.consultarFacilidades(GeneralDataPropCred[0].requestId).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(resp){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:resp=resp.filter(function($$){return $$.debtor!=='  '&&$$.facilityTypeId!==\" \";}).filter(function($$){return $$.proposalTypeId!==\"MEN\"&&$$.applyEscrow;});console.log(resp);if(!(resp.length>0)){_context2.next=11;break;}_this.facilities=resp;_this.instructiveType=resp[0].debtor;_this.facility=resp[0];_this.facilityId=resp[0].facilityId;_this.tabsFacility=resp.map(function(items,index){return/*#__PURE__*/_jsx(Tab,{className:\"m-0\",eventKey:index,title:FacilityType.find(function($$){return $$.id===items.facilityTypeId;}).description},index);});_context2.next=10;return _this.LoadNumeroFideicomiso();case 10:_this.basaFid=_context2.sent;case 11:resolve(_this.tabsFacility);case 12:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(err){console.error(err);});}).catch(function(err){console.error(err);});});}},{key:\"LoadFiduciario\",value:function(){var _LoadFiduciario=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this.backendServices.consultarSeccionServiciosFiduciario(this.locationData.transactionId);case 2:return _context3.abrupt(\"return\",_context3.sent);case 3:case\"end\":return _context3.stop();}}},_callee3,this);}));function LoadFiduciario(){return _LoadFiduciario.apply(this,arguments);}return LoadFiduciario;}()},{key:\"LoadOtherFiduciario\",value:function(){var _LoadOtherFiduciario=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var _this2=this;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\",new Promise(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(resolve,reject){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:Promise.allSettled([_this2.backendServices.consultListProgramPagoPropCred(_this2.facilityId),_this2.backendServices.consultarGarantiaPropCred(_this2.facilityId),_this2.backendServices.consultarSeccionOtrosServiciosFiduciario(_this2.locationData.transactionId,_this2.facilityId),_this2.LoadNumeroFideicomiso()]).then(function(allPromise){var _this2$proposalType$f;var _allPromise=_slicedToArray(allPromise,4),paymentMethods=_allPromise[0].value,guarantees=_allPromise[1].value,otherServiceFiduciary=_allPromise[2].value,basaFid=_allPromise[3].value;_this2.basaFid=basaFid;var dataOtherFiduciary={};(paymentMethods!==null||paymentMethods!==undefined)&&(dataOtherFiduciary=_objectSpread(_objectSpread({},dataOtherFiduciary),{},{paymentType:paymentMethods.map(function(paymentMethod){return paymentMethod.paymentProgram;}).join('; ')}));(guarantees!==null||guarantees!==undefined)&&(dataOtherFiduciary=_objectSpread(_objectSpread({},dataOtherFiduciary),{},{fixedActiveType:guarantees.map(function(guarantee){var _this2$guaranteesType;return(_this2$guaranteesType=_this2.guaranteesType.find(function(x){return x.Code===guarantee.guaranteeTypeName;}))===null||_this2$guaranteesType===void 0?void 0:_this2$guaranteesType.Description;}).join('; ')}));(otherServiceFiduciary!==null||otherServiceFiduciary!==undefined)&&(dataOtherFiduciary=_objectSpread(_objectSpread({},dataOtherFiduciary),{},{proposal:(_this2$proposalType$f=_this2.proposalType.find(function(x){return x.id===_this2.facility.proposalTypeId;}))===null||_this2$proposalType$f===void 0?void 0:_this2$proposalType$f.description,purpose:_this2.facility.purpose},otherServiceFiduciary));resolve(dataOtherFiduciary);}).catch(function(err){console.error(err);});case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x2,_x3){return _ref2.apply(this,arguments);};}()));case 1:case\"end\":return _context5.stop();}}},_callee5);}));function LoadOtherFiduciario(){return _LoadOtherFiduciario.apply(this,arguments);}return LoadOtherFiduciario;}()},{key:\"LoadNumeroFideicomiso\",value:function(){var _LoadNumeroFideicomiso=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var _this3=this;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return this.backendServices.consultarNumeroFideicomiso(this.locationData.transactionId).then(function(resp){var _resp$find;return resp===null||resp===void 0?void 0:(_resp$find=resp.find(function(fiduciary){return fiduciary.facilityId===_this3.facilityId;}))===null||_resp$find===void 0?void 0:_resp$find.trustName;});case 2:return _context6.abrupt(\"return\",_context6.sent);case 3:case\"end\":return _context6.stop();}}},_callee6,this);}));function LoadNumeroFideicomiso(){return _LoadNumeroFideicomiso.apply(this,arguments);}return LoadNumeroFideicomiso;}()},{key:\"loadCustomerID\",value:function(){var _loadCustomerID=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return this.backendServices.consultPrincipalDebtor(this.locationData.transactionId).then(function(resp){return resp.customerNumberT24;});case 2:this.customerID=_context7.sent;case 3:case\"end\":return _context7.stop();}}},_callee7,this);}));function loadCustomerID(){return _loadCustomerID.apply(this,arguments);}return loadCustomerID;}()},{key:\"loadDataGeneral\",value:function(){var _loadDataGeneral=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var _this4=this;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return this.backendServices.consultGeneralDataPropCred(this.locationData.transactionId).then(function(resp){var _this4$flowType$find;return _objectSpread(_objectSpread({},resp[0]),{},{requestDate:_this4.formatDate(resp[0].requestDate),lastRequestDate:_this4.formatDate(resp[0].lastRequestDate),nextRevisionDate:_this4.formatDate(resp[0].nextRevisionDate),proposedExpirationDate:_this4.formatDate(resp[0].proposedExpirationDate),flow:(_this4$flowType$find=_this4.flowType.find(function(flowType){return flowType.Code===resp[0].flow;}))===null||_this4$flowType$find===void 0?void 0:_this4$flowType$find.Description});});case 2:this.dataGeneral=_context8.sent;case 3:case\"end\":return _context8.stop();}}},_callee8,this);}));function loadDataGeneral(){return _loadDataGeneral.apply(this,arguments);}return loadDataGeneral;}()},{key:\"loadDataIGR\",value:function(){var _loadDataIGR=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return this.backendServices.consultGeneralDataIGR(this.locationData.transactionId);case 2:this.dataGeneralIGR=_context9.sent;case 3:case\"end\":return _context9.stop();}}},_callee9,this);}));function loadDataIGR(){return _loadDataIGR.apply(this,arguments);}return loadDataIGR;}()},{key:\"loadDataEnvironmentAspects\",value:function(){var _loadDataEnvironmentAspects=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return this.backendServices.consultEnvironmentalAspectsIGR(this.locationData.transactionId).then(function(resp){return resp.environmentalAspectsDTO;});case 2:this.dataGeneralEnvironmentAspects=_context10.sent;case 3:case\"end\":return _context10.stop();}}},_callee10,this);}));function loadDataEnvironmentAspects(){return _loadDataEnvironmentAspects.apply(this,arguments);}return loadDataEnvironmentAspects;}()},{key:\"getFacilityHistory\",value:function(){var _getFacilityHistory=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee14(){var _this5=this;return _regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:return _context14.abrupt(\"return\",new Promise(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee13(resolve,reject){var _this5$locationData$t,_this5$locationData;return _regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_context13.next=2;return _this5.backendServices.consultGeneralDataPropCred((_this5$locationData$t=(_this5$locationData=_this5.locationData)===null||_this5$locationData===void 0?void 0:_this5$locationData.transactionId)!==null&&_this5$locationData$t!==void 0?_this5$locationData$t:0).then(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(propuesta){var _propuesta$;return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_this5.backendServices.consultarFacilidadesT24((_propuesta$=propuesta[0])===null||_propuesta$===void 0?void 0:_propuesta$.requestId).then(/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(resp){return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:if(resp.length>0&&resp!=undefined){resolve(+resp.reduce(function(acc,crr){return acc+crr.amount;},0));}case 1:case\"end\":return _context11.stop();}}},_callee11);}));return function(_x7){return _ref5.apply(this,arguments);};}());_this5.backendServices.consultarFacilidades(propuesta[0].requestId).then(function(resp){var _resp;resp=(_resp=resp)===null||_resp===void 0?void 0:_resp.filter(function(data){return data.debtor!=\"  \";});if(resp.length>0){resolve(+resp.reduce(function(acc,crr){return acc+crr.amount;},0));}});case 2:case\"end\":return _context12.stop();}}},_callee12);}));return function(_x6){return _ref4.apply(this,arguments);};}());case 2:case\"end\":return _context13.stop();}}},_callee13);}));return function(_x4,_x5){return _ref3.apply(this,arguments);};}()));case 1:case\"end\":return _context14.stop();}}},_callee14);}));function getFacilityHistory(){return _getFacilityHistory.apply(this,arguments);}return getFacilityHistory;}()},{key:\"formatDate\",value:function formatDate(date){return date?moment(date).format(\"DD/MM/YYYY\"):'';}}]);return previewEscrow;}();export{previewEscrow as default};","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/CommercialCredit/10_Fideicomiso/Relacionfiduciaria/preview.model.js"],"names":["moment","BackendServices","CoreServices","BpmServices","Tab","Tabs","previewEscrow","dataSession","backendServices","bpmServices","coreServices","validateRoute","isActiveLoading","saveDataSession","sessionStorage","setItem","JSON","stringify","location","data","undefined","transactionId","length","locationData","result","getItem","parse","loadCustomerID","loadDataGeneral","loadDataIGR","loadDataEnvironmentAspects","loadCatalogCreditRisk","flowType","Code","Description","Promise","resolve","reject","allSettled","consultGeneralDataPropCred","retrieveFacilityType","getTipoGarantiaCatalogo","retrieveProposalType","then","GeneralDataPropCred","value","FacilityType","guaranteesType","proposalType","facilityType","Records","consultarFacilidades","requestId","resp","filter","$$","debtor","facilityTypeId","proposalTypeId","applyEscrow","console","log","facilities","instructiveType","facility","facilityId","tabsFacility","map","items","index","find","id","description","LoadNumeroFideicomiso","basaFid","catch","err","error","consultarSeccionServiciosFiduciario","consultListProgramPagoPropCred","consultarGarantiaPropCred","consultarSeccionOtrosServiciosFiduciario","allPromise","paymentMethods","guarantees","otherServiceFiduciary","dataOtherFiduciary","paymentType","paymentMethod","paymentProgram","join","fixedActiveType","guarantee","x","guaranteeTypeName","proposal","purpose","consultarNumeroFideicomiso","fiduciary","trustName","consultPrincipalDebtor","customerNumberT24","customerID","requestDate","formatDate","lastRequestDate","nextRevisionDate","proposedExpirationDate","flow","dataGeneral","consultGeneralDataIGR","dataGeneralIGR","consultEnvironmentalAspectsIGR","environmentalAspectsDTO","dataGeneralEnvironmentAspects","propuesta","consultarFacilidadesT24","reduce","acc","crr","amount","date","format"],"mappings":"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","sourcesContent":["import moment from \"moment\";\r\nimport { BackendServices, CoreServices, BpmServices } from \"../../../../services\";\r\nimport { Tab, Tabs } from 'react-bootstrap';\r\n\r\nexport default class previewEscrow {\r\n\r\n    backendServices = new BackendServices();\r\n    bpmServices = new BpmServices();\r\n    coreServices = new CoreServices();\r\n    serviciosFiduciario;\r\n    otherServiciosFiduciario;\r\n    locationData;\r\n    basaFid;\r\n    dataSession;\r\n    validateRoute = false;\r\n    customerID;\r\n    dataGeneral;\r\n    dataGeneralIGR;\r\n    dataGeneralEnvironmentAspects;\r\n    levelAutonomy;\r\n    isActiveLoading = false;\r\n    facilityType;\r\n    proposalType;\r\n    guaranteesType;\r\n    facilities;\r\n    instructiveType;\r\n    facility;\r\n    facilityId;\r\n    tabsFacility;\r\n\r\n    flowType;\r\n\r\n\r\n    constructor(dataSession) {\r\n        // super();\r\n        this.saveDataSession(dataSession)\r\n    }\r\n\r\n    saveDataSession(dataSession) {\r\n        sessionStorage.setItem('locationData', JSON.stringify(dataSession));\r\n        if (this.location?.data !== null && this.location?.data !== undefined) {\r\n            if (this.location?.data.transactionId === undefined || this.location?.data.transactionId.length <= 0) {\r\n                //this.location?.data.transactionId = 0;\r\n                //checkAndCreateProcedure(this.location?.data);\r\n                this.validateRoute = true\r\n            }\r\n            else {\r\n                sessionStorage.setItem('locationData', JSON.stringify(this.location?.data));\r\n                this.locationData = this.location?.data;\r\n                this.dataSession = this.location?.data;\r\n            }\r\n        }\r\n        else {\r\n            //chequeamos si tenemos guardado en session\r\n            var result = sessionStorage.getItem('locationData');\r\n            if (result !== undefined && result !== null) {\r\n                result = JSON.parse(result);\r\n                this.locationData = result;\r\n                this.dataSession = result;\r\n            }\r\n        }\r\n\r\n        this.loadCustomerID();\r\n        this.loadDataGeneral();\r\n        this.loadDataIGR();\r\n        this.loadDataEnvironmentAspects();\r\n        this.loadCatalogCreditRisk()\r\n    }\r\n    async loadCatalogCreditRisk() {\r\n        // let catalogue = await this.backendServices.getCreditRiskOpinionCatalog();\r\n        // this.flowType = (catalogue?.map(creditRiskOpinion => ({ Code: creditRiskOpinion.id, Description: creditRiskOpinion.description })))\r\n        this.flowType = [{ Code: '1', Description: 'Normal' }, { Code: '2', Description: 'Urgente' }]\r\n    }\r\n\r\n    loadOtherServiceFiduciary() {\r\n        return new Promise((resolve, reject) => {\r\n            Promise.allSettled([\r\n                this.backendServices.consultGeneralDataPropCred(this.locationData.transactionId),\r\n                this.backendServices.retrieveFacilityType(),\r\n                this.coreServices.getTipoGarantiaCatalogo(),\r\n                this.backendServices.retrieveProposalType(),\r\n            ]).then(data => {\r\n                const [{ value: GeneralDataPropCred }, { value: FacilityType }, { value: guaranteesType }, { value: proposalType }] = data;\r\n                this.facilityType = FacilityType;\r\n                this.proposalType = proposalType;\r\n                this.guaranteesType = guaranteesType?.Records;\r\n                this.backendServices.consultarFacilidades(GeneralDataPropCred[0].requestId).then(async resp => {\r\n                    resp = resp.filter($$ => $$.debtor !== '  ' && $$.facilityTypeId !== \" \").filter($$ => $$.proposalTypeId !== \"MEN\" && $$.applyEscrow);\r\n                    console.log(resp)\r\n                    if (resp.length > 0) {\r\n                        this.facilities = resp;\r\n                        this.instructiveType = resp[0].debtor;\r\n                        this.facility = resp[0];\r\n                        this.facilityId = resp[0].facilityId;\r\n                        this.tabsFacility = (resp.map((items, index) => (\r\n                            <Tab className=\"m-0\" key={index} eventKey={index} title={FacilityType.find($$ => $$.id === items.facilityTypeId).description}></Tab>\r\n                        )));\r\n                        this.basaFid = await this.LoadNumeroFideicomiso();\r\n                    }\r\n                    resolve(this.tabsFacility);\r\n                }).catch(err => {\r\n                    console.error(err);\r\n                });\r\n\r\n            }).catch(err => {\r\n                console.error(err)\r\n            })\r\n        })\r\n    }\r\n\r\n    async LoadFiduciario() {\r\n        return await this.backendServices.consultarSeccionServiciosFiduciario(this.locationData.transactionId);\r\n    }\r\n\r\n    async LoadOtherFiduciario() {\r\n        return new Promise(async (resolve, reject) => {\r\n            Promise.allSettled([\r\n                this.backendServices.consultListProgramPagoPropCred(this.facilityId),\r\n                this.backendServices.consultarGarantiaPropCred(this.facilityId),\r\n                this.backendServices.consultarSeccionOtrosServiciosFiduciario(this.locationData.transactionId, this.facilityId),\r\n                this.LoadNumeroFideicomiso()\r\n            ]).then(allPromise => {\r\n                const [{ value: paymentMethods }, { value: guarantees }, { value: otherServiceFiduciary }, { value: basaFid }] = allPromise;\r\n                this.basaFid = basaFid;\r\n\r\n                let dataOtherFiduciary = {};\r\n                (paymentMethods !== null || paymentMethods !== undefined) && (dataOtherFiduciary = { ...dataOtherFiduciary, paymentType: paymentMethods.map(paymentMethod => paymentMethod.paymentProgram).join('; ') });\r\n                (guarantees !== null || guarantees !== undefined) && (dataOtherFiduciary = { ...dataOtherFiduciary, fixedActiveType: guarantees.map(guarantee => this.guaranteesType.find(x => x.Code === guarantee.guaranteeTypeName)?.Description).join('; ') });\r\n                (otherServiceFiduciary !== null || otherServiceFiduciary !== undefined) && (dataOtherFiduciary = { ...dataOtherFiduciary, proposal: this.proposalType.find(x => x.id === this.facility.proposalTypeId)?.description, purpose: this.facility.purpose, ...otherServiceFiduciary });\r\n                resolve(dataOtherFiduciary);\r\n            }).catch(err => {\r\n                console.error(err)\r\n            });\r\n        });\r\n        // return await this.backendServices.consultarSeccionOtrosServiciosFiduciario(this.locationData.transactionId, this.facilityId);\r\n    }\r\n\r\n    async LoadNumeroFideicomiso() {\r\n        return await this.backendServices.consultarNumeroFideicomiso(this.locationData.transactionId).then(resp => resp?.find(fiduciary => fiduciary.facilityId === this.facilityId)?.trustName);\r\n    }\r\n\r\n    async loadCustomerID() {\r\n        this.customerID = await this.backendServices.consultPrincipalDebtor(this.locationData.transactionId).then(resp => resp.customerNumberT24);\r\n    }\r\n\r\n    async loadDataGeneral() {\r\n        this.dataGeneral = await this.backendServices.consultGeneralDataPropCred(this.locationData.transactionId).then(resp => ({ ...resp[0], requestDate: this.formatDate(resp[0].requestDate), lastRequestDate: this.formatDate(resp[0].lastRequestDate), nextRevisionDate: this.formatDate(resp[0].nextRevisionDate), proposedExpirationDate: this.formatDate(resp[0].proposedExpirationDate), flow: this.flowType.find(flowType => flowType.Code === resp[0].flow)?.Description }));\r\n    }\r\n\r\n    async loadDataIGR() {\r\n        this.dataGeneralIGR = await this.backendServices.consultGeneralDataIGR(this.locationData.transactionId);\r\n    }\r\n    async loadDataEnvironmentAspects() {\r\n        this.dataGeneralEnvironmentAspects = await this.backendServices.consultEnvironmentalAspectsIGR(this.locationData.transactionId).then(resp => resp.environmentalAspectsDTO)\r\n    }\r\n\r\n\r\n    async getFacilityHistory() {\r\n        return new Promise(async (resolve, reject) => {\r\n            await this.backendServices.consultGeneralDataPropCred(this.locationData?.transactionId ?? 0).then(async propuesta => {\r\n                this.backendServices.consultarFacilidadesT24(propuesta[0]?.requestId).then(async resp => {\r\n                    if (resp.length > 0 && resp != undefined) {\r\n                        resolve(+resp.reduce((acc, crr) => acc + crr.amount, 0))\r\n                    }\r\n                });\r\n                this.backendServices.consultarFacilidades(propuesta[0].requestId).then(resp => {\r\n                    resp = resp?.filter(data => data.debtor != \"  \");\r\n                    if (resp.length > 0) {\r\n                        resolve(+resp.reduce((acc, crr) => acc + crr.amount, 0));\r\n                    }\r\n                });\r\n            })\r\n        })\r\n    }\r\n\r\n    formatDate(date) {\r\n        return date ? moment(date).format(\"DD/MM/YYYY\") : '';\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}
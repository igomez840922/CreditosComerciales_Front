{"ast":null,"code":"var _jsxFileName = \"D:\\\\_PROJECTS\\\\_SOAINT\\\\JBPM\\\\App\\\\banescocreditoscomerciales\\\\src\\\\pages\\\\CommercialCredit\\\\5_PropuestaCredito\\\\Secciones\\\\LevelAutonomy.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport { withTranslation } from \"react-i18next\";\nimport PropTypes from 'prop-types';\nimport { Row, Col, Button, Label, Input, Modal, Card, CardBody, CardFooter } from \"reactstrap\";\nimport { AvForm, AvField } from \"availity-reactstrap-validation\";\nimport { translationHelpers } from \"../../../../helpers\";\nimport { BackendServices, BpmServices } from \"../../../../services\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport * as url from \"../../../../helpers/url_helper\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst LevelAutonomy = props => {\n  _s();\n\n  const [t, c] = translationHelpers('translation', 'common');\n  const [levelAutonomy, setLevelAutonomy] = useState(0);\n  const [levelAutonomyPosition, setLevelAutonomyPosition] = useState('');\n  const bpmServices = new BpmServices();\n  const backendServices = new BackendServices();\n  const location = useLocation();\n  const history = useHistory();\n  const [locationData, setLocationData] = useState(null);\n  useEffect(() => {\n    let dataSession;\n\n    if (location.data !== null && location.data !== undefined) {\n      if (location.data.transactionId === undefined || location.data.transactionId.length <= 0) {\n        //location.data.transactionId = 0;\n        //checkAndCreateProcedure(location.data);\n        history.push(url.URL_DASHBOARD);\n      } else {\n        sessionStorage.setItem('locationData', JSON.stringify(location.data));\n        setLocationData(location.data);\n        dataSession = location.data;\n      }\n    } else {\n      //chequeamos si tenemos guardado en session\n      var result = sessionStorage.getItem('locationData');\n\n      if (result !== undefined && result !== null) {\n        result = JSON.parse(result);\n        setLocationData(result);\n        dataSession = result;\n      }\n    }\n\n    getFacilityHistory({\n      dataSession\n    });\n  }, []);\n  useEffect(() => {\n    var _props$levelAutonomy;\n\n    let amount = levelAutonomy + ((_props$levelAutonomy = props.levelAutonomy) !== null && _props$levelAutonomy !== void 0 ? _props$levelAutonomy : 0);\n    amount > 0 && bpmServices.saveAutonomy(amount).then(resp => {\n      var _resp$body, _resp$body$result$dmn, _resp$body$result$dmn2;\n\n      setLevelAutonomyPosition(resp === null || resp === void 0 ? void 0 : (_resp$body = resp.body) === null || _resp$body === void 0 ? void 0 : (_resp$body$result$dmn = _resp$body.result['dmn-evaluation-result']['dmn-context']) === null || _resp$body$result$dmn === void 0 ? void 0 : (_resp$body$result$dmn2 = _resp$body$result$dmn.autonomiaduales) === null || _resp$body$result$dmn2 === void 0 ? void 0 : _resp$body$result$dmn2.banca);\n    }).catch(err => {\n      console.log(err);\n    });\n  }, [levelAutonomy, props.levelAutonomy]);\n\n  async function getFacilityHistory({\n    dataSession = locationData\n  }) {\n    var _dataSession$transact;\n\n    await backendServices.consultGeneralDataPropCred((_dataSession$transact = dataSession === null || dataSession === void 0 ? void 0 : dataSession.transactionId) !== null && _dataSession$transact !== void 0 ? _dataSession$transact : 0).then(async propuesta => {\n      var _propuesta$;\n\n      backendServices.consultarFacilidadesT24((_propuesta$ = propuesta[0]) === null || _propuesta$ === void 0 ? void 0 : _propuesta$.requestId).then(async resp => {\n        if (resp.length > 0 && resp != undefined) {\n          setLevelAutonomy(levelAutonomy => levelAutonomy + +resp.reduce((acc, crr) => acc + crr.amount, 0));\n        }\n      });\n      backendServices.consultarFacilidades(propuesta[0].requestId).then(resp => {\n        var _resp;\n\n        resp = (_resp = resp) === null || _resp === void 0 ? void 0 : _resp.filter(data => data.debtor != \"  \");\n\n        if (resp.length > 0) {\n          setLevelAutonomy(levelAutonomy => levelAutonomy + +resp.reduce((acc, crr) => acc + crr.amount, 0));\n        }\n      });\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"h5\", {\n    className: \"card-title mt-2\",\n    style: {\n      textAlign: \"right\",\n      fontSize: '21px!important'\n    },\n    children: [t(\"Level of Autonomy\"), \": \", levelAutonomyPosition]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n};\n\n_s(LevelAutonomy, \"q32ct45+21x6fsQYMduHcaUn+Tk=\", false, function () {\n  return [useLocation, useHistory];\n});\n\n_c = LevelAutonomy;\nexport default withTranslation()(LevelAutonomy);\n\nvar _c;\n\n$RefreshReg$(_c, \"LevelAutonomy\");","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/CommercialCredit/5_PropuestaCredito/Secciones/LevelAutonomy.js"],"names":["React","useEffect","useState","withTranslation","PropTypes","Row","Col","Button","Label","Input","Modal","Card","CardBody","CardFooter","AvForm","AvField","translationHelpers","BackendServices","BpmServices","useHistory","useLocation","url","LevelAutonomy","props","t","c","levelAutonomy","setLevelAutonomy","levelAutonomyPosition","setLevelAutonomyPosition","bpmServices","backendServices","location","history","locationData","setLocationData","dataSession","data","undefined","transactionId","length","push","URL_DASHBOARD","sessionStorage","setItem","JSON","stringify","result","getItem","parse","getFacilityHistory","amount","saveAutonomy","then","resp","body","autonomiaduales","banca","catch","err","console","log","consultGeneralDataPropCred","propuesta","consultarFacilidadesT24","requestId","reduce","acc","crr","consultarFacilidades","filter","debtor","textAlign","fontSize"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,SAASC,eAAT,QAAgC,eAAhC;AACA,OAAOC,SAAP,MAAsB,YAAtB;AAEA,SACEC,GADF,EAEEC,GAFF,EAGEC,MAHF,EAIEC,KAJF,EAKEC,KALF,EAMEC,KANF,EAOEC,IAPF,EAQEC,QARF,EASEC,UATF,QAUO,YAVP;AAYA,SAASC,MAAT,EAAiBC,OAAjB,QAAgC,gCAAhC;AACA,SAASC,kBAAT,QAAmC,qBAAnC;AACA,SAASC,eAAT,EAA0BC,WAA1B,QAA6C,sBAA7C;AACA,SAASC,UAAT,EAAqBC,WAArB,QAAwC,kBAAxC;AACA,OAAO,KAAKC,GAAZ,MAAqB,gCAArB;;;AAEA,MAAMC,aAAa,GAAIC,KAAD,IAAW;AAAA;;AAC/B,QAAM,CAACC,CAAD,EAAIC,CAAJ,IAAST,kBAAkB,CAAC,aAAD,EAAgB,QAAhB,CAAjC;AACA,QAAM,CAACU,aAAD,EAAgBC,gBAAhB,IAAoCzB,QAAQ,CAAC,CAAD,CAAlD;AACA,QAAM,CAAC0B,qBAAD,EAAwBC,wBAAxB,IAAoD3B,QAAQ,CAAC,EAAD,CAAlE;AACA,QAAM4B,WAAW,GAAG,IAAIZ,WAAJ,EAApB;AACA,QAAMa,eAAe,GAAG,IAAId,eAAJ,EAAxB;AAEA,QAAMe,QAAQ,GAAGZ,WAAW,EAA5B;AACA,QAAMa,OAAO,GAAGd,UAAU,EAA1B;AACA,QAAM,CAACe,YAAD,EAAeC,eAAf,IAAkCjC,QAAQ,CAAC,IAAD,CAAhD;AAEAD,EAAAA,SAAS,CAAC,MAAM;AAEd,QAAImC,WAAJ;;AACA,QAAIJ,QAAQ,CAACK,IAAT,KAAkB,IAAlB,IAA0BL,QAAQ,CAACK,IAAT,KAAkBC,SAAhD,EAA2D;AACzD,UAAIN,QAAQ,CAACK,IAAT,CAAcE,aAAd,KAAgCD,SAAhC,IAA6CN,QAAQ,CAACK,IAAT,CAAcE,aAAd,CAA4BC,MAA5B,IAAsC,CAAvF,EAA0F;AACxF;AACA;AACAP,QAAAA,OAAO,CAACQ,IAAR,CAAapB,GAAG,CAACqB,aAAjB;AACD,OAJD,MAKK;AACHC,QAAAA,cAAc,CAACC,OAAf,CAAuB,cAAvB,EAAuCC,IAAI,CAACC,SAAL,CAAed,QAAQ,CAACK,IAAxB,CAAvC;AACAF,QAAAA,eAAe,CAACH,QAAQ,CAACK,IAAV,CAAf;AACAD,QAAAA,WAAW,GAAGJ,QAAQ,CAACK,IAAvB;AACD;AACF,KAXD,MAYK;AACH;AACA,UAAIU,MAAM,GAAGJ,cAAc,CAACK,OAAf,CAAuB,cAAvB,CAAb;;AACA,UAAID,MAAM,KAAKT,SAAX,IAAwBS,MAAM,KAAK,IAAvC,EAA6C;AAC3CA,QAAAA,MAAM,GAAGF,IAAI,CAACI,KAAL,CAAWF,MAAX,CAAT;AACAZ,QAAAA,eAAe,CAACY,MAAD,CAAf;AACAX,QAAAA,WAAW,GAAGW,MAAd;AACD;AACF;;AAEDG,IAAAA,kBAAkB,CAAC;AAAEd,MAAAA;AAAF,KAAD,CAAlB;AAED,GA3BQ,EA2BN,EA3BM,CAAT;AA8BAnC,EAAAA,SAAS,CAAC,MAAM;AAAA;;AACd,QAAIkD,MAAM,GAAGzB,aAAa,4BAAIH,KAAK,CAACG,aAAV,uEAA2B,CAA3B,CAA1B;AACAyB,IAAAA,MAAM,GAAG,CAAT,IAAcrB,WAAW,CAACsB,YAAZ,CAAyBD,MAAzB,EAAiCE,IAAjC,CAAsCC,IAAI,IAAI;AAAA;;AAC1DzB,MAAAA,wBAAwB,CAACyB,IAAD,aAACA,IAAD,qCAACA,IAAI,CAAEC,IAAP,wEAAC,WAAYR,MAAZ,CAAmB,uBAAnB,EAA4C,aAA5C,CAAD,oFAAC,sBAA4DS,eAA7D,2DAAC,uBAA6EC,KAA9E,CAAxB;AACD,KAFa,EAEXC,KAFW,CAELC,GAAG,IAAI;AACdC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD,KAJa,CAAd;AAKD,GAPQ,EAON,CAACjC,aAAD,EAAgBH,KAAK,CAACG,aAAtB,CAPM,CAAT;;AASA,iBAAewB,kBAAf,CAAkC;AAAEd,IAAAA,WAAW,GAAGF;AAAhB,GAAlC,EAAkE;AAAA;;AAChE,UAAMH,eAAe,CAAC+B,0BAAhB,0BAA2C1B,WAA3C,aAA2CA,WAA3C,uBAA2CA,WAAW,CAAEG,aAAxD,yEAAyE,CAAzE,EAA4Ec,IAA5E,CAAiF,MAAMU,SAAN,IAAmB;AAAA;;AACxGhC,MAAAA,eAAe,CAACiC,uBAAhB,gBAAwCD,SAAS,CAAC,CAAD,CAAjD,gDAAwC,YAAcE,SAAtD,EAAiEZ,IAAjE,CAAsE,MAAMC,IAAN,IAAc;AAClF,YAAIA,IAAI,CAACd,MAAL,GAAc,CAAd,IAAmBc,IAAI,IAAIhB,SAA/B,EAA0C;AACxCX,UAAAA,gBAAgB,CAACD,aAAa,IAAIA,aAAa,GAAG,CAAC4B,IAAI,CAACY,MAAL,CAAY,CAACC,GAAD,EAAMC,GAAN,KAAcD,GAAG,GAAGC,GAAG,CAACjB,MAApC,EAA4C,CAA5C,CAAnC,CAAhB;AACD;AACF,OAJD;AAKApB,MAAAA,eAAe,CAACsC,oBAAhB,CAAqCN,SAAS,CAAC,CAAD,CAAT,CAAaE,SAAlD,EAA6DZ,IAA7D,CAAkEC,IAAI,IAAI;AAAA;;AACxEA,QAAAA,IAAI,YAAGA,IAAH,0CAAG,MAAMgB,MAAN,CAAajC,IAAI,IAAIA,IAAI,CAACkC,MAAL,IAAe,IAApC,CAAP;;AACA,YAAIjB,IAAI,CAACd,MAAL,GAAc,CAAlB,EAAqB;AACnBb,UAAAA,gBAAgB,CAACD,aAAa,IAAIA,aAAa,GAAG,CAAC4B,IAAI,CAACY,MAAL,CAAY,CAACC,GAAD,EAAMC,GAAN,KAAcD,GAAG,GAAGC,GAAG,CAACjB,MAApC,EAA4C,CAA5C,CAAnC,CAAhB;AACD;AACF,OALD;AAMD,KAZK,CAAN;AAaD;;AAED,sBACE;AAAI,IAAA,SAAS,EAAC,iBAAd;AAAgC,IAAA,KAAK,EAAE;AAAEqB,MAAAA,SAAS,EAAE,OAAb;AAAsBC,MAAAA,QAAQ,EAAE;AAAhC,KAAvC;AAAA,eAA4FjD,CAAC,CAAC,mBAAD,CAA7F,QAAsHI,qBAAtH;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AAGD,CArED;;GAAMN,a;UAOaF,W,EACDD,U;;;KARZG,a;AAuEN,eAAgBnB,eAAe,GAAGmB,aAAH,CAA/B","sourcesContent":["import React, { useEffect, useState } from \"react\"\r\nimport { withTranslation } from \"react-i18next\"\r\nimport PropTypes from 'prop-types';\r\n\r\nimport {\r\n  Row,\r\n  Col,\r\n  Button,\r\n  Label,\r\n  Input,\r\n  Modal,\r\n  Card,\r\n  CardBody,\r\n  CardFooter,\r\n} from \"reactstrap\"\r\n\r\nimport { AvForm, AvField } from \"availity-reactstrap-validation\"\r\nimport { translationHelpers } from \"../../../../helpers\";\r\nimport { BackendServices, BpmServices } from \"../../../../services\";\r\nimport { useHistory, useLocation } from \"react-router-dom\";\r\nimport * as url from \"../../../../helpers/url_helper\"\r\n\r\nconst LevelAutonomy = (props) => {\r\n  const [t, c] = translationHelpers('translation', 'common');\r\n  const [levelAutonomy, setLevelAutonomy] = useState(0);\r\n  const [levelAutonomyPosition, setLevelAutonomyPosition] = useState('');\r\n  const bpmServices = new BpmServices();\r\n  const backendServices = new BackendServices();\r\n\r\n  const location = useLocation();\r\n  const history = useHistory();\r\n  const [locationData, setLocationData] = useState(null);\r\n\r\n  useEffect(() => {\r\n\r\n    let dataSession;\r\n    if (location.data !== null && location.data !== undefined) {\r\n      if (location.data.transactionId === undefined || location.data.transactionId.length <= 0) {\r\n        //location.data.transactionId = 0;\r\n        //checkAndCreateProcedure(location.data);\r\n        history.push(url.URL_DASHBOARD);\r\n      }\r\n      else {\r\n        sessionStorage.setItem('locationData', JSON.stringify(location.data));\r\n        setLocationData(location.data);\r\n        dataSession = location.data;\r\n      }\r\n    }\r\n    else {\r\n      //chequeamos si tenemos guardado en session\r\n      var result = sessionStorage.getItem('locationData');\r\n      if (result !== undefined && result !== null) {\r\n        result = JSON.parse(result);\r\n        setLocationData(result);\r\n        dataSession = result\r\n      }\r\n    }\r\n\r\n    getFacilityHistory({ dataSession })\r\n\r\n  }, []);\r\n\r\n\r\n  useEffect(() => {\r\n    let amount = levelAutonomy + (props.levelAutonomy ?? 0)\r\n    amount > 0 && bpmServices.saveAutonomy(amount).then(resp => {\r\n      setLevelAutonomyPosition(resp?.body?.result['dmn-evaluation-result']['dmn-context']?.autonomiaduales?.banca)\r\n    }).catch(err => {\r\n      console.log(err)\r\n    });\r\n  }, [levelAutonomy, props.levelAutonomy])\r\n\r\n  async function getFacilityHistory({ dataSession = locationData }) {\r\n    await backendServices.consultGeneralDataPropCred(dataSession?.transactionId ?? 0).then(async propuesta => {\r\n      backendServices.consultarFacilidadesT24(propuesta[0]?.requestId).then(async resp => {\r\n        if (resp.length > 0 && resp != undefined) {\r\n          setLevelAutonomy(levelAutonomy => levelAutonomy + +resp.reduce((acc, crr) => acc + crr.amount, 0))\r\n        }\r\n      })\r\n      backendServices.consultarFacilidades(propuesta[0].requestId).then(resp => {\r\n        resp = resp?.filter(data => data.debtor != \"  \");\r\n        if (resp.length > 0) {\r\n          setLevelAutonomy(levelAutonomy => levelAutonomy + +resp.reduce((acc, crr) => acc + crr.amount, 0))\r\n        }\r\n      });\r\n    })\r\n  }\r\n\r\n  return (\r\n    <h5 className=\"card-title mt-2\" style={{ textAlign: \"right\", fontSize: '21px!important' }}>{t(\"Level of Autonomy\")}: {levelAutonomyPosition}</h5>\r\n  );\r\n};\r\n\r\nexport default (withTranslation()(LevelAutonomy));\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";//Gestionar Log de los Procesos\nimport React,{useEffect,useState}from\"react\";import{Link,useLocation}from\"react-router-dom\";import functionshelper from\"../../helpers/functions_helper\";import{Table,Card,CardBody,Alert,UncontrolledAlert,Pagination,PaginationItem,PaginationLink,CardFooter,Button,Row,Col}from\"reactstrap\";//i18n\nimport{withTranslation}from\"react-i18next\";//Import SweetAlert\nimport SweetAlert from\"react-bootstrap-sweetalert\";import ModalNewLog from\"./ModalNewLog\";import{BackendServices}from\"../../services/index\";import HeaderSections from\"../../components/Common/HeaderSections\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LogProcess=function LogProcess(props){//Data que recibimos en el location\nvar _useState=useState(props.locationData),_useState2=_slicedToArray(_useState,2),locationData=_useState2[0],setLocationData=_useState2[1];var location=useLocation();var _useState3=useState(undefined),_useState4=_slicedToArray(_useState3,2),dataLocation=_useState4[0],setdataLocation=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),dataList=_useState6[0],setDataList=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),displayNewLogModal=_useState8[0],setDisplayNewLogModal=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),success_dlg=_useState10[0],setsuccess_dlg=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),success_msg=_useState12[0],setsuccess_msg=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),error_dlg=_useState14[0],seterror_dlg=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),error_msg=_useState16[0],seterror_msg=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),showErro=_useState18[0],setshowErro=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),errorMsg=_useState20[0],seterrorMsg=_useState20[1];//On Mounting (componentDidMount) if selectedData has changes\n// React.useEffect(() => {\n//   if (props.locationData !== undefined && props.locationData !== null) {\n//     setLocationData(props.locationData)\n//     searchData(props.locationData);\n//   }\n// }, [props.locationData]);\nuseEffect(function(){if(location.data!==null&&location.data!==undefined){if(location.data.transactionId===undefined||location.data.transactionId.length<=0){location.data.transactionId=0;}else{sessionStorage.setItem('locationData',JSON.stringify(location.data));setdataLocation(location.data);searchData(location.data);}}else{//chequeamos si tenemos guardado en session\nvar result=sessionStorage.getItem('locationData');if(result!==undefined&&result!==null){result=JSON.parse(result);setdataLocation(result);searchData(result);}}},[]);//nuevo log\nfunction toggleDisplayNewLogModal(){setDisplayNewLogModal(!displayNewLogModal);removeBodyCss();}function removeBodyCss(){document.body.classList.add(\"no_padding\");}//buscamos las Propuestas de Credito\nfunction searchData(data){var api=new BackendServices();var parameters={responsible:\"admin\",instanceNumber:data.instanceId,transactId:data.transactionId};api.getHistorical(data.transactionId).then(function(resp){if(resp.status==200){var dataRows=resp.result.map(function(dt,idx){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"row\",children:dt.date}),/*#__PURE__*/_jsx(\"td\",{children:dt.observations}),/*#__PURE__*/_jsx(\"td\",{children:functionshelper.getProcessName(dt.processId)}),/*#__PURE__*/_jsx(\"td\",{}),/*#__PURE__*/_jsx(\"td\",{children:dt.responsible}),/*#__PURE__*/_jsx(\"td\",{})]},idx);});setDataList(dataRows);}else{setshowErro(false);seterrorMsg(props.t('ErrorCode')+\": \"+resp.status+\"  \"+props.t('ErrorMsg')+\": \"+resp.error.error);setshowErro(true);}}).catch(function(err){console.log(err);});}function _onSaveLogProcess(observations){var _dataLocation$transac;/* ---------------------------------------------------------------------------------------------- */ /*              Le pasamos los valores al servicio de guardar bitacora                            */ /* ---------------------------------------------------------------------------------------------- */var api=new BackendServices();api.consultPrincipalDebtor((_dataLocation$transac=dataLocation===null||dataLocation===void 0?void 0:dataLocation.transactionId)!==null&&_dataLocation$transac!==void 0?_dataLocation$transac:0).then(function(resp){var _dataLocation$instanc,_Number,_Number2,_Number3,_Number4;var data={instanceId:(_dataLocation$instanc=dataLocation===null||dataLocation===void 0?void 0:dataLocation.instanceId)!==null&&_dataLocation$instanc!==void 0?_dataLocation$instanc:0,transactId:(_Number=Number(dataLocation===null||dataLocation===void 0?void 0:dataLocation.transactionId))!==null&&_Number!==void 0?_Number:0,clientId:(_Number2=Number(resp.personId))!==null&&_Number2!==void 0?_Number2:0,observations:observations,responsible:\"admin\",//hay que poner el usuario login\nprocessId:(_Number3=Number(dataLocation===null||dataLocation===void 0?void 0:dataLocation.processId))!==null&&_Number3!==void 0?_Number3:0,activityId:(_Number4=Number(dataLocation===null||dataLocation===void 0?void 0:dataLocation.activityId))!==null&&_Number4!==void 0?_Number4:0,status:true,requestId:\"\",requestStatus:\"\",rejectionReason:\"\"};api.saveHistorical(data).then(function(resp){if(resp!==undefined){searchData(dataLocation);setsuccess_msg(props.t(\"SuccessSaveMessage\"));setsuccess_dlg(true);}else{setshowErro(false);seterrorMsg(props.t(\"ErrorSaveMessage\"));setshowErro(true);}}).catch(function(err){console.log(err);});});}return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(CardBody,{children:[showErro?/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{lg:\"12\",children:/*#__PURE__*/_jsx(UncontrolledAlert,{color:\"danger\",role:\"alert\",dismissible:true,onClose:function onClose(){console.log(\"error\");setshowErro(false);},children:errorMsg})})}):null,/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsxs(Col,{lg:\"12\",children:[/*#__PURE__*/_jsx(HeaderSections,{title:\"Binnacle\",t:props.t}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(Table,{className:\"table mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-light\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:props.t(\"Date\")}),/*#__PURE__*/_jsx(\"th\",{children:props.t(\"Comment\")}),/*#__PURE__*/_jsx(\"th\",{children:props.t(\"Process\")}),/*#__PURE__*/_jsx(\"th\",{children:props.t(\"Activity\")}),/*#__PURE__*/_jsx(\"th\",{children:props.t(\"User\")}),/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsxs(Link,{to:\"#\",className:\"float-end\",onClick:function onClick(){toggleDisplayNewLogModal();},title:props.t(\"Add\"),children:[/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-plus-box-multiple-outline mdi-24px\"}),\" \"]})})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:dataList})]})})]})})]}),/*#__PURE__*/_jsx(ModalNewLog,{onSaveLogProcess:function onSaveLogProcess(observations){_onSaveLogProcess(observations);},isOpen:displayNewLogModal,toggle:function toggle(){toggleDisplayNewLogModal();}}),success_dlg?/*#__PURE__*/_jsx(SweetAlert,{success:true,title:props.t(\"SuccessDialog\"),onConfirm:function onConfirm(){setsuccess_dlg(false);},children:success_msg}):null,error_dlg?/*#__PURE__*/_jsx(SweetAlert,{error:true,title:props.t(\"ErrorDialog\"),onConfirm:function onConfirm(){seterror_dlg(false);},children:error_msg}):null]});};export default withTranslation()(LogProcess);","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/components/LogProcess/index.js"],"names":["React","useEffect","useState","Link","useLocation","functionshelper","Table","Card","CardBody","Alert","UncontrolledAlert","Pagination","PaginationItem","PaginationLink","CardFooter","Button","Row","Col","withTranslation","SweetAlert","ModalNewLog","BackendServices","HeaderSections","LogProcess","props","locationData","setLocationData","location","undefined","dataLocation","setdataLocation","dataList","setDataList","displayNewLogModal","setDisplayNewLogModal","success_dlg","setsuccess_dlg","success_msg","setsuccess_msg","error_dlg","seterror_dlg","error_msg","seterror_msg","showErro","setshowErro","errorMsg","seterrorMsg","data","transactionId","length","sessionStorage","setItem","JSON","stringify","searchData","result","getItem","parse","toggleDisplayNewLogModal","removeBodyCss","document","body","classList","add","api","parameters","responsible","instanceNumber","instanceId","transactId","getHistorical","then","resp","status","dataRows","map","dt","idx","date","observations","getProcessName","processId","t","error","catch","err","console","log","onSaveLogProcess","consultPrincipalDebtor","Number","clientId","personId","activityId","requestId","requestStatus","rejectionReason","saveHistorical"],"mappings":"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","sourcesContent":["//Gestionar Log de los Procesos\r\nimport React, { useEffect, useState } from \"react\"\r\nimport PropTypes from 'prop-types';\r\nimport { Link, useLocation } from \"react-router-dom\"\r\nimport functionshelper from \"../../helpers/functions_helper\"\r\n\r\nimport {\r\n  Table,\r\n  Card,\r\n  CardBody,\r\n  Alert,\r\n  UncontrolledAlert,\r\n  Pagination,\r\n  PaginationItem,\r\n  PaginationLink,\r\n  CardFooter,\r\n  Button,\r\n  Row,\r\n  Col,\r\n} from \"reactstrap\"\r\n\r\n//i18n\r\nimport { withTranslation } from \"react-i18next\"\r\n//Import SweetAlert\r\nimport SweetAlert from \"react-bootstrap-sweetalert\"\r\n\r\nimport ModalNewLog from \"./ModalNewLog\"\r\nimport { BackendServices } from \"../../services/index\";\r\n\r\nimport HeaderSections from \"../../components/Common/HeaderSections\";\r\n\r\nconst LogProcess = props => {\r\n  //Data que recibimos en el location\r\n  const [locationData, setLocationData] = useState(props.locationData);\r\n  const location = useLocation();\r\n  const [dataLocation, setdataLocation] = useState(undefined);\r\n  const [dataList, setDataList] = useState([]);\r\n  const [displayNewLogModal, setDisplayNewLogModal] = useState(false);\r\n  const [success_dlg, setsuccess_dlg] = useState(false);\r\n  const [success_msg, setsuccess_msg] = useState(\"\");\r\n  const [error_dlg, seterror_dlg] = useState(false);\r\n  const [error_msg, seterror_msg] = useState(\"\");\r\n  const [showErro, setshowErro] = useState(false);\r\n  const [errorMsg, seterrorMsg] = useState(\"\");\r\n  //On Mounting (componentDidMount) if selectedData has changes\r\n  // React.useEffect(() => {\r\n  //   if (props.locationData !== undefined && props.locationData !== null) {\r\n  //     setLocationData(props.locationData)\r\n  //     searchData(props.locationData);\r\n  //   }\r\n  // }, [props.locationData]);\r\n  useEffect(() => {\r\n    if (location.data !== null && location.data !== undefined) {\r\n      if (location.data.transactionId === undefined || location.data.transactionId.length <= 0) {\r\n        location.data.transactionId = 0;\r\n      }\r\n      else {\r\n        sessionStorage.setItem('locationData', JSON.stringify(location.data));\r\n        setdataLocation(location.data);\r\n        searchData(location.data)\r\n      }\r\n    } else {\r\n      //chequeamos si tenemos guardado en session\r\n      var result = sessionStorage.getItem('locationData');\r\n      if (result !== undefined && result !== null) {\r\n        result = JSON.parse(result);\r\n        setdataLocation(result);\r\n        searchData(result)\r\n      }\r\n    }\r\n  }, []);\r\n  //nuevo log\r\n  function toggleDisplayNewLogModal() {\r\n    setDisplayNewLogModal(!displayNewLogModal);\r\n    removeBodyCss()\r\n  }\r\n  function removeBodyCss() {\r\n    document.body.classList.add(\"no_padding\")\r\n  }\r\n  //buscamos las Propuestas de Credito\r\n  function searchData(data) {\r\n\r\n    const api = new BackendServices();\r\n      var parameters = { responsible: \"admin\", instanceNumber: data.instanceId, transactId: data.transactionId }\r\n      api.getHistorical(data.transactionId)\r\n        .then(resp => {\r\n          if (resp.status == 200) {\r\n            const dataRows = resp.result.map((dt, idx) => (\r\n              <tr key={idx}>\r\n                <th scope=\"row\">{dt.date}</th>\r\n                <td>{dt.observations}</td>\r\n                <td>{functionshelper.getProcessName(dt.processId)}</td>\r\n                <td></td>\r\n                <td>{dt.responsible}</td>\r\n                <td></td>\r\n              </tr>)\r\n            );\r\n            setDataList(dataRows);\r\n          }\r\n          else {\r\n            setshowErro(false);\r\n            seterrorMsg(props.t('ErrorCode') + \": \" + resp.status + \"  \" + props.t('ErrorMsg') + \": \" + resp.error.error);\r\n            setshowErro(true)\r\n          }\r\n        }).catch(err => {\r\n          console.log(err);\r\n        });\r\n  }\r\n  function onSaveLogProcess(observations) {\r\n\r\n    /* ---------------------------------------------------------------------------------------------- */\r\n    /*              Le pasamos los valores al servicio de guardar bitacora                            */\r\n    /* ---------------------------------------------------------------------------------------------- */\r\n    const api = new BackendServices();\r\n    api.consultPrincipalDebtor(dataLocation?.transactionId ?? 0).then(resp => {\r\n      let data = {\r\n        instanceId: dataLocation?.instanceId ?? 0,\r\n        transactId: Number(dataLocation?.transactionId) ?? 0,\r\n        clientId: Number(resp.personId) ?? 0,\r\n        observations: observations,\r\n        responsible: \"admin\", //hay que poner el usuario login\r\n        processId: Number(dataLocation?.processId) ?? 0,\r\n        activityId: Number(dataLocation?.activityId) ?? 0,\r\n        status: true,\r\n        requestId: \"\",\r\n        requestStatus: \"\",\r\n        rejectionReason: \"\",\r\n      }\r\n      api.saveHistorical(data)\r\n        .then(resp => {\r\n          if (resp !== undefined) {\r\n            searchData(dataLocation);\r\n\r\n            setsuccess_msg(props.t(\"SuccessSaveMessage\"))\r\n            setsuccess_dlg(true)\r\n          }\r\n          else {\r\n            setshowErro(false);\r\n            seterrorMsg(props.t(\"ErrorSaveMessage\"));\r\n            setshowErro(true);\r\n          }\r\n        }).catch(err => {\r\n          console.log(err);\r\n        });\r\n    });\r\n  }\r\n  return (\r\n    <React.Fragment>\r\n      <CardBody>\r\n        {showErro ? (\r\n          <Row>\r\n            <Col lg=\"12\">\r\n              <UncontrolledAlert color=\"danger\" role=\"alert\" dismissible onClose={() => { console.log(\"error\"); setshowErro(false) }}>\r\n                {errorMsg}\r\n              </UncontrolledAlert>\r\n            </Col>\r\n          </Row>\r\n        ) : null}\r\n        <Row>\r\n          <Col lg=\"12\">\r\n            {/*<h4 className=\"card-title\">{props.t(\"Binnacle\")}</h4>*/}\r\n            <HeaderSections title=\"Binnacle\" t={props.t}></HeaderSections>\r\n            <div className=\"table-responsive\">\r\n              <Table className=\"table mb-0\">\r\n                <thead className=\"table-light\">\r\n                  <tr>\r\n                    <th>{props.t(\"Date\")}</th>\r\n                    <th>{props.t(\"Comment\")}</th>\r\n                    <th>{props.t(\"Process\")}</th>\r\n                    <th>{props.t(\"Activity\")}</th>\r\n                    <th>{props.t(\"User\")}</th>\r\n                    <th>\r\n                      <Link to=\"#\" className=\"float-end\" onClick={() => { toggleDisplayNewLogModal() }} title={props.t(\"Add\")}><i className=\"mdi mdi-plus-box-multiple-outline mdi-24px\"></i>{\" \"}</Link>\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {dataList}\r\n                </tbody>\r\n              </Table>\r\n\r\n            </div>\r\n          </Col>\r\n        </Row>\r\n      </CardBody>\r\n      <ModalNewLog onSaveLogProcess={(observations) => { onSaveLogProcess(observations) }} isOpen={displayNewLogModal} toggle={() => { toggleDisplayNewLogModal() }} />\r\n      {success_dlg ? (\r\n        <SweetAlert\r\n          success\r\n          title={props.t(\"SuccessDialog\")}\r\n          onConfirm={() => {\r\n            setsuccess_dlg(false)\r\n\r\n          }}\r\n        >\r\n          {success_msg}\r\n        </SweetAlert>\r\n      ) : null}\r\n\r\n      {error_dlg ? (\r\n        <SweetAlert\r\n          error\r\n          title={props.t(\"ErrorDialog\")}\r\n          onConfirm={() => {\r\n            seterror_dlg(false)\r\n          }}\r\n        >\r\n          {error_msg}\r\n        </SweetAlert>\r\n      ) : null}\r\n    </React.Fragment>\r\n  );\r\n}\r\nLogProcess.propTypes = {\r\n  locationData: PropTypes.any,\r\n};\r\nexport default (withTranslation()(LogProcess))\r\n"]},"metadata":{},"sourceType":"module"}
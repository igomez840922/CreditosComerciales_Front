{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _createForOfIteratorHelper from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _objectSpread from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";//Gestionar Log de los Procesos\nimport React,{useEffect,useState}from\"react\";import{Link,useLocation}from\"react-router-dom\";import functionshelper from\"../../helpers/functions_helper\";import moment from\"moment\";import{Table,Card,CardHeader,CardBody,UncontrolledAlert,Pagination,PaginationItem,PaginationLink,CardFooter,Button,Row,Col}from\"reactstrap\";import Alert from'react-bootstrap/Alert';//i18n\nimport{withTranslation}from\"react-i18next\";//Import SweetAlert\nimport SweetAlert from\"react-bootstrap-sweetalert\";import ModalNewLog from\"./ModalNewLog\";import{BackendServices}from\"../../services/index\";import LocalStorageHelper from\"../../helpers/LocalStorageHelper\";import*as opt from\"../../helpers/options_helper\";import BootstrapTable from'react-bootstrap-table-next';import ToolkitProvider,{Search,CSVExport}from'react-bootstrap-table2-toolkit';import paginationFactory from'react-bootstrap-table2-paginator';import{useTranslation}from'react-i18next';import{uniq_key}from\"../../helpers/unq_key\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ExportCSVButton=CSVExport.ExportCSVButton;var SearchBar=Search.SearchBar;var MyExportCSV=function MyExportCSV(props){var handleClick=function handleClick(){props.onExport();};return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Button,{className:\"btn\",color:\"success\",type:\"button\",style:{margin:'5px'},onClick:handleClick,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-file-csv\"}),\" \",\" \"]})});};var LogProcess=function LogProcess(props){var _useTranslation=useTranslation(),t=_useTranslation.t,i18n=_useTranslation.i18n;var _useState=useState(props.logProcessModel),_useState2=_slicedToArray(_useState,2),logProcessModel=_useState2[0],setlogProcessModel=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),dataList=_useState4[0],setDataList=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),displayNewLogModal=_useState6[0],setDisplayNewLogModal=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),mainDebtor=_useState8[0],setmainDebtor=_useState8[1];var _useState9=useState(new BackendServices()),_useState10=_slicedToArray(_useState9,2),backendServices=_useState10[0],setbackendServices=_useState10[1];var _useState11=useState({show:false,msg:\"\",isError:false}),_useState12=_slicedToArray(_useState11,2),msgData=_useState12[0],setmsgData=_useState12[1];var _useState13=useState(new LocalStorageHelper()),_useState14=_slicedToArray(_useState13,2),localStorageHelper=_useState14[0],setlocalStorageHelper=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),dataOptions=_useState16[0],setDataOptions=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),dataHeader=_useState18[0],setDataHeader=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),dataBody=_useState20[0],setDataBody=_useState20[1];useEffect(function(){if(logProcessModel!==undefined&&logProcessModel!==null){loadMainDebtor(logProcessModel.transactId);searchData(logProcessModel.transactId);}},[]);useEffect(function(){if(logProcessModel!==undefined&&logProcessModel!==null){loadMainDebtor(logProcessModel.transactId);searchData(logProcessModel.transactId);}},[props.updatedata]);//nuevo log\nfunction toggleDisplayNewLogModal(){setDisplayNewLogModal(!displayNewLogModal);removeBodyCss();}function removeBodyCss(){document.body.classList.add(\"no_padding\");}function loadMainDebtor(transactionId){// consultarDeudorPrincipal\nbackendServices.consultPrincipalDebtor(transactionId).then(function(data){if(data!==undefined){setmainDebtor(data);}});}//buscamos las Propuestas de Credito\nfunction searchData(transactId){loadTableData(transactId);/*backendServices.getHistorical(transactId)\r\n      .then(resp => {\r\n        const dataRows = resp.map((dt, idx) => (\r\n          <tr key={idx}>\r\n            <td scope=\"row\">{moment(dt.date).format(\"YYYY-MM-DD HH:mm:ss\")}</td>\r\n            <td>{dt.observations}</td>\r\n            <td>{dt.processBpmName }</td>\r\n            <td>{dt.activityBpmName }</td>\r\n            <td>{dt.statusDescription}</td>\r\n            <td>{dt.responsible}</td>\r\n          </tr>)\r\n        );\r\n        setDataList(dataRows);\r\n      }).catch(err => {console.log(err);});*/}function loadTableData(_x){return _loadTableData.apply(this,arguments);}function _loadTableData(){_loadTableData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(transactId){var result,_iterator,_step,dt,options,columns;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return backendServices.getHistorical(transactId);case 2:result=_context.sent;if(result!==undefined){_iterator=_createForOfIteratorHelper(result);try{for(_iterator.s();!(_step=_iterator.n()).done;){dt=_step.value;dt.date=moment(dt.date).format(\"DD-MM-YYYY HH:mm:ss\");}}catch(err){_iterator.e(err);}finally{_iterator.f();}setDataBody(result);}options={textLabels:{body:{noMatch:t(\"NoData\"),toolTip:t(\"Order\"),key:uniq_key(),columnHeaderTooltip:function columnHeaderTooltip(column){return\"\".concat(t(\"OrderBy\"),\" \").concat(column.label);}},pagination:{next:t(\"Next\"),previous:t(\"Prev\"),rowsPerPage:t(\"RowsPerPage\"),displayRows:t(\"From\"),sizePerPage:5,key:uniq_key(),sizePerPageList:[{text:'5th',value:5},{text:'10th',value:10},{text:'All',value:20}]},toolbar:{search:t(\"Search\"),downloadCsv:t(\"DownloadCSV\"),print:t(\"Print\"),viewColumns:t(\"ViewColumns\"),filterTable:t(\"FilterTable\")},filter:{all:t(\"All\"),title:t(\"Filter\"),reset:t(\"Restore\")},viewColumns:{title:t(\"ShowColumns\"),titleAria:t(\"ShowHideColumns\")},selectedRows:{text:t(\"SelectedRows\"),delete:t(\"Delete\"),deleteAria:t(\"DeleteSelectedRows\")}}};//Header de la Tabla de Bandeja de Entrada\ncolumns=[{text:t(\"Date\"),dataField:'date',sort:true},{text:t(\"Comment\"),dataField:'observations',sort:true},{text:t(\"Process\"),dataField:'processBpmName',sort:true},{text:t(\"Activity\"),dataField:'activityBpmName',sort:true},{text:t(\"Status\"),dataField:'statusDescription',sort:true},{text:t(\"Return Description\"),dataField:'devolutionDesc',sort:true},{text:t(\"User\"),dataField:'responsible',sort:true}];setDataHeader(columns);setDataOptions(options);case 8:case\"end\":return _context.stop();}}},_callee);}));return _loadTableData.apply(this,arguments);}function _onSaveLogProcess(observations){var _credentials$usr,_mainDebtor$personId;var credentials=localStorageHelper.get(opt.VARNAME_USRCREDENTIAL);logProcessModel.responsible=(_credentials$usr=credentials===null||credentials===void 0?void 0:credentials.usr)!==null&&_credentials$usr!==void 0?_credentials$usr:\"admin\";logProcessModel.clientId=(_mainDebtor$personId=mainDebtor===null||mainDebtor===void 0?void 0:mainDebtor.personId)!==null&&_mainDebtor$personId!==void 0?_mainDebtor$personId:logProcessModel.clientId;logProcessModel.observations=observations;backendServices.saveHistorical(logProcessModel).then(function(resp){if(resp!==undefined){searchData(logProcessModel.transactId);}else{//Mensaje ERROR\nshowMessage(t(\"ErrorSaveMessage\"),true);}}).catch(function(err){console.log(err);});}//mostrar mensaje \nfunction showMessage(message){var isError=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;setmsgData({show:true,msg:message,isError:isError});}return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsx(\"h4\",{className:\"card-title\",children:t(\"Binnacle\")})}),!(props===null||props===void 0?void 0:props.preview)&&/*#__PURE__*/_jsx(Col,{md:6,style:{textAlign:\"right\"},children:/*#__PURE__*/_jsxs(Button,{className:\"btn\",color:\"success\",type:\"button\",style:{margin:'5px'},onClick:function onClick(){toggleDisplayNewLogModal();},title:t(\"Add\"),children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-lg fa-plus-circle\"}),\" \",\" \"]})})]})}),/*#__PURE__*/_jsx(CardBody,{children:dataHeader.length>0?/*#__PURE__*/_jsx(ToolkitProvider,{keyField:\"pooo\",data:dataBody,columns:dataHeader,search:true,exportCSV:true,children:function children(props){return/*#__PURE__*/_jsxs(\"div\",{className:\"\",children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(SearchBar,_objectSpread({className:\"custome-search-field float-end\",delay:1000,placeholder:t(\"Search\")},props.searchProps))}),/*#__PURE__*/_jsx(Col,{md:8,style:{textAlign:\"right\"}})]}),/*#__PURE__*/_jsx(BootstrapTable,_objectSpread(_objectSpread({keyField:\"date\",bootstrap4:true,bordered:false,striped:true,hover:true,condensed:true,classes:\"styled-table\",style:{cursor:\"pointer\"},data:dataBody,columns:dataHeader},props.baseProps),{},{pagination:paginationFactory({sizePerPage:30,sizePerPageList:[30]})}))]});}}):null})]}),/*#__PURE__*/_jsx(ModalNewLog,{onSaveLogProcess:function onSaveLogProcess(observations){_onSaveLogProcess(observations);},isOpen:displayNewLogModal,toggle:function toggle(){toggleDisplayNewLogModal();}})]});};export default withTranslation()(LogProcess);","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/components/LogProcess/index.js"],"names":["React","useEffect","useState","Link","useLocation","functionshelper","moment","Table","Card","CardHeader","CardBody","UncontrolledAlert","Pagination","PaginationItem","PaginationLink","CardFooter","Button","Row","Col","Alert","withTranslation","SweetAlert","ModalNewLog","BackendServices","LocalStorageHelper","opt","BootstrapTable","ToolkitProvider","Search","CSVExport","paginationFactory","useTranslation","uniq_key","ExportCSVButton","SearchBar","MyExportCSV","props","handleClick","onExport","margin","LogProcess","t","i18n","logProcessModel","setlogProcessModel","dataList","setDataList","displayNewLogModal","setDisplayNewLogModal","mainDebtor","setmainDebtor","backendServices","setbackendServices","show","msg","isError","msgData","setmsgData","localStorageHelper","setlocalStorageHelper","dataOptions","setDataOptions","dataHeader","setDataHeader","dataBody","setDataBody","undefined","loadMainDebtor","transactId","searchData","updatedata","toggleDisplayNewLogModal","removeBodyCss","document","body","classList","add","transactionId","consultPrincipalDebtor","then","data","loadTableData","getHistorical","result","dt","date","format","options","textLabels","noMatch","toolTip","key","columnHeaderTooltip","column","label","pagination","next","previous","rowsPerPage","displayRows","sizePerPage","sizePerPageList","text","value","toolbar","search","downloadCsv","print","viewColumns","filterTable","filter","all","title","reset","titleAria","selectedRows","delete","deleteAria","columns","dataField","sort","onSaveLogProcess","observations","credentials","get","VARNAME_USRCREDENTIAL","responsible","usr","clientId","personId","saveHistorical","resp","showMessage","catch","err","console","log","message","preview","textAlign","length","searchProps","cursor","baseProps"],"mappings":"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","sourcesContent":["//Gestionar Log de los Procesos\r\nimport React, { useEffect, useState } from \"react\"\r\nimport PropTypes from 'prop-types';\r\nimport { Link, useLocation } from \"react-router-dom\"\r\nimport functionshelper from \"../../helpers/functions_helper\"\r\nimport moment from \"moment\";\r\n\r\nimport {\r\n  Table,\r\n  Card, CardHeader,\r\n  CardBody,\r\n  UncontrolledAlert,\r\n  Pagination,\r\n  PaginationItem,\r\n  PaginationLink,\r\n  CardFooter,\r\n  Button,\r\n  Row,\r\n  Col,\r\n} from \"reactstrap\"\r\n\r\nimport Alert from 'react-bootstrap/Alert'\r\n//i18n\r\nimport { withTranslation } from \"react-i18next\"\r\n//Import SweetAlert\r\nimport SweetAlert from \"react-bootstrap-sweetalert\"\r\n\r\nimport ModalNewLog from \"./ModalNewLog\"\r\nimport { BackendServices } from \"../../services/index\";\r\n\r\nimport LocalStorageHelper from \"../../helpers/LocalStorageHelper\";\r\nimport * as opt from \"../../helpers/options_helper\"\r\n\r\n\r\nimport BootstrapTable from 'react-bootstrap-table-next';\r\nimport ToolkitProvider, { Search, CSVExport } from 'react-bootstrap-table2-toolkit';\r\nimport paginationFactory from 'react-bootstrap-table2-paginator';\r\n\r\nimport { useTranslation } from 'react-i18next'\r\nimport { uniq_key } from \"../../helpers/unq_key\";\r\n\r\nconst { ExportCSVButton } = CSVExport;\r\n\r\nconst { SearchBar } = Search;\r\n\r\nconst MyExportCSV = (props) => {\r\n  const handleClick = () => {\r\n    props.onExport();\r\n  };\r\n  return (\r\n    <div>\r\n      <Button className=\"btn\" color=\"success\" type=\"button\" style={{ margin: '5px' }} onClick={handleClick}><i className=\"fas fa-file-csv\"></i> {(\" \")}</Button>\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\nconst LogProcess = props => {\r\n\r\n  const { t, i18n } = useTranslation();\r\n  const [logProcessModel, setlogProcessModel] = useState(props.logProcessModel);\r\n\r\n  const [dataList, setDataList] = useState([]);\r\n  const [displayNewLogModal, setDisplayNewLogModal] = useState(false);\r\n\r\n  const [mainDebtor, setmainDebtor] = useState(null);\r\n  const [backendServices, setbackendServices] = useState(new BackendServices());\r\n\r\n  const [msgData, setmsgData] = useState({ show: false, msg: \"\", isError: false });\r\n\r\n  const [localStorageHelper, setlocalStorageHelper] = useState(new LocalStorageHelper());\r\n\r\n  const [dataOptions, setDataOptions] = useState([]);\r\n  const [dataHeader, setDataHeader] = useState([]);\r\n  const [dataBody, setDataBody] = useState([]);\r\n\r\n\r\n  useEffect(() => {\r\n    if (logProcessModel !== undefined && logProcessModel !== null) {\r\n      loadMainDebtor(logProcessModel.transactId);\r\n      searchData(logProcessModel.transactId)\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (logProcessModel !== undefined && logProcessModel !== null) {\r\n      loadMainDebtor(logProcessModel.transactId);\r\n      searchData(logProcessModel.transactId)\r\n    }\r\n  }, [props.updatedata]);\r\n\r\n  //nuevo log\r\n  function toggleDisplayNewLogModal() {\r\n    setDisplayNewLogModal(!displayNewLogModal);\r\n    removeBodyCss()\r\n  }\r\n  function removeBodyCss() {\r\n    document.body.classList.add(\"no_padding\")\r\n  }\r\n\r\n  function loadMainDebtor(transactionId) {\r\n    // consultarDeudorPrincipal\r\n    backendServices.consultPrincipalDebtor(transactionId)\r\n      .then((data) => {\r\n        if (data !== undefined) {\r\n          setmainDebtor(data);\r\n        }\r\n      });\r\n  }\r\n\r\n  //buscamos las Propuestas de Credito\r\n  function searchData(transactId) {\r\n\r\n    loadTableData(transactId);\r\n    /*backendServices.getHistorical(transactId)\r\n      .then(resp => {\r\n        const dataRows = resp.map((dt, idx) => (\r\n          <tr key={idx}>\r\n            <td scope=\"row\">{moment(dt.date).format(\"YYYY-MM-DD HH:mm:ss\")}</td>\r\n            <td>{dt.observations}</td>\r\n            <td>{dt.processBpmName }</td>\r\n            <td>{dt.activityBpmName }</td>\r\n            <td>{dt.statusDescription}</td>\r\n            <td>{dt.responsible}</td>\r\n          </tr>)\r\n        );\r\n        setDataList(dataRows);\r\n      }).catch(err => {console.log(err);});*/\r\n  }\r\n\r\n  async function loadTableData(transactId) {\r\n\r\n    var result = await backendServices.getHistorical(transactId)\r\n    if (result !== undefined) {\r\n      for (var dt of result) {\r\n        dt.date = moment(dt.date).format(\"DD-MM-YYYY HH:mm:ss\")\r\n      }\r\n      setDataBody(result);\r\n    }\r\n\r\n\r\n    let options = {\r\n      textLabels: {\r\n        body: {\r\n          noMatch: t(\"NoData\"),\r\n          toolTip: t(\"Order\"),\r\n          key: uniq_key(),\r\n          columnHeaderTooltip: (column) => `${t(\"OrderBy\")} ${column.label}`,\r\n        },\r\n        pagination: {\r\n          next: t(\"Next\"),\r\n          previous: t(\"Prev\"),\r\n          rowsPerPage: t(\"RowsPerPage\"),\r\n          displayRows: t(\"From\"),\r\n          sizePerPage: 5,\r\n          key: uniq_key(),\r\n          sizePerPageList: [{\r\n            text: '5th', value: 5\r\n          }, {\r\n            text: '10th', value: 10\r\n          }, {\r\n            text: 'All', value: 20\r\n          }]\r\n        },\r\n        toolbar: {\r\n          search: t(\"Search\"),\r\n          downloadCsv: t(\"DownloadCSV\"),\r\n          print: t(\"Print\"),\r\n          viewColumns: t(\"ViewColumns\"),\r\n          filterTable: t(\"FilterTable\"),\r\n        },\r\n        filter: {\r\n          all: t(\"All\"),\r\n          title: t(\"Filter\"),\r\n          reset: t(\"Restore\"),\r\n        },\r\n        viewColumns: {\r\n          title: t(\"ShowColumns\"),\r\n          titleAria: t(\"ShowHideColumns\"),\r\n        },\r\n        selectedRows: {\r\n          text: t(\"SelectedRows\"),\r\n          delete: t(\"Delete\"),\r\n          deleteAria: t(\"DeleteSelectedRows\"),\r\n        },\r\n      },\r\n    };\r\n\r\n    //Header de la Tabla de Bandeja de Entrada\r\n    const columns = [\r\n      { text: t(\"Date\"), dataField: 'date', sort: true },\r\n      { text: t(\"Comment\"), dataField: 'observations', sort: true },\r\n      { text: t(\"Process\"), dataField: 'processBpmName', sort: true },\r\n      { text: t(\"Activity\"), dataField: 'activityBpmName', sort: true },\r\n      { text: t(\"Status\"), dataField: 'statusDescription', sort: true },\r\n      { text: t(\"Return Description\"), dataField: 'devolutionDesc', sort: true },\r\n      { text: t(\"User\"), dataField: 'responsible', sort: true }\r\n    ];\r\n\r\n    setDataHeader(columns);\r\n    setDataOptions(options);\r\n  }\r\n\r\n  function onSaveLogProcess(observations) {\r\n\r\n    var credentials = localStorageHelper.get(opt.VARNAME_USRCREDENTIAL);\r\n\r\n    logProcessModel.responsible = credentials?.usr ?? \"admin\"\r\n    logProcessModel.clientId = mainDebtor?.personId ?? logProcessModel.clientId;\r\n    logProcessModel.observations = observations;\r\n    backendServices.saveHistorical(logProcessModel)\r\n      .then(resp => {\r\n        if (resp !== undefined) {\r\n          searchData(logProcessModel.transactId);\r\n        }\r\n        else {\r\n          //Mensaje ERROR\r\n          showMessage(t(\"ErrorSaveMessage\"), true);\r\n        }\r\n      }).catch(err => {\r\n        console.log(err);\r\n      });\r\n  }\r\n\r\n  //mostrar mensaje \r\n  function showMessage(message, isError = false) {\r\n    setmsgData({ show: true, msg: message, isError: isError })\r\n  }\r\n\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Card>\r\n\r\n        <CardHeader>\r\n          <Row>\r\n            <Col md={6}>\r\n              <h4 className=\"card-title\">{t(\"Binnacle\")}</h4>\r\n            </Col>\r\n            {!props?.preview && <Col md={6} style={{ textAlign: \"right\" }}>\r\n              <Button className=\"btn\" color=\"success\" type=\"button\" style={{ margin: '5px' }} onClick={() => { toggleDisplayNewLogModal() }} title={t(\"Add\")}><i className=\"fas fa-lg fa-plus-circle\"></i> {(\" \")}</Button>\r\n\r\n            </Col>}\r\n          </Row>\r\n        </CardHeader>\r\n        {/*<CardBody>\r\n              <Row>\r\n                  <Col md=\"12\">\r\n                    <Alert show={msgData.show} variant={msgData.isError ? \"danger\" : \"success\"} dismissible onClose={() => { setmsgData({ show: false, msg: \"\", isError: false }) }}>\r\n                      {msgData.msg}\r\n                    </Alert>\r\n                  </Col>\r\n                </Row>\r\n        <Row>\r\n          <Col md={12}>\r\n            <div className=\"table-responsive styled-table-div\">\r\n              <Table className=\"table table-striped table-hover styled-table\">\r\n                <thead className=\"\">\r\n                  <tr>\r\n                    <th>{t(\"Date\")}</th>\r\n                    <th>{t(\"Comment\")}</th>\r\n                    <th>{t(\"Process\")}</th>\r\n                    <th>{t(\"Activity\")}</th>\r\n                    <th>{t(\"Status\")}</th>\r\n                    <th>{t(\"User\")}</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {dataList!==undefined && dataList.length>0?\r\n                    dataList:\r\n                  <td colspan=\"7\"><div className=\"alert alert-info\" style={{ textAlign: \"center\" }}>{t(\"NoData\")}</div></td> }\r\n                </tbody>\r\n              </Table>\r\n            </div>\r\n          </Col>\r\n        </Row>\r\n        \r\n      </CardBody>*/}\r\n\r\n        <CardBody>\r\n          {dataHeader.length > 0 ?\r\n            <ToolkitProvider\r\n              keyField={\"pooo\"}\r\n              data={dataBody}\r\n              columns={dataHeader}\r\n              search\r\n              exportCSV\r\n            >\r\n              {\r\n                props => (\r\n                  <div className=\"\">\r\n                    <Row>\r\n                      <Col md={4}>\r\n                        <SearchBar className=\"custome-search-field float-end\" delay={1000} placeholder={t(\"Search\")} {...props.searchProps} />\r\n                      </Col>\r\n                      <Col md={8} style={{ textAlign: \"right\" }}>\r\n                        {/*<MyExportCSV { ...props.csvProps } />*/}\r\n                      </Col>\r\n                    </Row>\r\n                    <BootstrapTable\r\n                      keyField=\"date\"\r\n                      bootstrap4\r\n                      bordered={false}\r\n                      striped\r\n                      hover\r\n                      condensed\r\n                      classes='styled-table'\r\n                      style={{ cursor: \"pointer\" }}\r\n                      data={dataBody} columns={dataHeader}\r\n                      {...props.baseProps}\r\n                      pagination={paginationFactory({\r\n                        sizePerPage: 30,\r\n                        sizePerPageList: [30]\r\n                      })}\r\n                    />\r\n                  </div>\r\n                )\r\n              }\r\n            </ToolkitProvider>\r\n            : null}\r\n        </CardBody>\r\n      </Card>\r\n      <ModalNewLog onSaveLogProcess={(observations) => { onSaveLogProcess(observations) }} isOpen={displayNewLogModal} toggle={() => { toggleDisplayNewLogModal() }} />\r\n\r\n\r\n    </React.Fragment>\r\n  );\r\n}\r\nLogProcess.propTypes = {\r\n  logProcessModel: PropTypes.any, //LogProcessModel\r\n  updatedata: PropTypes.bool,\r\n};\r\nexport default (withTranslation()(LogProcess))\r\n"]},"metadata":{},"sourceType":"module"}
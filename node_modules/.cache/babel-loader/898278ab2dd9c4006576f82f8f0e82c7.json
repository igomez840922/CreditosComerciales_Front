{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{translationHelpers}from'../../../helpers/translation-helper';import{Table,Card,CardBody,Button}from\"reactstrap\";import{BackendServices}from'../../../services';import{useLocation,useHistory}from'react-router-dom';import ModalNewHistoryDetail from'./ModalNewHistoryDetail';import SweetAlert from\"react-bootstrap-sweetalert\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var History=function History(props){/**\r\n   * All useState\r\n   */var _useState=useState(false),_useState2=_slicedToArray(_useState,2),displayModalNewHistoryDetail=_useState2[0],setDisplayModalNewHistoryDetail=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),dataRows=_useState4[0],setDataRows=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),totals=_useState6[0],setTotals=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),totalRow=_useState8[0],setTotalRow=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),proportions=_useState10[0],setProportions=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),proportionRow=_useState12[0],setProportionRow=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),confirm_alert=_useState14[0],setconfirm_alert=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),error_dlg=_useState16[0],seterror_dlg=_useState16[1];var _useState17=useState(null),_useState18=_slicedToArray(_useState17,2),bank=_useState18[0],setbank=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),successSave_dlg=_useState20[0],setsuccessSave_dlg=_useState20[1];var _useState21=useState(null),_useState22=_slicedToArray(_useState21,2),dataEdit=_useState22[0],setDataEdit=_useState22[1];var _useState23=useState(null),_useState24=_slicedToArray(_useState23,2),action=_useState24[0],setAction=_useState24[1];/**\r\n   * End All useState\r\n   */var location=useLocation();var _translationHelpers=translationHelpers('commercial_credit','common'),_translationHelpers2=_slicedToArray(_translationHelpers,2),t=_translationHelpers2[0],c=_translationHelpers2[1];var api=new BackendServices();var editMode=props.editMode;var headers=[t('# days',{days:30}),t('# days',{days:60}),t('# days',{days:90}),t('# days',{days:120}),t('# days',{days:150}),t('# days',{days:180}),t('# days',{days:210}),t('# days',{days:240}),t('# days',{days:270}),t('# days',{days:300}),t('# days',{days:330}),t('+# days',{days:331}),t('Totals')];var data=[{name:'Banesco',data:[100,80,80,80,100,80,80,80,100,80,80,200,0]},{name:'Banesco',data:[100,80,80,80,100,80,80,80,100,80,80,200,0]}];React.useEffect(function(){getDataHistory();console.log(location);},[]);function calculateTotals(headers,data){var totals=new Array(headers.length);totals.fill(0,0,headers.length);headers.forEach(function(header,index){totals[index]=data.reduce(function(total,current){return total+current.data[index];},0);});return totals;}function calculateProportions(headers,data){var cols=new Array(headers.length);cols.fill(0,0,headers.length);return cols;}var dataHeaders=headers.map(function(header,index){return/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:header},\"header-\"+index);});function getDataHistory(){api.consultarDetalleAntiguedad(location.data.transactionId,props.debtorId).then(function(data){var mapData=data===null||data===void 0?void 0:data.map(function($$){return{data:[].concat(_toConsumableArray(Object.entries($$.details).map(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];return value;})),[$$.total])};});console.log(mapData);var key=0;setDataRows(data===null||data===void 0?void 0:data.map(function(item,index){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:item.bank},index),Object.entries(item.details).map(function(_ref3){var _ref4=_slicedToArray(_ref3,2),data=_ref4[0],col=_ref4[1];return/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:col},\"col-\"+key++);}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:item.total}),/*#__PURE__*/_jsxs(\"td\",{style:{textAlign:\"right\"},children:[/*#__PURE__*/_jsx(Button,{type:\"button\",color:\"link\",onClick:function onClick(resp){editData(item);},className:\"btn btn-link\",children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-border-color mdi-24px\"})}),/*#__PURE__*/_jsx(Button,{type:\"button\",color:\"link\",onClick:function onClick(resp){deleteData(item.bank);},className:\"btn btn-link\",children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-trash-can-outline mdi-24px\"})})]})]},'row-'+index);}));// Calculate total\nvar totals=calculateTotals(headers,mapData);setTotalRow(/*#__PURE__*/_jsxs(\"tr\",{className:\"table-info\",children:[/*#__PURE__*/_jsx(\"th\",{children:t(\"Total\").toLocaleUpperCase()}),totals.map(function(val,index){return/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:val},index);})]}));// Calculate proportions\nvar proportions=calculateProportions(headers,mapData);setProportionRow(/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:t(\"Proportion\").toLocaleUpperCase()}),proportions.map(function(val,index){return/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:val},index);})]}));});}function toggleModalNewHistoryItem(){setDisplayModalNewHistoryDetail(!displayModalNewHistoryDetail);}function onSave(_x){return _onSave.apply(this,arguments);}function _onSave(){_onSave=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:values={details:values,transactId:location.data.transactionId,personId:props.debtorId,total:values.totals,percentage:values.totals/(headers.length-2),bank:values.bank};_context.t0=action=='edit';if(!_context.t0){_context.next=5;break;}_context.next=5;return api.actualizarDetalleAntiguedad(values).then(function(resp){if(resp.statusCode==\"500\"||undefined){seterror_dlg(true);}else{setsuccessSave_dlg(true);}});case 5:_context.t1=action=='new';if(!_context.t1){_context.next=9;break;}_context.next=9;return api.nuevoDetalleAntiguedad(values).then(function(resp){if(resp.statusCode==\"500\"||undefined){seterror_dlg(true);}else{setsuccessSave_dlg(true);}});case 9:getDataHistory();case 10:case\"end\":return _context.stop();}}},_callee);}));return _onSave.apply(this,arguments);}function editData(data){setDataEdit(data);toggleModalNewHistoryItem();setAction('edit');}function deleteData(bank){setbank(bank);setconfirm_alert(true);}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"card-title clearfix\",children:[t(\"History Details\"),editMode&&/*#__PURE__*/_jsx(Button,{id:\"btnNew\",color:\"success\",type:\"button\",className:\"float-end\",style:{margin:'5px'},onClick:function onClick(){setAction('new');toggleModalNewHistoryItem();setDataEdit(null);},children:c(\"New\")})]}),/*#__PURE__*/_jsx(\"p\",{className:\"card-title-desc\"}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive mt-2\",children:/*#__PURE__*/_jsxs(Table,{className:\"table mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-light\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:t(\"Country / Client\")}),dataHeaders]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[dataRows,totalRow]})]})}),/*#__PURE__*/_jsx(ModalNewHistoryDetail,{dataEdit:dataEdit,setAction:setAction,isOpen:displayModalNewHistoryDetail,toggle:toggleModalNewHistoryItem,onSave:onSave}),confirm_alert?/*#__PURE__*/_jsx(SweetAlert,{title:t(\"Areyousure\"),warning:true,showCancel:true,confirmButtonText:t(\"Yesdeleteit\"),confirmBtnBsStyle:\"success\",cancelBtnBsStyle:\"danger\",onConfirm:function onConfirm(){var apiBack=new BackendServices();apiBack.eliminarDetalleAntiguedad(location.data.transactionId,props.debtorId,bank).then(function(resp){if(resp.statusCode==\"500\"||undefined){setconfirm_alert(false);seterror_dlg(true);}else{setconfirm_alert(false);setsuccessSave_dlg(true);}getDataHistory();}).catch(function(error){setconfirm_alert(false);seterror_dlg(true);});},onCancel:function onCancel(){return setconfirm_alert(false);},children:t(\"Youwontbeabletorevertthis\")}):null,successSave_dlg?/*#__PURE__*/_jsx(SweetAlert,{success:true,title:t(\"SuccessDialog\"),onConfirm:function onConfirm(){setsuccessSave_dlg(false);getDataHistory();},children:t(\"SuccessSaveMessage\")}):null,error_dlg?/*#__PURE__*/_jsx(SweetAlert,{error:true,title:t(\"ErrorDialog\"),onConfirm:function onConfirm(){seterror_dlg(false);getDataHistory();}}):null]});};History.defaultProps={editMode:false};export default History;","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/components/PropuestaCreditoComercial/financialSummary/History.js"],"names":["React","useEffect","useState","translationHelpers","Table","Card","CardBody","Button","BackendServices","useLocation","useHistory","ModalNewHistoryDetail","SweetAlert","History","props","displayModalNewHistoryDetail","setDisplayModalNewHistoryDetail","dataRows","setDataRows","totals","setTotals","totalRow","setTotalRow","proportions","setProportions","proportionRow","setProportionRow","confirm_alert","setconfirm_alert","error_dlg","seterror_dlg","bank","setbank","successSave_dlg","setsuccessSave_dlg","dataEdit","setDataEdit","action","setAction","location","t","c","api","editMode","headers","days","data","name","getDataHistory","console","log","calculateTotals","Array","length","fill","forEach","header","index","reduce","total","current","calculateProportions","cols","dataHeaders","map","consultarDetalleAntiguedad","transactionId","debtorId","then","mapData","$$","Object","entries","details","key","value","item","col","textAlign","resp","editData","deleteData","toLocaleUpperCase","val","toggleModalNewHistoryItem","onSave","values","transactId","personId","percentage","actualizarDetalleAntiguedad","statusCode","undefined","nuevoDetalleAntiguedad","margin","apiBack","eliminarDetalleAntiguedad","catch","error","defaultProps"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\"\r\nimport PropTypes from 'prop-types';\r\nimport { translationHelpers } from '../../../helpers/translation-helper';\r\n\r\nimport {\r\n  Table,\r\n  Card,\r\n  CardBody,\r\n  Button\r\n} from \"reactstrap\"\r\nimport { BackendServices } from '../../../services';\r\nimport { useLocation, useHistory } from 'react-router-dom'\r\nimport ModalNewHistoryDetail from './ModalNewHistoryDetail';\r\nimport SweetAlert from \"react-bootstrap-sweetalert\";\r\n\r\n\r\nconst History = (props) => {\r\n\r\n  /**\r\n   * All useState\r\n   */\r\n  const [displayModalNewHistoryDetail, setDisplayModalNewHistoryDetail] = useState(false);\r\n  const [dataRows, setDataRows] = useState(null);\r\n  const [totals, setTotals] = useState(null);\r\n  const [totalRow, setTotalRow] = useState(null);\r\n  const [proportions, setProportions] = useState(null);\r\n  const [proportionRow, setProportionRow] = useState(null);\r\n  const [confirm_alert, setconfirm_alert] = useState(false);\r\n  const [error_dlg, seterror_dlg] = useState(false);\r\n  const [bank, setbank] = useState(null);\r\n  const [successSave_dlg, setsuccessSave_dlg] = useState(false);\r\n  const [dataEdit, setDataEdit] = useState(null);\r\n  const [action, setAction] = useState(null);\r\n  /**\r\n   * End All useState\r\n   */\r\n  const location = useLocation();\r\n\r\n  const [t, c] = translationHelpers('commercial_credit', 'common');\r\n\r\n  const api = new BackendServices();\r\n\r\n\r\n  const { editMode } = props;\r\n\r\n  const headers = [\r\n    t('# days', { days: 30 }),\r\n    t('# days', { days: 60 }),\r\n    t('# days', { days: 90 }),\r\n    t('# days', { days: 120 }),\r\n    t('# days', { days: 150 }),\r\n    t('# days', { days: 180 }),\r\n    t('# days', { days: 210 }),\r\n    t('# days', { days: 240 }),\r\n    t('# days', { days: 270 }),\r\n    t('# days', { days: 300 }),\r\n    t('# days', { days: 330 }),\r\n    t('+# days', { days: 331 }),\r\n    t('Totals')\r\n  ]\r\n\r\n  const data = [\r\n    {\r\n      name: 'Banesco',\r\n      data: [100, 80, 80, 80, 100, 80, 80, 80, 100, 80, 80, 200, 0]\r\n    },\r\n    {\r\n      name: 'Banesco',\r\n      data: [100, 80, 80, 80, 100, 80, 80, 80, 100, 80, 80, 200, 0]\r\n    }\r\n  ]\r\n\r\n  React.useEffect(() => {\r\n    getDataHistory();\r\n    console.log(location);\r\n  }, []);\r\n\r\n  function calculateTotals(headers, data) {\r\n    const totals = new Array(headers.length);\r\n    totals.fill(0, 0, headers.length);\r\n    headers.forEach((header, index) => {\r\n      totals[index] = data.reduce((total, current) => {\r\n        return total + current.data[index];\r\n      }, 0);\r\n    });\r\n    return totals;\r\n  }\r\n\r\n  function calculateProportions(headers, data) {\r\n    const cols = new Array(headers.length);\r\n    cols.fill(0, 0, headers.length);\r\n    return cols;\r\n  }\r\n\r\n  const dataHeaders = headers.map((header, index) => (\r\n    <th key={\"header-\" + index} className=\"text-end\">{header}</th>\r\n  ));\r\n\r\n  function getDataHistory() {\r\n    api.consultarDetalleAntiguedad(location.data.transactionId, props.debtorId).then((data) => {\r\n\r\n      let mapData = data?.map($$ => ({ data: [...Object.entries($$.details).map(([key, value]) => value), $$.total] }));\r\n      console.log(mapData);\r\n\r\n      let key = 0;\r\n      setDataRows(data?.map((item, index) => (\r\n        <tr key={'row-' + index}>\r\n          <td key={index}>{item.bank}</td>\r\n          {Object.entries(item.details).map(([data, col]) => (\r\n            <td key={\"col-\" + key++} className=\"text-end\">{col}</td>\r\n          ))}\r\n          <td className=\"text-end\">{item.total}</td>\r\n          <td style={{ textAlign: \"right\" }}>\r\n            <Button type=\"button\" color=\"link\" onClick={(resp) => {\r\n              editData(item)\r\n            }} className=\"btn btn-link\" ><i className=\"mdi mdi-border-color mdi-24px\"></i></Button>\r\n            <Button type=\"button\" color=\"link\" onClick={(resp) => {\r\n              deleteData(item.bank)\r\n            }} className=\"btn btn-link\" ><i className=\"mdi mdi-trash-can-outline mdi-24px\"></i></Button>\r\n          </td>\r\n        </tr>)\r\n      ));\r\n      // Calculate total\r\n      let totals = (calculateTotals(headers, mapData));\r\n      setTotalRow(\r\n        <tr className=\"table-info\">\r\n          <th>{t(\"Total\").toLocaleUpperCase()}</th>\r\n          {totals.map((val, index) => (\r\n            <th key={index} className=\"text-end\">{val}</th>\r\n          ))}\r\n        </tr>\r\n      );\r\n\r\n      // Calculate proportions\r\n      let proportions = (calculateProportions(headers, mapData));\r\n      setProportionRow(\r\n        <tr>\r\n          <td>{t(\"Proportion\").toLocaleUpperCase()}</td>\r\n          {proportions.map((val, index) => (\r\n            <td key={index} className=\"text-end\">{val}</td>\r\n          ))}\r\n        </tr>\r\n      );\r\n    })\r\n\r\n\r\n  }\r\n\r\n  function toggleModalNewHistoryItem() {\r\n    setDisplayModalNewHistoryDetail(!displayModalNewHistoryDetail);\r\n  }\r\n\r\n  async function onSave(values) {\r\n\r\n    values = { details: values, transactId: location.data.transactionId, personId: props.debtorId, total: values.totals, percentage: (values.totals / (headers.length - 2)), bank: values.bank }\r\n\r\n    action == 'edit' && await api.actualizarDetalleAntiguedad(values).then(resp => {\r\n      if (resp.statusCode == \"500\" || undefined) {\r\n        seterror_dlg(true)\r\n      } else {\r\n        setsuccessSave_dlg(true)\r\n      }\r\n    });\r\n\r\n    action == 'new' && await api.nuevoDetalleAntiguedad(values).then(resp => {\r\n      if (resp.statusCode == \"500\" || undefined) {\r\n        seterror_dlg(true)\r\n      } else {\r\n        setsuccessSave_dlg(true)\r\n      }\r\n    });\r\n\r\n    getDataHistory();\r\n  }\r\n\r\n  function editData(data) {\r\n    setDataEdit(data);\r\n    toggleModalNewHistoryItem();\r\n    setAction('edit');\r\n  }\r\n\r\n  function deleteData(bank) {\r\n    setbank(bank);\r\n    setconfirm_alert(true);\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <h4 className=\"card-title clearfix\">\r\n        {t(\"History Details\")}\r\n        {editMode &&\r\n          <Button id=\"btnNew\" color=\"success\" type=\"button\" className=\"float-end\" style={{ margin: '5px' }} onClick={() => { setAction('new'); toggleModalNewHistoryItem(); setDataEdit(null); }}>\r\n            {c(\"New\")}\r\n          </Button>\r\n        }\r\n      </h4>\r\n      <p className=\"card-title-desc\"></p>\r\n      <div className=\"table-responsive mt-2\">\r\n        <Table className=\"table mb-0\">\r\n          <thead className=\"table-light\">\r\n            <tr>\r\n              <th>{t(\"Country / Client\")}</th>\r\n              {dataHeaders}\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {dataRows}\r\n            {totalRow}\r\n            {/* {proportionRow} */}\r\n          </tbody>\r\n        </Table>\r\n      </div>\r\n      <ModalNewHistoryDetail dataEdit={dataEdit} setAction={setAction} isOpen={displayModalNewHistoryDetail} toggle={toggleModalNewHistoryItem} onSave={onSave} />\r\n\r\n      {confirm_alert ? (\r\n        <SweetAlert\r\n          title={t(\"Areyousure\")}\r\n          warning\r\n          showCancel\r\n          confirmButtonText={t(\"Yesdeleteit\")}\r\n          confirmBtnBsStyle=\"success\"\r\n          cancelBtnBsStyle=\"danger\"\r\n          onConfirm={() => {\r\n            const apiBack = new BackendServices();\r\n            apiBack.eliminarDetalleAntiguedad(location.data.transactionId, props.debtorId, bank).then(resp => {\r\n              if (resp.statusCode == \"500\" || undefined) {\r\n                setconfirm_alert(false)\r\n                seterror_dlg(true)\r\n              } else {\r\n                setconfirm_alert(false)\r\n                setsuccessSave_dlg(true)\r\n              }\r\n              getDataHistory();\r\n            }).catch(error => {\r\n              setconfirm_alert(false)\r\n              seterror_dlg(true)\r\n            })\r\n          }}\r\n          onCancel={() => setconfirm_alert(false)}\r\n        >\r\n          {t(\"Youwontbeabletorevertthis\")}\r\n        </SweetAlert>\r\n      ) : null}\r\n\r\n      {successSave_dlg ? (\r\n        <SweetAlert\r\n          success\r\n          title={t(\"SuccessDialog\")}\r\n          onConfirm={() => {\r\n            setsuccessSave_dlg(false)\r\n            getDataHistory();\r\n          }}\r\n        >\r\n          {t(\"SuccessSaveMessage\")}\r\n        </SweetAlert>\r\n      ) : null}\r\n\r\n      {error_dlg ? (\r\n        <SweetAlert\r\n          error\r\n          title={t(\"ErrorDialog\")}\r\n          onConfirm={() => {\r\n            seterror_dlg(false)\r\n            getDataHistory();\r\n          }}\r\n        >\r\n          { }\r\n        </SweetAlert>\r\n      ) : null}\r\n    </>\r\n  );\r\n};\r\n\r\nHistory.propTypes = {\r\n  title: PropTypes.string,\r\n  headers: PropTypes.array.isRequired,\r\n  data: PropTypes.array.isRequired,\r\n  editMode: PropTypes.bool,\r\n  addHistoryDetail: PropTypes.func\r\n};\r\n\r\nHistory.defaultProps = {\r\n  editMode: false\r\n};\r\n\r\n\r\nexport default History;\r\n"]},"metadata":{},"sourceType":"module"}
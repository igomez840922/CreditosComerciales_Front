{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import{useTranslation}from'react-i18next';import Select from\"react-select\";import{useLocation,useHistory}from'react-router-dom';import LoadingOverlay from'react-loading-overlay';import{Row,Col,Card,CardBody,Button,Label,Table,Pagination,PaginationItem,PaginationLink,CardFooter}from\"reactstrap\";import{AvForm,AvField}from\"availity-reactstrap-validation\";import{Link}from\"react-router-dom\";import{CoreServices,BackendServices}from'../../services';import Currency from'../../helpers/currency';import{uniq_key}from'../../helpers/unq_key';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";;var AccountMovementsHistory=function AccountMovementsHistory(props){var currencyData=new Currency();var _useTranslation=useTranslation(),t=_useTranslation.t,i18n=_useTranslation.i18n;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),dataRows=_useState2[0],setDataRows=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isActiveLoading=_useState4[0],setIsActiveLoading=_useState4[1];var _useState5=useState(new BackendServices()),_useState6=_slicedToArray(_useState5,2),apiServiceBackend=_useState6[0],setapiServiceBackend=_useState6[1];var _useState7=useState(new CoreServices()),_useState8=_slicedToArray(_useState7,2),apiCoreServices=_useState8[0],setCoreServices=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),dataMovimientos=_useState10[0],setdataMovimientos=_useState10[1];//On Mounting (componentDidMount)\nReact.useEffect(function(){fetchData();},[]);function fetchData(){loadData();}function groupBy(collection,property){var i=0,val,index,values=[],result=[];for(;i<collection.length;i++){val=collection[i][property];index=values.indexOf(val);if(index>-1)result[index].push(collection[i]);else{values.push(val);result.push([collection[i]]);}}return result;}//cargar lista de facilidades\nfunction loadData(){return _loadData.apply(this,arguments);}function _loadData(){_loadData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _props$transactionId;var core,_args2=arguments;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:core=_args2.length>0&&_args2[0]!==undefined?_args2[0]:false;setIsActiveLoading(true);_context2.next=4;return apiServiceBackend.consultMovementsBank((_props$transactionId=props===null||props===void 0?void 0:props.transactionId)!==null&&_props$transactionId!==void 0?_props$transactionId:0).then(function(resp){if(resp.bankBanesco.length>0){setIsActiveLoading(false);//toca dibujar la tabla\n//toca dibujar la tabla\nif(resp.bankBanesco.length>0){resp=resp.bankBanesco;// console.log(\"ssdadasda\",groupBy(resp,\"accountNumber\"));\n// let newJson=groupBy(resp,\"accountNumber\");\n// console.log(\"ssdadasda\",groupBy(resp,\"accountNumber\"));\n// let newJson=groupBy(resp,\"accountNumber\");\nsetdataMovimientos(resp.map(function(data,index,arr){var _resp,_arr,_data$averageBalance,_data$deposits,_arr2,_movementsYear$reduce,_movementsYear$reduce2,_movementsYear$reduce3,_movementsYear$reduce4;var movementsYear=(_resp=resp)===null||_resp===void 0?void 0:_resp.filter(function(movement){return movement.year===data.year&&movement.status&&movement.accountNumber===data.accountNumber;});return data.status?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:((_arr=arr[index-1])===null||_arr===void 0?void 0:_arr.accountNumber)!=data.accountNumber&&data.accountNumber}),/*#__PURE__*/_jsx(\"td\",{children:data.year}),/*#__PURE__*/_jsx(\"td\",{children:data.month}),/*#__PURE__*/_jsxs(\"td\",{children:[\"$\",currencyData.formatTable((_data$averageBalance=data.averageBalance)!==null&&_data$averageBalance!==void 0?_data$averageBalance:0)]}),/*#__PURE__*/_jsxs(\"td\",{children:[\"$\",currencyData.formatTable((_data$deposits=data.deposits)!==null&&_data$deposits!==void 0?_data$deposits:0)]})]},uniq_key()+\"1\"),data.year!==((_arr2=arr[index+1])===null||_arr2===void 0?void 0:_arr2.year)&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{}),/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsx(\"b\",{children:t(\"Total\")})}),/*#__PURE__*/_jsx(\"td\",{}),/*#__PURE__*/_jsxs(\"th\",{children:[\"$\",currencyData.formatTable((_movementsYear$reduce=movementsYear===null||movementsYear===void 0?void 0:movementsYear.reduce(function(acu,crr){return acu+crr.averageBalance;},0).toFixed(2))!==null&&_movementsYear$reduce!==void 0?_movementsYear$reduce:0)]}),/*#__PURE__*/_jsxs(\"th\",{children:[\"$\",currencyData.formatTable((_movementsYear$reduce2=movementsYear===null||movementsYear===void 0?void 0:movementsYear.reduce(function(acu,crr){return acu+crr.deposits;},0).toFixed(2))!==null&&_movementsYear$reduce2!==void 0?_movementsYear$reduce2:0)]}),/*#__PURE__*/_jsx(\"td\",{})]},uniq_key()+\"2\"),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{}),/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsx(\"b\",{children:t(\"Average\")})}),/*#__PURE__*/_jsx(\"td\",{}),/*#__PURE__*/_jsxs(\"th\",{children:[\"$\",currencyData.formatTable((_movementsYear$reduce3=movementsYear===null||movementsYear===void 0?void 0:movementsYear.reduce(function(acu,crr){return acu+crr.averageBalance/movementsYear.length;},0).toFixed(2))!==null&&_movementsYear$reduce3!==void 0?_movementsYear$reduce3:0)]}),/*#__PURE__*/_jsxs(\"th\",{children:[\"$\",currencyData.formatTable((_movementsYear$reduce4=movementsYear===null||movementsYear===void 0?void 0:movementsYear.reduce(function(acu,crr){return acu+crr.deposits/movementsYear.length;},0).toFixed(2))!==null&&_movementsYear$reduce4!==void 0?_movementsYear$reduce4:0)]}),/*#__PURE__*/_jsx(\"td\",{})]},uniq_key()+\"3\")]})]}):null;}));}else{setdataMovimientos(/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"6\",style:{textAlign:'center'},children:t(\"NoData\")})},uniq_key()+\"2\"));}}else{var _props$transactionId2;if(core){setIsActiveLoading(false);return;}//guardamos los datos de t24\n//guardamos los datos de t24\napiCoreServices.getAccountMovementsByTransaction((_props$transactionId2=props===null||props===void 0?void 0:props.transactionId)!==null&&_props$transactionId2!==void 0?_props$transactionId2:0).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){var i,cuenta,j,k,jsonSet;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"getAccountMovements\",data);if(!(data!==null&&data!==undefined)){_context.next=26;break;}i=0;case 3:if(!(i<data.length)){_context.next=22;break;}//aqui cargamos por cuentas\ncuenta=data[i].AcctId;j=0;case 6:if(!(j<data[i].dataByYear.length)){_context.next=19;break;}console.log(\"data[i].dataByYear\",data[i].dataByYear);k=0;case 9:if(!(k<data[i].dataByYear[j].dataresult.length)){_context.next=16;break;}jsonSet={\"trasactId\":Number(props===null||props===void 0?void 0:props.transactionId),\"year\":data[i].dataByYear[j].dataresult[k].year,\"month\":data[i].dataByYear[j].dataresult[k].month,\"deposits\":data[i].dataByYear[j].dataresult[k].deposits,\"averageBalance\":data[i].dataByYear[j].dataresult[k].amount,\"observations\":\"\",\"accountNumber\":cuenta,\"t24\":true};_context.next=13;return apiServiceBackend.newMovementsAccountsIGR(jsonSet).then(function(resp){});case 13:k++;_context.next=9;break;case 16:j++;_context.next=6;break;case 19:i++;_context.next=3;break;case 22:setIsActiveLoading(false);loadData(true);_context.next=27;break;case 26:setIsActiveLoading(false);case 27:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){setIsActiveLoading(false);});}});case 4:case\"end\":return _context2.stop();}}},_callee2);}));return _loadData.apply(this,arguments);}return/*#__PURE__*/_jsx(LoadingOverlay,{active:isActiveLoading,spinner:true,text:t(\"WaitingPlease\"),children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{md:\"6\",children:/*#__PURE__*/_jsx(\"h5\",{className:\"card-sub-title\",children:t(\"AccountMovementsHistory\")+\" - Banesco\"})})}),/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{md:\"12\",className:\"table-responsive styled-table-div\",children:/*#__PURE__*/_jsxs(Table,{className:\"table table-striped table-hover styled-table table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:t(\"Account\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"Year\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"Month\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"AverageAmount\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"Deposits\")})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:dataMovimientos})]})})})})]})});};//export default (withTranslation()(DatosGenerales));\nexport default AccountMovementsHistory;","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/components/Common/AccountMovementsHistory.js"],"names":["React","useState","useTranslation","Select","useLocation","useHistory","LoadingOverlay","Row","Col","Card","CardBody","Button","Label","Table","Pagination","PaginationItem","PaginationLink","CardFooter","AvForm","AvField","Link","CoreServices","BackendServices","Currency","uniq_key","AccountMovementsHistory","props","currencyData","t","i18n","dataRows","setDataRows","isActiveLoading","setIsActiveLoading","apiServiceBackend","setapiServiceBackend","apiCoreServices","setCoreServices","dataMovimientos","setdataMovimientos","useEffect","fetchData","loadData","groupBy","collection","property","i","val","index","values","result","length","indexOf","push","core","consultMovementsBank","transactionId","then","resp","bankBanesco","map","data","arr","movementsYear","filter","movement","year","status","accountNumber","month","formatTable","averageBalance","deposits","reduce","acu","crr","toFixed","textAlign","getAccountMovementsByTransaction","console","log","undefined","cuenta","AcctId","j","dataByYear","k","dataresult","jsonSet","Number","amount","newMovementsAccountsIGR","catch","error"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useTranslation } from 'react-i18next'\r\nimport Select from \"react-select\";\r\nimport { useLocation, useHistory } from 'react-router-dom'\r\nimport LoadingOverlay from 'react-loading-overlay';\r\n\r\nimport {\r\n  Row,\r\n  Col,\r\n  Card,\r\n  CardBody,\r\n  Button,\r\n  Label,\r\n  Table,\r\n  Pagination,\r\n  PaginationItem,\r\n  PaginationLink,\r\n  CardFooter,\r\n} from \"reactstrap\"\r\n\r\nimport { AvForm, AvField } from \"availity-reactstrap-validation\"\r\nimport { Link } from \"react-router-dom\"\r\n\r\nimport { CoreServices, BackendServices } from '../../services';\r\nimport Currency from '../../helpers/currency'; import { uniq_key } from '../../helpers/unq_key';\r\n;\r\n\r\nconst AccountMovementsHistory = (props) => {\r\n  const currencyData = new Currency();\r\n  const { t, i18n } = useTranslation();\r\n\r\n  const [dataRows, setDataRows] = useState([]);\r\n  const [isActiveLoading, setIsActiveLoading] = useState(false);\r\n\r\n  const [apiServiceBackend, setapiServiceBackend] = useState(new BackendServices());\r\n  const [apiCoreServices, setCoreServices] = useState(new CoreServices());\r\n\r\n  const [dataMovimientos, setdataMovimientos] = useState(null);\r\n  //On Mounting (componentDidMount)\r\n  React.useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  function fetchData() {\r\n    loadData();\r\n  }\r\n  function groupBy(collection, property) {\r\n    var i = 0, val, index,\r\n      values = [], result = [];\r\n    for (; i < collection.length; i++) {\r\n      val = collection[i][property];\r\n      index = values.indexOf(val);\r\n      if (index > -1)\r\n        result[index].push(collection[i]);\r\n      else {\r\n        values.push(val);\r\n        result.push([collection[i]]);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  //cargar lista de facilidades\r\n  async function loadData(core = false) {\r\n    setIsActiveLoading(true)\r\n    await apiServiceBackend.consultMovementsBank(props?.transactionId ?? 0).then(resp => {\r\n      if (resp.bankBanesco.length > 0) {\r\n        setIsActiveLoading(false)\r\n        //toca dibujar la tabla\r\n        if (resp.bankBanesco.length > 0) {\r\n          resp = resp.bankBanesco;\r\n          // console.log(\"ssdadasda\",groupBy(resp,\"accountNumber\"));\r\n          // let newJson=groupBy(resp,\"accountNumber\");\r\n          setdataMovimientos(resp.map((data, index, arr) => {\r\n            let movementsYear = resp?.filter(movement => movement.year === data.year && movement.status && movement.accountNumber === data.accountNumber);\r\n            return (\r\n              data.status ?\r\n                <>\r\n                  <tr key={uniq_key() + \"1\"}>\r\n                    <th>{arr[index - 1]?.accountNumber != data.accountNumber && data.accountNumber}</th>\r\n                    <td>{data.year}</td>\r\n                    <td>{data.month}</td>\r\n                    <td>${currencyData.formatTable(data.averageBalance ?? 0)}</td>\r\n                    <td>${currencyData.formatTable(data.deposits ?? 0)}</td>\r\n\r\n                  </tr>\r\n                  {data.year !== arr[index + 1]?.year && (\r\n                    <>\r\n                      <tr key={uniq_key() + \"2\"}>\r\n                        <td></td>\r\n                        <th><b>{t(\"Total\")}</b></th>\r\n                        <td></td>\r\n                        <th>${currencyData.formatTable(movementsYear?.reduce((acu, crr) => acu + crr.averageBalance, 0).toFixed(2) ?? 0)}</th>\r\n                        <th>${currencyData.formatTable(movementsYear?.reduce((acu, crr) => acu + crr.deposits, 0).toFixed(2) ?? 0)}</th>\r\n                        <td></td>\r\n                      </tr>\r\n                      <tr key={uniq_key() + \"3\"}>\r\n                        <td></td>\r\n                        <th><b>{t(\"Average\")}</b></th>\r\n                        <td></td>\r\n                        <th>${currencyData.formatTable(movementsYear?.reduce((acu, crr) => acu + crr.averageBalance / movementsYear.length, 0).toFixed(2) ?? 0)}</th>\r\n                        <th>${currencyData.formatTable(movementsYear?.reduce((acu, crr) => acu + crr.deposits / movementsYear.length, 0).toFixed(2) ?? 0)}</th>\r\n                        <td></td>\r\n                      </tr>\r\n                    </>\r\n                  )}\r\n                </>\r\n                : null)\r\n          }\r\n          ));\r\n        } else {\r\n          setdataMovimientos(\r\n            <tr key={uniq_key() + \"2\"}>\r\n              <td colSpan=\"6\" style={{ textAlign: 'center' }}>{t(\"NoData\")}</td>\r\n            </tr>);\r\n        }\r\n      } else {\r\n        if (core) {\r\n          setIsActiveLoading(false)\r\n          return;\r\n        }\r\n        //guardamos los datos de t24\r\n        apiCoreServices.getAccountMovementsByTransaction(props?.transactionId ?? 0)\r\n          .then(async (data) => {\r\n            console.log(\"getAccountMovements\", data);\r\n            if (data !== null && data !== undefined) {\r\n              for (let i = 0; i < data.length; i++) {\r\n                //aqui cargamos por cuentas\r\n                let cuenta = data[i].AcctId;\r\n                for (let j = 0; j < data[i].dataByYear.length; j++) {\r\n                  console.log(\"data[i].dataByYear\", data[i].dataByYear);\r\n                  for (let k = 0; k < data[i].dataByYear[j].dataresult.length; k++) {\r\n                    let jsonSet = {\r\n                      \"trasactId\": Number(props?.transactionId),\r\n                      \"year\": data[i].dataByYear[j].dataresult[k].year,\r\n                      \"month\": data[i].dataByYear[j].dataresult[k].month,\r\n                      \"deposits\": data[i].dataByYear[j].dataresult[k].deposits,\r\n                      \"averageBalance\": data[i].dataByYear[j].dataresult[k].amount,\r\n                      \"observations\": \"\",\r\n                      \"accountNumber\": cuenta,\r\n                      \"t24\": true\r\n                    }\r\n                    await apiServiceBackend.newMovementsAccountsIGR(jsonSet).then(resp => {\r\n\r\n                    })\r\n\r\n                  }\r\n\r\n                }\r\n\r\n              }\r\n              setIsActiveLoading(false)\r\n              loadData(true)\r\n            } else {\r\n              setIsActiveLoading(false)\r\n            }\r\n          }).catch((error) => {\r\n            setIsActiveLoading(false)\r\n          });\r\n      }\r\n\r\n    });\r\n\r\n\r\n    // apiCoreServices.getAccountMovements(props.customerNumberT24)\r\n    //   .then((data) => {\r\n    //     console.log(\"getAccountMovements\", data);\r\n    //     if (data !== null && data !== undefined) {\r\n    //       var rows = data.map((dataRow, index) => (\r\n    //         dataRow.dataByYear.map((dataByYear, index2) => (\r\n    //           <>\r\n    //             {dataByYear.dataresult.map((dataresult, index3) => (\r\n    //               <tr key={index2 + index3}>\r\n    //                 <th>{index2 === 0 && index3 === 0 ? dataRow.AcctId : \"\"}</th>\r\n    //                 <td>{dataByYear.year}</td>\r\n    //                 <td>{t(dataresult.month)}</td>\r\n    //                 <td>${currencyData.formatTable((Number(dataresult?.amount ?? 0)).toFixed(2))}</td>\r\n    //                 {<td>${currencyData.formatTable((Number(dataresult?.deposits ?? 0)).toFixed(2))}</td>}\r\n    //               </tr>\r\n    //             ))}\r\n    //             <tr>\r\n    //               <th></th>\r\n    //               <th>{t(\"Total\")}</th>\r\n    //               <th></th>\r\n    //               <th>${currencyData.formatTable((dataByYear.dataresult.reduce((total, currentValue) => total + Number(currentValue.amount), 0)).toFixed(2))}</th>\r\n    //               <th>${currencyData.formatTable((dataByYear.dataresult.reduce((total, currentValue) => total + Number(currentValue.deposits), 0)).toFixed(2))}</th>\r\n    //             </tr>\r\n    //             <tr>\r\n    //               <th></th>\r\n    //               <th>{t(\"Average\")}</th>\r\n    //               <th></th>\r\n    //               <th>${currencyData.formatTable((dataByYear.dataresult.reduce((total, currentValue) => total + Number(currentValue.amount), 0) / dataByYear.dataresult.length).toFixed(2))}</th>\r\n    //               <th>${currencyData.formatTable((dataByYear.dataresult.reduce((total, currentValue) => total + Number(currentValue.deposits), 0) / dataByYear.dataresult.length).toFixed(2))}</th>\r\n    //             </tr>\r\n    //           </>\r\n    //         ))\r\n    //       )\r\n    //       );\r\n    //       setDataRows(rows);\r\n    //     }\r\n    //   }).catch((error) => { });\r\n  }\r\n\r\n  return (\r\n\r\n    <LoadingOverlay active={isActiveLoading} spinner text={t(\"WaitingPlease\")}>\r\n\r\n      <Card>\r\n\r\n        <Row>\r\n          <Col md=\"6\">\r\n            <h5 className=\"card-sub-title\">{t(\"AccountMovementsHistory\") + \" - Banesco\"}</h5>\r\n          </Col>\r\n        </Row>\r\n\r\n        <CardBody>\r\n\r\n          <Row>\r\n            <Col md=\"12\" className=\"table-responsive styled-table-div\">\r\n              <Table className=\"table table-striped table-hover styled-table table\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>{t(\"Account\")}</th>\r\n                    <th>{t(\"Year\")}</th>\r\n                    <th>{t(\"Month\")}</th>\r\n                    <th>{t(\"AverageAmount\")}</th>\r\n                    <th>{t(\"Deposits\")}</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {/* {dataRows.length > 0 ? dataRows : null} */}\r\n                  {dataMovimientos}\r\n                </tbody>\r\n              </Table>\r\n            </Col>\r\n          </Row>\r\n        </CardBody>\r\n      </Card>\r\n\r\n    </LoadingOverlay>\r\n\r\n  )\r\n}\r\n\r\nAccountMovementsHistory.propTypes = {\r\n  customerNumberT24: PropTypes.string\r\n}\r\n\r\n//export default (withTranslation()(DatosGenerales));\r\nexport default AccountMovementsHistory;\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}
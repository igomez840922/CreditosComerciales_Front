{"ast":null,"code":"import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import{useLocation,useHistory}from'react-router-dom';import*as OPTs from\"../../../helpers/options_helper\";import*as url from\"../../../helpers/url_helper\";import{Row,Col,Card,CardBody,Label,CardFooter,Button,Table,CardHeader}from\"reactstrap\";import Alert from'react-bootstrap/Alert';import{AvForm,AvField}from\"availity-reactstrap-validation\";import{Link}from\"react-router-dom\";//Import Breadcrumb\nimport Breadcrumbs from\"../../../components/Common/Breadcrumb\";//i18n\nimport{useTranslation}from\"react-i18next\";//Import SweetAlert\nimport SweetAlert from\"react-bootstrap-sweetalert\";import{Search,ToolkitProvider}from'react-bootstrap-table2-toolkit';import BootstrapTable from'react-bootstrap-table-next';import paginationFactory from'react-bootstrap-table2-paginator';import LoadingOverlay from'react-loading-overlay';import AttachmentFileCore from\"../../../components/Common/AttachmentFileCore\";import ClientForm from\"./ClientForm\";import ModalEndProcess from\"../../../components/EndProcess/ModalEndProcess\";import{BackendServices,CoreServices,BpmServices}from\"../../../services\";import ApiService from\"../../../services/ApiService\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PreRequest=function PreRequest(props){var _useTranslation=useTranslation(),t=_useTranslation.t,i18n=_useTranslation.i18n;var history=useHistory();var location=useLocation();//Data que recibimos en el location\nvar _useState=useState(undefined),_useState2=_slicedToArray(_useState,2),locationData=_useState2[0],setLocationData=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isActiveLoading=_useState4[0],setIsActiveLoading=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),openNewClient=_useState6[0],setopenNewClient=_useState6[1];//Datos de la Tabla de Clientes\nvar _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),dataClientList=_useState8[0],setdataClientList=_useState8[1];//Cliente seleccionado\nvar _useState9=useState(undefined),_useState10=_slicedToArray(_useState9,2),selectedClient=_useState10[0],setselectedClient=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),identificationTypeList=_useState12[0],setidentificationTypeList=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),personTypeList=_useState14[0],setpersonTypeList=_useState14[1];//mostrar el modal para la opci√≥n de finalizar proceso\nvar _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),displayModalEndProcess=_useState16[0],setdisplayModalEndProcess=_useState16[1];var _useState17=useState({show:false,msg:\"\",isError:false}),_useState18=_slicedToArray(_useState17,2),msgData=_useState18[0],setmsgData=_useState18[1];//Servicios\nvar backendServices=new BackendServices();var bpmServices=new BpmServices();//On Mounting (componentDidMount)\nReact.useEffect(function(){if(location.data!==null&&location.data!==undefined){if(location.data.transactionId.length<=0){location.data.transactionId=location.data.instanceId;}//la guardo en sesion por si refresh el browser\nsessionStorage.setItem('locationData',JSON.stringify(location.data));setLocationData(location.data);fetchData(location.data);}else{//chequeamos si tenemos guardado en session\nvar result=sessionStorage.getItem('locationData');if(result!==undefined&&result!==null){result=JSON.parse(result);setLocationData(result);fetchData(result);}}},[]);//Caraga Inicial de datos\nfunction fetchData(locationData){//chequear si la tarea no ha sido iniciada\nbpmServices.checkAndStartTask(locationData).then(function(iniresult){if(iniresult===false){history.push(url.URL_DASHBOARD);}});checkAndCreateProcedure(locationData);loadIdentificationTypes();loadPersonTypes();getProcessClients(locationData.transactionId);}//CHEQUEAMOS Y GENERAMOS EL PROCESO EN BASE DE DATOS\nfunction checkAndCreateProcedure(locationData){backendServices.nuevoTramite(locationData.transactionId,locationData.instanceId,OPTs.PROCESS_BUSQUEDADESCARTE,OPTs.PROCESS_BUSQUEDADESCARTE,\"admin\",\"0\").then(function(data){if(data!==null&&data!==undefined){return;}}).catch(function(error){});}//cargar lista de tipo de identificacion\nfunction loadIdentificationTypes(){backendServices.consultarCatalogoTipoIdentificacion().then(function(data){if(data!==null&&data!==undefined){var json=[];for(var i=0;i<data.length;i++){json.push({label:t(data[i][\"description\"]),value:data[i][\"id\"]});}setidentificationTypeList(json);}}).catch(function(error){});}//cargar lista de tipo de personas\nfunction loadPersonTypes(){backendServices.consultarCatalogoTipoPersona().then(function(data){if(data!==null&&data!==undefined){var json=[];for(var i=0;i<data.length;i++){json.push({label:t(data[i][\"label\"]),value:data[i][\"code\"]});}setpersonTypeList(json);}}).catch(function(error){});}//se buscan todos los clientes de este proceso \nfunction getProcessClients(transactionId){backendServices.consultarOrquestadoListaPersonaSolicitud(transactionId).then(function(data){if(data!==null&&data!==undefined){setdataClientList(data);if(data.length<=0){onOpenNewClient();}}}).catch(function(error){});}//Abrir formulario Persona\nfunction onOpenNewClient(){var show=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;setopenNewClient(show);}//Editar Persona\nfunction onEditClient(dataClient){setselectedClient(dataClient);onOpenNewClient();}//Eliminar Persona\nfunction onDeleteClient(dataClient){//eliminarOrquestadoListaPersonaSolicitud\nbackendServices.eliminarOrquestadoListaPersonaSolicitud(dataClient).then(function(data){getProcessClients(dataClient.transactId);}).catch(function(error){});}//retorna el Tipo de Persona\nfunction getPersnoType(pType){return personTypeList.find(function(x){return x.value===pType;});}//retorna el Tipo de identificacion\nfunction getIdentificationType(idType){console.log(\"getIdentificationType\");if(idType!==undefined&&idType!==null&&idType.length>0){return identificationTypeList.find(function(x){return x.value===idType;});}return\"\";}//mostrar mensaje \nfunction showMessage(message){var isError=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;setmsgData({show:true,msg:message,isError:isError});}////////// PARTE ES LA FINAL DEL PROCESO ///////\n//Modal Para mostrar Comentario de Fin de Proceso\nfunction showModalEndProcess(){var show=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;setdisplayModalEndProcess(show);}//Salvando el Proceso y le pasamos una opcion: 1-Finalizar Proceso, 2- Salvarlo, 3- A Cumplimmineto, 4- Avanzar a IGR\nfunction onSaveProcess(option){if(option===OPTs.OPT_PREFINALIZARPROCESO){showModalEndProcess();return;}var person=null;for(var i=0;i<dataClientList.length;i++){var blacklist=dataClientList[i].blacklist.find(function(bklist){return bklist.backList===true;});if(blacklist!==undefined&&blacklist!==null){person=dataClientList[i];break;}}if(person!==null&&option===OPTs.OPT_LISTAEXCLUSION){option=OPTs.OPT_ENVIARCUMPLIMIENTO;}switch(option){case OPTs.OPT_LISTAEXCLUSION:case OPTs.OPT_ENVIARCUMPLIMIENTO:{//chequear si existe algun deudor para poder continuar\nbackendServices.consultarDeudorPrincipal(locationData.transactionId).then(function(data){if(data!==null&&data!==undefined){saveJBPMProcess(option);}else{console.log(\"deudor\",data);//Mensaje ERROR\nshowMessage(t(\"Youmustselectatleastonedebtor\"),true);}}).catch(function(error){});break;}default:{saveJBPMProcess(option);break;}}}function saveJBPMProcess(option){switch(option){case OPTs.OPT_FINALIZARPROCESO:{bpmServices.abortProcess(locationData.instanceId).then(function(data){if(data!==undefined){history.push(url.URL_DASHBOARD);}else{//Mensaje ERROR\nshowMessage(t(\"TheProcessCouldNotFinish\"),true);}});break;}case OPTs.OPT_SALVAPARCIAL:{var values={\"processId\":OPTs.PROCESS_BUSQUEDADESCARTE.toString(),\"activityId\":OPTs.ACT_NONE.toString(),\"transactionId\":locationData.transactionId,\"customerId\":\"\",\"applicationNumber\":\"\",\"procedureNumber\":\"\"//\"decision\":\"no\"          \n};bpmServices.updatevariables(locationData.instanceId,values).then(function(data){if(data!==undefined){showMessage(t(\"TheProcessCouldNotFinish\"));}else{//Mensaje ERROR\nshowMessage(t(\"ErrorSaveMessage\"),true);}});break;}case OPTs.OPT_ENVIARCUMPLIMIENTO:{var values={\"processId\":OPTs.PROCESS_CUMPLIMIENTO.toString(),\"activityId\":OPTs.ACT_NONE.toString(),\"transactionId\":locationData.transactionId,\"customerId\":\"\",\"applicationNumber\":\"\",\"procedureNumber\":\"\",\"decision\":\"si\"};bpmServices.completedStatusTask(locationData.taskId,values).then(function(data){if(data!==undefined){history.push(url.URL_DASHBOARD);showMessage(t(\"TheProcessCouldNotFinish\"));}else{//Mensaje ERROR\nshowMessage(t(\"ErrorSaveMessage\"),true);}});break;}case OPTs.OPT_LISTAEXCLUSION:{var values={\"processId\":OPTs.PROCESS_LISTAEXCLUSION.toString(),\"activityId\":OPTs.ACT_NONE.toString(),\"transactionId\":locationData.transactionId,\"customerId\":\"\",\"applicationNumber\":\"\",\"procedureNumber\":\"\",\"decision\":\"no\"};bpmServices.completedStatusTask(locationData.taskId,values).then(function(data){if(data!==undefined){history.push(url.URL_DASHBOARD);showMessage(t(\"TheProcessCouldNotFinish\"));}else{//Mensaje ERROR\nshowMessage(t(\"ErrorSaveMessage\"),true);}});break;}}}//salvar comentario de end process\nfunction onSaveEndProcess(values){//Salvar los comentarios en Bitacora    \n//selectedData.endProcessComment = values.txtComment;\n//UpdateDataModel(selectedData);\nonSaveProcess(OPTs.OPT_FINALIZARPROCESO);}return/*#__PURE__*/_jsxs(\"div\",{className:\"page-content\",children:[/*#__PURE__*/_jsx(Breadcrumbs,{title:t(\"CommercialCredit\"),breadcrumbItem:t(\"PreRequest\")}),/*#__PURE__*/_jsx(LoadingOverlay,{active:isActiveLoading,spinner:true,text:t(\"WaitingPlease\"),children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"card-title\",children:[t(\"PreRequest\"),\" \",/*#__PURE__*/_jsx(\"br\",{}),\" \",t(\"Process\")+\": #\"+(locationData===null||locationData===void 0?void 0:locationData.instanceId)]}),/*#__PURE__*/_jsx(\"p\",{className:\"card-title-desc\",children:t(\"This form is official and must be filled out correctly\")})]}),/*#__PURE__*/_jsx(CardBody,{children:openNewClient?/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{md:\"12\",children:/*#__PURE__*/_jsx(ClientForm,{transactId:locationData.transactionId,clientSelected:selectedClient,onCancel:function onCancel(){onOpenNewClient(false);getProcessClients(locationData.transactionId);}})})}):/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{md:\"12\",children:/*#__PURE__*/_jsx(Link,{className:\"float-end\",onClick:function onClick(){setselectedClient(undefined);onOpenNewClient();},children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-plus-box-multiple-outline mdi-24px\"})})})}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{md:\"12\",children:/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(Table,{className:\"table mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-light\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:t(\"PersonType\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"FullName\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"IdentificationType\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"IdentificationNumber\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"Roles\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"WatchList\")}),/*#__PURE__*/_jsx(\"th\",{})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:dataClientList.map(function(item,index){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:getPersnoType(Number(item.personType)).label}),/*#__PURE__*/_jsx(\"td\",{children:Number(item.personType)>1?item.name:item.name+\" \"+item.secondName+\" \"+item.lastName+\" \"+item.secondSurname}),/*#__PURE__*/_jsx(\"td\",{children:getIdentificationType(item.idType).label}),/*#__PURE__*/_jsx(\"td\",{children:item.clientDocumentId}),/*#__PURE__*/_jsx(\"td\",{children:item.roles!==undefined?item.roles.map(function(rol,index){return rol.roleDescription+\" - \";}):null}),/*#__PURE__*/_jsx(\"td\",{children:item.blacklist!==undefined?item.blacklist.map(function(black,index){return black.backList===true?\"Aplica\":\"No Aplica\";}):null}),/*#__PURE__*/_jsxs(\"td\",{style:{textAlign:\"right\"},children:[/*#__PURE__*/_jsx(Link,{to:\"#\",onClick:function onClick(e){onEditClient(item);},children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-border-color mdi-24px\"})}),/*#__PURE__*/_jsx(Link,{to:\"#\",onClick:function onClick(e){onDeleteClient(item);},children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-trash-can-outline mdi-24px\"})})]})]});})})]})})})}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{md:\"12\",children:/*#__PURE__*/_jsx(Alert,{show:msgData.show,variant:msgData.isError?\"danger\":\"success\",dismissible:true,onClose:function onClose(){console.log(\"onClose\");setmsgData({show:false,msg:\"\",isError:false});},children:msgData.msg})})})]})}),!openNewClient?/*#__PURE__*/_jsxs(CardFooter,{style:{textAlign:\"right\"},children:[/*#__PURE__*/_jsxs(Button,{color:\"danger\",type:\"button\",style:{margin:'5px'},onClick:function onClick(){showModalEndProcess();},children:[/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-arrow-left-bold-circle-outline mid-12px\"}),\" \",t(\"Exit\")]}),/*#__PURE__*/_jsxs(Button,{color:\"success\",type:\"button\",style:{margin:'5px'},onClick:function onClick(){onSaveProcess(OPTs.OPT_LISTAEXCLUSION);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-arrow-right-bold-circle-outline mid-12px\"}),\" \",t(\"Advance\")]})]}):null]})}),/*#__PURE__*/_jsx(ModalEndProcess,{onSaveEndProcess:onSaveEndProcess,isOpen:displayModalEndProcess,toggle:function toggle(){showModalEndProcess(false);}})]});};export default PreRequest;","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/CommercialCredit/1_Presolicitud/index.js"],"names":["React","useState","useLocation","useHistory","OPTs","url","Row","Col","Card","CardBody","Label","CardFooter","Button","Table","CardHeader","Alert","AvForm","AvField","Link","Breadcrumbs","useTranslation","SweetAlert","Search","ToolkitProvider","BootstrapTable","paginationFactory","LoadingOverlay","AttachmentFileCore","ClientForm","ModalEndProcess","BackendServices","CoreServices","BpmServices","ApiService","PreRequest","props","t","i18n","history","location","undefined","locationData","setLocationData","isActiveLoading","setIsActiveLoading","openNewClient","setopenNewClient","dataClientList","setdataClientList","selectedClient","setselectedClient","identificationTypeList","setidentificationTypeList","personTypeList","setpersonTypeList","displayModalEndProcess","setdisplayModalEndProcess","show","msg","isError","msgData","setmsgData","backendServices","bpmServices","useEffect","data","transactionId","length","instanceId","sessionStorage","setItem","JSON","stringify","fetchData","result","getItem","parse","checkAndStartTask","then","iniresult","push","URL_DASHBOARD","checkAndCreateProcedure","loadIdentificationTypes","loadPersonTypes","getProcessClients","nuevoTramite","PROCESS_BUSQUEDADESCARTE","catch","error","consultarCatalogoTipoIdentificacion","json","i","label","value","consultarCatalogoTipoPersona","consultarOrquestadoListaPersonaSolicitud","onOpenNewClient","onEditClient","dataClient","onDeleteClient","eliminarOrquestadoListaPersonaSolicitud","transactId","getPersnoType","pType","find","x","getIdentificationType","idType","console","log","showMessage","message","showModalEndProcess","onSaveProcess","option","OPT_PREFINALIZARPROCESO","person","blacklist","bklist","backList","OPT_LISTAEXCLUSION","OPT_ENVIARCUMPLIMIENTO","consultarDeudorPrincipal","saveJBPMProcess","OPT_FINALIZARPROCESO","abortProcess","OPT_SALVAPARCIAL","values","toString","ACT_NONE","updatevariables","PROCESS_CUMPLIMIENTO","completedStatusTask","taskId","PROCESS_LISTAEXCLUSION","onSaveEndProcess","map","item","index","Number","personType","name","secondName","lastName","secondSurname","clientDocumentId","roles","rol","roleDescription","black","textAlign","e","margin"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\"\r\nimport PropTypes from 'prop-types';\r\nimport { useLocation,useHistory } from 'react-router-dom'\r\nimport * as OPTs from \"../../../helpers/options_helper\"\r\nimport * as url from \"../../../helpers/url_helper\"\r\n\r\nimport {\r\n  Row,\r\n  Col,\r\n  Card,\r\n  CardBody,\r\n  Label,\r\n  CardFooter,\r\n  Button,\r\n  Table,\r\n  CardHeader,\r\n} from \"reactstrap\"\r\n\r\nimport Alert from 'react-bootstrap/Alert'\r\n\r\nimport { AvForm, AvField } from \"availity-reactstrap-validation\"\r\nimport { Link } from \"react-router-dom\"\r\n//Import Breadcrumb\r\nimport Breadcrumbs from \"../../../components/Common/Breadcrumb\"\r\n//i18n\r\nimport { useTranslation } from \"react-i18next\";\r\n//Import SweetAlert\r\nimport SweetAlert from \"react-bootstrap-sweetalert\";\r\nimport { Search,ToolkitProvider } from 'react-bootstrap-table2-toolkit';\r\nimport BootstrapTable from 'react-bootstrap-table-next';\r\nimport paginationFactory from 'react-bootstrap-table2-paginator';\r\nimport LoadingOverlay from 'react-loading-overlay';\r\nimport AttachmentFileCore from \"../../../components/Common/AttachmentFileCore\";\r\nimport ClientForm from \"./ClientForm\";\r\nimport ModalEndProcess from \"../../../components/EndProcess/ModalEndProcess\";\r\n\r\nimport {BackendServices,CoreServices,BpmServices,} from \"../../../services\";\r\nimport ApiService from \"../../../services/ApiService\";\r\n\r\nconst PreRequest = props => {\r\n  \r\n  const { t, i18n } = useTranslation();\r\n\r\n  const history = useHistory();\r\n  const location = useLocation();\r\n\r\n  //Data que recibimos en el location\r\n  const [locationData, setLocationData] = useState(undefined);     \r\n  const [isActiveLoading, setIsActiveLoading] = useState(false);\r\n  const [openNewClient, setopenNewClient] = useState(false);\r\n\r\n  //Datos de la Tabla de Clientes\r\n  const [dataClientList, setdataClientList ] = useState([]);\r\n  //Cliente seleccionado\r\n  const [selectedClient,setselectedClient]= useState(undefined);     \r\n\r\n  const [identificationTypeList, setidentificationTypeList] = useState([]);  \r\n  const [personTypeList, setpersonTypeList] = useState([]);\r\n\r\n  //mostrar el modal para la opci√≥n de finalizar proceso\r\n  const [displayModalEndProcess, setdisplayModalEndProcess] = useState(false);\r\n\r\n  const [msgData, setmsgData] = useState({show:false,msg:\"\",isError:false});\r\n        \r\n  //Servicios\r\n  const backendServices = new BackendServices();\r\n  const bpmServices = new BpmServices();\r\n    \r\n  //On Mounting (componentDidMount)\r\n  React.useEffect(() => {    \r\n    if(location.data!==null && location.data!==undefined){\r\n      if(location.data.transactionId.length <= 0){\r\n        location.data.transactionId=location.data.instanceId;\r\n      }\r\n      //la guardo en sesion por si refresh el browser\r\n      sessionStorage.setItem('locationData', JSON.stringify(location.data));\r\n\r\n      setLocationData(location.data);\r\n      fetchData(location.data);    \r\n    }\r\n    else{\r\n      //chequeamos si tenemos guardado en session\r\n      var result = sessionStorage.getItem('locationData');\r\n      if(result!==undefined && result!==null){\r\n        result = JSON.parse(result);\r\n\r\n        setLocationData(result);\r\n        fetchData(result);  \r\n      }\r\n    }    \r\n  }, []);\r\n\r\n    //Caraga Inicial de datos\r\n    function fetchData(locationData) {\r\n\r\n      //chequear si la tarea no ha sido iniciada\r\n      bpmServices.checkAndStartTask(locationData)\r\n        .then((iniresult) => {                       \r\n          if(iniresult===false){\r\n            history.push(url.URL_DASHBOARD);\r\n          }                \r\n        })\r\n\r\n        checkAndCreateProcedure(locationData);\r\n        loadIdentificationTypes();\r\n        loadPersonTypes();\r\n        getProcessClients(locationData.transactionId);\r\n    } \r\n    \r\n    //CHEQUEAMOS Y GENERAMOS EL PROCESO EN BASE DE DATOS\r\n    function checkAndCreateProcedure(locationData){\r\n      backendServices.nuevoTramite(locationData.transactionId,locationData.instanceId,OPTs.PROCESS_BUSQUEDADESCARTE,OPTs.PROCESS_BUSQUEDADESCARTE,\"admin\",\"0\")\r\n        .then((data) => {\r\n            if (data !== null && data !== undefined) {\r\n                return;\r\n            }          \r\n      }).catch((error) => { });    \r\n    }\r\n    \r\n    //cargar lista de tipo de identificacion\r\n    function loadIdentificationTypes(){\r\n      backendServices.consultarCatalogoTipoIdentificacion()\r\n        .then((data) => {\r\n            if (data !== null && data !== undefined) {\r\n                let json = [];\r\n                for (let i = 0; i < data.length; i++) {\r\n                  json.push({ label: t(data[i][\"description\"]), value: data[i][\"id\"] })\r\n                }\r\n                setidentificationTypeList(json);\r\n            }          \r\n      }).catch((error) => { });    \r\n    }\r\n    //cargar lista de tipo de personas\r\n    function loadPersonTypes(){\r\n      backendServices.consultarCatalogoTipoPersona()\r\n        .then((data) => {\r\n            if (data !== null && data !== undefined) {\r\n                let json = [];\r\n                for (let i = 0; i < data.length; i++) {\r\n                  json.push({ label: t(data[i][\"label\"]), value: data[i][\"code\"] })\r\n                }\r\n                setpersonTypeList(json);                \r\n            }          \r\n      }).catch((error) => { });    \r\n    } \r\n    //se buscan todos los clientes de este proceso \r\n    function getProcessClients(transactionId){      \r\n      backendServices.consultarOrquestadoListaPersonaSolicitud(transactionId)\r\n        .then((data) => {\r\n          if (data !== null && data !== undefined) {            \r\n            setdataClientList(data)\r\n\r\n            if(data.length<=0){\r\n              onOpenNewClient();\r\n            }\r\n          }         \r\n      }).catch((error) => { }); \r\n    }\r\n    //Abrir formulario Persona\r\n    function onOpenNewClient(show=true){\r\n      setopenNewClient(show)\r\n    }\r\n    //Editar Persona\r\n    function onEditClient(dataClient){\r\n      setselectedClient(dataClient)\r\n      onOpenNewClient();      \r\n    }\r\n    //Eliminar Persona\r\n    function onDeleteClient(dataClient){\r\n      //eliminarOrquestadoListaPersonaSolicitud\r\n      backendServices.eliminarOrquestadoListaPersonaSolicitud(dataClient)\r\n        .then((data) => {\r\n          getProcessClients(dataClient.transactId);    \r\n      }).catch((error) => { }); \r\n    }    \r\n    //retorna el Tipo de Persona\r\n    function getPersnoType(pType){\r\n      return personTypeList.find(x => x.value === pType);\r\n    }\r\n    //retorna el Tipo de identificacion\r\n    function getIdentificationType(idType){\r\n      console.log(\"getIdentificationType\",)\r\n      if(idType!==undefined && idType!==null && idType.length > 0){\r\n        return identificationTypeList.find(x => x.value === idType);\r\n      }\r\n      return \"\";      \r\n    }\r\n    //mostrar mensaje \r\n    function showMessage(message,isError=false){    \r\n     \r\n      setmsgData({show:true,msg:message,isError:isError})   \r\n    } \r\n\r\n    ////////// PARTE ES LA FINAL DEL PROCESO ///////\r\n    //Modal Para mostrar Comentario de Fin de Proceso\r\n    function showModalEndProcess(show=true) {\r\n      setdisplayModalEndProcess(show);\r\n    }  \r\n    //Salvando el Proceso y le pasamos una opcion: 1-Finalizar Proceso, 2- Salvarlo, 3- A Cumplimmineto, 4- Avanzar a IGR\r\n    function onSaveProcess(option){\r\n    \r\n    if(option === OPTs.OPT_PREFINALIZARPROCESO){\r\n      showModalEndProcess();\r\n      return;\r\n    }\r\n\r\n    var person = null;\r\n    for (var i = 0; i < dataClientList.length; i++) {\r\n      var blacklist = dataClientList[i].blacklist.find((bklist) => {\r\n        return bklist.backList === true;\r\n      })\r\n      if(blacklist!==undefined && blacklist!==null){\r\n        person = dataClientList[i];\r\n        break;\r\n      }\r\n    }\r\n\r\n    if(person!==null && option===OPTs.OPT_LISTAEXCLUSION){\r\n      option = OPTs.OPT_ENVIARCUMPLIMIENTO;\r\n    }\r\n    \r\n    switch(option){\r\n      case OPTs.OPT_LISTAEXCLUSION:\r\n      case OPTs.OPT_ENVIARCUMPLIMIENTO: {\r\n        //chequear si existe algun deudor para poder continuar\r\n        backendServices.consultarDeudorPrincipal(locationData.transactionId)\r\n        .then((data) => {\r\n            if (data !== null && data !== undefined) {\r\n              saveJBPMProcess(option);\r\n            }  \r\n            else{\r\n              console.log(\"deudor\",data);\r\n              //Mensaje ERROR\r\n              showMessage(t(\"Youmustselectatleastonedebtor\"),true);\r\n            }        \r\n        }).catch((error) => { });  \r\n        break;\r\n      }\r\n      default:{\r\n        saveJBPMProcess(option);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  function saveJBPMProcess(option){ \r\n    switch(option){\r\n      case OPTs.OPT_FINALIZARPROCESO: {        \r\n        bpmServices.abortProcess(locationData.instanceId)\r\n          .then((data) => {\r\n            if(data!==undefined){              \r\n              history.push(url.URL_DASHBOARD);          \r\n              }\r\n            else{\r\n              //Mensaje ERROR\r\n              showMessage(t(\"TheProcessCouldNotFinish\"),true);\r\n            }\r\n        });\r\n        break;\r\n      }\r\n      case OPTs.OPT_SALVAPARCIAL: {\r\n        var values = {\r\n          \"processId\":OPTs.PROCESS_BUSQUEDADESCARTE.toString(),\r\n          \"activityId\":OPTs.ACT_NONE.toString(),                    \r\n          \"transactionId\":locationData.transactionId,\r\n          \"customerId\":\"\",                   \r\n          \"applicationNumber\":\"\",\r\n          \"procedureNumber\":\"\" ,\r\n          //\"decision\":\"no\"          \r\n      };\r\n      bpmServices.updatevariables(locationData.instanceId,values)\r\n          .then((data) => {\r\n            if(data!==undefined){              \r\n              showMessage(t(\"TheProcessCouldNotFinish\"));\r\n            }\r\n            else{\r\n              //Mensaje ERROR\r\n              showMessage(t(\"ErrorSaveMessage\"),true);\r\n            }\r\n        });\r\n        break;\r\n      }\r\n      case OPTs.OPT_ENVIARCUMPLIMIENTO: {\r\n        var values = {\r\n          \"processId\":OPTs.PROCESS_CUMPLIMIENTO.toString(),\r\n          \"activityId\":OPTs.ACT_NONE.toString(),                    \r\n          \"transactionId\":locationData.transactionId,\r\n          \"customerId\":\"\",                      \r\n          \"applicationNumber\":\"\",\r\n          \"procedureNumber\":\"\" ,\r\n          \"decision\":\"si\"          \r\n      };\r\n      bpmServices.completedStatusTask(locationData.taskId,values)\r\n          .then((data) => {\r\n            if(data!==undefined){  \r\n              history.push(url.URL_DASHBOARD);              \r\n              showMessage(t(\"TheProcessCouldNotFinish\"));\r\n            }\r\n            else{\r\n              //Mensaje ERROR\r\n              showMessage(t(\"ErrorSaveMessage\"),true);\r\n            }\r\n        });\r\n        break;\r\n      }\r\n      case OPTs.OPT_LISTAEXCLUSION: {\r\n        var values = {\r\n          \"processId\":OPTs.PROCESS_LISTAEXCLUSION.toString(),\r\n          \"activityId\":OPTs.ACT_NONE.toString(),                    \r\n          \"transactionId\":locationData.transactionId,\r\n          \"customerId\":\"\",                      \r\n          \"applicationNumber\":\"\",\r\n          \"procedureNumber\":\"\" ,\r\n          \"decision\":\"no\"          \r\n      };\r\n      bpmServices.completedStatusTask(locationData.taskId,values)\r\n          .then((data) => {\r\n            if(data!==undefined){  \r\n              history.push(url.URL_DASHBOARD);              \r\n              showMessage(t(\"TheProcessCouldNotFinish\"));\r\n            }\r\n            else{\r\n              //Mensaje ERROR\r\n              showMessage(t(\"ErrorSaveMessage\"),true);\r\n            }\r\n        });\r\n        break;\r\n      }      \r\n    }\r\n  }\r\n\r\n  //salvar comentario de end process\r\n  function onSaveEndProcess(values){\r\n    \r\n    //Salvar los comentarios en Bitacora    \r\n    //selectedData.endProcessComment = values.txtComment;\r\n    //UpdateDataModel(selectedData);\r\n    onSaveProcess(OPTs.OPT_FINALIZARPROCESO);\r\n  }\r\n\r\n\r\n  return (\r\n     <div className=\"page-content\">\r\n        \r\n        <Breadcrumbs title={t(\"CommercialCredit\")} breadcrumbItem={t(\"PreRequest\")} />\r\n\r\n        <LoadingOverlay active={isActiveLoading} spinner text={t(\"WaitingPlease\")}>\r\n        \r\n        <Card>\r\n          <CardHeader>\r\n          <h4 className=\"card-title\">{t(\"PreRequest\")} <br/> {t(\"Process\") + \": #\" + locationData?.instanceId}</h4>\r\n            <p className=\"card-title-desc\">{t(\"This form is official and must be filled out correctly\")}</p>\r\n            \r\n          </CardHeader>\r\n            <CardBody>\r\n            \r\n\r\n        {openNewClient?\r\n        <Row>\r\n          <Col md=\"12\">\r\n\r\n            <ClientForm transactId={locationData.transactionId} clientSelected={selectedClient} onCancel={()=>{onOpenNewClient(false);getProcessClients(locationData.transactionId)}}></ClientForm>\r\n\r\n          </Col>\r\n        </Row>\r\n        :\r\n        <React.Fragment>\r\n          <Row>\r\n            <Col md=\"12\">\r\n              <Link className=\"float-end\" onClick={()=>{setselectedClient(undefined); onOpenNewClient()}}><i className=\"mdi mdi-plus-box-multiple-outline mdi-24px\"></i></Link>\r\n            </Col>\r\n              </Row>          \r\n            <Row>\r\n          <Col md=\"12\">\r\n          <div className=\"table-responsive\">\r\n          <Table className=\"table mb-0\">\r\n              <thead className=\"table-light\">\r\n                <tr>\r\n                  <th>{t(\"PersonType\")}</th>\r\n                  <th>{t(\"FullName\")}</th>\r\n                  <th>{t(\"IdentificationType\")}</th>\r\n                  <th>{t(\"IdentificationNumber\")}</th>\r\n                  <th>{t(\"Roles\")}</th>\r\n                  <th>{t(\"WatchList\")}</th>\r\n                  <th></th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n              {dataClientList.map((item, index) => (\r\n                  <tr>\r\n                    <td>{getPersnoType(Number(item.personType)).label}</td>\r\n                    <td>{Number(item.personType)>1?(item.name):(item.name + \" \" + item.secondName + \" \" + item.lastName + \" \" + item.secondSurname)}</td>\r\n                    <td>{getIdentificationType(item.idType).label}</td>\r\n                    <td>{item.clientDocumentId}</td>\r\n                    <td>\r\n                      {item.roles!==undefined?\r\n                      item.roles.map((rol, index) => (\r\n                        rol.roleDescription + \" - \"\r\n                      )):null}\r\n                    </td>\r\n                    <td>\r\n                      {item.blacklist!==undefined?\r\n                        item.blacklist.map((black, index) => (\r\n                          black.backList===true?\"Aplica\":\"No Aplica\"\r\n                      )):null}\r\n                    </td> \r\n                    <td style={{ textAlign: \"right\" }}>\r\n                      <Link to=\"#\" onClick={(e) => { onEditClient(item) }}><i className=\"mdi mdi-border-color mdi-24px\"></i></Link>\r\n                      <Link to=\"#\" onClick={(e) => { onDeleteClient(item) }}><i className=\"mdi mdi-trash-can-outline mdi-24px\"></i></Link>\r\n                    </td>                   \r\n                  </tr>                   \r\n                  ))}\r\n              </tbody>\r\n            </Table>\r\n          </div>\r\n           \r\n          </Col>\r\n        </Row>\r\n        <Row>\r\n            <Col md=\"12\">            \r\n            <Alert show={msgData.show} variant={msgData.isError?\"danger\":\"success\"} dismissible onClose={() =>{ console.log(\"onClose\"); setmsgData({show:false,msg:\"\",isError:false})}}>\r\n              {msgData.msg}\r\n            </Alert>\r\n            </Col>   \r\n             </Row>  \r\n        </React.Fragment>\r\n        }\r\n            </CardBody>\r\n\r\n            {!openNewClient?\r\n            <CardFooter style={{textAlign:\"right\"}}>  \r\n                  <Button color=\"danger\" type=\"button\" style={{ margin: '5px' }} onClick={() => { showModalEndProcess() }}><i className=\"mdi mdi-arrow-left-bold-circle-outline mid-12px\"></i> {t(\"Exit\")}</Button>\r\n                  <Button color=\"success\" type=\"button\" style={{ margin: '5px' }} onClick={() => { onSaveProcess(OPTs.OPT_LISTAEXCLUSION) }}><i className=\"mdi mdi-arrow-right-bold-circle-outline mid-12px\"></i> {t(\"Advance\")}</Button>\r\n              </CardFooter>\r\n            :null}\r\n        </Card>       \r\n      </LoadingOverlay>       \r\n\r\n      <ModalEndProcess onSaveEndProcess={ onSaveEndProcess } isOpen={ displayModalEndProcess } toggle={ () => { showModalEndProcess(false) } } />        \r\n\r\n      </div>      \r\n    \r\n  )\r\n}\r\n\r\nexport default PreRequest\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"var _jsxFileName = \"D:\\\\_PROJECTS\\\\_SOAINT\\\\JBPM\\\\App\\\\banescocreditoscomerciales\\\\src\\\\pages\\\\CommercialCredit\\\\5_PropuestaCredito\\\\Secciones\\\\LevelAutonomy.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport { withTranslation } from \"react-i18next\";\nimport PropTypes from 'prop-types';\nimport { Row, Col, Button, Label, Input, Modal, Card, CardBody, CardFooter } from \"reactstrap\";\nimport { AvForm, AvField } from \"availity-reactstrap-validation\";\nimport { translationHelpers } from \"../../../../helpers\";\nimport { BackendServices, BpmServices, CoreServices } from \"../../../../services\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport * as url from \"../../../../helpers/url_helper\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst LevelAutonomy = props => {\n  _s();\n\n  const [t, c] = translationHelpers('translation', 'common');\n  const [levelAutonomy, setLevelAutonomy] = useState(0);\n  const [levelAutonomyPosition, setLevelAutonomyPosition] = useState('');\n  const bpmServices = new BpmServices();\n  const backendServices = new BackendServices();\n  const coreServices = new CoreServices();\n  const location = useLocation();\n  const history = useHistory();\n  const [locationData, setLocationData] = useState(null);\n  useEffect(() => {\n    let dataSession;\n\n    if (location.data !== null && location.data !== undefined) {\n      if (location.data.transactionId === undefined || location.data.transactionId.length <= 0) {\n        //location.data.transactionId = 0;\n        //checkAndCreateProcedure(location.data);\n        history.push(url.URL_DASHBOARD);\n      } else {\n        sessionStorage.setItem('locationData', JSON.stringify(location.data));\n        setLocationData(location.data);\n        dataSession = location.data;\n      }\n    } else {\n      //chequeamos si tenemos guardado en session\n      var result = sessionStorage.getItem('locationData');\n\n      if (result !== undefined && result !== null) {\n        result = JSON.parse(result);\n        setLocationData(result);\n        dataSession = result;\n      }\n    }\n\n    getFacilityHistory({\n      dataSession\n    });\n  }, []);\n  useEffect(() => {\n    (levelAutonomy === null || levelAutonomy === void 0 ? void 0 : levelAutonomy.amount) > 0 && bpmServices.saveAutonomy(levelAutonomy).then(resp => {\n      var _resp$body, _resp$body$result$dmn, _resp$body$result$dmn2, _resp$body2, _resp$body2$result$dm, _resp$body2$result$dm2;\n\n      let banca = resp === null || resp === void 0 ? void 0 : (_resp$body = resp.body) === null || _resp$body === void 0 ? void 0 : (_resp$body$result$dmn = _resp$body.result['dmn-evaluation-result']['dmn-context']) === null || _resp$body$result$dmn === void 0 ? void 0 : (_resp$body$result$dmn2 = _resp$body$result$dmn.autonomiaduales) === null || _resp$body$result$dmn2 === void 0 ? void 0 : _resp$body$result$dmn2.banca;\n      let credito = resp === null || resp === void 0 ? void 0 : (_resp$body2 = resp.body) === null || _resp$body2 === void 0 ? void 0 : (_resp$body2$result$dm = _resp$body2.result['dmn-evaluation-result']['dmn-context']) === null || _resp$body2$result$dm === void 0 ? void 0 : (_resp$body2$result$dm2 = _resp$body2$result$dm.autonomiaduales) === null || _resp$body2$result$dm2 === void 0 ? void 0 : _resp$body2$result$dm2.credito;\n      setLevelAutonomyPosition({\n        banca,\n        credito\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }, [levelAutonomy, props.levelAutonomy]);\n\n  async function getFacilityHistory({\n    dataSession = locationData\n  }) {\n    var _dataSession$transact;\n\n    //guarantee prendaria code 500\n    await backendServices.consultGeneralDataPropCred((_dataSession$transact = dataSession === null || dataSession === void 0 ? void 0 : dataSession.transactionId) !== null && _dataSession$transact !== void 0 ? _dataSession$transact : 0).then(async propuesta => {\n      var _propuesta$;\n\n      let requestId = (_propuesta$ = propuesta[0]) === null || _propuesta$ === void 0 ? void 0 : _propuesta$.requestId;\n      backendServices.consultarFacilidades(requestId !== null && requestId !== void 0 ? requestId : '').then(async resp => {\n        if (resp.length > 0 && resp != undefined) {\n          var _guaranteePrendario$c, _guaranteePrendario;\n\n          let guaranteePrendario;\n\n          for (const facility of resp) {\n            let guarantee = await backendServices.consultarGarantiaPropCred(facility.facilityId);\n            guaranteePrendario = guarantee.find(prendario => prendario.guaranteeTypeName === '500');\n            if (guaranteePrendario) break;\n          }\n\n          let tipo = guaranteePrendario ? '3' : '';\n          let amount = (_guaranteePrendario$c = (_guaranteePrendario = guaranteePrendario) === null || _guaranteePrendario === void 0 ? void 0 : _guaranteePrendario.commercialValue) !== null && _guaranteePrendario$c !== void 0 ? _guaranteePrendario$c : 0;\n\n          if (tipo !== '3') {\n            var _expositionCorporativ, _expositionCorporativ2;\n\n            let expositionCorporative = await backendServices.getExposicionCorporativaBD(dataSession.transactionId);\n            let facilityCP = (_expositionCorporativ = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Corto Plazo\".toUpperCase())) !== null && _expositionCorporativ !== void 0 ? _expositionCorporativ : {\n              \"approved\": 0,\n              \"currentBalance\": 0,\n              \"ltv\": 0,\n              \"proposed\": 0,\n              \"guarantee\": 0\n            };\n            let facilityLP = (_expositionCorporativ2 = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Largo Plazo\".toUpperCase())) !== null && _expositionCorporativ2 !== void 0 ? _expositionCorporativ2 : {\n              \"approved\": 0,\n              \"currentBalance\": 0,\n              \"ltv\": 0,\n              \"proposed\": 0,\n              \"guarantee\": 0\n            };\n            let facilities = await backendServices.consultarFacilidadesExposicionCorporativa(requestId !== null && requestId !== void 0 ? requestId : '');\n            let jsonFacilidades = {\n              CP: facilities.CP.reduce((acu, crr) => acu + crr.requestAmount, 0) || 0,\n              LP: facilities.LP.reduce((acu, crr) => acu + crr.requestAmount, 0) || 0\n            };\n            let amountCP = parseFloat(facilityCP.approved) + parseFloat(jsonFacilidades.CP);\n            let amountLP = parseFloat(facilityLP.currentBalance) + parseFloat(jsonFacilidades.LP);\n            let ltvCP = facilityCP.guarantee > 0 ? parseFloat(facilityCP.proposed) / parseFloat(facilityCP.guarantee) * 100 : 0;\n            let ltvLP = facilityLP.guarantee > 0 ? parseFloat(facilityLP.proposed) / parseFloat(facilityLP.guarantee) * 100 : 0;\n            const {\n              amount: amounting,\n              ltv\n            } = amountCP > amountLP ? {\n              amount: amountCP,\n              ltv: ltvCP\n            } : {\n              amount: amountLP,\n              ltv: ltvLP\n            };\n            amount = amounting;\n            tipo = ltv >= 70 ? '1' : '2';\n          }\n\n          setLevelAutonomy({\n            tipo,\n            amount\n          });\n        }\n      });\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(React.Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n      className: \"card-title mt-2\",\n      style: {\n        textAlign: \"left\",\n        fontSize: '21px!important'\n      },\n      children: [t(\"Level of Autonomy\"), \" \", t(\"Creditt\"), \": \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 138\n      }, this), levelAutonomyPosition.credito]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n      className: \"card-title mt-2\",\n      style: {\n        textAlign: \"right\",\n        fontSize: '21px!important'\n      },\n      children: [t(\"Level of Autonomy\"), \" \", t(\"Banking\"), \": \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 139\n      }, this), levelAutonomyPosition.banca]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 131,\n    columnNumber: 5\n  }, this);\n};\n\n_s(LevelAutonomy, \"q32ct45+21x6fsQYMduHcaUn+Tk=\", false, function () {\n  return [useLocation, useHistory];\n});\n\n_c = LevelAutonomy;\nexport default withTranslation()(LevelAutonomy);\n\nvar _c;\n\n$RefreshReg$(_c, \"LevelAutonomy\");","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/CommercialCredit/5_PropuestaCredito/Secciones/LevelAutonomy.js"],"names":["React","useEffect","useState","withTranslation","PropTypes","Row","Col","Button","Label","Input","Modal","Card","CardBody","CardFooter","AvForm","AvField","translationHelpers","BackendServices","BpmServices","CoreServices","useHistory","useLocation","url","LevelAutonomy","props","t","c","levelAutonomy","setLevelAutonomy","levelAutonomyPosition","setLevelAutonomyPosition","bpmServices","backendServices","coreServices","location","history","locationData","setLocationData","dataSession","data","undefined","transactionId","length","push","URL_DASHBOARD","sessionStorage","setItem","JSON","stringify","result","getItem","parse","getFacilityHistory","amount","saveAutonomy","then","resp","banca","body","autonomiaduales","credito","catch","err","console","log","consultGeneralDataPropCred","propuesta","requestId","consultarFacilidades","guaranteePrendario","facility","guarantee","consultarGarantiaPropCred","facilityId","find","prendario","guaranteeTypeName","tipo","commercialValue","expositionCorporative","getExposicionCorporativaBD","facilityCP","x","description","toUpperCase","facilityLP","facilities","consultarFacilidadesExposicionCorporativa","jsonFacilidades","CP","reduce","acu","crr","requestAmount","LP","amountCP","parseFloat","approved","amountLP","currentBalance","ltvCP","proposed","ltvLP","amounting","ltv","textAlign","fontSize"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\"\r\nimport { withTranslation } from \"react-i18next\"\r\nimport PropTypes from 'prop-types';\r\n\r\nimport {\r\n  Row,\r\n  Col,\r\n  Button,\r\n  Label,\r\n  Input,\r\n  Modal,\r\n  Card,\r\n  CardBody,\r\n  CardFooter,\r\n} from \"reactstrap\"\r\n\r\nimport { AvForm, AvField } from \"availity-reactstrap-validation\"\r\nimport { translationHelpers } from \"../../../../helpers\";\r\nimport { BackendServices, BpmServices, CoreServices } from \"../../../../services\";\r\nimport { useHistory, useLocation } from \"react-router-dom\";\r\nimport * as url from \"../../../../helpers/url_helper\"\r\n\r\nconst LevelAutonomy = (props) => {\r\n  const [t, c] = translationHelpers('translation', 'common');\r\n  const [levelAutonomy, setLevelAutonomy] = useState(0);\r\n  const [levelAutonomyPosition, setLevelAutonomyPosition] = useState('');\r\n  const bpmServices = new BpmServices();\r\n  const backendServices = new BackendServices();\r\n  const coreServices = new CoreServices();\r\n\r\n  const location = useLocation();\r\n  const history = useHistory();\r\n  const [locationData, setLocationData] = useState(null);\r\n\r\n  useEffect(() => {\r\n\r\n    let dataSession;\r\n    if (location.data !== null && location.data !== undefined) {\r\n      if (location.data.transactionId === undefined || location.data.transactionId.length <= 0) {\r\n        //location.data.transactionId = 0;\r\n        //checkAndCreateProcedure(location.data);\r\n        history.push(url.URL_DASHBOARD);\r\n      }\r\n      else {\r\n        sessionStorage.setItem('locationData', JSON.stringify(location.data));\r\n        setLocationData(location.data);\r\n        dataSession = location.data;\r\n      }\r\n    }\r\n    else {\r\n      //chequeamos si tenemos guardado en session\r\n      var result = sessionStorage.getItem('locationData');\r\n      if (result !== undefined && result !== null) {\r\n        result = JSON.parse(result);\r\n        setLocationData(result);\r\n        dataSession = result\r\n      }\r\n    }\r\n\r\n    getFacilityHistory({ dataSession })\r\n\r\n  }, []);\r\n\r\n\r\n  useEffect(() => {\r\n    levelAutonomy?.amount > 0 && bpmServices.saveAutonomy(levelAutonomy).then(resp => {\r\n      let banca = resp?.body?.result['dmn-evaluation-result']['dmn-context']?.autonomiaduales?.banca;\r\n      let credito = resp?.body?.result['dmn-evaluation-result']['dmn-context']?.autonomiaduales?.credito;\r\n      setLevelAutonomyPosition({ banca, credito })\r\n    }).catch(err => {\r\n      console.log(err)\r\n    });\r\n  }, [levelAutonomy, props.levelAutonomy])\r\n\r\n  async function getFacilityHistory({ dataSession = locationData }) {\r\n    //guarantee prendaria code 500\r\n    await backendServices.consultGeneralDataPropCred(dataSession?.transactionId ?? 0).then(async propuesta => {\r\n      let requestId = propuesta[0]?.requestId;\r\n      backendServices.consultarFacilidades(requestId ?? '').then(async resp => {\r\n        if (resp.length > 0 && resp != undefined) {\r\n          let guaranteePrendario;\r\n          for (const facility of resp) {\r\n            let guarantee = await backendServices.consultarGarantiaPropCred(facility.facilityId)\r\n            guaranteePrendario = guarantee.find(prendario => prendario.guaranteeTypeName === '500')\r\n            if (guaranteePrendario)\r\n              break;\r\n          }\r\n          let tipo = guaranteePrendario ? '3' : '';\r\n          let amount = guaranteePrendario?.commercialValue ?? 0;\r\n\r\n          if (tipo !== '3') {\r\n            let expositionCorporative = await backendServices.getExposicionCorporativaBD(dataSession.transactionId);\r\n            let facilityCP = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Corto Plazo\".toUpperCase()) ?? {\r\n              \"approved\": 0,\r\n              \"currentBalance\": 0,\r\n              \"ltv\": 0,\r\n              \"proposed\": 0,\r\n              \"guarantee\": 0,\r\n            }\r\n            let facilityLP = expositionCorporative.find(x => x.description.toUpperCase() === \"Facilidades Largo Plazo\".toUpperCase()) ?? {\r\n              \"approved\": 0,\r\n              \"currentBalance\": 0,\r\n              \"ltv\": 0,\r\n              \"proposed\": 0,\r\n              \"guarantee\": 0,\r\n            }\r\n\r\n            let facilities = await backendServices.consultarFacilidadesExposicionCorporativa(requestId ?? '');\r\n            let jsonFacilidades = {\r\n              CP: facilities.CP.reduce((acu, crr) => (acu + crr.requestAmount), 0) || 0,\r\n              LP: facilities.LP.reduce((acu, crr) => (acu + crr.requestAmount), 0) || 0,\r\n            }\r\n            let amountCP = parseFloat(facilityCP.approved) + parseFloat(jsonFacilidades.CP);\r\n            let amountLP = parseFloat(facilityLP.currentBalance) + parseFloat(jsonFacilidades.LP);\r\n\r\n            let ltvCP = facilityCP.guarantee > 0 ? parseFloat(facilityCP.proposed) / parseFloat(facilityCP.guarantee) * 100 : 0;\r\n            let ltvLP = facilityLP.guarantee > 0 ? parseFloat(facilityLP.proposed) / parseFloat(facilityLP.guarantee) * 100 : 0;\r\n\r\n            const { amount: amounting, ltv } = amountCP > amountLP ? { amount: amountCP, ltv: ltvCP } : { amount: amountLP, ltv: ltvLP };\r\n            amount = amounting;\r\n            tipo = ltv >= 70 ? '1' : '2';\r\n\r\n          }\r\n          setLevelAutonomy({ tipo, amount })\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <h5 className=\"card-title mt-2\" style={{ textAlign: \"left\", fontSize: '21px!important' }}>{t(\"Level of Autonomy\")} {t(\"Creditt\")}: <br />{levelAutonomyPosition.credito}</h5>\r\n      <h5 className=\"card-title mt-2\" style={{ textAlign: \"right\", fontSize: '21px!important' }}>{t(\"Level of Autonomy\")} {t(\"Banking\")}: <br />{levelAutonomyPosition.banca}</h5>\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default (withTranslation()(LevelAutonomy));\r\n"]},"metadata":{},"sourceType":"module"}
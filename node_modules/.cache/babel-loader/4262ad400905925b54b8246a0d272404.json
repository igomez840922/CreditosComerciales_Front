{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{translationHelpers}from'../../../helpers/translation-helper';import{Table,Card,CardBody,Button,Col}from\"reactstrap\";import{BackendServices}from'../../../services';import{useLocation,useHistory}from'react-router-dom';import ModalNewHistoryDetail from'./ModalNewHistoryDetail';import SweetAlert from\"react-bootstrap-sweetalert\";import HeaderSections from\"../../Common/HeaderSections\";import{Link}from\"react-router-dom\";import Currency from\"../../../helpers/currency\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var History=function History(props){var _location$data;var location=useLocation();var _translationHelpers=translationHelpers('commercial_credit','common','translation'),_translationHelpers2=_slicedToArray(_translationHelpers,3),t=_translationHelpers2[0],c=_translationHelpers2[1],tr=_translationHelpers2[2];var api=new BackendServices();var editMode=props.editMode;/**\r\n   * All useState\r\n   */var _useState=useState(false),_useState2=_slicedToArray(_useState,2),displayModalNewHistoryDetail=_useState2[0],setDisplayModalNewHistoryDetail=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),dataRows=_useState4[0],setDataRows=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),totals=_useState6[0],setTotals=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),totalRow=_useState8[0],setTotalRow=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),proportions=_useState10[0],setProportions=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),proportionRow=_useState12[0],setProportionRow=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),confirm_alert=_useState14[0],setconfirm_alert=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),error_dlg=_useState16[0],seterror_dlg=_useState16[1];var _useState17=useState(null),_useState18=_slicedToArray(_useState17,2),bank=_useState18[0],setbank=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),successSave_dlg=_useState20[0],setsuccessSave_dlg=_useState20[1];var _useState21=useState(null),_useState22=_slicedToArray(_useState21,2),dataEdit=_useState22[0],setDataEdit=_useState22[1];var _useState23=useState(null),_useState24=_slicedToArray(_useState23,2),action=_useState24[0],setAction=_useState24[1];var _useState25=useState((_location$data=location.data)!==null&&_location$data!==void 0?_location$data:JSON.parse(sessionStorage.getItem('locationData'))),_useState26=_slicedToArray(_useState25,2),dataLocation=_useState26[0],setdataLocaton=_useState26[1];/**\r\n   * End All useState\r\n   */var currencyData=new Currency();var headers=[t('# days',{days:30}),t('# days',{days:60}),t('# days',{days:90}),t('# days',{days:120}),t('# days',{days:150}),t('# days',{days:180}),t('# days',{days:210}),t('# days',{days:240}),t('# days',{days:270}),t('# days',{days:300}),t('# days',{days:330}),t('+# days',{days:331}),tr('Totals')];!props.preview&&headers.push(tr('Actions'));React.useEffect(function(){getDataHistory();},[]);function calculateTotals(headers,data){var totals=new Array(headers.length);totals.fill(0,0,headers.length);headers.forEach(function(header,index){totals[index]=data.reduce(function(total,current){return total+current.data[index];},0);});return totals.filter(Boolean);}function calculateProportions(headers,data){var cols=new Array(headers.length);cols.fill(0,0,headers.length);return cols;}var dataHeaders=headers.map(function(header,index){return/*#__PURE__*/_jsx(\"th\",{className:\"text-start\",children:header},\"header-\"+index);});function getDataHistory(){var _dataLocation$transac;api.consultarDetalleAntiguedad((_dataLocation$transac=dataLocation===null||dataLocation===void 0?void 0:dataLocation.transactionId)!==null&&_dataLocation$transac!==void 0?_dataLocation$transac:0,props.debtorId).then(function(data){var mapData=data===null||data===void 0?void 0:data.map(function($$){return{data:[].concat(_toConsumableArray(Object.entries($$.details).map(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];return value;})),[$$.total])};});setDataRows(data===null||data===void 0?void 0:data.map(function(item,index){var _item$total;var key=0;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"td\",{\"data-label\":t(\"Country / Client\"),children:[item.bank,index]},index),Object.entries(item.details).map(function(_ref3){var _ref4=_slicedToArray(_ref3,2),data=_ref4[0],col=_ref4[1];return/*#__PURE__*/_jsx(\"td\",{\"data-label\":headers[key],className:\"text-end\",children:currencyData.format(col!==null&&col!==void 0?col:0)},\"col-\"+key++);}),/*#__PURE__*/_jsx(\"td\",{\"data-label\":tr('Totals'),className:\"text-end\",children:currencyData.format((_item$total=item.total)!==null&&_item$total!==void 0?_item$total:0)}),!props.preview&&/*#__PURE__*/_jsxs(\"td\",{\"data-label\":t(\"Actions\"),style:{textAlign:\"right\"},children:[/*#__PURE__*/_jsx(Button,{type:\"button\",color:\"link\",onClick:function onClick(resp){editData(item);},className:\"btn btn-link\",children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-border-color mdi-24px\"})}),/*#__PURE__*/_jsx(Button,{type:\"button\",color:\"link\",onClick:function onClick(resp){deleteData(item.bank);},className:\"btn btn-link\",children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-trash-can-outline mdi-24px\"})})]})]},'row-'+index);}));// Calculate total\nvar totals=calculateTotals(headers,mapData);setTotalRow(/*#__PURE__*/_jsxs(\"tr\",{className:\"table-info\",children:[/*#__PURE__*/_jsx(\"th\",{children:t(\"Total\").toLocaleUpperCase()}),totals.map(function(val,index){if(!val)return;return/*#__PURE__*/_jsx(\"th\",{className:\"text-start\",children:currencyData.format(val!==null&&val!==void 0?val:0)},index);}),!props.preview&&/*#__PURE__*/_jsx(\"th\",{})]}));// Calculate proportions\nvar proportions=calculateProportions(headers,mapData);setProportionRow(/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:t(\"Proportion\").toLocaleUpperCase()}),proportions.map(function(val,index){return/*#__PURE__*/_jsx(\"td\",{className:\"text-start\",children:val},index);})]}));});}function toggleModalNewHistoryItem(){setDisplayModalNewHistoryDetail(!displayModalNewHistoryDetail);}function onSave(_x){return _onSave.apply(this,arguments);}function _onSave(){_onSave=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:values={details:values,transactId:dataLocation.transactionId,personId:props.debtorId,total:values.totals,percentage:values.totals/(headers.length-2),bank:values.bank};delete values.details.bank;delete values.details.totals;_context.t0=action=='edit';if(!_context.t0){_context.next=7;break;}_context.next=7;return api.actualizarDetalleAntiguedad(values).then(function(resp){if(resp.statusCode==\"500\"||undefined){seterror_dlg(true);}else{setsuccessSave_dlg(true);}}).catch(function(err){seterror_dlg(true);});case 7:_context.t1=action=='new';if(!_context.t1){_context.next=11;break;}_context.next=11;return api.nuevoDetalleAntiguedad(values).then(function(resp){if(resp.statusCode==\"500\"||undefined){seterror_dlg(true);}else{setsuccessSave_dlg(true);}}).catch(function(err){seterror_dlg(true);});case 11:getDataHistory();case 12:case\"end\":return _context.stop();}}},_callee);}));return _onSave.apply(this,arguments);}function editData(data){setDataEdit(data);toggleModalNewHistoryItem();setAction('edit');}function deleteData(bank){setbank(bank);setconfirm_alert(true);}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(HeaderSections,{title:\"History Details\",t:t}),/*#__PURE__*/_jsx(\"p\",{className:\"card-title-desc\"}),!props.preview&&/*#__PURE__*/_jsx(Col,{md:\"12\",style:{textAlign:\"right\"},children:/*#__PURE__*/_jsxs(Button,{className:\"btn\",color:\"success\",type:\"button\",style:{margin:'5px'},onClick:function onClick(){setAction('new');toggleModalNewHistoryItem();setDataEdit(null);},title:t(\"Add\"),children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-lg fa-plus-circle\"}),\" \",\" \"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive styled-table-div mt-2\",children:/*#__PURE__*/_jsxs(Table,{className:\"table table-striped table-hover styled-table table mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:t(\"Country / Client\")}),dataHeaders]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[dataRows,(dataRows===null||dataRows===void 0?void 0:dataRows.length)>0&&totalRow]})]})}),/*#__PURE__*/_jsx(ModalNewHistoryDetail,{dataEdit:dataEdit,setAction:setAction,isOpen:displayModalNewHistoryDetail,toggle:toggleModalNewHistoryItem,onSave:onSave}),confirm_alert?/*#__PURE__*/_jsx(SweetAlert,{title:tr(\"Areyousure\"),warning:true,showCancel:true,confirmButtonText:tr(\"Yesdeleteit\"),cancelButtonText:tr(\"Cancel\"),confirmBtnBsStyle:\"success\",cancelBtnBsStyle:\"danger\",onConfirm:function onConfirm(){var apiBack=new BackendServices();apiBack.eliminarDetalleAntiguedad(dataLocation.transactionId,props.debtorId,bank).then(function(resp){if(resp.statusCode==\"500\"||undefined){setconfirm_alert(false);seterror_dlg(true);}else{setconfirm_alert(false);setsuccessSave_dlg(true);}getDataHistory();}).catch(function(error){setconfirm_alert(false);seterror_dlg(true);});},onCancel:function onCancel(){return setconfirm_alert(false);},children:tr(\"Youwontbeabletorevertthis\")}):null,successSave_dlg?/*#__PURE__*/_jsx(SweetAlert,{success:true,title:t(\"SuccessDialog\"),confirmButtonText:t(\"Confirm\"),cancelButtonText:t(\"Cancel\"),onConfirm:function onConfirm(){setsuccessSave_dlg(false);getDataHistory();},children:t(\"SuccessSaveMessage\")}):null,error_dlg?/*#__PURE__*/_jsx(SweetAlert,{error:true,title:t(\"ErrorDialog\"),confirmButtonText:t(\"Confirm\"),cancelButtonText:t(\"Cancel\"),onConfirm:function onConfirm(){seterror_dlg(false);getDataHistory();}}):null]});};History.defaultProps={editMode:false};export default History;","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/components/PropuestaCreditoComercial/financialSummary/History.js"],"names":["React","useEffect","useState","translationHelpers","Table","Card","CardBody","Button","Col","BackendServices","useLocation","useHistory","ModalNewHistoryDetail","SweetAlert","HeaderSections","Link","Currency","History","props","location","t","c","tr","api","editMode","displayModalNewHistoryDetail","setDisplayModalNewHistoryDetail","dataRows","setDataRows","totals","setTotals","totalRow","setTotalRow","proportions","setProportions","proportionRow","setProportionRow","confirm_alert","setconfirm_alert","error_dlg","seterror_dlg","bank","setbank","successSave_dlg","setsuccessSave_dlg","dataEdit","setDataEdit","action","setAction","data","JSON","parse","sessionStorage","getItem","dataLocation","setdataLocaton","currencyData","headers","days","preview","push","getDataHistory","calculateTotals","Array","length","fill","forEach","header","index","reduce","total","current","filter","Boolean","calculateProportions","cols","dataHeaders","map","consultarDetalleAntiguedad","transactionId","debtorId","then","mapData","$$","Object","entries","details","key","value","item","col","format","textAlign","resp","editData","deleteData","toLocaleUpperCase","val","toggleModalNewHistoryItem","onSave","values","transactId","personId","percentage","actualizarDetalleAntiguedad","statusCode","undefined","catch","err","nuevoDetalleAntiguedad","margin","apiBack","eliminarDetalleAntiguedad","error","defaultProps"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\"\r\nimport PropTypes from 'prop-types';\r\nimport { translationHelpers } from '../../../helpers/translation-helper';\r\n\r\nimport {\r\n  Table,\r\n  Card,\r\n  CardBody,\r\n  Button,\r\n  Col\r\n} from \"reactstrap\"\r\nimport { BackendServices } from '../../../services';\r\nimport { useLocation, useHistory } from 'react-router-dom'\r\nimport ModalNewHistoryDetail from './ModalNewHistoryDetail';\r\nimport SweetAlert from \"react-bootstrap-sweetalert\";\r\nimport HeaderSections from \"../../Common/HeaderSections\";\r\nimport { Link } from \"react-router-dom\";\r\nimport Currency from \"../../../helpers/currency\";\r\n\r\n\r\nconst History = (props) => {\r\n  const location = useLocation();\r\n\r\n  const [t, c, tr] = translationHelpers('commercial_credit', 'common', 'translation');\r\n\r\n  const api = new BackendServices();\r\n\r\n\r\n  const { editMode } = props;\r\n\r\n  /**\r\n   * All useState\r\n   */\r\n  const [displayModalNewHistoryDetail, setDisplayModalNewHistoryDetail] = useState(false);\r\n  const [dataRows, setDataRows] = useState(null);\r\n  const [totals, setTotals] = useState(null);\r\n  const [totalRow, setTotalRow] = useState(null);\r\n  const [proportions, setProportions] = useState(null);\r\n  const [proportionRow, setProportionRow] = useState(null);\r\n  const [confirm_alert, setconfirm_alert] = useState(false);\r\n  const [error_dlg, seterror_dlg] = useState(false);\r\n  const [bank, setbank] = useState(null);\r\n  const [successSave_dlg, setsuccessSave_dlg] = useState(false);\r\n  const [dataEdit, setDataEdit] = useState(null);\r\n  const [action, setAction] = useState(null);\r\n  const [dataLocation, setdataLocaton] = useState(location.data ?? JSON.parse(sessionStorage.getItem('locationData')));\r\n  /**\r\n   * End All useState\r\n   */\r\n\r\n  const currencyData = new Currency();\r\n\r\n  const headers = [\r\n    t('# days', { days: 30 }),\r\n    t('# days', { days: 60 }),\r\n    t('# days', { days: 90 }),\r\n    t('# days', { days: 120 }),\r\n    t('# days', { days: 150 }),\r\n    t('# days', { days: 180 }),\r\n    t('# days', { days: 210 }),\r\n    t('# days', { days: 240 }),\r\n    t('# days', { days: 270 }),\r\n    t('# days', { days: 300 }),\r\n    t('# days', { days: 330 }),\r\n    t('+# days', { days: 331 }),\r\n    tr('Totals')\r\n  ]\r\n\r\n  !props.preview && headers.push(tr('Actions'));\r\n\r\n\r\n  React.useEffect(() => {\r\n    getDataHistory();\r\n  }, []);\r\n\r\n  function calculateTotals(headers, data) {\r\n    const totals = new Array(headers.length);\r\n    totals.fill(0, 0, headers.length);\r\n    headers.forEach((header, index) => {\r\n      totals[index] = data.reduce((total, current) => {\r\n        return total + current.data[index];\r\n      }, 0);\r\n    });\r\n    return totals.filter(Boolean);\r\n  }\r\n\r\n  function calculateProportions(headers, data) {\r\n    const cols = new Array(headers.length);\r\n    cols.fill(0, 0, headers.length);\r\n    return cols;\r\n  }\r\n  const dataHeaders = headers.map((header, index) => (\r\n    <th key={\"header-\" + index} className=\"text-start\">{header}</th>\r\n  ));\r\n\r\n  function getDataHistory() {\r\n    api.consultarDetalleAntiguedad(dataLocation?.transactionId ?? 0, props.debtorId).then((data) => {\r\n\r\n      let mapData = data?.map($$ => ({ data: [...Object.entries($$.details).map(([key, value]) => value), $$.total] }));\r\n\r\n      setDataRows(data?.map((item, index) => {\r\n        let key = 0;\r\n        return (\r\n          <tr key={'row-' + index}>\r\n            <td data-label={t(\"Country / Client\")} key={index}>{item.bank}{index}</td>\r\n            {Object.entries(item.details).map(([data, col]) => (\r\n              <td key={\"col-\" + key++} data-label={headers[key]} className=\"text-end\">{currencyData.format(col ?? 0)}</td>\r\n            ))}\r\n            <td data-label={tr('Totals')} className=\"text-end\">{currencyData.format(item.total ?? 0)}</td>\r\n            {!props.preview && <td data-label={t(\"Actions\")} style={{ textAlign: \"right\" }}>\r\n              <Button type=\"button\" color=\"link\" onClick={(resp) => {\r\n                editData(item)\r\n              }} className=\"btn btn-link\" ><i className=\"mdi mdi-border-color mdi-24px\"></i></Button>\r\n              <Button type=\"button\" color=\"link\" onClick={(resp) => {\r\n                deleteData(item.bank)\r\n              }} className=\"btn btn-link\" ><i className=\"mdi mdi-trash-can-outline mdi-24px\"></i></Button>\r\n            </td>}\r\n          </tr>)\r\n      }\r\n      ));\r\n      // Calculate total\r\n      let totals = (calculateTotals(headers, mapData));\r\n      setTotalRow(\r\n        <tr className=\"table-info\">\r\n          <th>{t(\"Total\").toLocaleUpperCase()}</th>\r\n          {totals.map((val, index) => {\r\n            if (!val)\r\n              return;\r\n            return (\r\n              <th key={index} className=\"text-start\">{currencyData.format(val ?? 0)}</th>\r\n            );\r\n          })}\r\n          {!props.preview && <th></th>}\r\n        </tr>\r\n      );\r\n\r\n      // Calculate proportions\r\n      let proportions = (calculateProportions(headers, mapData));\r\n      setProportionRow(\r\n        <tr>\r\n          <td>{t(\"Proportion\").toLocaleUpperCase()}</td>\r\n          {proportions.map((val, index) => (\r\n            <td key={index} className=\"text-start\">{val}</td>\r\n          ))}\r\n        </tr>\r\n      );\r\n    })\r\n\r\n\r\n  }\r\n\r\n  function toggleModalNewHistoryItem() {\r\n    setDisplayModalNewHistoryDetail(!displayModalNewHistoryDetail);\r\n  }\r\n\r\n  async function onSave(values) {\r\n\r\n    values = { details: values, transactId: dataLocation.transactionId, personId: props.debtorId, total: values.totals, percentage: (values.totals / (headers.length - 2)), bank: values.bank }\r\n    delete values.details.bank\r\n    delete values.details.totals\r\n    action == 'edit' && await api.actualizarDetalleAntiguedad(values).then(resp => {\r\n      if (resp.statusCode == \"500\" || undefined) {\r\n        seterror_dlg(true)\r\n      } else {\r\n        setsuccessSave_dlg(true)\r\n      }\r\n    }).catch(err => {\r\n      seterror_dlg(true)\r\n    });\r\n\r\n    action == 'new' && await api.nuevoDetalleAntiguedad(values).then(resp => {\r\n      if (resp.statusCode == \"500\" || undefined) {\r\n        seterror_dlg(true)\r\n      } else {\r\n        setsuccessSave_dlg(true)\r\n      }\r\n    }).catch(err => {\r\n      seterror_dlg(true)\r\n    });\r\n\r\n    getDataHistory();\r\n  }\r\n\r\n  function editData(data) {\r\n    setDataEdit(data);\r\n    toggleModalNewHistoryItem();\r\n    setAction('edit');\r\n  }\r\n\r\n  function deleteData(bank) {\r\n    setbank(bank);\r\n    setconfirm_alert(true);\r\n  }\r\n  return (\r\n    <>\r\n      <HeaderSections title=\"History Details\" t={t}></HeaderSections>\r\n      <p className=\"card-title-desc\"></p>\r\n      {!props.preview && <Col md=\"12\" style={{ textAlign: \"right\" }}>\r\n        <Button className=\"btn\" color=\"success\" type=\"button\" style={{ margin: '5px' }} onClick={() => { setAction('new'); toggleModalNewHistoryItem(); setDataEdit(null); }} title={t(\"Add\")}><i className=\"fas fa-lg fa-plus-circle\"></i> {(\" \")}</Button>\r\n      </Col>}\r\n      <div className=\"table-responsive styled-table-div mt-2\">\r\n        <Table className=\"table table-striped table-hover styled-table table mb-0\">\r\n          <thead>\r\n            <tr>\r\n              <th>{t(\"Country / Client\")}</th>\r\n              {dataHeaders}\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {dataRows}\r\n            {dataRows?.length > 0 && totalRow}\r\n            {/* {proportionRow} */}\r\n          </tbody>\r\n        </Table>\r\n      </div>\r\n      <ModalNewHistoryDetail dataEdit={dataEdit} setAction={setAction} isOpen={displayModalNewHistoryDetail} toggle={toggleModalNewHistoryItem} onSave={onSave} />\r\n\r\n      {confirm_alert ? (\r\n        <SweetAlert\r\n          title={tr(\"Areyousure\")}\r\n          warning\r\n          showCancel\r\n          confirmButtonText={tr(\"Yesdeleteit\")}\r\n          cancelButtonText={tr(\"Cancel\")}\r\n          confirmBtnBsStyle=\"success\"\r\n          cancelBtnBsStyle=\"danger\"\r\n          onConfirm={() => {\r\n            const apiBack = new BackendServices();\r\n            apiBack.eliminarDetalleAntiguedad(dataLocation.transactionId, props.debtorId, bank).then(resp => {\r\n              if (resp.statusCode == \"500\" || undefined) {\r\n                setconfirm_alert(false)\r\n                seterror_dlg(true)\r\n              } else {\r\n                setconfirm_alert(false)\r\n                setsuccessSave_dlg(true)\r\n              }\r\n              getDataHistory();\r\n            }).catch(error => {\r\n              setconfirm_alert(false)\r\n              seterror_dlg(true)\r\n            })\r\n          }}\r\n          onCancel={() => setconfirm_alert(false)}\r\n        >\r\n          {tr(\"Youwontbeabletorevertthis\")}\r\n        </SweetAlert>\r\n      ) : null}\r\n\r\n      {successSave_dlg ? (\r\n        <SweetAlert\r\n          success\r\n          title={t(\"SuccessDialog\")}\r\n          confirmButtonText={t(\"Confirm\")}\r\n          cancelButtonText={t(\"Cancel\")}\r\n          onConfirm={() => {\r\n            setsuccessSave_dlg(false)\r\n            getDataHistory();\r\n          }}\r\n        >\r\n          {t(\"SuccessSaveMessage\")}\r\n        </SweetAlert>\r\n      ) : null}\r\n\r\n      {error_dlg ? (\r\n        <SweetAlert\r\n          error\r\n          title={t(\"ErrorDialog\")}\r\n          confirmButtonText={t(\"Confirm\")}\r\n          cancelButtonText={t(\"Cancel\")}\r\n          onConfirm={() => {\r\n            seterror_dlg(false)\r\n            getDataHistory();\r\n          }}\r\n        >\r\n          { }\r\n        </SweetAlert>\r\n      ) : null}\r\n    </>\r\n  );\r\n};\r\n\r\nHistory.propTypes = {\r\n  title: PropTypes.string,\r\n  headers: PropTypes.array.isRequired,\r\n  data: PropTypes.array.isRequired,\r\n  editMode: PropTypes.bool,\r\n  addHistoryDetail: PropTypes.func\r\n};\r\n\r\nHistory.defaultProps = {\r\n  editMode: false\r\n};\r\n\r\n\r\nexport default History;\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _objectSpread from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import moment from\"moment\";import{BackendServices,CoreServices,BpmServices}from\"../../../../services\";var previewEscrow=/*#__PURE__*/function(){function previewEscrow(dataSession){_classCallCheck(this,previewEscrow);this.backendServices=new BackendServices();this.bpmServices=new BpmServices();this.validateRoute=false;this.flowType=[{Code:'1',Description:'Muy Urgente'},{Code:'2',Description:'Urgencia Moderada'},{Code:'3',Description:'Importante'},{Code:'4',Description:'Baja Urgencia'},{Code:'5',Description:'Sin Urgencia'}];// super();\nthis.saveDataSession(dataSession);}_createClass(previewEscrow,[{key:\"saveDataSession\",value:function saveDataSession(dataSession){var _this$location,_this$location2;sessionStorage.setItem('locationData',JSON.stringify(dataSession));if(((_this$location=this.location)===null||_this$location===void 0?void 0:_this$location.data)!==null&&((_this$location2=this.location)===null||_this$location2===void 0?void 0:_this$location2.data)!==undefined){var _this$location3,_this$location4;if(((_this$location3=this.location)===null||_this$location3===void 0?void 0:_this$location3.data.transactionId)===undefined||((_this$location4=this.location)===null||_this$location4===void 0?void 0:_this$location4.data.transactionId.length)<=0){//this.location?.data.transactionId = 0;\n//checkAndCreateProcedure(this.location?.data);\nthis.validateRoute=true;}else{var _this$location5,_this$location6,_this$location7;sessionStorage.setItem('this.locationData',JSON.stringify((_this$location5=this.location)===null||_this$location5===void 0?void 0:_this$location5.data));this.locationData=(_this$location6=this.location)===null||_this$location6===void 0?void 0:_this$location6.data;this.dataSession=(_this$location7=this.location)===null||_this$location7===void 0?void 0:_this$location7.data;}}else{//chequeamos si tenemos guardado en session\nvar result=sessionStorage.getItem('locationData');if(result!==undefined&&result!==null){result=JSON.parse(result);this.locationData=result;this.dataSession=result;}}this.LoadNumeroFideicomiso();this.loadCustomerID();this.loadDataGeneral();this.loadDataIGR();this.loadDataEnvironmentAspects();}},{key:\"LoadFiduciario\",value:function(){var _LoadFiduciario=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.backendServices.consultarSeccionServiciosFiduciario(this.locationData.transactionId);case 2:return _context.abrupt(\"return\",_context.sent);case 3:case\"end\":return _context.stop();}}},_callee,this);}));function LoadFiduciario(){return _LoadFiduciario.apply(this,arguments);}return LoadFiduciario;}()},{key:\"LoadOtherFiduciario\",value:function LoadOtherFiduciario(){return this.backendServices.consultarSeccionOtrosServiciosFiduciario(this.locationData.transactionId);}},{key:\"LoadNumeroFideicomiso\",value:function(){var _LoadNumeroFideicomiso=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return this.backendServices.consultarNumeroFideicomiso(this.locationData.transactionId).then(function(resp){return resp[0].trustName;});case 2:this.basaFid=_context2.sent;case 3:case\"end\":return _context2.stop();}}},_callee2,this);}));function LoadNumeroFideicomiso(){return _LoadNumeroFideicomiso.apply(this,arguments);}return LoadNumeroFideicomiso;}()},{key:\"loadCustomerID\",value:function(){var _loadCustomerID=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this.backendServices.consultPrincipalDebtor(this.locationData.transactionId).then(function(resp){return resp.customerNumberT24;});case 2:this.customerID=_context3.sent;case 3:case\"end\":return _context3.stop();}}},_callee3,this);}));function loadCustomerID(){return _loadCustomerID.apply(this,arguments);}return loadCustomerID;}()},{key:\"loadDataGeneral\",value:function(){var _loadDataGeneral=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _this=this;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this.backendServices.consultGeneralDataPropCred(this.locationData.transactionId).then(function(resp){var _this$flowType$find;return _objectSpread(_objectSpread({},resp[0]),{},{requestDate:_this.formatDate(resp[0].requestDate),lastRequestDate:_this.formatDate(resp[0].lastRequestDate),nextRevisionDate:_this.formatDate(resp[0].nextRevisionDate),proposedExpirationDate:_this.formatDate(resp[0].proposedExpirationDate),flow:(_this$flowType$find=_this.flowType.find(function(flowType){return flowType.Code===resp[0].flow;}))===null||_this$flowType$find===void 0?void 0:_this$flowType$find.Description});});case 2:this.dataGeneral=_context4.sent;case 3:case\"end\":return _context4.stop();}}},_callee4,this);}));function loadDataGeneral(){return _loadDataGeneral.apply(this,arguments);}return loadDataGeneral;}()},{key:\"loadDataIGR\",value:function(){var _loadDataIGR=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return this.backendServices.consultGeneralDataIGR(this.locationData.transactionId);case 2:this.dataGeneralIGR=_context5.sent;case 3:case\"end\":return _context5.stop();}}},_callee5,this);}));function loadDataIGR(){return _loadDataIGR.apply(this,arguments);}return loadDataIGR;}()},{key:\"loadDataEnvironmentAspects\",value:function(){var _loadDataEnvironmentAspects=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return this.backendServices.consultEnvironmentalAspectsIGR(this.locationData.transactionId).then(function(resp){return resp.environmentalAspectsDTO;});case 2:this.dataGeneralEnvironmentAspects=_context6.sent;case 3:case\"end\":return _context6.stop();}}},_callee6,this);}));function loadDataEnvironmentAspects(){return _loadDataEnvironmentAspects.apply(this,arguments);}return loadDataEnvironmentAspects;}()},{key:\"saveAutonomy\",value:function(){var _saveAutonomy=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(levelAutonomy){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return this.bpmServices.saveAutonomy(levelAutonomy).then(function(resp){return resp.body.result['dmn-evaluation-result']['dmn-context'].autonomia.cargo;}).catch(function(err){console.log(err);});case 2:return _context7.abrupt(\"return\",_context7.sent);case 3:case\"end\":return _context7.stop();}}},_callee7,this);}));function saveAutonomy(_x){return _saveAutonomy.apply(this,arguments);}return saveAutonomy;}()},{key:\"getFacilityHistory\",value:function(){var _getFacilityHistory=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(){var _this2=this;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:return _context11.abrupt(\"return\",new Promise(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(resolve,reject){var _this2$locationData$t,_this2$locationData;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return _this2.backendServices.consultGeneralDataPropCred((_this2$locationData$t=(_this2$locationData=_this2.locationData)===null||_this2$locationData===void 0?void 0:_this2$locationData.transactionId)!==null&&_this2$locationData$t!==void 0?_this2$locationData$t:0).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(propuesta){var _propuesta$;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_this2.backendServices.consultarFacilidadesT24((_propuesta$=propuesta[0])===null||_propuesta$===void 0?void 0:_propuesta$.requestId).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(resp){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:if(resp.length>0&&resp!=undefined){resolve(+resp.reduce(function(acc,crr){return acc+crr.amount;},0));}case 1:case\"end\":return _context8.stop();}}},_callee8);}));return function(_x5){return _ref3.apply(this,arguments);};}());_this2.backendServices.consultarFacilidades(propuesta[0].requestId).then(function(resp){var _resp;resp=(_resp=resp)===null||_resp===void 0?void 0:_resp.filter(function(data){return data.debtor!=\"  \";});console.log('facilidad2',resp);if(resp.length>0){resolve(+resp.reduce(function(acc,crr){return acc+crr.amount;},0));}});case 2:case\"end\":return _context9.stop();}}},_callee9);}));return function(_x4){return _ref2.apply(this,arguments);};}());case 2:case\"end\":return _context10.stop();}}},_callee10);}));return function(_x2,_x3){return _ref.apply(this,arguments);};}()));case 1:case\"end\":return _context11.stop();}}},_callee11);}));function getFacilityHistory(){return _getFacilityHistory.apply(this,arguments);}return getFacilityHistory;}()},{key:\"formatDate\",value:function formatDate(date){return date?moment(date).format(\"DD/MM/YYYY\"):'';}}]);return previewEscrow;}();export{previewEscrow as default};","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/CommercialCredit/10_Fideicomiso/Relacionfiduciaria/preview.model.js"],"names":["moment","BackendServices","CoreServices","BpmServices","previewEscrow","dataSession","backendServices","bpmServices","validateRoute","flowType","Code","Description","saveDataSession","sessionStorage","setItem","JSON","stringify","location","data","undefined","transactionId","length","locationData","result","getItem","parse","LoadNumeroFideicomiso","loadCustomerID","loadDataGeneral","loadDataIGR","loadDataEnvironmentAspects","consultarSeccionServiciosFiduciario","consultarSeccionOtrosServiciosFiduciario","consultarNumeroFideicomiso","then","resp","trustName","basaFid","consultPrincipalDebtor","customerNumberT24","customerID","consultGeneralDataPropCred","requestDate","formatDate","lastRequestDate","nextRevisionDate","proposedExpirationDate","flow","find","dataGeneral","consultGeneralDataIGR","dataGeneralIGR","consultEnvironmentalAspectsIGR","environmentalAspectsDTO","dataGeneralEnvironmentAspects","levelAutonomy","saveAutonomy","body","autonomia","cargo","catch","err","console","log","Promise","resolve","reject","propuesta","consultarFacilidadesT24","requestId","reduce","acc","crr","amount","consultarFacilidades","filter","debtor","date","format"],"mappings":"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","sourcesContent":["import moment from \"moment\";\r\nimport { BackendServices, CoreServices, BpmServices } from \"../../../../services\";\r\n\r\nexport default class previewEscrow {\r\n\r\n    backendServices = new BackendServices();\r\n    bpmServices = new BpmServices();\r\n    serviciosFiduciario;\r\n    otherServiciosFiduciario;\r\n    locationData;\r\n    basaFid;\r\n    dataSession;\r\n    validateRoute = false;\r\n    customerID;\r\n    dataGeneral;\r\n    dataGeneralIGR;\r\n    dataGeneralEnvironmentAspects;\r\n    levelAutonomy;\r\n\r\n    flowType = [{ Code: '1', Description: 'Muy Urgente' }, { Code: '2', Description: 'Urgencia Moderada' }, { Code: '3', Description: 'Importante' }, { Code: '4', Description: 'Baja Urgencia' }, { Code: '5', Description: 'Sin Urgencia' }]\r\n\r\n\r\n    constructor(dataSession) {\r\n        // super();\r\n        this.saveDataSession(dataSession)\r\n    }\r\n\r\n    saveDataSession(dataSession) {\r\n        sessionStorage.setItem('locationData', JSON.stringify(dataSession));\r\n        if (this.location?.data !== null && this.location?.data !== undefined) {\r\n            if (this.location?.data.transactionId === undefined || this.location?.data.transactionId.length <= 0) {\r\n                //this.location?.data.transactionId = 0;\r\n                //checkAndCreateProcedure(this.location?.data);\r\n                this.validateRoute = true\r\n            }\r\n            else {\r\n                sessionStorage.setItem('this.locationData', JSON.stringify(this.location?.data));\r\n                this.locationData = this.location?.data;\r\n                this.dataSession = this.location?.data;\r\n            }\r\n        }\r\n        else {\r\n            //chequeamos si tenemos guardado en session\r\n            var result = sessionStorage.getItem('locationData');\r\n            if (result !== undefined && result !== null) {\r\n                result = JSON.parse(result);\r\n                this.locationData = result;\r\n                this.dataSession = result;\r\n            }\r\n        }\r\n        this.LoadNumeroFideicomiso();\r\n        this.loadCustomerID();\r\n        this.loadDataGeneral();\r\n        this.loadDataIGR();\r\n        this.loadDataEnvironmentAspects();\r\n    }\r\n\r\n    async LoadFiduciario() {\r\n        return await this.backendServices.consultarSeccionServiciosFiduciario(this.locationData.transactionId);\r\n    }\r\n\r\n    LoadOtherFiduciario() {\r\n        return this.backendServices.consultarSeccionOtrosServiciosFiduciario(this.locationData.transactionId);\r\n    }\r\n\r\n    async LoadNumeroFideicomiso() {\r\n        this.basaFid = await this.backendServices.consultarNumeroFideicomiso(this.locationData.transactionId).then(resp => resp[0].trustName);\r\n    }\r\n\r\n    async loadCustomerID() {\r\n        this.customerID = await this.backendServices.consultPrincipalDebtor(this.locationData.transactionId).then(resp => resp.customerNumberT24);\r\n    }\r\n\r\n    async loadDataGeneral() {\r\n        this.dataGeneral = await this.backendServices.consultGeneralDataPropCred(this.locationData.transactionId).then(resp => ({ ...resp[0], requestDate: this.formatDate(resp[0].requestDate), lastRequestDate: this.formatDate(resp[0].lastRequestDate), nextRevisionDate: this.formatDate(resp[0].nextRevisionDate), proposedExpirationDate: this.formatDate(resp[0].proposedExpirationDate), flow: this.flowType.find(flowType => flowType.Code === resp[0].flow)?.Description }));\r\n    }\r\n\r\n    async loadDataIGR() {\r\n        this.dataGeneralIGR = await this.backendServices.consultGeneralDataIGR(this.locationData.transactionId);\r\n    }\r\n    async loadDataEnvironmentAspects() {\r\n        this.dataGeneralEnvironmentAspects = await this.backendServices.consultEnvironmentalAspectsIGR(this.locationData.transactionId).then(resp => resp.environmentalAspectsDTO)\r\n    }\r\n\r\n\r\n    async saveAutonomy(levelAutonomy) {\r\n        return await this.bpmServices.saveAutonomy(levelAutonomy).then(resp => resp.body.result['dmn-evaluation-result']['dmn-context'].autonomia.cargo).catch(err => {\r\n            console.log(err)\r\n        });\r\n    }\r\n\r\n\r\n    async getFacilityHistory() {\r\n        return new Promise(async (resolve, reject) => {\r\n            await this.backendServices.consultGeneralDataPropCred(this.locationData?.transactionId ?? 0).then(async propuesta => {\r\n                this.backendServices.consultarFacilidadesT24(propuesta[0]?.requestId).then(async resp => {\r\n                    if (resp.length > 0 && resp != undefined) {\r\n                        resolve(+resp.reduce((acc, crr) => acc + crr.amount, 0))\r\n                    }\r\n                });\r\n                this.backendServices.consultarFacilidades(propuesta[0].requestId).then(resp => {\r\n                    resp = resp?.filter(data => data.debtor != \"  \");\r\n                    console.log('facilidad2', resp)\r\n                    if (resp.length > 0) {\r\n                        resolve(+resp.reduce((acc, crr) => acc + crr.amount, 0));\r\n                    }\r\n                });\r\n            })\r\n        })\r\n    }\r\n\r\n    formatDate(date) {\r\n        return date ? moment(date).format(\"DD/MM/YYYY\") : '';\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}
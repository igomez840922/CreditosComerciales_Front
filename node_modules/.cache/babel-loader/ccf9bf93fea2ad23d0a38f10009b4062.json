{"ast":null,"code":"import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{withTranslation}from\"react-i18next\";import{Link}from\"react-router-dom\";import{Table,Card,CardBody,Pagination,PaginationItem,PaginationLink,CardFooter,Button,Row,Col}from\"reactstrap\";import ApiServicesDetalleDocumentacion from'../../../../services/DocumentacionLegal/ApiServicesDetalleDocumentacion';import{BpmServices,BackendServices}from\"../../../../services\";import{useLocation,useHistory}from\"react-router-dom\";import*as url from\"../../../../helpers/url_helper\";import ModalComentarioDocumentacion from\"./ModalComentario\";import moment from'moment';import SweetAlert from\"react-bootstrap-sweetalert\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ResultadosBusqueda=function ResultadosBusqueda(props){var apiServiceBackend=new BackendServices();var location=useLocation();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),openModalRiesgo=_useState2[0],setopenModalRiesgo=_useState2[1];var _useState3=useState({\"processDocumentId\":0,\"transactId\":0,\"legalDocumentId\":0,\"legalDocumentDescription\":\"\",\"description\":\"\",\"status\":true}),_useState4=_slicedToArray(_useState3,2),dataSet=_useState4[0],setdataSet=_useState4[1];/**\r\n   * All useState\r\n   */var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),dataRows=_useState6[0],setdataRows=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),messageNotAvailable=_useState8[0],setmessageNotAvailable=_useState8[1];/**\r\n   * End All useSate\r\n   */var jsonCond=['rotary','commercialLoan','multipleRotary','rotaryNumber','overdraft','transfer','bail','trust','agroPawn','naturalBail','legalBail','crossedLegalBail','crossedNaturalBail','promiseLetter','privateRecord','trustRecord','loanGuarantees','fiduciaryLine','prefinance'];var _useState9=useState(location.data),_useState10=_slicedToArray(_useState9,2),locationData=_useState10[0],setLocationData=_useState10[1];var history=useHistory();React.useEffect(function(){var dataSession;if(location.data!==null&&location.data!==undefined){if(location.data.transactionId===undefined||location.data.transactionId.length<=0){//location.data.transactionId = 0;\n//checkAndCreateProcedure(location.data);\nhistory.push(url.URL_DASHBOARD);}else{sessionStorage.setItem('locationData',JSON.stringify(location.data));setLocationData(location.data);dataSession=location.data;}}else{//chequeamos si tenemos guardado en session\nvar result=sessionStorage.getItem('locationData');if(result!==undefined&&result!==null){result=JSON.parse(result);setLocationData(result);dataSession=result;}}console.log('location');locationData&&searchData();},[!locationData]);function capitalizarPrimeraLetra(str){return str.charAt(0).toUpperCase()+str.slice(1);}function actuaizarDocumentacion(data){var _data$comments,_dataSet$processDocum,_dataSet$transactId,_dataSet$legalDocumen,_dataSet$legalDocumen2,_dataSet$date,_dataSet$physical,_dataSet$received,_data$comments2,_dataSet$status;// let jsonSet = {\n//   \"processDocumentId\": Number(dataSet?.processDocumentId ?? 0),\n//   \"transactId\": Number(locationData.transactionId),\n//   \"legalDocumentId\": Number(dataSet?.legalDocumentId ?? 0),\n//   \"legalDocumentDescription\": dataSet?.legalDocumentDescription ?? \"\",\n//   \"description\": data?.description ?? \"\",\n//   \"status\": true\n// }\ndataSet.comments=(_data$comments=data===null||data===void 0?void 0:data.comments)!==null&&_data$comments!==void 0?_data$comments:\" \";dataSet.transactId=Number(locationData.transactionId);console.log(dataSet);var dato={processDocumentId:(_dataSet$processDocum=dataSet===null||dataSet===void 0?void 0:dataSet.processDocumentId)!==null&&_dataSet$processDocum!==void 0?_dataSet$processDocum:0,transactId:(_dataSet$transactId=dataSet===null||dataSet===void 0?void 0:dataSet.transactId)!==null&&_dataSet$transactId!==void 0?_dataSet$transactId:0,legalDocumentId:(_dataSet$legalDocumen=dataSet===null||dataSet===void 0?void 0:dataSet.legalDocumentId)!==null&&_dataSet$legalDocumen!==void 0?_dataSet$legalDocumen:0,legalDocumentDescription:(_dataSet$legalDocumen2=dataSet===null||dataSet===void 0?void 0:dataSet.legalDocumentDescription)!==null&&_dataSet$legalDocumen2!==void 0?_dataSet$legalDocumen2:\"\",date:(_dataSet$date=dataSet===null||dataSet===void 0?void 0:dataSet.date)!==null&&_dataSet$date!==void 0?_dataSet$date:moment().format(\"YYYY-MM-DD\"),physical:(_dataSet$physical=dataSet===null||dataSet===void 0?void 0:dataSet.physical)!==null&&_dataSet$physical!==void 0?_dataSet$physical:false,received:(_dataSet$received=dataSet===null||dataSet===void 0?void 0:dataSet.received)!==null&&_dataSet$received!==void 0?_dataSet$received:false,comments:(_data$comments2=data===null||data===void 0?void 0:data.comments)!==null&&_data$comments2!==void 0?_data$comments2:\" \",status:(_dataSet$status=dataSet===null||dataSet===void 0?void 0:dataSet.status)!==null&&_dataSet$status!==void 0?_dataSet$status:true};apiServiceBackend.updateDocumentation(dato).then(function(resp){setopenModalRiesgo(false);// setmessageNotAvailable(true)\nsearchData();}).catch(function(err){setopenModalRiesgo(false);// setmessageNotAvailable(true)\n});}function searchData(){Promise.allSettled([apiServiceBackend.getLegalDocsFunction(),apiServiceBackend.getLegalDocumentation(locationData.transactionId)]).then(function(resp){var _resp=_slicedToArray(resp,2),LegalDocsFunction=_resp[0].value,LegalDocumentation=_resp[1].value;setdataRows(drawRows(LegalDocsFunction.filter(function(docLegalMap){return!!LegalDocumentation.find(function(LegalDocumentationFind){return LegalDocumentationFind.legalDocumentId==docLegalMap.id;});}),LegalDocumentation));}).catch(function(err){});/*apiServiceBackend.consultarDocumentacionLegal(location.data.transactionId).then(async data => {\r\n      delete data.status;\r\n      delete data.transactId;\r\n      delete data.legalDocumentationId;\r\n      data = Object.entries(data).filter(([key, value]) => value).map(([key, value]) => key);\r\n      let docLegal = await props.results.map(($$, index) => {\r\n        if (data.some($$ => $$ === jsonCond[index]))\r\n          return { ...$$, legal: jsonCond[index] }\r\n      }).filter(Boolean);\r\n      setdataRows(docLegal.map((data) => (\r\n        <tr key={data.id}>\r\n\r\n          <td>{data.comment}</td>\r\n          <td>\r\n            <Button color=\"link\" className=\"btn btn-link\" title={props.t(\"View\")}> <i className=\"mdi mdi-file-search-outline mdi-24px\"></i>  </Button>\r\n          </td>\r\n\r\n        </tr>)\r\n      ));\r\n    });*/}function drawRows(docLegal,dataAdd){return dataAdd.map(function(data,index){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:capitalizarPrimeraLetra(data.legalDocumentDescription)}),/*#__PURE__*/_jsx(\"td\",{children:(props===null||props===void 0?void 0:props.validacion)?data.comments:null}),/*#__PURE__*/_jsxs(\"td\",{children:[(props===null||props===void 0?void 0:props.validacion)?/*#__PURE__*/_jsx(Link,{to:\"#\",onClick:function onClick(resp){setdataSet(dataAdd[index]);setopenModalRiesgo(true);},children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-comment-plus mdi-24px\"})}):null,/*#__PURE__*/_jsxs(Link,{to:\"#\",title:props.t(\"View\"),onClick:function onClick(){setmessageNotAvailable(true);},children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-file-search-outline mdi-24px\"}),\"  \"]})]})]},data.legalDocumentId);});}return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{lg:\"12\",children:/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(Table,{className:\"table mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-light\"}),/*#__PURE__*/_jsx(\"tbody\",{children:dataRows})]})})}),/*#__PURE__*/_jsx(Col,{lg:\"12\"})]}),messageNotAvailable?/*#__PURE__*/_jsx(SweetAlert,{warning:true,title:props.t(\"Advise\"),confirmButtonText:props.t(\"Accept\"),cancelButtonText:props.t(\"Cancel\"),onConfirm:function onConfirm(){setmessageNotAvailable(false);},children:props.t(\"ServiceNotavailable\")}):null,/*#__PURE__*/_jsx(ModalComentarioDocumentacion,{actuaizarDocumentacion:actuaizarDocumentacion,dataSet:dataSet,isOpen:openModalRiesgo,toggle:function toggle(){setopenModalRiesgo(false);}})]});};/*ResultadosBusqueda.propTypes = {\r\n  results: PropTypes.array.isRequired, //Resultado de la busqueda\r\n}*/export default withTranslation()(ResultadosBusqueda);","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/CommercialCredit/12_Abogado/PantallaDetalle/ResultadosBusqueda.js"],"names":["React","useEffect","useState","withTranslation","Link","Table","Card","CardBody","Pagination","PaginationItem","PaginationLink","CardFooter","Button","Row","Col","ApiServicesDetalleDocumentacion","BpmServices","BackendServices","useLocation","useHistory","url","ModalComentarioDocumentacion","moment","SweetAlert","ResultadosBusqueda","props","apiServiceBackend","location","openModalRiesgo","setopenModalRiesgo","dataSet","setdataSet","dataRows","setdataRows","messageNotAvailable","setmessageNotAvailable","jsonCond","data","locationData","setLocationData","history","dataSession","undefined","transactionId","length","push","URL_DASHBOARD","sessionStorage","setItem","JSON","stringify","result","getItem","parse","console","log","searchData","capitalizarPrimeraLetra","str","charAt","toUpperCase","slice","actuaizarDocumentacion","comments","transactId","Number","dato","processDocumentId","legalDocumentId","legalDocumentDescription","date","format","physical","received","status","updateDocumentation","then","resp","catch","err","Promise","allSettled","getLegalDocsFunction","getLegalDocumentation","LegalDocsFunction","value","LegalDocumentation","drawRows","filter","docLegalMap","find","LegalDocumentationFind","id","docLegal","dataAdd","map","index","validacion","t"],"mappings":"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","sourcesContent":["import PropTypes from 'prop-types';\r\nimport React, { useEffect, useState } from \"react\"\r\n\r\nimport { withTranslation } from \"react-i18next\"\r\nimport { Link } from \"react-router-dom\"\r\n\r\nimport {\r\n  Table,\r\n  Card,\r\n  CardBody,\r\n  Pagination,\r\n  PaginationItem,\r\n  PaginationLink,\r\n  CardFooter,\r\n  Button,\r\n  Row,\r\n  Col,\r\n} from \"reactstrap\"\r\nimport ApiServicesDetalleDocumentacion from '../../../../services/DocumentacionLegal/ApiServicesDetalleDocumentacion';\r\nimport { BpmServices, BackendServices } from \"../../../../services\";\r\nimport { useLocation, useHistory } from \"react-router-dom\";\r\nimport * as url from \"../../../../helpers/url_helper\"\r\nimport ModalComentarioDocumentacion from \"./ModalComentario\"\r\nimport moment from 'moment';\r\nimport SweetAlert from \"react-bootstrap-sweetalert\"\r\n\r\nconst ResultadosBusqueda = (props) => {\r\n\r\n  const apiServiceBackend = new BackendServices();\r\n  const location = useLocation()\r\n  const [openModalRiesgo, setopenModalRiesgo] = useState(false);\r\n  const [dataSet, setdataSet] = useState({\r\n    \"processDocumentId\": 0,\r\n    \"transactId\": 0,\r\n    \"legalDocumentId\": 0,\r\n    \"legalDocumentDescription\": \"\",\r\n    \"description\": \"\",\r\n    \"status\": true\r\n  });\r\n  /**\r\n   * All useState\r\n   */\r\n  const [dataRows, setdataRows] = useState(null);\r\n\r\n  const [messageNotAvailable, setmessageNotAvailable] = useState(false);\r\n  /**\r\n   * End All useSate\r\n   */\r\n\r\n  const jsonCond = [\r\n    'rotary',\r\n    'commercialLoan',\r\n    'multipleRotary',\r\n    'rotaryNumber',\r\n    'overdraft',\r\n    'transfer',\r\n    'bail',\r\n    'trust',\r\n    'agroPawn',\r\n    'naturalBail',\r\n    'legalBail',\r\n    'crossedLegalBail',\r\n    'crossedNaturalBail',\r\n    'promiseLetter',\r\n    'privateRecord',\r\n    'trustRecord',\r\n    'loanGuarantees',\r\n    'fiduciaryLine',\r\n    'prefinance',\r\n  ]\r\n\r\n  const [locationData, setLocationData] = useState(location.data);\r\n  const history = useHistory();\r\n\r\n  React.useEffect(() => {\r\n\r\n    let dataSession;\r\n\r\n    if (location.data !== null && location.data !== undefined) {\r\n      if (location.data.transactionId === undefined || location.data.transactionId.length <= 0) {\r\n        //location.data.transactionId = 0;\r\n        //checkAndCreateProcedure(location.data);\r\n        history.push(url.URL_DASHBOARD);\r\n      } else {\r\n        sessionStorage.setItem('locationData', JSON.stringify(location.data));\r\n        setLocationData(location.data);\r\n        dataSession = location.data;\r\n      }\r\n    } else {\r\n      //chequeamos si tenemos guardado en session\r\n      var result = sessionStorage.getItem('locationData');\r\n\r\n      if (result !== undefined && result !== null) {\r\n        result = JSON.parse(result);\r\n        setLocationData(result);\r\n        dataSession = result;\r\n      }\r\n    }\r\n    console.log('location');\r\n    locationData && searchData();\r\n\r\n  }, [!locationData]);\r\n\r\n  function capitalizarPrimeraLetra(str) {\r\n    return str.charAt(0).toUpperCase() + str.slice(1);\r\n  }\r\n  function actuaizarDocumentacion(data) {\r\n    // let jsonSet = {\r\n    //   \"processDocumentId\": Number(dataSet?.processDocumentId ?? 0),\r\n    //   \"transactId\": Number(locationData.transactionId),\r\n    //   \"legalDocumentId\": Number(dataSet?.legalDocumentId ?? 0),\r\n    //   \"legalDocumentDescription\": dataSet?.legalDocumentDescription ?? \"\",\r\n    //   \"description\": data?.description ?? \"\",\r\n    //   \"status\": true\r\n    // }\r\n    dataSet.comments = data?.comments ?? \" \";\r\n    dataSet.transactId = Number(locationData.transactionId)\r\n    console.log(dataSet);\r\n    let dato = {\r\n      processDocumentId: dataSet?.processDocumentId ?? 0,\r\n      transactId: dataSet?.transactId ?? 0,\r\n      legalDocumentId: dataSet?.legalDocumentId ?? 0,\r\n      legalDocumentDescription: dataSet?.legalDocumentDescription ?? \"\",\r\n      date: dataSet?.date ?? moment().format(\"YYYY-MM-DD\"),\r\n      physical: dataSet?.physical ?? false,\r\n      received: dataSet?.received ?? false,\r\n      comments: data?.comments ?? \" \",\r\n      status: dataSet?.status ?? true\r\n    }\r\n    apiServiceBackend.updateDocumentation(dato).then(resp => {\r\n      setopenModalRiesgo(false);\r\n      // setmessageNotAvailable(true)\r\n      searchData()\r\n    }).catch(err => {\r\n      setopenModalRiesgo(false);\r\n      // setmessageNotAvailable(true)\r\n\r\n    })\r\n  }\r\n  function searchData() {\r\n    Promise.allSettled([\r\n      apiServiceBackend.getLegalDocsFunction(),\r\n      apiServiceBackend.getLegalDocumentation(locationData.transactionId),\r\n    ]).then(resp => {\r\n      const [{ value: LegalDocsFunction }, { value: LegalDocumentation }] = resp;\r\n      setdataRows(drawRows(LegalDocsFunction.filter(docLegalMap => !!LegalDocumentation.find(LegalDocumentationFind => LegalDocumentationFind.legalDocumentId == docLegalMap.id)), LegalDocumentation));\r\n\r\n    }).catch(err => {\r\n\r\n    });\r\n\r\n    /*apiServiceBackend.consultarDocumentacionLegal(location.data.transactionId).then(async data => {\r\n      delete data.status;\r\n      delete data.transactId;\r\n      delete data.legalDocumentationId;\r\n      data = Object.entries(data).filter(([key, value]) => value).map(([key, value]) => key);\r\n      let docLegal = await props.results.map(($$, index) => {\r\n        if (data.some($$ => $$ === jsonCond[index]))\r\n          return { ...$$, legal: jsonCond[index] }\r\n      }).filter(Boolean);\r\n      setdataRows(docLegal.map((data) => (\r\n        <tr key={data.id}>\r\n\r\n          <td>{data.comment}</td>\r\n          <td>\r\n            <Button color=\"link\" className=\"btn btn-link\" title={props.t(\"View\")}> <i className=\"mdi mdi-file-search-outline mdi-24px\"></i>  </Button>\r\n          </td>\r\n\r\n        </tr>)\r\n      ));\r\n    });*/\r\n  }\r\n\r\n  function drawRows(docLegal, dataAdd) {\r\n    return dataAdd.map((data, index) => (\r\n      <tr key={data.legalDocumentId} >\r\n        <td>{capitalizarPrimeraLetra(data.legalDocumentDescription)}</td>\r\n        <td>{props?.validacion ? data.comments : null}</td>\r\n        <td>\r\n          {props?.validacion ?\r\n            <Link to=\"#\" onClick={(resp) => { setdataSet(dataAdd[index]); setopenModalRiesgo(true) }}><i className=\"mdi mdi-comment-plus mdi-24px\"></i></Link> : null}\r\n          <Link to={\"#\"} title={props.t(\"View\")} onClick={() => { setmessageNotAvailable(true) }}> <i className=\"mdi mdi-file-search-outline mdi-24px\"></i>  </Link>\r\n        </td>\r\n      </tr >))\r\n  }\r\n  return (\r\n    <React.Fragment>\r\n      <Row>\r\n        <Col lg=\"12\">\r\n          <div className=\"table-responsive\">\r\n            <Table className=\"table mb-0\">\r\n              <thead className=\"table-light\">\r\n              </thead>\r\n              <tbody>\r\n                {dataRows}\r\n              </tbody>\r\n            </Table>\r\n\r\n          </div>\r\n        </Col>\r\n        <Col lg=\"12\">\r\n\r\n        </Col>\r\n      </Row>\r\n\r\n\r\n      {messageNotAvailable ? (\r\n        <SweetAlert\r\n          warning\r\n          title={props.t(\"Advise\")}\r\n          confirmButtonText={props.t(\"Accept\")}\r\n          cancelButtonText={props.t(\"Cancel\")}\r\n          onConfirm={() => {\r\n            setmessageNotAvailable(false)\r\n          }}\r\n        >\r\n          {props.t(\"ServiceNotavailable\")}\r\n        </SweetAlert>\r\n      ) : null}\r\n      <ModalComentarioDocumentacion actuaizarDocumentacion={actuaizarDocumentacion} dataSet={dataSet} isOpen={openModalRiesgo} toggle={() => { setopenModalRiesgo(false) }} />\r\n    </React.Fragment>\r\n\r\n\r\n  );\r\n}\r\n\r\n/*ResultadosBusqueda.propTypes = {\r\n  results: PropTypes.array.isRequired, //Resultado de la busqueda\r\n}*/\r\n\r\nexport default (withTranslation()(ResultadosBusqueda));\r\n"]},"metadata":{},"sourceType":"module"}
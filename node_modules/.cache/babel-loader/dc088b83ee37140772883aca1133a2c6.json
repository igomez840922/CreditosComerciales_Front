{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{translationHelpers}from'../../../helpers/translation-helper';import{Table,Card,CardBody,Button}from\"reactstrap\";import{BackendServices}from'../../../services';import{useLocation,useHistory}from'react-router-dom';import ModalNewHistoryDetail from'./ModalNewHistoryDetail';import SweetAlert from\"react-bootstrap-sweetalert\";import HeaderSections from\"../../Common/HeaderSections\";import{Link}from\"react-router-dom\";import Currency from\"../../../helpers/currency\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var History=function History(props){var _location$data;var location=useLocation();var _translationHelpers=translationHelpers('commercial_credit','common','translation'),_translationHelpers2=_slicedToArray(_translationHelpers,3),t=_translationHelpers2[0],c=_translationHelpers2[1],tr=_translationHelpers2[2];var api=new BackendServices();var editMode=props.editMode;/**\r\n   * All useState\r\n   */var _useState=useState(false),_useState2=_slicedToArray(_useState,2),displayModalNewHistoryDetail=_useState2[0],setDisplayModalNewHistoryDetail=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),dataRows=_useState4[0],setDataRows=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),totals=_useState6[0],setTotals=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),totalRow=_useState8[0],setTotalRow=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),proportions=_useState10[0],setProportions=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),proportionRow=_useState12[0],setProportionRow=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),confirm_alert=_useState14[0],setconfirm_alert=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),error_dlg=_useState16[0],seterror_dlg=_useState16[1];var _useState17=useState(null),_useState18=_slicedToArray(_useState17,2),bank=_useState18[0],setbank=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),successSave_dlg=_useState20[0],setsuccessSave_dlg=_useState20[1];var _useState21=useState(null),_useState22=_slicedToArray(_useState21,2),dataEdit=_useState22[0],setDataEdit=_useState22[1];var _useState23=useState(null),_useState24=_slicedToArray(_useState23,2),action=_useState24[0],setAction=_useState24[1];var _useState25=useState((_location$data=location.data)!==null&&_location$data!==void 0?_location$data:JSON.parse(sessionStorage.getItem('locationData'))),_useState26=_slicedToArray(_useState25,2),dataLocation=_useState26[0],setdataLocaton=_useState26[1];/**\r\n   * End All useState\r\n   */var currencyData=new Currency();var headers=[t('# days',{days:30}),t('# days',{days:60}),t('# days',{days:90}),t('# days',{days:120}),t('# days',{days:150}),t('# days',{days:180}),t('# days',{days:210}),t('# days',{days:240}),t('# days',{days:270}),t('# days',{days:300}),t('# days',{days:330}),t('+# days',{days:331}),tr('Totals')];var data=[{name:'Banesco',data:[100,80,80,80,100,80,80,80,100,80,80,200,0]},{name:'Banesco',data:[100,80,80,80,100,80,80,80,100,80,80,200,0]}];React.useEffect(function(){getDataHistory();},[]);function calculateTotals(headers,data){var totals=new Array(headers.length);totals.fill(0,0,headers.length);headers.forEach(function(header,index){totals[index]=data.reduce(function(total,current){return total+current.data[index];},0);});return totals;}function calculateProportions(headers,data){var cols=new Array(headers.length);cols.fill(0,0,headers.length);return cols;}var dataHeaders=headers.map(function(header,index){return/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:header},\"header-\"+index);});function getDataHistory(){var _dataLocation$transac;api.consultarDetalleAntiguedad((_dataLocation$transac=dataLocation===null||dataLocation===void 0?void 0:dataLocation.transactionId)!==null&&_dataLocation$transac!==void 0?_dataLocation$transac:0,props.debtorId).then(function(data){var mapData=data===null||data===void 0?void 0:data.map(function($$){return{data:[].concat(_toConsumableArray(Object.entries($$.details).map(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];return value;})),[$$.total])};});var key=0;setDataRows(data===null||data===void 0?void 0:data.map(function(item,index){var _item$total;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:item.bank},index),Object.entries(item.details).map(function(_ref3){var _ref4=_slicedToArray(_ref3,2),data=_ref4[0],col=_ref4[1];return/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:currencyData.format(col!==null&&col!==void 0?col:0)},\"col-\"+key++);}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:currencyData.format((_item$total=item.total)!==null&&_item$total!==void 0?_item$total:0)}),!props.preview&&/*#__PURE__*/_jsxs(\"td\",{style:{textAlign:\"right\"},children:[/*#__PURE__*/_jsx(Button,{type:\"button\",color:\"link\",onClick:function onClick(resp){editData(item);},className:\"btn btn-link\",children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-border-color mdi-24px\"})}),/*#__PURE__*/_jsx(Button,{type:\"button\",color:\"link\",onClick:function onClick(resp){deleteData(item.bank);},className:\"btn btn-link\",children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-trash-can-outline mdi-24px\"})})]})]},'row-'+index);}));// Calculate total\nvar totals=calculateTotals(headers,mapData);setTotalRow(/*#__PURE__*/_jsxs(\"tr\",{className:\"table-info\",children:[/*#__PURE__*/_jsx(\"th\",{children:t(\"Total\").toLocaleUpperCase()}),totals.map(function(val,index){return/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:currencyData.format(val)},index);}),/*#__PURE__*/_jsx(\"th\",{})]}));// Calculate proportions\nvar proportions=calculateProportions(headers,mapData);setProportionRow(/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:t(\"Proportion\").toLocaleUpperCase()}),proportions.map(function(val,index){return/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:val},index);})]}));});}function toggleModalNewHistoryItem(){setDisplayModalNewHistoryDetail(!displayModalNewHistoryDetail);}function onSave(_x){return _onSave.apply(this,arguments);}function _onSave(){_onSave=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:values={details:values,transactId:dataLocation.transactionId,personId:props.debtorId,total:values.totals,percentage:values.totals/(headers.length-2),bank:values.bank};delete values.details.bank;delete values.details.totals;_context.t0=action=='edit';if(!_context.t0){_context.next=7;break;}_context.next=7;return api.actualizarDetalleAntiguedad(values).then(function(resp){if(resp.statusCode==\"500\"||undefined){seterror_dlg(true);}else{setsuccessSave_dlg(true);}}).catch(function(err){seterror_dlg(true);});case 7:_context.t1=action=='new';if(!_context.t1){_context.next=11;break;}_context.next=11;return api.nuevoDetalleAntiguedad(values).then(function(resp){if(resp.statusCode==\"500\"||undefined){seterror_dlg(true);}else{setsuccessSave_dlg(true);}}).catch(function(err){seterror_dlg(true);});case 11:getDataHistory();case 12:case\"end\":return _context.stop();}}},_callee);}));return _onSave.apply(this,arguments);}function editData(data){setDataEdit(data);toggleModalNewHistoryItem();setAction('edit');}function deleteData(bank){setbank(bank);setconfirm_alert(true);}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(HeaderSections,{title:\"History Details\",t:t}),/*#__PURE__*/_jsx(\"p\",{className:\"card-title-desc\"}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive mt-2\",children:/*#__PURE__*/_jsxs(Table,{className:\"table mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-light\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:t(\"Country / Client\")}),dataHeaders,!props.preview&&/*#__PURE__*/_jsx(\"th\",{children:editMode&&/*#__PURE__*/_jsxs(Link,{to:\"#\",className:\"float-end\",onClick:function onClick(){setAction('new');toggleModalNewHistoryItem();setDataEdit(null);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-plus-box-multiple-outline mdi-24px\"}),t(\"\")]})})]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[dataRows,(dataRows===null||dataRows===void 0?void 0:dataRows.length)>0&&totalRow]})]})}),/*#__PURE__*/_jsx(ModalNewHistoryDetail,{dataEdit:dataEdit,setAction:setAction,isOpen:displayModalNewHistoryDetail,toggle:toggleModalNewHistoryItem,onSave:onSave}),confirm_alert?/*#__PURE__*/_jsx(SweetAlert,{title:t(\"Areyousure\"),warning:true,showCancel:true,confirmButtonText:t(\"Yesdeleteit\"),cancelButtonText:t(\"Cancel\"),confirmBtnBsStyle:\"success\",cancelBtnBsStyle:\"danger\",onConfirm:function onConfirm(){var apiBack=new BackendServices();apiBack.eliminarDetalleAntiguedad(dataLocation.transactionId,props.debtorId,bank).then(function(resp){if(resp.statusCode==\"500\"||undefined){setconfirm_alert(false);seterror_dlg(true);}else{setconfirm_alert(false);setsuccessSave_dlg(true);}getDataHistory();}).catch(function(error){setconfirm_alert(false);seterror_dlg(true);});},onCancel:function onCancel(){return setconfirm_alert(false);},children:t(\"Youwontbeabletorevertthis\")}):null,successSave_dlg?/*#__PURE__*/_jsx(SweetAlert,{success:true,title:t(\"SuccessDialog\"),confirmButtonText:t(\"Confirm\"),cancelButtonText:t(\"Cancel\"),onConfirm:function onConfirm(){setsuccessSave_dlg(false);getDataHistory();},children:t(\"SuccessSaveMessage\")}):null,error_dlg?/*#__PURE__*/_jsx(SweetAlert,{error:true,title:t(\"ErrorDialog\"),confirmButtonText:t(\"Confirm\"),cancelButtonText:t(\"Cancel\"),onConfirm:function onConfirm(){seterror_dlg(false);getDataHistory();}}):null]});};History.defaultProps={editMode:false};export default History;","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/components/PropuestaCreditoComercial/financialSummary/History.js"],"names":["React","useEffect","useState","translationHelpers","Table","Card","CardBody","Button","BackendServices","useLocation","useHistory","ModalNewHistoryDetail","SweetAlert","HeaderSections","Link","Currency","History","props","location","t","c","tr","api","editMode","displayModalNewHistoryDetail","setDisplayModalNewHistoryDetail","dataRows","setDataRows","totals","setTotals","totalRow","setTotalRow","proportions","setProportions","proportionRow","setProportionRow","confirm_alert","setconfirm_alert","error_dlg","seterror_dlg","bank","setbank","successSave_dlg","setsuccessSave_dlg","dataEdit","setDataEdit","action","setAction","data","JSON","parse","sessionStorage","getItem","dataLocation","setdataLocaton","currencyData","headers","days","name","getDataHistory","calculateTotals","Array","length","fill","forEach","header","index","reduce","total","current","calculateProportions","cols","dataHeaders","map","consultarDetalleAntiguedad","transactionId","debtorId","then","mapData","$$","Object","entries","details","key","value","item","col","format","preview","textAlign","resp","editData","deleteData","toLocaleUpperCase","val","toggleModalNewHistoryItem","onSave","values","transactId","personId","percentage","actualizarDetalleAntiguedad","statusCode","undefined","catch","err","nuevoDetalleAntiguedad","apiBack","eliminarDetalleAntiguedad","error","defaultProps"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\"\r\nimport PropTypes from 'prop-types';\r\nimport { translationHelpers } from '../../../helpers/translation-helper';\r\n\r\nimport {\r\n  Table,\r\n  Card,\r\n  CardBody,\r\n  Button\r\n} from \"reactstrap\"\r\nimport { BackendServices } from '../../../services';\r\nimport { useLocation, useHistory } from 'react-router-dom'\r\nimport ModalNewHistoryDetail from './ModalNewHistoryDetail';\r\nimport SweetAlert from \"react-bootstrap-sweetalert\";\r\nimport HeaderSections from \"../../Common/HeaderSections\";\r\nimport { Link } from \"react-router-dom\";\r\nimport Currency from \"../../../helpers/currency\";\r\n\r\n\r\nconst History = (props) => {\r\n  const location = useLocation();\r\n\r\n  const [t, c, tr] = translationHelpers('commercial_credit', 'common', 'translation');\r\n\r\n  const api = new BackendServices();\r\n\r\n\r\n  const { editMode } = props;\r\n\r\n  /**\r\n   * All useState\r\n   */\r\n  const [displayModalNewHistoryDetail, setDisplayModalNewHistoryDetail] = useState(false);\r\n  const [dataRows, setDataRows] = useState(null);\r\n  const [totals, setTotals] = useState(null);\r\n  const [totalRow, setTotalRow] = useState(null);\r\n  const [proportions, setProportions] = useState(null);\r\n  const [proportionRow, setProportionRow] = useState(null);\r\n  const [confirm_alert, setconfirm_alert] = useState(false);\r\n  const [error_dlg, seterror_dlg] = useState(false);\r\n  const [bank, setbank] = useState(null);\r\n  const [successSave_dlg, setsuccessSave_dlg] = useState(false);\r\n  const [dataEdit, setDataEdit] = useState(null);\r\n  const [action, setAction] = useState(null);\r\n  const [dataLocation, setdataLocaton] = useState(location.data ?? JSON.parse(sessionStorage.getItem('locationData')));\r\n  /**\r\n   * End All useState\r\n   */\r\n\r\n  const currencyData = new Currency();\r\n\r\n  const headers = [\r\n    t('# days', { days: 30 }),\r\n    t('# days', { days: 60 }),\r\n    t('# days', { days: 90 }),\r\n    t('# days', { days: 120 }),\r\n    t('# days', { days: 150 }),\r\n    t('# days', { days: 180 }),\r\n    t('# days', { days: 210 }),\r\n    t('# days', { days: 240 }),\r\n    t('# days', { days: 270 }),\r\n    t('# days', { days: 300 }),\r\n    t('# days', { days: 330 }),\r\n    t('+# days', { days: 331 }),\r\n    tr('Totals')\r\n  ]\r\n\r\n  const data = [\r\n    {\r\n      name: 'Banesco',\r\n      data: [100, 80, 80, 80, 100, 80, 80, 80, 100, 80, 80, 200, 0]\r\n    },\r\n    {\r\n      name: 'Banesco',\r\n      data: [100, 80, 80, 80, 100, 80, 80, 80, 100, 80, 80, 200, 0]\r\n    }\r\n  ]\r\n\r\n  React.useEffect(() => {\r\n    getDataHistory();\r\n  }, []);\r\n\r\n  function calculateTotals(headers, data) {\r\n    const totals = new Array(headers.length);\r\n    totals.fill(0, 0, headers.length);\r\n    headers.forEach((header, index) => {\r\n      totals[index] = data.reduce((total, current) => {\r\n        return total + current.data[index];\r\n      }, 0);\r\n    });\r\n    return totals;\r\n  }\r\n\r\n  function calculateProportions(headers, data) {\r\n    const cols = new Array(headers.length);\r\n    cols.fill(0, 0, headers.length);\r\n    return cols;\r\n  }\r\n\r\n  const dataHeaders = headers.map((header, index) => (\r\n    <th key={\"header-\" + index} className=\"text-end\">{header}</th>\r\n  ));\r\n\r\n  function getDataHistory() {\r\n    api.consultarDetalleAntiguedad(dataLocation?.transactionId ?? 0, props.debtorId).then((data) => {\r\n\r\n      let mapData = data?.map($$ => ({ data: [...Object.entries($$.details).map(([key, value]) => value), $$.total] }));\r\n\r\n      let key = 0;\r\n      setDataRows(data?.map((item, index) => (\r\n        <tr key={'row-' + index}>\r\n          <td key={index}>{item.bank}</td>\r\n          {Object.entries(item.details).map(([data, col]) => (\r\n            <td key={\"col-\" + key++} className=\"text-end\">{currencyData.format(col ?? 0)}</td>\r\n          ))}\r\n          <td className=\"text-end\">{currencyData.format(item.total ?? 0)}</td>\r\n          {!props.preview && <td style={{ textAlign: \"right\" }}>\r\n            <Button type=\"button\" color=\"link\" onClick={(resp) => {\r\n              editData(item)\r\n            }} className=\"btn btn-link\" ><i className=\"mdi mdi-border-color mdi-24px\"></i></Button>\r\n            <Button type=\"button\" color=\"link\" onClick={(resp) => {\r\n              deleteData(item.bank)\r\n            }} className=\"btn btn-link\" ><i className=\"mdi mdi-trash-can-outline mdi-24px\"></i></Button>\r\n          </td>}\r\n        </tr>)\r\n      ));\r\n      // Calculate total\r\n      let totals = (calculateTotals(headers, mapData));\r\n      setTotalRow(\r\n        <tr className=\"table-info\">\r\n          <th>{t(\"Total\").toLocaleUpperCase()}</th>\r\n          {totals.map((val, index) => (\r\n            <th key={index} className=\"text-end\">{currencyData.format(val)}</th>\r\n          ))}\r\n          <th></th>\r\n        </tr>\r\n      );\r\n\r\n      // Calculate proportions\r\n      let proportions = (calculateProportions(headers, mapData));\r\n      setProportionRow(\r\n        <tr>\r\n          <td>{t(\"Proportion\").toLocaleUpperCase()}</td>\r\n          {proportions.map((val, index) => (\r\n            <td key={index} className=\"text-end\">{val}</td>\r\n          ))}\r\n        </tr>\r\n      );\r\n    })\r\n\r\n\r\n  }\r\n\r\n  function toggleModalNewHistoryItem() {\r\n    setDisplayModalNewHistoryDetail(!displayModalNewHistoryDetail);\r\n  }\r\n\r\n  async function onSave(values) {\r\n\r\n    values = { details: values, transactId: dataLocation.transactionId, personId: props.debtorId, total: values.totals, percentage: (values.totals / (headers.length - 2)), bank: values.bank }\r\n    delete values.details.bank\r\n    delete values.details.totals\r\n    action == 'edit' && await api.actualizarDetalleAntiguedad(values).then(resp => {\r\n      if (resp.statusCode == \"500\" || undefined) {\r\n        seterror_dlg(true)\r\n      } else {\r\n        setsuccessSave_dlg(true)\r\n      }\r\n    }).catch(err => {\r\n      seterror_dlg(true)\r\n    });\r\n\r\n    action == 'new' && await api.nuevoDetalleAntiguedad(values).then(resp => {\r\n      if (resp.statusCode == \"500\" || undefined) {\r\n        seterror_dlg(true)\r\n      } else {\r\n        setsuccessSave_dlg(true)\r\n      }\r\n    }).catch(err => {\r\n      seterror_dlg(true)\r\n    });\r\n\r\n    getDataHistory();\r\n  }\r\n\r\n  function editData(data) {\r\n    setDataEdit(data);\r\n    toggleModalNewHistoryItem();\r\n    setAction('edit');\r\n  }\r\n\r\n  function deleteData(bank) {\r\n    setbank(bank);\r\n    setconfirm_alert(true);\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <HeaderSections title=\"History Details\" t={t}></HeaderSections>\r\n      <p className=\"card-title-desc\"></p>\r\n      <div className=\"table-responsive mt-2\">\r\n        <Table className=\"table mb-0\">\r\n          <thead className=\"table-light\">\r\n            <tr>\r\n              <th>{t(\"Country / Client\")}</th>\r\n              {dataHeaders}\r\n              {\r\n                !props.preview && <th>\r\n                  {editMode && (<Link to=\"#\" className=\"float-end\" onClick={() => { setAction('new'); toggleModalNewHistoryItem(); setDataEdit(null); }}>\r\n                    <i className=\"mdi mdi-plus-box-multiple-outline mdi-24px\"></i>{t(\"\")}\r\n                  </Link>)}\r\n                </th>\r\n              }\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {dataRows}\r\n            {dataRows?.length > 0 && totalRow}\r\n            {/* {proportionRow} */}\r\n          </tbody>\r\n        </Table>\r\n      </div>\r\n      <ModalNewHistoryDetail dataEdit={dataEdit} setAction={setAction} isOpen={displayModalNewHistoryDetail} toggle={toggleModalNewHistoryItem} onSave={onSave} />\r\n\r\n      {confirm_alert ? (\r\n        <SweetAlert\r\n          title={t(\"Areyousure\")}\r\n          warning\r\n          showCancel\r\n          confirmButtonText={t(\"Yesdeleteit\")}\r\n          cancelButtonText= {t(\"Cancel\")}\r\n          confirmBtnBsStyle=\"success\"\r\n          cancelBtnBsStyle=\"danger\"\r\n          onConfirm={() => {\r\n            const apiBack = new BackendServices();\r\n            apiBack.eliminarDetalleAntiguedad(dataLocation.transactionId, props.debtorId, bank).then(resp => {\r\n              if (resp.statusCode == \"500\" || undefined) {\r\n                setconfirm_alert(false)\r\n                seterror_dlg(true)\r\n              } else {\r\n                setconfirm_alert(false)\r\n                setsuccessSave_dlg(true)\r\n              }\r\n              getDataHistory();\r\n            }).catch(error => {\r\n              setconfirm_alert(false)\r\n              seterror_dlg(true)\r\n            })\r\n          }}\r\n          onCancel={() => setconfirm_alert(false)}\r\n        >\r\n          {t(\"Youwontbeabletorevertthis\")}\r\n        </SweetAlert>\r\n      ) : null}\r\n\r\n      {successSave_dlg ? (\r\n        <SweetAlert\r\n          success\r\n          title={t(\"SuccessDialog\")}\r\n          confirmButtonText= {t(\"Confirm\")}\r\n          cancelButtonText= {t(\"Cancel\")}\r\n          onConfirm={() => {\r\n            setsuccessSave_dlg(false)\r\n            getDataHistory();\r\n          }}\r\n        >\r\n          {t(\"SuccessSaveMessage\")}\r\n        </SweetAlert>\r\n      ) : null}\r\n\r\n      {error_dlg ? (\r\n        <SweetAlert\r\n          error\r\n          title={t(\"ErrorDialog\")}\r\n          confirmButtonText= {t(\"Confirm\")}\r\n          cancelButtonText= {t(\"Cancel\")}\r\n          onConfirm={() => {\r\n            seterror_dlg(false)\r\n            getDataHistory();\r\n          }}\r\n        >\r\n          { }\r\n        </SweetAlert>\r\n      ) : null}\r\n    </>\r\n  );\r\n};\r\n\r\nHistory.propTypes = {\r\n  title: PropTypes.string,\r\n  headers: PropTypes.array.isRequired,\r\n  data: PropTypes.array.isRequired,\r\n  editMode: PropTypes.bool,\r\n  addHistoryDetail: PropTypes.func\r\n};\r\n\r\nHistory.defaultProps = {\r\n  editMode: false\r\n};\r\n\r\n\r\nexport default History;\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _objectSpread from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{Component}from\"react\";import{Row,Col,Card,CardBody}from\"reactstrap\";import ReactApexChart from\"react-apexcharts\";import{jsPDF}from\"jspdf\";import{BackendServices}from\"../../services\";import*as moment from'moment';import{translationHelpers}from'../../helpers/translation-helper';import{Button,Label,Input,CardHeader,CardTitle,InputGroup,Table,CardFooter}from\"reactstrap\";import ApexCharts from\"apexcharts\";import\"jspdf-autotable\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var _translationHelpers=translationHelpers('translation'),_translationHelpers2=_slicedToArray(_translationHelpers,1),t=_translationHelpers2[0];var SalesAnalytics=/*#__PURE__*/function(_Component){_inherits(SalesAnalytics,_Component);var _super=_createSuper(SalesAnalytics);function SalesAnalytics(props){var _this;_classCallCheck(this,SalesAnalytics);_this=_super.call(this,props);_this.downloadExcel=function(){var uri='data:application/vnd.ms-excel;base64,',template=\"<html xmlns:o=\\\"urn:schemas-microsoft-com:office:office\\\" xmlns:x=\\\"urn:schemas-microsoft-com:office:excel\\\" xmlns=\\\"http://www.w3.org/TR/REC-html40\\\"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>\",base64=function base64(s){return window.btoa(unescape(encodeURIComponent(s)));},format=function format(s,c){return s.replace(/{(\\w+)}/g,function(m,p){return c[p];});};return function(table,name){ApexCharts.exec(\"chartStatistics\",\"dataURI\").then(function(_ref){var imgURI=_ref.imgURI;var byteCharacters=atob(imgURI.replace('data:image/png;base64,',''));if(!table.nodeType)table=document.getElementById(table);var ctx={worksheet:name||'Worksheet',table:table.innerHTML,img:imgURI};window.location.href=uri+base64(format(template,ctx));});};}();_this.backendServices=new BackendServices();_this.inicialize();_this.state={series:[],options:{labels:[],plotOptions:{pie:{donut:{size:'75%'}}},legend:{show:false},colors:['#3b5de7','#45cb85','#eeb902'],events:{dataPointSelection:function dataPointSelection(event,chartContext,config){console.log(config.w.config.labels[config.dataPointIndex]);}},chart:{id:\"chartStatistics\",events:{dataPointSelection:function dataPointSelection(event,chartContext,config){var options=config.w.config.labels[config.dataPointIndex];var statistic=_this.state.statistics.filter(function(statistic){return statistic.activityBpmName===options;});var dataRows=statistic.map(function(statistic){return[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:statistic.transactId}),/*#__PURE__*/_jsx(\"td\",{children:statistic.processBpmName}),/*#__PURE__*/_jsx(\"td\",{children:statistic.activityBpmName}),/*#__PURE__*/_jsx(\"td\",{children:_this.formatDate(statistic.date)})]},statistic.transactId)];});_this.setState(_objectSpread(_objectSpread({},_this.state),{},{detailStatistic:statistic,dataRows:dataRows}));}},toolbar:{show:true,offsetX:0,offsetY:0,tools:{download:true,selection:true,zoom:true,zoomin:true,zoomout:true,pan:true,reset:true|'<img src=\"/static/icons/reset.png\" width=\"20\">',customIcons:[]}},export:{csv:{filename:undefined,columnDelimiter:',',headerCategory:['category','category2'],headerValue:['value','value2'],dateFormatter:function dateFormatter(timestamp){return new Date(timestamp).toDateString();}},svg:{filename:'banesco_statistic'},png:{filename:'banesco_statistic'}},autoSelected:'zoom'},statistics:[],detailStatistic:null,dataRows:null}};return _this;}_createClass(SalesAnalytics,[{key:\"inicialize\",value:function inicialize(){var _this2=this;this.backendServices.getBpmStatistics().then(function(resp){console.log(resp);var processBpmId=_this2.groupBy(resp,\"activityBpmName\");var labels=processBpmId.map(function(process){return process.at(0).activityBpmName;});var series=processBpmId.map(function(process){return process.length;});_this2.setState(_objectSpread(_objectSpread({},_this2.state),{},{series:series,options:_objectSpread(_objectSpread({},_this2.state.options),{},{labels:labels}),statistics:resp}));}).catch(function(err){});}/**\r\n   * groupBy, agrupa los items de un JSON\r\n   * @param {Array} collection array JSON\r\n   * @param {string} property clave a agrupar\r\n   * @returns {Array}\r\n   */},{key:\"groupBy\",value:function groupBy(collection,property){var i=0,val,index,values=[],result=[];for(;i<collection.length;i++){val=collection[i][property];index=values.indexOf(val);if(index>-1)result[index].push(collection[i]);else{values.push(val);result.push([collection[i]]);}}return result;}},{key:\"formatDate\",value:function formatDate(date){return moment(date).format(\"DD/MM/YYYY\");}},{key:\"downloadPDF\",value:function downloadPDF(){var chart=new ApexCharts(document.querySelector(\"#chartStatistics\"),this.state.options);ApexCharts.exec(\"chartStatistics\",\"dataURI\").then(function(_ref2){var imgURI=_ref2.imgURI;var pdf=new jsPDF();pdf.addImage(imgURI,'PNG',36,30,130,60);pdf.setFontSize(25);pdf.setTextColor('#007953');pdf.text(t(\"Statistics\"),15,15);var headers=[[t(\"Procedure\"),t(\"Process\"),t(\"Activity\"),t(\"Date\")]];var content={startY:100,head:headers,// body: this.state.detailStatistic?.map(Statistic => [Statistic.transactId, Statistic.processBpmName, Statistic.activityBpmName, this.formatDate(Statistic.date)]) ?? [],\nhtml:'#tableStatistic',styles:{halign:'center'},headStyles:{fillColor:[0,121,83]},// alternateRowStyles: { fillColor: [174, 217, 203] },\ntableLineColor:[0,121,83],tableLineWidth:0.1};document.querySelector(\"#tableStatistic\")&&pdf.autoTable(content);pdf.save(\"banesco_statistics.pdf\");});}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardBody,{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"card-title mb-4\",children:\"Estad\\xEDsticas\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex flex-row justify-content-between\",children:[/*#__PURE__*/_jsx(Button,{color:\"success\",className:\"mdi mid-12px\",onClick:function onClick(){_this3.downloadPDF();},children:\"PDF\"}),/*#__PURE__*/_jsx(Button,{color:\"success\",className:\"mdi mid-12px\",onClick:function onClick(){_this3.downloadExcel('tableStatistic','banesco_statistics');},children:\"Excel\"})]}),/*#__PURE__*/_jsxs(Row,{className:\"align-items-center\",children:[/*#__PURE__*/_jsx(Col,{id:\"tests\",children:/*#__PURE__*/_jsx(ReactApexChart,{options:this.state.options,series:this.state.series,type:\"donut\",height:245,onClick:function onClick(e){},className:\"apex-charts\",id:\"chartStatistics\"})}),this.state.detailStatistic&&/*#__PURE__*/_jsx(Col,{sm:12,children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive styled-table-div\",style:{maxHeight:'300px'},children:/*#__PURE__*/_jsxs(Table,{className:\"table table-striped table-hover styled-table table\",id:\"tableStatistic\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:t(\"Procedure\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"Process\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"Activity\")}),/*#__PURE__*/_jsx(\"th\",{children:t(\"Date\")})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:this.state.dataRows})]})})})})})]})]})})});}}]);return SalesAnalytics;}(Component);export default SalesAnalytics;","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/pages/Dashboard/sales-analytics.js"],"names":["React","Component","Row","Col","Card","CardBody","ReactApexChart","jsPDF","BackendServices","moment","translationHelpers","Button","Label","Input","CardHeader","CardTitle","InputGroup","Table","CardFooter","ApexCharts","t","SalesAnalytics","props","downloadExcel","uri","template","base64","s","window","btoa","unescape","encodeURIComponent","format","c","replace","m","p","table","name","exec","then","imgURI","byteCharacters","atob","nodeType","document","getElementById","ctx","worksheet","innerHTML","img","location","href","backendServices","inicialize","state","series","options","labels","plotOptions","pie","donut","size","legend","show","colors","events","dataPointSelection","event","chartContext","config","console","log","w","dataPointIndex","chart","id","statistic","statistics","filter","activityBpmName","dataRows","map","transactId","processBpmName","formatDate","date","setState","detailStatistic","toolbar","offsetX","offsetY","tools","download","selection","zoom","zoomin","zoomout","pan","reset","customIcons","export","csv","filename","undefined","columnDelimiter","headerCategory","headerValue","dateFormatter","timestamp","Date","toDateString","svg","png","autoSelected","getBpmStatistics","resp","processBpmId","groupBy","process","at","length","catch","err","collection","property","i","val","index","values","result","indexOf","push","querySelector","pdf","addImage","setFontSize","setTextColor","text","headers","content","startY","head","html","styles","halign","headStyles","fillColor","tableLineColor","tableLineWidth","autoTable","save","downloadPDF","e","maxHeight"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\"\r\nimport { Row, Col, Card, CardBody } from \"reactstrap\"\r\nimport ReactApexChart from \"react-apexcharts\"\r\nimport { jsPDF } from \"jspdf\"\r\nimport { BackendServices } from \"../../services\";\r\nimport * as moment from 'moment';\r\nimport { translationHelpers } from '../../helpers/translation-helper';\r\nimport {\r\n  Button,\r\n  Label,\r\n  Input,\r\n  CardHeader,\r\n  CardTitle,\r\n  InputGroup,\r\n  Table,\r\n  CardFooter\r\n} from \"reactstrap\"\r\nimport ApexCharts from \"apexcharts\";\r\nimport \"jspdf-autotable\";\r\n\r\nconst [t] = translationHelpers('translation');\r\n\r\nclass SalesAnalytics extends Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.backendServices = new BackendServices();\r\n    this.inicialize();\r\n\r\n    this.state = {\r\n      series: [],\r\n      options: {\r\n        labels: [],\r\n        plotOptions: {\r\n          pie: {\r\n            donut: {\r\n              size: '75%'\r\n            }\r\n          }\r\n        },\r\n        legend: {\r\n          show: false,\r\n        },\r\n        colors: ['#3b5de7', '#45cb85', '#eeb902'],\r\n        events: {\r\n          dataPointSelection: (event, chartContext, config) => {\r\n            console.log(config.w.config.labels[config.dataPointIndex])\r\n          }\r\n        },\r\n        chart: {\r\n          id: \"chartStatistics\",\r\n          events: {\r\n            dataPointSelection: (event, chartContext, config) => {\r\n              let options = config.w.config.labels[config.dataPointIndex];\r\n              let statistic = this.state.statistics.filter(statistic => statistic.activityBpmName === options);\r\n              let dataRows = statistic.map(statistic => (\r\n                [<tr key={statistic.transactId}>\r\n                  <td>\r\n                    {statistic.transactId}\r\n                  </td>\r\n                  <td>\r\n                    {statistic.processBpmName}\r\n                  </td>\r\n                  <td>\r\n                    {statistic.activityBpmName}\r\n                  </td>\r\n                  <td>\r\n                    {this.formatDate(statistic.date)}\r\n                  </td>\r\n                </tr>]\r\n              ));\r\n              this.setState({ ...this.state, detailStatistic: statistic, dataRows });\r\n            }\r\n          },\r\n          toolbar: {\r\n            show: true,\r\n            offsetX: 0,\r\n            offsetY: 0,\r\n            tools: {\r\n              download: true,\r\n              selection: true,\r\n              zoom: true,\r\n              zoomin: true,\r\n              zoomout: true,\r\n              pan: true,\r\n              reset: true | '<img src=\"/static/icons/reset.png\" width=\"20\">',\r\n              customIcons: []\r\n            },\r\n          },\r\n          export: {\r\n            csv: {\r\n              filename: undefined,\r\n              columnDelimiter: ',',\r\n              headerCategory: ['category', 'category2'],\r\n              headerValue: ['value', 'value2'],\r\n              dateFormatter(timestamp) {\r\n                return new Date(timestamp).toDateString()\r\n              }\r\n            },\r\n            svg: {\r\n              filename: 'banesco_statistic',\r\n            },\r\n            png: {\r\n              filename: 'banesco_statistic',\r\n            }\r\n          },\r\n          autoSelected: 'zoom'\r\n        },\r\n        statistics: [],\r\n        detailStatistic: null,\r\n        dataRows: null\r\n      }\r\n    }\r\n  }\r\n\r\n  inicialize() {\r\n    this.backendServices.getBpmStatistics().then(resp => {\r\n      console.log(resp);\r\n      let processBpmId = this.groupBy(resp, \"activityBpmName\");\r\n      let labels = processBpmId.map(process => process.at(0).activityBpmName);\r\n      let series = processBpmId.map(process => process.length);\r\n      this.setState({ ...this.state, series, options: { ...this.state.options, labels }, statistics: resp });\r\n    }).catch(err => { })\r\n  }\r\n\r\n  /**\r\n   * groupBy, agrupa los items de un JSON\r\n   * @param {Array} collection array JSON\r\n   * @param {string} property clave a agrupar\r\n   * @returns {Array}\r\n   */\r\n  groupBy(collection, property) {\r\n    var i = 0, val, index,\r\n      values = [], result = [];\r\n    for (; i < collection.length; i++) {\r\n      val = collection[i][property];\r\n      index = values.indexOf(val);\r\n      if (index > -1)\r\n        result[index].push(collection[i]);\r\n      else {\r\n        values.push(val);\r\n        result.push([collection[i]]);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  formatDate(date) {\r\n    return moment(date).format(\"DD/MM/YYYY\");\r\n  }\r\n\r\n  downloadPDF() {\r\n    var chart = new ApexCharts(document.querySelector(\"#chartStatistics\"), this.state.options);\r\n    ApexCharts.exec(\"chartStatistics\", \"dataURI\").then(({ imgURI }) => {\r\n      const pdf = new jsPDF();\r\n      pdf.addImage(imgURI, 'PNG', 36, 30, 130, 60);\r\n      pdf.setFontSize(25);\r\n      pdf.setTextColor('#007953');\r\n      pdf.text(t(\"Statistics\"), 15, 15);\r\n\r\n      const headers = [[t(\"Procedure\"), t(\"Process\"), t(\"Activity\"), t(\"Date\")]];\r\n\r\n      let content = {\r\n        startY: 100,\r\n        head: headers,\r\n        // body: this.state.detailStatistic?.map(Statistic => [Statistic.transactId, Statistic.processBpmName, Statistic.activityBpmName, this.formatDate(Statistic.date)]) ?? [],\r\n        html: '#tableStatistic',\r\n        styles: { halign: 'center' },\r\n        headStyles: { fillColor: [0, 121, 83] },\r\n        // alternateRowStyles: { fillColor: [174, 217, 203] },\r\n        tableLineColor: [0, 121, 83], tableLineWidth: 0.1,\r\n      };\r\n      document.querySelector(\"#tableStatistic\") && pdf.autoTable(content);\r\n      pdf.save(\"banesco_statistics.pdf\");\r\n    });\r\n  }\r\n\r\n  downloadExcel = (function () {\r\n    var uri = 'data:application/vnd.ms-excel;base64,',\r\n      template = `<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:x=\"urn:schemas-microsoft-com:office:excel\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>`,\r\n      base64 = function (s) {\r\n        return window.btoa(unescape(encodeURIComponent(s)))\r\n      },\r\n      format = function (s, c) {\r\n        return s.replace(/{(\\w+)}/g, function (m, p) {\r\n          return c[p];\r\n        })\r\n      }\r\n    return function (table, name) {\r\n\r\n      ApexCharts.exec(\"chartStatistics\", \"dataURI\").then(({ imgURI }) => {\r\n\r\n        const byteCharacters = atob(imgURI.replace('data:image/png;base64,', ''));\r\n\r\n        if (!table.nodeType) table = document.getElementById(table)\r\n        var ctx = {\r\n          worksheet: name || 'Worksheet',\r\n          table: table.innerHTML,\r\n          img: imgURI,\r\n        }\r\n        window.location.href = uri + base64(format(template, ctx))\r\n      });\r\n\r\n\r\n\r\n    }\r\n  })()\r\n\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        <Card>\r\n          <CardBody>\r\n            <h4 className=\"card-title mb-4\">Estadísticas</h4>\r\n            <div className=\"d-flex flex-row justify-content-between\">\r\n              <Button color=\"success\" className=\"mdi mid-12px\" onClick={() => { this.downloadPDF() }}>PDF</Button>\r\n              <Button color=\"success\" className=\"mdi mid-12px\" onClick={() => { this.downloadExcel('tableStatistic', 'banesco_statistics') }}>Excel</Button>\r\n            </div>\r\n            <Row className=\"align-items-center\">\r\n              <Col id=\"tests\">\r\n                <ReactApexChart\r\n                  options={this.state.options}\r\n                  series={this.state.series}\r\n                  type=\"donut\"\r\n                  height={245}\r\n                  onClick={(e) => { }}\r\n                  className=\"apex-charts\"\r\n                  id=\"chartStatistics\"\r\n                />\r\n              </Col>\r\n              {this.state.detailStatistic && <Col sm={12}>\r\n                <div>\r\n                  <Row>\r\n                    <div className=\"table-responsive styled-table-div\" style={{ maxHeight: '300px' }}>\r\n                      <Table className=\"table table-striped table-hover styled-table table\" id=\"tableStatistic\">\r\n                        <thead>\r\n                          <tr>\r\n                            <th>{t(\"Procedure\")}</th>\r\n                            <th>{t(\"Process\")}</th>\r\n                            <th>{t(\"Activity\")}</th>\r\n                            <th>{t(\"Date\")}</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          {this.state.dataRows}\r\n                        </tbody>\r\n                      </Table>\r\n                    </div>\r\n                  </Row>\r\n                </div>\r\n              </Col>}\r\n            </Row>\r\n          </CardBody>\r\n        </Card>\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport default SalesAnalytics\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import TaskListPostownersModel from\"../../models/BPM/TaskListPostownersModel\";import{GetDashBoardModel}from\"../../models\";import ApiServiceBpm from\"../ApiServiceBpm\";import*as url from\"../../helpers/url_helper\";import*as opt from\"../../helpers/options_helper\";import qs from\"qs\";import{result}from\"lodash\";import LocalStorageHelper from\"../../helpers/LocalStorageHelper\";var Services=/*#__PURE__*/function(_ApiServiceBpm){_inherits(Services,_ApiServiceBpm);var _super=_createSuper(Services);function Services(){_classCallCheck(this,Services);return _super.apply(this,arguments);}_createClass(Services,[{key:\"createNewInstance\",value:/* ------------------------------------------------------------------------------------------------------------------ */ /*                                 retorna las actividades para la bandeja de entrada                                 */ /* ------------------------------------------------------------------------------------------------------------------ */ //creamos un nueva instancia de proceso en BPM...    \nfunction(){var _createNewInstance=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var number,result1,result2;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return this.startProcess();case 3:number=_context.sent;if(!(number!==null&&number!==undefined&&number>0)){_context.next=14;break;}_context.next=7;return this.getTasksByPrcess(number);case 7:result1=_context.sent;if(!(result1!==undefined)){_context.next=14;break;}_context.next=11;return this.startedStatusTask(result1.taskId);case 11:result2=_context.sent;if(!(result2!==undefined)){_context.next=14;break;}return _context.abrupt(\"return\",result1);case 14:_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 19:return _context.abrupt(\"return\",undefined);case 20:case\"end\":return _context.stop();}}},_callee,this,[[0,16]]);}));function createNewInstance(){return _createNewInstance.apply(this,arguments);}return createNewInstance;}()//creamos un nueva instancia de proceso de Instructivo de desembolso...    \n},{key:\"createNewInstanceDisbursementInstructions\",value:function(){var _createNewInstanceDisbursementInstructions=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var number,result1;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return this.startProcessDisbursementInstructions();case 3:number=_context2.sent;if(!(number!==null&&number!==undefined&&number>0)){_context2.next=10;break;}_context2.next=7;return this.getTasksByPrcess(number);case 7:result1=_context2.sent;if(!(result1!==undefined)){_context2.next=10;break;}return _context2.abrupt(\"return\",result1);case 10:_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](0);console.error(_context2.t0);case 15:return _context2.abrupt(\"return\",undefined);case 16:case\"end\":return _context2.stop();}}},_callee2,this,[[0,12]]);}));function createNewInstanceDisbursementInstructions(){return _createNewInstanceDisbursementInstructions.apply(this,arguments);}return createNewInstanceDisbursementInstructions;}()//retorna la bandeja de entrada\n},{key:\"getDashBoard\",value:function(){var _getDashBoard=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var result;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this.get(url.URL_BPM_DASHBOARD);case 2:result=_context3.sent;return _context3.abrupt(\"return\",GetDashBoardModel.fromJson(result));case 4:case\"end\":return _context3.stop();}}},_callee3,this);}));function getDashBoard(){return _getDashBoard.apply(this,arguments);}return getDashBoard;}()//retorna la bandeja de entrada\n},{key:\"getDashBoard2\",value:function(){var _getDashBoard2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var params,data,result;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:params={containerId:url.WORD_BPM_CONTAINERID};//processInstanceId: processInstanceId\ndata=qs.stringify(params);_context4.next=4;return this.get(url.URL_BPM_DASHBOARDADMIN+\"?\"+data);case 4:result=_context4.sent;return _context4.abrupt(\"return\",GetDashBoardModel.fromJsonAdmin(result));case 6:case\"end\":return _context4.stop();}}},_callee4,this);}));function getDashBoard2(){return _getDashBoard2.apply(this,arguments);}return getDashBoard2;}()//Chequea e Inicializa la tarea\n},{key:\"checkAndStartTask\",value:function(){var _checkAndStartTask=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(locationData){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;console.log(\"checkAndStartTask\",locationData);_context5.next=4;return this.startedStatusTask(locationData.taskId,undefined,locationData.instanceId);case 4:return _context5.abrupt(\"return\",true);case 7:_context5.prev=7;_context5.t0=_context5[\"catch\"](0);console.error(_context5.t0);case 10:return _context5.abrupt(\"return\",false);case 11:case\"end\":return _context5.stop();}}},_callee5,this,[[0,7]]);}));function checkAndStartTask(_x){return _checkAndStartTask.apply(this,arguments);}return checkAndStartTask;}()//retorna las tareas de un proceso especifico\n},{key:\"getTasksByPrcess\",value:function(){var _getTasksByPrcess=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(instanceId){var result;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return this.get(url.URL_BPM_DASHBOARD);case 3:result=_context6.sent;result=GetDashBoardModel.fromJson(result);return _context6.abrupt(\"return\",result.filter(function(e){return e.instanceId===instanceId;})[0]);case 8:_context6.prev=8;_context6.t0=_context6[\"catch\"](0);console.error(\"getTasksByPrcess\",_context6.t0);case 11:return _context6.abrupt(\"return\",undefined);case 12:case\"end\":return _context6.stop();}}},_callee6,this,[[0,8]]);}));function getTasksByPrcess(_x2){return _getTasksByPrcess.apply(this,arguments);}return getTasksByPrcess;}()//crea e inicia una nueva instancia de Proceso y actividad\n},{key:\"startProcess\",value:function(){var _startProcess=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var data,result;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0://Estructura de la data que se le debe pasar\ndata={\"containerId\":url.WORD_BPM_CONTAINERID,\"processId\":url.WORD_BPM_PROCESSID,\"parametros\":{\"values\":{\"info\":\"\",\"processId\":opt.PROCESS_BUSQUEDADESCARTE.toString(),\"activityId\":\"0\",\"transactionId\":\"\",\"customerId\":\"\",\"applicationNumber\":\"\",\"procedureNumber\":\"\",\"requestId\":\"\",\"facilityId\":\"\",\"dambientalparalelo\":\"\",\"decision\":\"\",\"id\":\"\",\"monto\":0,\"status\":\"\",\"decicionforma\":\"\",\"cargo\":\"cargo\",\"statuscredito\":\"\",\"statusadm\":\"\",\"statusformali\":\"\",\"tiposolicitud\":\"\",\"origensolicitud\":\"\",\"dcreditoparalelo\":\"\",\"regresar\":\"\",\"rol\":\"\"}}};_context7.next=3;return this.post(url.URL_BPM_STARTPROCESS,data);case 3:result=_context7.sent;return _context7.abrupt(\"return\",result.body.processInstanceId);case 5:case\"end\":return _context7.stop();}}},_callee7,this);}));function startProcess(){return _startProcess.apply(this,arguments);}return startProcess;}()//crea uns nueva instancia del Proceso de instructivo desembolso\n},{key:\"startProcessDisbursementInstructions\",value:function(){var _startProcessDisbursementInstructions=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var data,result;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0://Estructura de la data que se le debe pasar\ndata={\"containerId\":url.WORD_BPM_CONTAINERID,\"processId\":url.WORD_BPM_PROCESSID_DisbursementInstructions,\"parametros\":{\"values\":{\"info\":\"\",\"processId\":opt.PROCESS_INSTRUCTIVEDISBURSEMENT.toString(),\"activityId\":\"0\",\"transactionId\":\"\",\"customerId\":\"\",\"applicationNumber\":\"\",\"procedureNumber\":\"\",\"requestId\":\"\",\"facilityId\":\"\",\"decision\":\"\",\"id\":\"\",\"regresar\":\"\"}}};_context8.next=3;return this.post(url.URL_BPM_STARTPROCESS,data);case 3:result=_context8.sent;return _context8.abrupt(\"return\",result.body.processInstanceId);case 5:case\"end\":return _context8.stop();}}},_callee8,this);}));function startProcessDisbursementInstructions(){return _startProcessDisbursementInstructions.apply(this,arguments);}return startProcessDisbursementInstructions;}()},{key:\"authentication\",value:function(){var _authentication=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(data){var result;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return this.post(url.URL_BPM_LOGIN,data);case 2:result=_context9.sent;return _context9.abrupt(\"return\",result.status);case 4:case\"end\":return _context9.stop();}}},_callee9,this);}));function authentication(_x3){return _authentication.apply(this,arguments);}return authentication;}()},{key:\"startedStatusTask\",value:function(){var _startedStatusTask=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(taskId){var containerId,instanceId,data,result,localStorageHelper,credentials,values,_args10=arguments;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:containerId=_args10.length>1&&_args10[1]!==undefined?_args10[1]:undefined;instanceId=_args10.length>2&&_args10[2]!==undefined?_args10[2]:undefined;_context10.prev=2;data={\"containerId\":containerId!==undefined?containerId:url.WORD_BPM_CONTAINERID,\"taskId\":taskId,\"taskStatus\":url.WORD_BPM_STARTED};_context10.next=6;return this.put(url.URL_BPM_STATUSTASK,data);case 6:result=_context10.sent;console.log(\"startedStatusTask\",result);if(!((result===null||result===void 0?void 0:result.status)===\"OK\")){_context10.next=16;break;}if(!(instanceId!==undefined)){_context10.next=15;break;}localStorageHelper=new LocalStorageHelper();credentials=localStorageHelper.get(opt.VARNAME_USRCREDENTIAL);values={\"asignado\":credentials.usr};_context10.next=15;return this.updatevariables(instanceId,values);case 15:return _context10.abrupt(\"return\",result);case 16:_context10.next=21;break;case 18:_context10.prev=18;_context10.t0=_context10[\"catch\"](2);console.error(\"api startedStatusTask:\",_context10.t0);case 21:return _context10.abrupt(\"return\",undefined);case 22:case\"end\":return _context10.stop();}}},_callee10,this,[[2,18]]);}));function startedStatusTask(_x4){return _startedStatusTask.apply(this,arguments);}return startedStatusTask;}()},{key:\"completedStatusTask\",value:function(){var _completedStatusTask=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(taskId,values){var containerId,data,result,_args11=arguments;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:containerId=_args11.length>2&&_args11[2]!==undefined?_args11[2]:undefined;_context11.prev=1;/* \"values\":{\r\n          \"decision\":\"si\"  \r\n      } */data={\"containerId\":containerId!==undefined?containerId:url.WORD_BPM_CONTAINERID,\"taskId\":taskId,\"taskStatus\":url.WORD_BPM_COMPLETED,\"parametros\":{\"values\":values}};_context11.next=5;return this.put(url.URL_BPM_STATUSTASK,data);case 5:result=_context11.sent;if(!(result.status===\"OK\")){_context11.next=8;break;}return _context11.abrupt(\"return\",result);case 8:_context11.next=13;break;case 10:_context11.prev=10;_context11.t0=_context11[\"catch\"](1);console.error(\"api completedStatusTask:\",_context11.t0);case 13:return _context11.abrupt(\"return\",undefined);case 14:case\"end\":return _context11.stop();}}},_callee11,this,[[1,10]]);}));function completedStatusTask(_x5,_x6){return _completedStatusTask.apply(this,arguments);}return completedStatusTask;}()},{key:\"abortProcess\",value:function(){var _abortProcess=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(instanceId){var containerId,data,result,_args12=arguments;return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:containerId=_args12.length>1&&_args12[1]!==undefined?_args12[1]:undefined;_context12.prev=1;console.log(\"abortProcess\",instanceId);//Estructura de la data que se le debe pasar\ndata={\"containerId\":containerId!==undefined?containerId:url.WORD_BPM_CONTAINERID,\"processInstanceId\":instanceId};console.log(\"data\",data);_context12.next=7;return this.del(url.URL_BPM_ABORTPROCESS,data);case 7:result=_context12.sent;if(!(result.status===\"OK\")){_context12.next=10;break;}return _context12.abrupt(\"return\",result);case 10:_context12.next=15;break;case 12:_context12.prev=12;_context12.t0=_context12[\"catch\"](1);console.error(\"api abortProcess:\",_context12.t0);case 15:return _context12.abrupt(\"return\",undefined);case 16:case\"end\":return _context12.stop();}}},_callee12,this,[[1,12]]);}));function abortProcess(_x7){return _abortProcess.apply(this,arguments);}return abortProcess;}()},{key:\"updatevariables\",value:function(){var _updatevariables=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee13(instanceId,values){var containerId,data,result,_args13=arguments;return _regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:containerId=_args13.length>2&&_args13[2]!==undefined?_args13[2]:undefined;_context13.prev=1;/* \"values\":{\r\n          \"decision\":\"si\"  \r\n      } */data={\"containerId\":containerId!==undefined?containerId:url.WORD_BPM_CONTAINERID,\"processInstanceId\":instanceId,\"parametros\":{\"values\":values}};_context13.next=5;return this.post(url.URL_BPM_UPDATEVAR,data);case 5:result=_context13.sent;if(!(result.status===\"OK\")){_context13.next=8;break;}return _context13.abrupt(\"return\",result);case 8:_context13.next=13;break;case 10:_context13.prev=10;_context13.t0=_context13[\"catch\"](1);console.error(\"api completedStatusTask:\",_context13.t0);case 13:return _context13.abrupt(\"return\",undefined);case 14:case\"end\":return _context13.stop();}}},_callee13,this,[[1,10]]);}));function updatevariables(_x8,_x9){return _updatevariables.apply(this,arguments);}return updatevariables;}()//Retorna la imagen relacionada a un proceso\n},{key:\"wacthprocess\",value:function(){var _wacthprocess=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee14(processInstanceId){var params,data,result;return _regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:_context14.prev=0;params={containerId:url.WORD_BPM_CONTAINERID,processInstanceId:processInstanceId};data=qs.stringify(params);_context14.next=5;return this.get(url.URL_BPM_WATCHPROCESS+\"?\"+data);case 5:result=_context14.sent;console.log(\"wacthprocess\",result);return _context14.abrupt(\"return\",result.body.response);case 10:_context14.prev=10;_context14.t0=_context14[\"catch\"](0);console.error(_context14.t0);case 13:return _context14.abrupt(\"return\",undefined);case 14:case\"end\":return _context14.stop();}}},_callee14,this,[[0,10]]);}));function wacthprocess(_x10){return _wacthprocess.apply(this,arguments);}return wacthprocess;}()},{key:\"saveAutonomy\",value:function(){var _saveAutonomy=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee15(autonomy){var containerId,montos,tipo,data,result,_args15=arguments;return _regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:containerId=_args15.length>1&&_args15[1]!==undefined?_args15[1]:undefined;_context15.prev=1;/* \"values\":{\r\n          \"decision\":\"si\"  \r\n      } */montos=autonomy.amount,tipo=autonomy.tipo;//\"model-namespace\": \"https://kiegroup.org/dmn/_3B8E611A-D760-4020-9BA9-69ED1FD4DFFC\"\ndata={\"containerId\":containerId!==undefined?containerId:url.WORD_BPM_CONTAINERID,//\"processId\": url.WORD_BPM_PROCESSID,\n\"parametros\":{\"values\":{\"model-namespace\":\"https://kiegroup.org/dmn/_6A4C1540-4D56-4357-BDF3-3F9E81907A54\",\"model-name\":\"ReglaAsignacionAutonomiasduales\",\"dmn-context\":{montos:montos,tipo:tipo}}}};_context15.next=6;return this.post(url.URL_BPM_checketapa,data);case 6:result=_context15.sent;if(!(result.status===\"OK\")){_context15.next=9;break;}return _context15.abrupt(\"return\",result);case 9:_context15.next=15;break;case 11:_context15.prev=11;_context15.t0=_context15[\"catch\"](1);console.error(\"api completedStatusTask:\",_context15.t0);return _context15.abrupt(\"return\",undefined);case 15:case\"end\":return _context15.stop();}}},_callee15,this,[[1,11]]);}));function saveAutonomy(_x11){return _saveAutonomy.apply(this,arguments);}return saveAutonomy;}()},{key:\"listCheckValidation\",value:function(){var _listCheckValidation=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee16(process){var containerId,data,result,_result$body,_result$body$result$d,_args16=arguments;return _regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:containerId=_args16.length>1&&_args16[1]!==undefined?_args16[1]:undefined;_context16.prev=1;/* \"values\":{\r\n          \"decision\":\"si\"  \r\n      } */data={\"containerId\":containerId!==undefined?containerId:url.WORD_BPM_CONTAINERID,//\"processId\": url.WORD_BPM_PROCESSID,\n\"parametros\":{\"values\":{\"model-namespace\":url.URL_BPM_MODELNAMESPACE,\"model-name\":\"estadoetapa\",\"dmn-context\":{\"numeroetapa\":\"\".concat(process)}}}};_context16.next=5;return this.post(url.URL_BPM_checketapa,data);case 5:result=_context16.sent;if(!(result.status===\"OK\")){_context16.next=8;break;}return _context16.abrupt(\"return\",(result===null||result===void 0?void 0:(_result$body=result.body)===null||_result$body===void 0?void 0:(_result$body$result$d=_result$body.result['dmn-evaluation-result']['dmn-context'])===null||_result$body$result$d===void 0?void 0:_result$body$result$d.resuletapa)==='true');case 8:_context16.next=14;break;case 10:_context16.prev=10;_context16.t0=_context16[\"catch\"](1);console.error(\"api completedStatusTask:\",_context16.t0);return _context16.abrupt(\"return\",undefined);case 14:case\"end\":return _context16.stop();}}},_callee16,this,[[1,10]]);}));function listCheckValidation(_x12){return _listCheckValidation.apply(this,arguments);}return listCheckValidation;}()//reasignar tarea a otro usuario\n},{key:\"ChangeTaskUser\",value:function(){var _ChangeTaskUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee17(user,taskId,instanceId){var containerId,localStorageHelper,credentials,values,data,result,_args17=arguments;return _regeneratorRuntime.wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:containerId=_args17.length>3&&_args17[3]!==undefined?_args17[3]:undefined;localStorageHelper=new LocalStorageHelper();credentials=localStorageHelper.get(opt.VARNAME_USRCREDENTIAL);_context17.prev=3;values={\"asignado\":user};_context17.next=7;return this.updatevariables(instanceId,values);case 7:data={\"containerId\":containerId!==undefined?containerId:url.WORD_BPM_CONTAINERID,\"taskId\":taskId,//\"10006\",         \n\"parametros\":{\"values\":{\"users\":user,//\"ETECCAnlPrevencion1\" \n\"asignado\":user}}};localStorageHelper.save(opt.VARNAME_USRCREDENTIAL,{usr:url.USRREASIGNACION,psw:url.PSWREASIGNACION,email:credentials.email});_context17.next=11;return this.post(url.URL_BPM_ChangeTaskUser,data);case 11:result=_context17.sent;if(!(result.status===\"OK\")){_context17.next=14;break;}return _context17.abrupt(\"return\",true);case 14:values={\"asignado\":credentials.usr};_context17.next=17;return this.updatevariables(instanceId,values);case 17:_context17.next=21;break;case 19:_context17.prev=19;_context17.t0=_context17[\"catch\"](3);case 21:_context17.prev=21;localStorageHelper.save(opt.VARNAME_USRCREDENTIAL,credentials);return _context17.finish(21);case 24:return _context17.abrupt(\"return\",false);case 25:case\"end\":return _context17.stop();}}},_callee17,this,[[3,19,21,24]]);}));function ChangeTaskUser(_x13,_x14,_x15){return _ChangeTaskUser.apply(this,arguments);}return ChangeTaskUser;}()}]);return Services;}(ApiServiceBpm);export{Services as default};","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/services/BpmServices/Services.js"],"names":["TaskListPostownersModel","GetDashBoardModel","ApiServiceBpm","url","opt","qs","result","LocalStorageHelper","Services","startProcess","number","undefined","getTasksByPrcess","result1","startedStatusTask","taskId","result2","console","error","startProcessDisbursementInstructions","get","URL_BPM_DASHBOARD","fromJson","params","containerId","WORD_BPM_CONTAINERID","data","stringify","URL_BPM_DASHBOARDADMIN","fromJsonAdmin","locationData","log","instanceId","filter","e","WORD_BPM_PROCESSID","PROCESS_BUSQUEDADESCARTE","toString","post","URL_BPM_STARTPROCESS","body","processInstanceId","WORD_BPM_PROCESSID_DisbursementInstructions","PROCESS_INSTRUCTIVEDISBURSEMENT","URL_BPM_LOGIN","status","WORD_BPM_STARTED","put","URL_BPM_STATUSTASK","localStorageHelper","credentials","VARNAME_USRCREDENTIAL","values","usr","updatevariables","WORD_BPM_COMPLETED","del","URL_BPM_ABORTPROCESS","URL_BPM_UPDATEVAR","URL_BPM_WATCHPROCESS","response","autonomy","montos","amount","tipo","URL_BPM_checketapa","process","URL_BPM_MODELNAMESPACE","resuletapa","user","save","USRREASIGNACION","psw","PSWREASIGNACION","email","URL_BPM_ChangeTaskUser"],"mappings":"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","sourcesContent":["\r\nimport TaskListPostownersModel from \"../../models/BPM/TaskListPostownersModel\";\r\nimport { GetDashBoardModel } from \"../../models\";\r\nimport ApiServiceBpm from \"../ApiServiceBpm\";\r\nimport * as url from \"../../helpers/url_helper\"\r\nimport * as opt from \"../../helpers/options_helper\"\r\nimport qs from \"qs\";\r\nimport { result } from \"lodash\";\r\n\r\nimport LocalStorageHelper from \"../../helpers/LocalStorageHelper\";\r\n\r\nexport default class Services extends ApiServiceBpm {\r\n\r\n  /* ------------------------------------------------------------------------------------------------------------------ */\r\n  /*                                 retorna las actividades para la bandeja de entrada                                 */\r\n  /* ------------------------------------------------------------------------------------------------------------------ */\r\n\r\n\r\n  //creamos un nueva instancia de proceso en BPM...    \r\n  async createNewInstance() {\r\n    try {\r\n      var number = await this.startProcess(); //iniciamos una nueva instancia de proceso en BPM...    \r\n      if (number !== null && number !== undefined && number > 0) {\r\n        var result1 = await this.getTasksByPrcess(number);//buscamos la tarea que crea el nuevo proceso\r\n        if (result1 !== undefined) {\r\n          var result2 = await this.startedStatusTask(result1.taskId);//iniciamos la tarea\r\n          if (result2 !== undefined) {\r\n            return result1; //instanceId:result.instanceId,taskId:result.taskId,taskStatus:result.status\r\n          }\r\n        }\r\n      }\r\n    }\r\n    catch (err) {\r\n      console.error(err);\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  //creamos un nueva instancia de proceso de Instructivo de desembolso...    \r\n  async createNewInstanceDisbursementInstructions() {\r\n    try {\r\n      var number = await this.startProcessDisbursementInstructions(); //iniciamos una nueva instancia de proceso en BPM...    \r\n      if (number !== null && number !== undefined && number > 0) {\r\n        var result1 = await this.getTasksByPrcess(number);//buscamos la tarea que crea el nuevo proceso\r\n        if (result1 !== undefined) {\r\n          //var result2 = await this.startedStatusTask(result1.taskId);//iniciamos la tarea\r\n          //if (result2 !== undefined) {\r\n            return result1; //instanceId:result.instanceId,taskId:result.taskId,taskStatus:result.status\r\n          //}\r\n        }\r\n      }\r\n    }\r\n    catch (err) {\r\n      console.error(err);\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  //retorna la bandeja de entrada\r\n  async getDashBoard() {\r\n    var result = await this.get(url.URL_BPM_DASHBOARD);\r\n    return GetDashBoardModel.fromJson(result);\r\n  }\r\n\r\n  //retorna la bandeja de entrada\r\n  async getDashBoard2() {\r\n\r\n    var params = { containerId: url.WORD_BPM_CONTAINERID } //processInstanceId: processInstanceId\r\n    var data = qs.stringify(params);\r\n\r\n    var result = await this.get(url.URL_BPM_DASHBOARDADMIN + \"?\" + data);\r\n    return GetDashBoardModel.fromJsonAdmin(result);\r\n  }\r\n\r\n  //Chequea e Inicializa la tarea\r\n  async checkAndStartTask(locationData) {\r\n    try {\r\n\r\n\r\n      console.log(\"checkAndStartTask\", locationData);\r\n      await this.startedStatusTask(locationData.taskId, undefined, locationData.instanceId)\r\n      return true;\r\n      //chequear si la tarea no ha sido iniciada\r\n      /*if(locationData.taskStatus === \"Ready\" || locationData.taskStatus === \"Listo\"){        \r\n        //Iniciamos la nueva tarea en BPM   \r\n        await this.startedStatusTask(locationData.taskId)\r\n        return true;\r\n      }\r\n      else{\r\n        return true;\r\n      }      */\r\n    }\r\n    catch (err) { console.error(err) }\r\n    return false;\r\n  }\r\n\r\n  //retorna las tareas de un proceso especifico\r\n  async getTasksByPrcess(instanceId) {\r\n    try {\r\n      var result = await this.get(url.URL_BPM_DASHBOARD);\r\n      result = GetDashBoardModel.fromJson(result);\r\n      return result.filter((e) => e.instanceId === instanceId)[0];\r\n    }\r\n    catch (err) { console.error(\"getTasksByPrcess\", err) }\r\n    return undefined;\r\n  }\r\n\r\n  //crea e inicia una nueva instancia de Proceso y actividad\r\n  async startProcess() {\r\n    //Estructura de la data que se le debe pasar\r\n    var data = {\r\n      \"containerId\": url.WORD_BPM_CONTAINERID,\r\n      \"processId\": url.WORD_BPM_PROCESSID,\r\n      \"parametros\": {\r\n        \"values\": {\r\n          \"info\": \"\",\r\n          \"processId\": opt.PROCESS_BUSQUEDADESCARTE.toString(),\r\n          \"activityId\": \"0\",\r\n          \"transactionId\": \"\",\r\n          \"customerId\": \"\",\r\n          \"applicationNumber\": \"\",\r\n          \"procedureNumber\": \"\",\r\n          \"requestId\": \"\",\r\n          \"facilityId\": \"\",\r\n          \"dambientalparalelo\": \"\",\r\n          \"decision\": \"\",\r\n          \"id\": \"\",\r\n          \"monto\": 0,\r\n          \"status\": \"\",\r\n          \"decicionforma\": \"\",\r\n          \"cargo\": \"cargo\",\r\n          \"statuscredito\": \"\",\r\n          \"statusadm\": \"\",\r\n          \"statusformali\": \"\",\r\n          \"tiposolicitud\": \"\",\r\n          \"origensolicitud\": \"\",\r\n          \"dcreditoparalelo\": \"\",\r\n          \"regresar\": \"\",\r\n          \"rol\": \"\"\r\n        }\r\n      }\r\n    }\r\n\r\n    var result = await this.post(url.URL_BPM_STARTPROCESS, data);\r\n    /*\r\n    {\r\n    \"body\": {\r\n        \"processInstanceId\": \"8124\",\r\n        \"containers\": null,\r\n        \"response\": null\r\n    },\r\n    \"status\": \"CREATED\",\r\n    \"businessStatus\": \"\",\r\n    \"timeResponse\": \"2021-12-06 13:41:57\",\r\n    \"message\": null,\r\n    \"path\": \"/api-jbpm-0.0.1-SNAPSHOT/soaint-toolbox-eis/bpm-api/v0/processes/startProcess\",\r\n    \"transactionState\": null\r\n    }\r\n    */\r\n\r\n    return result.body.processInstanceId;\r\n  }\r\n\r\n  //crea uns nueva instancia del Proceso de instructivo desembolso\r\n  async startProcessDisbursementInstructions() {\r\n    //Estructura de la data que se le debe pasar\r\n    var data = {\r\n      \"containerId\": url.WORD_BPM_CONTAINERID,\r\n      \"processId\": url.WORD_BPM_PROCESSID_DisbursementInstructions,\r\n      \"parametros\": {\r\n        \"values\": {\r\n          \"info\": \"\",\r\n          \"processId\": opt.PROCESS_INSTRUCTIVEDISBURSEMENT.toString(),\r\n          \"activityId\": \"0\",\r\n          \"transactionId\": \"\",\r\n          \"customerId\": \"\",\r\n          \"applicationNumber\": \"\",\r\n          \"procedureNumber\": \"\",\r\n          \"requestId\": \"\",\r\n          \"facilityId\": \"\",\r\n          \"decision\": \"\",\r\n          \"id\": \"\",\r\n          \"regresar\": \"\",\r\n        }\r\n      }\r\n    }\r\n\r\n    var result = await this.post(url.URL_BPM_STARTPROCESS, data);\r\n    /*\r\n    {\r\n    \"body\": {\r\n        \"processInstanceId\": \"8124\",\r\n        \"containers\": null,\r\n        \"response\": null\r\n    },\r\n    \"status\": \"CREATED\",\r\n    \"businessStatus\": \"\",\r\n    \"timeResponse\": \"2021-12-06 13:41:57\",\r\n    \"message\": null,\r\n    \"path\": \"/api-jbpm-0.0.1-SNAPSHOT/soaint-toolbox-eis/bpm-api/v0/processes/startProcess\",\r\n    \"transactionState\": null\r\n    }\r\n    */\r\n\r\n    return result.body.processInstanceId;\r\n  }\r\n\r\n  async authentication(data) {\r\n    var result = await this.post(url.URL_BPM_LOGIN, data);\r\n    return result.status; //OK\r\n  }\r\n\r\n  async startedStatusTask(taskId, containerId = undefined, instanceId = undefined) {\r\n    try {\r\n\r\n      var data = {\r\n        \"containerId\": containerId !== undefined ? containerId : url.WORD_BPM_CONTAINERID,\r\n        \"taskId\": taskId,\r\n        \"taskStatus\": url.WORD_BPM_STARTED\r\n      }\r\n\r\n      var result = await this.put(url.URL_BPM_STATUSTASK, data);\r\n      console.log(\"startedStatusTask\", result);\r\n\r\n      if (result?.status === \"OK\") {\r\n        if (instanceId !== undefined) {\r\n          const localStorageHelper = new LocalStorageHelper();\r\n          var credentials = localStorageHelper.get(opt.VARNAME_USRCREDENTIAL);\r\n          var values = {\r\n            \"asignado\": credentials.usr\r\n          };\r\n          await this.updatevariables(instanceId, values)\r\n        }\r\n        return result;\r\n      }\r\n\r\n    }\r\n    catch (err) {\r\n      console.error(\"api startedStatusTask:\", err)\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  async completedStatusTask(taskId, values, containerId = undefined) {\r\n    try {\r\n      /* \"values\":{\r\n          \"decision\":\"si\"  \r\n      } */\r\n      var data = {\r\n        \"containerId\": containerId !== undefined ? containerId : url.WORD_BPM_CONTAINERID,\r\n        \"taskId\": taskId,\r\n        \"taskStatus\": url.WORD_BPM_COMPLETED,\r\n        \"parametros\": {\r\n          \"values\": values,\r\n        }\r\n      }\r\n      var result = await this.put(url.URL_BPM_STATUSTASK, data);\r\n      if (result.status === \"OK\") {\r\n        return result;\r\n      }\r\n\r\n    }\r\n    catch (err) {\r\n      console.error(\"api completedStatusTask:\", err)\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  async abortProcess(instanceId, containerId = undefined) {\r\n\r\n    try {\r\n      console.log(\"abortProcess\", instanceId);\r\n      //Estructura de la data que se le debe pasar\r\n      var data = {\r\n        \"containerId\": containerId !== undefined ? containerId : url.WORD_BPM_CONTAINERID,\r\n        \"processInstanceId\": instanceId,\r\n      }\r\n      console.log(\"data\", data);\r\n      var result = await this.del(url.URL_BPM_ABORTPROCESS, data);\r\n\r\n      if (result.status === \"OK\") {\r\n        return result;\r\n      }\r\n\r\n    }\r\n    catch (err) {\r\n      console.error(\"api abortProcess:\", err)\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  async updatevariables(instanceId, values, containerId = undefined) {\r\n    try {\r\n      /* \"values\":{\r\n          \"decision\":\"si\"  \r\n      } */\r\n      var data = {\r\n        \"containerId\": containerId !== undefined ? containerId : url.WORD_BPM_CONTAINERID,\r\n        \"processInstanceId\": instanceId,\r\n        \"parametros\": {\r\n          \"values\": values,\r\n        }\r\n      }\r\n      var result = await this.post(url.URL_BPM_UPDATEVAR, data);\r\n      if (result.status === \"OK\") {\r\n        return result;\r\n      }\r\n\r\n    }\r\n    catch (err) {\r\n      console.error(\"api completedStatusTask:\", err)\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  //Retorna la imagen relacionada a un proceso\r\n  async wacthprocess(processInstanceId) {\r\n    try {\r\n\r\n      var params = { containerId: url.WORD_BPM_CONTAINERID, processInstanceId: processInstanceId }\r\n      var data = qs.stringify(params);\r\n\r\n      var result = await this.get(url.URL_BPM_WATCHPROCESS + \"?\" + data);\r\n\r\n      console.log(\"wacthprocess\", result);\r\n\r\n      return result.body.response;\r\n    }\r\n    catch (err) { console.error(err); }\r\n    return undefined;\r\n  }\r\n\r\n  async saveAutonomy(autonomy, containerId = undefined) {\r\n    try {\r\n      /* \"values\":{\r\n          \"decision\":\"si\"  \r\n      } */\r\n\r\n      const { amount: montos, tipo } = autonomy\r\n      //\"model-namespace\": \"https://kiegroup.org/dmn/_3B8E611A-D760-4020-9BA9-69ED1FD4DFFC\"\r\n      var data = {\r\n        \"containerId\": containerId !== undefined ? containerId : url.WORD_BPM_CONTAINERID,\r\n        //\"processId\": url.WORD_BPM_PROCESSID,\r\n        \"parametros\": {\r\n          \"values\": {\r\n            \"model-namespace\": \"https://kiegroup.org/dmn/_6A4C1540-4D56-4357-BDF3-3F9E81907A54\",\r\n            \"model-name\": \"ReglaAsignacionAutonomiasduales\",\r\n            \"dmn-context\": { montos, tipo }\r\n          }\r\n        }\r\n      }\r\n      var result = await this.post(url.URL_BPM_checketapa, data);\r\n      if (result.status === \"OK\") {\r\n        return result;\r\n      }\r\n\r\n    }\r\n    catch (err) {\r\n      console.error(\"api completedStatusTask:\", err);\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  async listCheckValidation(process, containerId = undefined) {\r\n    try {\r\n      /* \"values\":{\r\n          \"decision\":\"si\"  \r\n      } */\r\n      var data = {\r\n        \"containerId\": containerId !== undefined ? containerId : url.WORD_BPM_CONTAINERID,\r\n        //\"processId\": url.WORD_BPM_PROCESSID,\r\n        \"parametros\": {\r\n          \"values\": {\r\n            \"model-namespace\": url.URL_BPM_MODELNAMESPACE,\r\n            \"model-name\": \"estadoetapa\",\r\n            \"dmn-context\": { \"numeroetapa\": `${process}` }\r\n          }\r\n        }\r\n      }\r\n      var result = await this.post(url.URL_BPM_checketapa, data);\r\n      if (result.status === \"OK\") {\r\n        return result?.body?.result['dmn-evaluation-result']['dmn-context']?.resuletapa === 'true';\r\n      }\r\n\r\n    }\r\n    catch (err) {\r\n      console.error(\"api completedStatusTask:\", err);\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n\r\n  //reasignar tarea a otro usuario\r\n  async ChangeTaskUser(user, taskId, instanceId, containerId = undefined) {\r\n    const localStorageHelper = new LocalStorageHelper();\r\n    var credentials = localStorageHelper.get(opt.VARNAME_USRCREDENTIAL);\r\n    try {\r\n      var values = {\r\n        \"asignado\": user\r\n      };\r\n      await this.updatevariables(instanceId, values)\r\n\r\n      var data = {\r\n        \"containerId\": containerId !== undefined ? containerId : url.WORD_BPM_CONTAINERID,\r\n        \"taskId\": taskId,//\"10006\",         \r\n        \"parametros\": {\r\n          \"values\": {\r\n            \"users\": user,//\"ETECCAnlPrevencion1\" \r\n            \"asignado\": user\r\n          }\r\n        }\r\n      }\r\n      localStorageHelper.save(opt.VARNAME_USRCREDENTIAL, { usr: url.USRREASIGNACION, psw: url.PSWREASIGNACION, email: credentials.email });\r\n      var result = await this.post(url.URL_BPM_ChangeTaskUser, data);\r\n      if (result.status === \"OK\") {\r\n        return true;\r\n      }\r\n\r\n      values = {\r\n        \"asignado\": credentials.usr\r\n      };\r\n      await this.updatevariables(instanceId, values)\r\n\r\n    }\r\n    catch (err) { }\r\n    finally {\r\n      localStorageHelper.save(opt.VARNAME_USRCREDENTIAL, credentials);\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _regeneratorRuntime from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{translationHelpers}from'../../../helpers/translation-helper';import{Table,Card,CardBody,Button}from\"reactstrap\";import{BackendServices}from'../../../services';import{useLocation,useHistory}from'react-router-dom';import ModalNewHistoryDetail from'./ModalNewHistoryDetail';import SweetAlert from\"react-bootstrap-sweetalert\";import HeaderSections from\"../../Common/HeaderSections\";import{Link}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var History=function History(props){var _location$data;var location=useLocation();var _translationHelpers=translationHelpers('commercial_credit','common','translation'),_translationHelpers2=_slicedToArray(_translationHelpers,3),t=_translationHelpers2[0],c=_translationHelpers2[1],tr=_translationHelpers2[2];var api=new BackendServices();var editMode=props.editMode;/**\r\n   * All useState\r\n   */var _useState=useState(false),_useState2=_slicedToArray(_useState,2),displayModalNewHistoryDetail=_useState2[0],setDisplayModalNewHistoryDetail=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),dataRows=_useState4[0],setDataRows=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),totals=_useState6[0],setTotals=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),totalRow=_useState8[0],setTotalRow=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),proportions=_useState10[0],setProportions=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),proportionRow=_useState12[0],setProportionRow=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),confirm_alert=_useState14[0],setconfirm_alert=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),error_dlg=_useState16[0],seterror_dlg=_useState16[1];var _useState17=useState(null),_useState18=_slicedToArray(_useState17,2),bank=_useState18[0],setbank=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),successSave_dlg=_useState20[0],setsuccessSave_dlg=_useState20[1];var _useState21=useState(null),_useState22=_slicedToArray(_useState21,2),dataEdit=_useState22[0],setDataEdit=_useState22[1];var _useState23=useState(null),_useState24=_slicedToArray(_useState23,2),action=_useState24[0],setAction=_useState24[1];var _useState25=useState((_location$data=location.data)!==null&&_location$data!==void 0?_location$data:JSON.parse(sessionStorage.getItem('locationData'))),_useState26=_slicedToArray(_useState25,2),dataLocation=_useState26[0],setdataLocaton=_useState26[1];/**\r\n   * End All useState\r\n   */var headers=[t('# days',{days:30}),t('# days',{days:60}),t('# days',{days:90}),t('# days',{days:120}),t('# days',{days:150}),t('# days',{days:180}),t('# days',{days:210}),t('# days',{days:240}),t('# days',{days:270}),t('# days',{days:300}),t('# days',{days:330}),t('+# days',{days:331}),tr('Totals')];var data=[{name:'Banesco',data:[100,80,80,80,100,80,80,80,100,80,80,200,0]},{name:'Banesco',data:[100,80,80,80,100,80,80,80,100,80,80,200,0]}];React.useEffect(function(){getDataHistory();},[]);function calculateTotals(headers,data){var totals=new Array(headers.length);totals.fill(0,0,headers.length);headers.forEach(function(header,index){totals[index]=data.reduce(function(total,current){return total+current.data[index];},0);});return totals;}function calculateProportions(headers,data){var cols=new Array(headers.length);cols.fill(0,0,headers.length);return cols;}var dataHeaders=headers.map(function(header,index){return/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:header},\"header-\"+index);});function getDataHistory(){var _dataLocation$transac;api.consultarDetalleAntiguedad((_dataLocation$transac=dataLocation===null||dataLocation===void 0?void 0:dataLocation.transactionId)!==null&&_dataLocation$transac!==void 0?_dataLocation$transac:0,props.debtorId).then(function(data){var mapData=data===null||data===void 0?void 0:data.map(function($$){return{data:[].concat(_toConsumableArray(Object.entries($$.details).map(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];return value;})),[$$.total])};});var key=0;setDataRows(data===null||data===void 0?void 0:data.map(function(item,index){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:item.bank},index),Object.entries(item.details).map(function(_ref3){var _ref4=_slicedToArray(_ref3,2),data=_ref4[0],col=_ref4[1];return/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:col},\"col-\"+key++);}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:item.total}),!props.preview&&/*#__PURE__*/_jsxs(\"td\",{style:{textAlign:\"right\"},children:[/*#__PURE__*/_jsx(Button,{type:\"button\",color:\"link\",onClick:function onClick(resp){editData(item);},className:\"btn btn-link\",children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-border-color mdi-24px\"})}),/*#__PURE__*/_jsx(Button,{type:\"button\",color:\"link\",onClick:function onClick(resp){deleteData(item.bank);},className:\"btn btn-link\",children:/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-trash-can-outline mdi-24px\"})})]})]},'row-'+index);}));// Calculate total\nvar totals=calculateTotals(headers,mapData);setTotalRow(/*#__PURE__*/_jsxs(\"tr\",{className:\"table-info\",children:[/*#__PURE__*/_jsx(\"th\",{children:t(\"Total\").toLocaleUpperCase()}),totals.map(function(val,index){return/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:val},index);}),/*#__PURE__*/_jsx(\"th\",{})]}));// Calculate proportions\nvar proportions=calculateProportions(headers,mapData);setProportionRow(/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:t(\"Proportion\").toLocaleUpperCase()}),proportions.map(function(val,index){return/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:val},index);})]}));});}function toggleModalNewHistoryItem(){setDisplayModalNewHistoryDetail(!displayModalNewHistoryDetail);}function onSave(_x){return _onSave.apply(this,arguments);}function _onSave(){_onSave=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(values,location);values={details:values,transactId:dataLocation.transactionId,personId:props.debtorId,total:values.totals,percentage:values.totals/(headers.length-2),bank:values.bank};delete values.details.bank;delete values.details.totals;_context.t0=action=='edit';if(!_context.t0){_context.next=8;break;}_context.next=8;return api.actualizarDetalleAntiguedad(values).then(function(resp){if(resp.statusCode==\"500\"||undefined){seterror_dlg(true);}else{setsuccessSave_dlg(true);}}).catch(function(err){seterror_dlg(true);});case 8:_context.t1=action=='new';if(!_context.t1){_context.next=12;break;}_context.next=12;return api.nuevoDetalleAntiguedad(values).then(function(resp){if(resp.statusCode==\"500\"||undefined){seterror_dlg(true);}else{setsuccessSave_dlg(true);}}).catch(function(err){seterror_dlg(true);});case 12:getDataHistory();case 13:case\"end\":return _context.stop();}}},_callee);}));return _onSave.apply(this,arguments);}function editData(data){setDataEdit(data);toggleModalNewHistoryItem();setAction('edit');}function deleteData(bank){setbank(bank);setconfirm_alert(true);}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(HeaderSections,{title:\"History Details\",t:t}),/*#__PURE__*/_jsx(\"p\",{className:\"card-title-desc\"}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive mt-2\",children:/*#__PURE__*/_jsxs(Table,{className:\"table mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-light\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:t(\"Country / Client\")}),dataHeaders,!props.preview&&/*#__PURE__*/_jsx(\"th\",{children:editMode&&/*#__PURE__*/_jsxs(Link,{to:\"#\",className:\"float-end\",onClick:function onClick(){setAction('new');toggleModalNewHistoryItem();setDataEdit(null);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"mdi mdi-plus-box-multiple-outline mdi-24px\"}),t(\"\")]})})]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[dataRows,(dataRows===null||dataRows===void 0?void 0:dataRows.length)>0&&totalRow]})]})}),/*#__PURE__*/_jsx(ModalNewHistoryDetail,{dataEdit:dataEdit,setAction:setAction,isOpen:displayModalNewHistoryDetail,toggle:toggleModalNewHistoryItem,onSave:onSave}),confirm_alert?/*#__PURE__*/_jsx(SweetAlert,{title:t(\"Areyousure\"),warning:true,showCancel:true,confirmButtonText:t(\"Yesdeleteit\"),confirmBtnBsStyle:\"success\",cancelBtnBsStyle:\"danger\",onConfirm:function onConfirm(){var apiBack=new BackendServices();apiBack.eliminarDetalleAntiguedad(dataLocation.transactionId,props.debtorId,bank).then(function(resp){if(resp.statusCode==\"500\"||undefined){setconfirm_alert(false);seterror_dlg(true);}else{setconfirm_alert(false);setsuccessSave_dlg(true);}getDataHistory();}).catch(function(error){setconfirm_alert(false);seterror_dlg(true);});},onCancel:function onCancel(){return setconfirm_alert(false);},children:t(\"Youwontbeabletorevertthis\")}):null,successSave_dlg?/*#__PURE__*/_jsx(SweetAlert,{success:true,title:t(\"SuccessDialog\"),onConfirm:function onConfirm(){setsuccessSave_dlg(false);getDataHistory();},children:t(\"SuccessSaveMessage\")}):null,error_dlg?/*#__PURE__*/_jsx(SweetAlert,{error:true,title:t(\"ErrorDialog\"),onConfirm:function onConfirm(){seterror_dlg(false);getDataHistory();}}):null]});};History.defaultProps={editMode:false};export default History;","map":{"version":3,"sources":["D:/_PROJECTS/_SOAINT/JBPM/App/banescocreditoscomerciales/src/components/PropuestaCreditoComercial/financialSummary/History.js"],"names":["React","useEffect","useState","translationHelpers","Table","Card","CardBody","Button","BackendServices","useLocation","useHistory","ModalNewHistoryDetail","SweetAlert","HeaderSections","Link","History","props","location","t","c","tr","api","editMode","displayModalNewHistoryDetail","setDisplayModalNewHistoryDetail","dataRows","setDataRows","totals","setTotals","totalRow","setTotalRow","proportions","setProportions","proportionRow","setProportionRow","confirm_alert","setconfirm_alert","error_dlg","seterror_dlg","bank","setbank","successSave_dlg","setsuccessSave_dlg","dataEdit","setDataEdit","action","setAction","data","JSON","parse","sessionStorage","getItem","dataLocation","setdataLocaton","headers","days","name","getDataHistory","calculateTotals","Array","length","fill","forEach","header","index","reduce","total","current","calculateProportions","cols","dataHeaders","map","consultarDetalleAntiguedad","transactionId","debtorId","then","mapData","$$","Object","entries","details","key","value","item","col","preview","textAlign","resp","editData","deleteData","toLocaleUpperCase","val","toggleModalNewHistoryItem","onSave","values","console","log","transactId","personId","percentage","actualizarDetalleAntiguedad","statusCode","undefined","catch","err","nuevoDetalleAntiguedad","apiBack","eliminarDetalleAntiguedad","error","defaultProps"],"mappings":"isBAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CAEA,OAASC,kBAAT,KAAmC,qCAAnC,CAEA,OACEC,KADF,CAEEC,IAFF,CAGEC,QAHF,CAIEC,MAJF,KAKO,YALP,CAMA,OAASC,eAAT,KAAgC,mBAAhC,CACA,OAASC,WAAT,CAAsBC,UAAtB,KAAwC,kBAAxC,CACA,MAAOC,CAAAA,qBAAP,KAAkC,yBAAlC,CACA,MAAOC,CAAAA,UAAP,KAAuB,4BAAvB,CACA,MAAOC,CAAAA,cAAP,KAA2B,6BAA3B,CACA,OAASC,IAAT,KAAqB,kBAArB,C,6IAGA,GAAMC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,CAACC,KAAD,CAAW,oBACzB,GAAMC,CAAAA,QAAQ,CAAGR,WAAW,EAA5B,CAEA,wBAAmBN,kBAAkB,CAAC,mBAAD,CAAsB,QAAtB,CAAgC,aAAhC,CAArC,4DAAOe,CAAP,yBAAUC,CAAV,yBAAaC,EAAb,yBAEA,GAAMC,CAAAA,GAAG,CAAG,GAAIb,CAAAA,eAAJ,EAAZ,CAGA,GAAQc,CAAAA,QAAR,CAAqBN,KAArB,CAAQM,QAAR,CAEA;AACF;AACA,KACE,cAAwEpB,QAAQ,CAAC,KAAD,CAAhF,wCAAOqB,4BAAP,eAAqCC,+BAArC,eACA,eAAgCtB,QAAQ,CAAC,IAAD,CAAxC,yCAAOuB,QAAP,eAAiBC,WAAjB,eACA,eAA4BxB,QAAQ,CAAC,IAAD,CAApC,yCAAOyB,MAAP,eAAeC,SAAf,eACA,eAAgC1B,QAAQ,CAAC,IAAD,CAAxC,yCAAO2B,QAAP,eAAiBC,WAAjB,eACA,eAAsC5B,QAAQ,CAAC,IAAD,CAA9C,0CAAO6B,WAAP,gBAAoBC,cAApB,gBACA,gBAA0C9B,QAAQ,CAAC,IAAD,CAAlD,2CAAO+B,aAAP,gBAAsBC,gBAAtB,gBACA,gBAA0ChC,QAAQ,CAAC,KAAD,CAAlD,2CAAOiC,aAAP,gBAAsBC,gBAAtB,gBACA,gBAAkClC,QAAQ,CAAC,KAAD,CAA1C,2CAAOmC,SAAP,gBAAkBC,YAAlB,gBACA,gBAAwBpC,QAAQ,CAAC,IAAD,CAAhC,2CAAOqC,IAAP,gBAAaC,OAAb,gBACA,gBAA8CtC,QAAQ,CAAC,KAAD,CAAtD,2CAAOuC,eAAP,gBAAwBC,kBAAxB,gBACA,gBAAgCxC,QAAQ,CAAC,IAAD,CAAxC,2CAAOyC,QAAP,gBAAiBC,WAAjB,gBACA,gBAA4B1C,QAAQ,CAAC,IAAD,CAApC,2CAAO2C,MAAP,gBAAeC,SAAf,gBACA,gBAAuC5C,QAAQ,iBAACe,QAAQ,CAAC8B,IAAV,iDAAkBC,IAAI,CAACC,KAAL,CAAWC,cAAc,CAACC,OAAf,CAAuB,cAAvB,CAAX,CAAlB,CAA/C,2CAAOC,YAAP,gBAAqBC,cAArB,gBACA;AACF;AACA,KAEE,GAAMC,CAAAA,OAAO,CAAG,CACdpC,CAAC,CAAC,QAAD,CAAW,CAAEqC,IAAI,CAAE,EAAR,CAAX,CADa,CAEdrC,CAAC,CAAC,QAAD,CAAW,CAAEqC,IAAI,CAAE,EAAR,CAAX,CAFa,CAGdrC,CAAC,CAAC,QAAD,CAAW,CAAEqC,IAAI,CAAE,EAAR,CAAX,CAHa,CAIdrC,CAAC,CAAC,QAAD,CAAW,CAAEqC,IAAI,CAAE,GAAR,CAAX,CAJa,CAKdrC,CAAC,CAAC,QAAD,CAAW,CAAEqC,IAAI,CAAE,GAAR,CAAX,CALa,CAMdrC,CAAC,CAAC,QAAD,CAAW,CAAEqC,IAAI,CAAE,GAAR,CAAX,CANa,CAOdrC,CAAC,CAAC,QAAD,CAAW,CAAEqC,IAAI,CAAE,GAAR,CAAX,CAPa,CAQdrC,CAAC,CAAC,QAAD,CAAW,CAAEqC,IAAI,CAAE,GAAR,CAAX,CARa,CASdrC,CAAC,CAAC,QAAD,CAAW,CAAEqC,IAAI,CAAE,GAAR,CAAX,CATa,CAUdrC,CAAC,CAAC,QAAD,CAAW,CAAEqC,IAAI,CAAE,GAAR,CAAX,CAVa,CAWdrC,CAAC,CAAC,QAAD,CAAW,CAAEqC,IAAI,CAAE,GAAR,CAAX,CAXa,CAYdrC,CAAC,CAAC,SAAD,CAAY,CAAEqC,IAAI,CAAE,GAAR,CAAZ,CAZa,CAadnC,EAAE,CAAC,QAAD,CAbY,CAAhB,CAgBA,GAAM2B,CAAAA,IAAI,CAAG,CACX,CACES,IAAI,CAAE,SADR,CAEET,IAAI,CAAE,CAAC,GAAD,CAAM,EAAN,CAAU,EAAV,CAAc,EAAd,CAAkB,GAAlB,CAAuB,EAAvB,CAA2B,EAA3B,CAA+B,EAA/B,CAAmC,GAAnC,CAAwC,EAAxC,CAA4C,EAA5C,CAAgD,GAAhD,CAAqD,CAArD,CAFR,CADW,CAKX,CACES,IAAI,CAAE,SADR,CAEET,IAAI,CAAE,CAAC,GAAD,CAAM,EAAN,CAAU,EAAV,CAAc,EAAd,CAAkB,GAAlB,CAAuB,EAAvB,CAA2B,EAA3B,CAA+B,EAA/B,CAAmC,GAAnC,CAAwC,EAAxC,CAA4C,EAA5C,CAAgD,GAAhD,CAAqD,CAArD,CAFR,CALW,CAAb,CAWA/C,KAAK,CAACC,SAAN,CAAgB,UAAM,CACpBwD,cAAc,GACf,CAFD,CAEG,EAFH,EAIA,QAASC,CAAAA,eAAT,CAAyBJ,OAAzB,CAAkCP,IAAlC,CAAwC,CACtC,GAAMpB,CAAAA,MAAM,CAAG,GAAIgC,CAAAA,KAAJ,CAAUL,OAAO,CAACM,MAAlB,CAAf,CACAjC,MAAM,CAACkC,IAAP,CAAY,CAAZ,CAAe,CAAf,CAAkBP,OAAO,CAACM,MAA1B,EACAN,OAAO,CAACQ,OAAR,CAAgB,SAACC,MAAD,CAASC,KAAT,CAAmB,CACjCrC,MAAM,CAACqC,KAAD,CAAN,CAAgBjB,IAAI,CAACkB,MAAL,CAAY,SAACC,KAAD,CAAQC,OAAR,CAAoB,CAC9C,MAAOD,CAAAA,KAAK,CAAGC,OAAO,CAACpB,IAAR,CAAaiB,KAAb,CAAf,CACD,CAFe,CAEb,CAFa,CAAhB,CAGD,CAJD,EAKA,MAAOrC,CAAAA,MAAP,CACD,CAED,QAASyC,CAAAA,oBAAT,CAA8Bd,OAA9B,CAAuCP,IAAvC,CAA6C,CAC3C,GAAMsB,CAAAA,IAAI,CAAG,GAAIV,CAAAA,KAAJ,CAAUL,OAAO,CAACM,MAAlB,CAAb,CACAS,IAAI,CAACR,IAAL,CAAU,CAAV,CAAa,CAAb,CAAgBP,OAAO,CAACM,MAAxB,EACA,MAAOS,CAAAA,IAAP,CACD,CAED,GAAMC,CAAAA,WAAW,CAAGhB,OAAO,CAACiB,GAAR,CAAY,SAACR,MAAD,CAASC,KAAT,qBAC9B,WAA4B,SAAS,CAAC,UAAtC,UAAkDD,MAAlD,EAAS,UAAYC,KAArB,CAD8B,EAAZ,CAApB,CAIA,QAASP,CAAAA,cAAT,EAA0B,2BACxBpC,GAAG,CAACmD,0BAAJ,wBAA+BpB,YAA/B,SAA+BA,YAA/B,iBAA+BA,YAAY,CAAEqB,aAA7C,+DAA8D,CAA9D,CAAiEzD,KAAK,CAAC0D,QAAvE,EAAiFC,IAAjF,CAAsF,SAAC5B,IAAD,CAAU,CAE9F,GAAI6B,CAAAA,OAAO,CAAG7B,IAAH,SAAGA,IAAH,iBAAGA,IAAI,CAAEwB,GAAN,CAAU,SAAAM,EAAE,QAAK,CAAE9B,IAAI,8BAAM+B,MAAM,CAACC,OAAP,CAAeF,EAAE,CAACG,OAAlB,EAA2BT,GAA3B,CAA+B,gDAAEU,GAAF,UAAOC,KAAP,gBAAkBA,CAAAA,KAAlB,EAA/B,CAAN,GAA+DL,EAAE,CAACX,KAAlE,EAAN,CAAL,EAAZ,CAAd,CAEA,GAAIe,CAAAA,GAAG,CAAG,CAAV,CACAvD,WAAW,CAACqB,IAAD,SAACA,IAAD,iBAACA,IAAI,CAAEwB,GAAN,CAAU,SAACY,IAAD,CAAOnB,KAAP,qBACpB,mCACE,oBAAiBmB,IAAI,CAAC5C,IAAtB,EAASyB,KAAT,CADF,CAEGc,MAAM,CAACC,OAAP,CAAeI,IAAI,CAACH,OAApB,EAA6BT,GAA7B,CAAiC,kDAAExB,IAAF,UAAQqC,GAAR,6BAChC,WAAyB,SAAS,CAAC,UAAnC,UAA+CA,GAA/C,EAAS,OAASH,GAAG,EAArB,CADgC,EAAjC,CAFH,cAKE,WAAI,SAAS,CAAC,UAAd,UAA0BE,IAAI,CAACjB,KAA/B,EALF,CAMG,CAAClD,KAAK,CAACqE,OAAP,eAAkB,YAAI,KAAK,CAAE,CAAEC,SAAS,CAAE,OAAb,CAAX,wBACjB,KAAC,MAAD,EAAQ,IAAI,CAAC,QAAb,CAAsB,KAAK,CAAC,MAA5B,CAAmC,OAAO,CAAE,iBAACC,IAAD,CAAU,CACpDC,QAAQ,CAACL,IAAD,CAAR,CACD,CAFD,CAEG,SAAS,CAAC,cAFb,uBAE6B,UAAG,SAAS,CAAC,+BAAb,EAF7B,EADiB,cAIjB,KAAC,MAAD,EAAQ,IAAI,CAAC,QAAb,CAAsB,KAAK,CAAC,MAA5B,CAAmC,OAAO,CAAE,iBAACI,IAAD,CAAU,CACpDE,UAAU,CAACN,IAAI,CAAC5C,IAAN,CAAV,CACD,CAFD,CAEG,SAAS,CAAC,cAFb,uBAE6B,UAAG,SAAS,CAAC,oCAAb,EAF7B,EAJiB,GANrB,GAAS,OAASyB,KAAlB,CADoB,EAAV,CAAD,CAAX,CAiBA;AACA,GAAIrC,CAAAA,MAAM,CAAI+B,eAAe,CAACJ,OAAD,CAAUsB,OAAV,CAA7B,CACA9C,WAAW,cACT,YAAI,SAAS,CAAC,YAAd,wBACE,oBAAKZ,CAAC,CAAC,OAAD,CAAD,CAAWwE,iBAAX,EAAL,EADF,CAEG/D,MAAM,CAAC4C,GAAP,CAAW,SAACoB,GAAD,CAAM3B,KAAN,qBACV,WAAgB,SAAS,CAAC,UAA1B,UAAsC2B,GAAtC,EAAS3B,KAAT,CADU,EAAX,CAFH,cAKE,aALF,GADS,CAAX,CAUA;AACA,GAAIjC,CAAAA,WAAW,CAAIqC,oBAAoB,CAACd,OAAD,CAAUsB,OAAV,CAAvC,CACA1C,gBAAgB,cACd,mCACE,oBAAKhB,CAAC,CAAC,YAAD,CAAD,CAAgBwE,iBAAhB,EAAL,EADF,CAEG3D,WAAW,CAACwC,GAAZ,CAAgB,SAACoB,GAAD,CAAM3B,KAAN,qBACf,WAAgB,SAAS,CAAC,UAA1B,UAAsC2B,GAAtC,EAAS3B,KAAT,CADe,EAAhB,CAFH,GADc,CAAhB,CAQD,CA5CD,EA+CD,CAED,QAAS4B,CAAAA,yBAAT,EAAqC,CACnCpE,+BAA+B,CAAC,CAACD,4BAAF,CAA/B,CACD,CAtIwB,QAwIVsE,CAAAA,MAxIU,8HAwIzB,iBAAsBC,MAAtB,kHAEEC,OAAO,CAACC,GAAR,CAAYF,MAAZ,CAAoB7E,QAApB,EACA6E,MAAM,CAAG,CAAEd,OAAO,CAAEc,MAAX,CAAmBG,UAAU,CAAE7C,YAAY,CAACqB,aAA5C,CAA2DyB,QAAQ,CAAElF,KAAK,CAAC0D,QAA3E,CAAqFR,KAAK,CAAE4B,MAAM,CAACnE,MAAnG,CAA2GwE,UAAU,CAAGL,MAAM,CAACnE,MAAP,EAAiB2B,OAAO,CAACM,MAAR,CAAiB,CAAlC,CAAxH,CAA+JrB,IAAI,CAAEuD,MAAM,CAACvD,IAA5K,CAAT,CACA,MAAOuD,CAAAA,MAAM,CAACd,OAAP,CAAezC,IAAtB,CACA,MAAOuD,CAAAA,MAAM,CAACd,OAAP,CAAerD,MAAtB,CALF,YAMEkB,MAAM,EAAI,MANZ,+DAM4BxB,CAAAA,GAAG,CAAC+E,2BAAJ,CAAgCN,MAAhC,EAAwCnB,IAAxC,CAA6C,SAAAY,IAAI,CAAI,CAC7E,GAAIA,IAAI,CAACc,UAAL,EAAmB,KAAnB,EAA4BC,SAAhC,CAA2C,CACzChE,YAAY,CAAC,IAAD,CAAZ,CACD,CAFD,IAEO,CACLI,kBAAkB,CAAC,IAAD,CAAlB,CACD,CACF,CANyB,EAMvB6D,KANuB,CAMjB,SAAAC,GAAG,CAAI,CACdlE,YAAY,CAAC,IAAD,CAAZ,CACD,CARyB,CAN5B,oBAgBEO,MAAM,EAAI,KAhBZ,iEAgB2BxB,CAAAA,GAAG,CAACoF,sBAAJ,CAA2BX,MAA3B,EAAmCnB,IAAnC,CAAwC,SAAAY,IAAI,CAAI,CACvE,GAAIA,IAAI,CAACc,UAAL,EAAmB,KAAnB,EAA4BC,SAAhC,CAA2C,CACzChE,YAAY,CAAC,IAAD,CAAZ,CACD,CAFD,IAEO,CACLI,kBAAkB,CAAC,IAAD,CAAlB,CACD,CACF,CANwB,EAMtB6D,KANsB,CAMhB,SAAAC,GAAG,CAAI,CACdlE,YAAY,CAAC,IAAD,CAAZ,CACD,CARwB,CAhB3B,SA0BEmB,cAAc,GA1BhB,uDAxIyB,yCAqKzB,QAAS+B,CAAAA,QAAT,CAAkBzC,IAAlB,CAAwB,CACtBH,WAAW,CAACG,IAAD,CAAX,CACA6C,yBAAyB,GACzB9C,SAAS,CAAC,MAAD,CAAT,CACD,CAED,QAAS2C,CAAAA,UAAT,CAAoBlD,IAApB,CAA0B,CACxBC,OAAO,CAACD,IAAD,CAAP,CACAH,gBAAgB,CAAC,IAAD,CAAhB,CACD,CAED,mBACE,wCACE,KAAC,cAAD,EAAgB,KAAK,CAAC,iBAAtB,CAAwC,CAAC,CAAElB,CAA3C,EADF,cAEE,UAAG,SAAS,CAAC,iBAAb,EAFF,cAGE,YAAK,SAAS,CAAC,uBAAf,uBACE,MAAC,KAAD,EAAO,SAAS,CAAC,YAAjB,wBACE,cAAO,SAAS,CAAC,aAAjB,uBACE,mCACE,oBAAKA,CAAC,CAAC,kBAAD,CAAN,EADF,CAEGoD,WAFH,CAII,CAACtD,KAAK,CAACqE,OAAP,eAAkB,oBACf/D,QAAQ,eAAK,MAAC,IAAD,EAAM,EAAE,CAAC,GAAT,CAAa,SAAS,CAAC,WAAvB,CAAmC,OAAO,CAAE,kBAAM,CAAEwB,SAAS,CAAC,KAAD,CAAT,CAAkB8C,yBAAyB,GAAIhD,WAAW,CAAC,IAAD,CAAX,CAAoB,CAAvH,wBACZ,UAAG,SAAS,CAAC,4CAAb,EADY,CACmD1B,CAAC,CAAC,EAAD,CADpD,GADE,EAJtB,GADF,EADF,cAcE,yBACGO,QADH,CAEG,CAAAA,QAAQ,OAAR,EAAAA,QAAQ,SAAR,QAAAA,QAAQ,CAAEmC,MAAV,EAAmB,CAAnB,EAAwB/B,QAF3B,GAdF,GADF,EAHF,cAyBE,KAAC,qBAAD,EAAuB,QAAQ,CAAEc,QAAjC,CAA2C,SAAS,CAAEG,SAAtD,CAAiE,MAAM,CAAEvB,4BAAzE,CAAuG,MAAM,CAAEqE,yBAA/G,CAA0I,MAAM,CAAEC,MAAlJ,EAzBF,CA2BG1D,aAAa,cACZ,KAAC,UAAD,EACE,KAAK,CAAEjB,CAAC,CAAC,YAAD,CADV,CAEE,OAAO,KAFT,CAGE,UAAU,KAHZ,CAIE,iBAAiB,CAAEA,CAAC,CAAC,aAAD,CAJtB,CAKE,iBAAiB,CAAC,SALpB,CAME,gBAAgB,CAAC,QANnB,CAOE,SAAS,CAAE,oBAAM,CACf,GAAMwF,CAAAA,OAAO,CAAG,GAAIlG,CAAAA,eAAJ,EAAhB,CACAkG,OAAO,CAACC,yBAAR,CAAkCvD,YAAY,CAACqB,aAA/C,CAA8DzD,KAAK,CAAC0D,QAApE,CAA8EnC,IAA9E,EAAoFoC,IAApF,CAAyF,SAAAY,IAAI,CAAI,CAC/F,GAAIA,IAAI,CAACc,UAAL,EAAmB,KAAnB,EAA4BC,SAAhC,CAA2C,CACzClE,gBAAgB,CAAC,KAAD,CAAhB,CACAE,YAAY,CAAC,IAAD,CAAZ,CACD,CAHD,IAGO,CACLF,gBAAgB,CAAC,KAAD,CAAhB,CACAM,kBAAkB,CAAC,IAAD,CAAlB,CACD,CACDe,cAAc,GACf,CATD,EASG8C,KATH,CASS,SAAAK,KAAK,CAAI,CAChBxE,gBAAgB,CAAC,KAAD,CAAhB,CACAE,YAAY,CAAC,IAAD,CAAZ,CACD,CAZD,EAaD,CAtBH,CAuBE,QAAQ,CAAE,0BAAMF,CAAAA,gBAAgB,CAAC,KAAD,CAAtB,EAvBZ,UAyBGlB,CAAC,CAAC,2BAAD,CAzBJ,EADY,CA4BV,IAvDN,CAyDGuB,eAAe,cACd,KAAC,UAAD,EACE,OAAO,KADT,CAEE,KAAK,CAAEvB,CAAC,CAAC,eAAD,CAFV,CAGE,SAAS,CAAE,oBAAM,CACfwB,kBAAkB,CAAC,KAAD,CAAlB,CACAe,cAAc,GACf,CANH,UAQGvC,CAAC,CAAC,oBAAD,CARJ,EADc,CAWZ,IApEN,CAsEGmB,SAAS,cACR,KAAC,UAAD,EACE,KAAK,KADP,CAEE,KAAK,CAAEnB,CAAC,CAAC,aAAD,CAFV,CAGE,SAAS,CAAE,oBAAM,CACfoB,YAAY,CAAC,KAAD,CAAZ,CACAmB,cAAc,GACf,CANH,EADQ,CAWN,IAjFN,GADF,CAqFD,CArQD,CA+QA1C,OAAO,CAAC8F,YAAR,CAAuB,CACrBvF,QAAQ,CAAE,KADW,CAAvB,CAKA,cAAeP,CAAAA,OAAf","sourcesContent":["import React, { useEffect, useState } from \"react\"\r\nimport PropTypes from 'prop-types';\r\nimport { translationHelpers } from '../../../helpers/translation-helper';\r\n\r\nimport {\r\n  Table,\r\n  Card,\r\n  CardBody,\r\n  Button\r\n} from \"reactstrap\"\r\nimport { BackendServices } from '../../../services';\r\nimport { useLocation, useHistory } from 'react-router-dom'\r\nimport ModalNewHistoryDetail from './ModalNewHistoryDetail';\r\nimport SweetAlert from \"react-bootstrap-sweetalert\";\r\nimport HeaderSections from \"../../Common/HeaderSections\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\n\r\nconst History = (props) => {\r\n  const location = useLocation();\r\n\r\n  const [t, c, tr] = translationHelpers('commercial_credit', 'common', 'translation');\r\n\r\n  const api = new BackendServices();\r\n\r\n\r\n  const { editMode } = props;\r\n\r\n  /**\r\n   * All useState\r\n   */\r\n  const [displayModalNewHistoryDetail, setDisplayModalNewHistoryDetail] = useState(false);\r\n  const [dataRows, setDataRows] = useState(null);\r\n  const [totals, setTotals] = useState(null);\r\n  const [totalRow, setTotalRow] = useState(null);\r\n  const [proportions, setProportions] = useState(null);\r\n  const [proportionRow, setProportionRow] = useState(null);\r\n  const [confirm_alert, setconfirm_alert] = useState(false);\r\n  const [error_dlg, seterror_dlg] = useState(false);\r\n  const [bank, setbank] = useState(null);\r\n  const [successSave_dlg, setsuccessSave_dlg] = useState(false);\r\n  const [dataEdit, setDataEdit] = useState(null);\r\n  const [action, setAction] = useState(null);\r\n  const [dataLocation, setdataLocaton] = useState(location.data ?? JSON.parse(sessionStorage.getItem('locationData')));\r\n  /**\r\n   * End All useState\r\n   */\r\n\r\n  const headers = [\r\n    t('# days', { days: 30 }),\r\n    t('# days', { days: 60 }),\r\n    t('# days', { days: 90 }),\r\n    t('# days', { days: 120 }),\r\n    t('# days', { days: 150 }),\r\n    t('# days', { days: 180 }),\r\n    t('# days', { days: 210 }),\r\n    t('# days', { days: 240 }),\r\n    t('# days', { days: 270 }),\r\n    t('# days', { days: 300 }),\r\n    t('# days', { days: 330 }),\r\n    t('+# days', { days: 331 }),\r\n    tr('Totals')\r\n  ]\r\n\r\n  const data = [\r\n    {\r\n      name: 'Banesco',\r\n      data: [100, 80, 80, 80, 100, 80, 80, 80, 100, 80, 80, 200, 0]\r\n    },\r\n    {\r\n      name: 'Banesco',\r\n      data: [100, 80, 80, 80, 100, 80, 80, 80, 100, 80, 80, 200, 0]\r\n    }\r\n  ]\r\n\r\n  React.useEffect(() => {\r\n    getDataHistory();\r\n  }, []);\r\n\r\n  function calculateTotals(headers, data) {\r\n    const totals = new Array(headers.length);\r\n    totals.fill(0, 0, headers.length);\r\n    headers.forEach((header, index) => {\r\n      totals[index] = data.reduce((total, current) => {\r\n        return total + current.data[index];\r\n      }, 0);\r\n    });\r\n    return totals;\r\n  }\r\n\r\n  function calculateProportions(headers, data) {\r\n    const cols = new Array(headers.length);\r\n    cols.fill(0, 0, headers.length);\r\n    return cols;\r\n  }\r\n\r\n  const dataHeaders = headers.map((header, index) => (\r\n    <th key={\"header-\" + index} className=\"text-end\">{header}</th>\r\n  ));\r\n\r\n  function getDataHistory() {\r\n    api.consultarDetalleAntiguedad(dataLocation?.transactionId ?? 0, props.debtorId).then((data) => {\r\n\r\n      let mapData = data?.map($$ => ({ data: [...Object.entries($$.details).map(([key, value]) => value), $$.total] }));\r\n\r\n      let key = 0;\r\n      setDataRows(data?.map((item, index) => (\r\n        <tr key={'row-' + index}>\r\n          <td key={index}>{item.bank}</td>\r\n          {Object.entries(item.details).map(([data, col]) => (\r\n            <td key={\"col-\" + key++} className=\"text-end\">{col}</td>\r\n          ))}\r\n          <td className=\"text-end\">{item.total}</td>\r\n          {!props.preview && <td style={{ textAlign: \"right\" }}>\r\n            <Button type=\"button\" color=\"link\" onClick={(resp) => {\r\n              editData(item)\r\n            }} className=\"btn btn-link\" ><i className=\"mdi mdi-border-color mdi-24px\"></i></Button>\r\n            <Button type=\"button\" color=\"link\" onClick={(resp) => {\r\n              deleteData(item.bank)\r\n            }} className=\"btn btn-link\" ><i className=\"mdi mdi-trash-can-outline mdi-24px\"></i></Button>\r\n          </td>}\r\n        </tr>)\r\n      ));\r\n      // Calculate total\r\n      let totals = (calculateTotals(headers, mapData));\r\n      setTotalRow(\r\n        <tr className=\"table-info\">\r\n          <th>{t(\"Total\").toLocaleUpperCase()}</th>\r\n          {totals.map((val, index) => (\r\n            <th key={index} className=\"text-end\">{val}</th>\r\n          ))}\r\n          <th></th>\r\n        </tr>\r\n      );\r\n\r\n      // Calculate proportions\r\n      let proportions = (calculateProportions(headers, mapData));\r\n      setProportionRow(\r\n        <tr>\r\n          <td>{t(\"Proportion\").toLocaleUpperCase()}</td>\r\n          {proportions.map((val, index) => (\r\n            <td key={index} className=\"text-end\">{val}</td>\r\n          ))}\r\n        </tr>\r\n      );\r\n    })\r\n\r\n\r\n  }\r\n\r\n  function toggleModalNewHistoryItem() {\r\n    setDisplayModalNewHistoryDetail(!displayModalNewHistoryDetail);\r\n  }\r\n\r\n  async function onSave(values) {\r\n\r\n    console.log(values, location);\r\n    values = { details: values, transactId: dataLocation.transactionId, personId: props.debtorId, total: values.totals, percentage: (values.totals / (headers.length - 2)), bank: values.bank }\r\n    delete values.details.bank\r\n    delete values.details.totals\r\n    action == 'edit' && await api.actualizarDetalleAntiguedad(values).then(resp => {\r\n      if (resp.statusCode == \"500\" || undefined) {\r\n        seterror_dlg(true)\r\n      } else {\r\n        setsuccessSave_dlg(true)\r\n      }\r\n    }).catch(err => {\r\n      seterror_dlg(true)\r\n    });\r\n\r\n    action == 'new' && await api.nuevoDetalleAntiguedad(values).then(resp => {\r\n      if (resp.statusCode == \"500\" || undefined) {\r\n        seterror_dlg(true)\r\n      } else {\r\n        setsuccessSave_dlg(true)\r\n      }\r\n    }).catch(err => {\r\n      seterror_dlg(true)\r\n    });\r\n\r\n    getDataHistory();\r\n  }\r\n\r\n  function editData(data) {\r\n    setDataEdit(data);\r\n    toggleModalNewHistoryItem();\r\n    setAction('edit');\r\n  }\r\n\r\n  function deleteData(bank) {\r\n    setbank(bank);\r\n    setconfirm_alert(true);\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <HeaderSections title=\"History Details\" t={t}></HeaderSections>\r\n      <p className=\"card-title-desc\"></p>\r\n      <div className=\"table-responsive mt-2\">\r\n        <Table className=\"table mb-0\">\r\n          <thead className=\"table-light\">\r\n            <tr>\r\n              <th>{t(\"Country / Client\")}</th>\r\n              {dataHeaders}\r\n              {\r\n                !props.preview && <th>\r\n                  {editMode && (<Link to=\"#\" className=\"float-end\" onClick={() => { setAction('new'); toggleModalNewHistoryItem(); setDataEdit(null); }}>\r\n                    <i className=\"mdi mdi-plus-box-multiple-outline mdi-24px\"></i>{t(\"\")}\r\n                  </Link>)}\r\n                </th>\r\n              }\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {dataRows}\r\n            {dataRows?.length > 0 && totalRow}\r\n            {/* {proportionRow} */}\r\n          </tbody>\r\n        </Table>\r\n      </div>\r\n      <ModalNewHistoryDetail dataEdit={dataEdit} setAction={setAction} isOpen={displayModalNewHistoryDetail} toggle={toggleModalNewHistoryItem} onSave={onSave} />\r\n\r\n      {confirm_alert ? (\r\n        <SweetAlert\r\n          title={t(\"Areyousure\")}\r\n          warning\r\n          showCancel\r\n          confirmButtonText={t(\"Yesdeleteit\")}\r\n          confirmBtnBsStyle=\"success\"\r\n          cancelBtnBsStyle=\"danger\"\r\n          onConfirm={() => {\r\n            const apiBack = new BackendServices();\r\n            apiBack.eliminarDetalleAntiguedad(dataLocation.transactionId, props.debtorId, bank).then(resp => {\r\n              if (resp.statusCode == \"500\" || undefined) {\r\n                setconfirm_alert(false)\r\n                seterror_dlg(true)\r\n              } else {\r\n                setconfirm_alert(false)\r\n                setsuccessSave_dlg(true)\r\n              }\r\n              getDataHistory();\r\n            }).catch(error => {\r\n              setconfirm_alert(false)\r\n              seterror_dlg(true)\r\n            })\r\n          }}\r\n          onCancel={() => setconfirm_alert(false)}\r\n        >\r\n          {t(\"Youwontbeabletorevertthis\")}\r\n        </SweetAlert>\r\n      ) : null}\r\n\r\n      {successSave_dlg ? (\r\n        <SweetAlert\r\n          success\r\n          title={t(\"SuccessDialog\")}\r\n          onConfirm={() => {\r\n            setsuccessSave_dlg(false)\r\n            getDataHistory();\r\n          }}\r\n        >\r\n          {t(\"SuccessSaveMessage\")}\r\n        </SweetAlert>\r\n      ) : null}\r\n\r\n      {error_dlg ? (\r\n        <SweetAlert\r\n          error\r\n          title={t(\"ErrorDialog\")}\r\n          onConfirm={() => {\r\n            seterror_dlg(false)\r\n            getDataHistory();\r\n          }}\r\n        >\r\n          { }\r\n        </SweetAlert>\r\n      ) : null}\r\n    </>\r\n  );\r\n};\r\n\r\nHistory.propTypes = {\r\n  title: PropTypes.string,\r\n  headers: PropTypes.array.isRequired,\r\n  data: PropTypes.array.isRequired,\r\n  editMode: PropTypes.bool,\r\n  addHistoryDetail: PropTypes.func\r\n};\r\n\r\nHistory.defaultProps = {\r\n  editMode: false\r\n};\r\n\r\n\r\nexport default History;\r\n"]},"metadata":{},"sourceType":"module"}